(()=>{var exports={};exports.id=974,exports.ids=[974],exports.modules={40:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"options":{"go_package":"google.golang.org/protobuf/types/descriptorpb","java_package":"com.google.protobuf","java_outer_classname":"DescriptorProtos","csharp_namespace":"Google.Protobuf.Reflection","objc_class_prefix":"GPB","cc_enable_arenas":true,"optimize_for":"SPEED"},"nested":{"FileDescriptorSet":{"edition":"proto2","fields":{"file":{"rule":"repeated","type":"FileDescriptorProto","id":1}},"extensions":[[536000000,536000000]]},"Edition":{"edition":"proto2","values":{"EDITION_UNKNOWN":0,"EDITION_LEGACY":900,"EDITION_PROTO2":998,"EDITION_PROTO3":999,"EDITION_2023":1000,"EDITION_2024":1001,"EDITION_1_TEST_ONLY":1,"EDITION_2_TEST_ONLY":2,"EDITION_99997_TEST_ONLY":99997,"EDITION_99998_TEST_ONLY":99998,"EDITION_99999_TEST_ONLY":99999,"EDITION_MAX":2147483647}},"FileDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"package":{"type":"string","id":2},"dependency":{"rule":"repeated","type":"string","id":3},"publicDependency":{"rule":"repeated","type":"int32","id":10},"weakDependency":{"rule":"repeated","type":"int32","id":11},"optionDependency":{"rule":"repeated","type":"string","id":15},"messageType":{"rule":"repeated","type":"DescriptorProto","id":4},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":5},"service":{"rule":"repeated","type":"ServiceDescriptorProto","id":6},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":7},"options":{"type":"FileOptions","id":8},"sourceCodeInfo":{"type":"SourceCodeInfo","id":9},"syntax":{"type":"string","id":12},"edition":{"type":"Edition","id":14}}},"DescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"field":{"rule":"repeated","type":"FieldDescriptorProto","id":2},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":6},"nestedType":{"rule":"repeated","type":"DescriptorProto","id":3},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":4},"extensionRange":{"rule":"repeated","type":"ExtensionRange","id":5},"oneofDecl":{"rule":"repeated","type":"OneofDescriptorProto","id":8},"options":{"type":"MessageOptions","id":7},"reservedRange":{"rule":"repeated","type":"ReservedRange","id":9},"reservedName":{"rule":"repeated","type":"string","id":10},"visibility":{"type":"SymbolVisibility","id":11}},"nested":{"ExtensionRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2},"options":{"type":"ExtensionRangeOptions","id":3}}},"ReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"ExtensionRangeOptions":{"edition":"proto2","fields":{"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999},"declaration":{"rule":"repeated","type":"Declaration","id":2,"options":{"retention":"RETENTION_SOURCE"}},"features":{"type":"FeatureSet","id":50},"verification":{"type":"VerificationState","id":3,"options":{"default":"UNVERIFIED","retention":"RETENTION_SOURCE"}}},"extensions":[[1000,536870911]],"nested":{"Declaration":{"fields":{"number":{"type":"int32","id":1},"fullName":{"type":"string","id":2},"type":{"type":"string","id":3},"reserved":{"type":"bool","id":5},"repeated":{"type":"bool","id":6}},"reserved":[[4,4]]},"VerificationState":{"values":{"DECLARATION":0,"UNVERIFIED":1}}}},"FieldDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":3},"label":{"type":"Label","id":4},"type":{"type":"Type","id":5},"typeName":{"type":"string","id":6},"extendee":{"type":"string","id":2},"defaultValue":{"type":"string","id":7},"oneofIndex":{"type":"int32","id":9},"jsonName":{"type":"string","id":10},"options":{"type":"FieldOptions","id":8},"proto3Optional":{"type":"bool","id":17}},"nested":{"Type":{"values":{"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Label":{"values":{"LABEL_OPTIONAL":1,"LABEL_REPEATED":3,"LABEL_REQUIRED":2}}}},"OneofDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"options":{"type":"OneofOptions","id":2}}},"EnumDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"value":{"rule":"repeated","type":"EnumValueDescriptorProto","id":2},"options":{"type":"EnumOptions","id":3},"reservedRange":{"rule":"repeated","type":"EnumReservedRange","id":4},"reservedName":{"rule":"repeated","type":"string","id":5},"visibility":{"type":"SymbolVisibility","id":6}},"nested":{"EnumReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"EnumValueDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"type":"EnumValueOptions","id":3}}},"ServiceDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"method":{"rule":"repeated","type":"MethodDescriptorProto","id":2},"options":{"type":"ServiceOptions","id":3}}},"MethodDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"inputType":{"type":"string","id":2},"outputType":{"type":"string","id":3},"options":{"type":"MethodOptions","id":4},"clientStreaming":{"type":"bool","id":5},"serverStreaming":{"type":"bool","id":6}}},"FileOptions":{"edition":"proto2","fields":{"javaPackage":{"type":"string","id":1},"javaOuterClassname":{"type":"string","id":8},"javaMultipleFiles":{"type":"bool","id":10},"javaGenerateEqualsAndHash":{"type":"bool","id":20,"options":{"deprecated":true}},"javaStringCheckUtf8":{"type":"bool","id":27},"optimizeFor":{"type":"OptimizeMode","id":9,"options":{"default":"SPEED"}},"goPackage":{"type":"string","id":11},"ccGenericServices":{"type":"bool","id":16},"javaGenericServices":{"type":"bool","id":17},"pyGenericServices":{"type":"bool","id":18},"deprecated":{"type":"bool","id":23},"ccEnableArenas":{"type":"bool","id":31,"options":{"default":true}},"objcClassPrefix":{"type":"string","id":36},"csharpNamespace":{"type":"string","id":37},"swiftPrefix":{"type":"string","id":39},"phpClassPrefix":{"type":"string","id":40},"phpNamespace":{"type":"string","id":41},"phpMetadataNamespace":{"type":"string","id":44},"rubyPackage":{"type":"string","id":45},"features":{"type":"FeatureSet","id":50},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[42,42],"php_generic_services",[38,38]],"nested":{"OptimizeMode":{"values":{"SPEED":1,"CODE_SIZE":2,"LITE_RUNTIME":3}}}},"MessageOptions":{"edition":"proto2","fields":{"messageSetWireFormat":{"type":"bool","id":1},"noStandardDescriptorAccessor":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"mapEntry":{"type":"bool","id":7},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":11,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":12},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[5,5],[6,6],[8,8],[9,9]]},"FieldOptions":{"edition":"proto2","fields":{"ctype":{"type":"CType","id":1,"options":{"default":"STRING"}},"packed":{"type":"bool","id":2},"jstype":{"type":"JSType","id":6,"options":{"default":"JS_NORMAL"}},"lazy":{"type":"bool","id":5},"unverifiedLazy":{"type":"bool","id":15},"deprecated":{"type":"bool","id":3},"weak":{"type":"bool","id":10,"options":{"deprecated":true}},"debugRedact":{"type":"bool","id":16},"retention":{"type":"OptionRetention","id":17},"targets":{"rule":"repeated","type":"OptionTargetType","id":19},"editionDefaults":{"rule":"repeated","type":"EditionDefault","id":20},"features":{"type":"FeatureSet","id":21},"featureSupport":{"type":"FeatureSupport","id":22},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[18,18]],"nested":{"CType":{"values":{"STRING":0,"CORD":1,"STRING_PIECE":2}},"JSType":{"values":{"JS_NORMAL":0,"JS_STRING":1,"JS_NUMBER":2}},"OptionRetention":{"values":{"RETENTION_UNKNOWN":0,"RETENTION_RUNTIME":1,"RETENTION_SOURCE":2}},"OptionTargetType":{"values":{"TARGET_TYPE_UNKNOWN":0,"TARGET_TYPE_FILE":1,"TARGET_TYPE_EXTENSION_RANGE":2,"TARGET_TYPE_MESSAGE":3,"TARGET_TYPE_FIELD":4,"TARGET_TYPE_ONEOF":5,"TARGET_TYPE_ENUM":6,"TARGET_TYPE_ENUM_ENTRY":7,"TARGET_TYPE_SERVICE":8,"TARGET_TYPE_METHOD":9}},"EditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"value":{"type":"string","id":2}}},"FeatureSupport":{"fields":{"editionIntroduced":{"type":"Edition","id":1},"editionDeprecated":{"type":"Edition","id":2},"deprecationWarning":{"type":"string","id":3},"editionRemoved":{"type":"Edition","id":4}}}}},"OneofOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":1},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumOptions":{"edition":"proto2","fields":{"allowAlias":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":6,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":7},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[5,5]]},"EnumValueOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":1},"features":{"type":"FeatureSet","id":2},"debugRedact":{"type":"bool","id":3},"featureSupport":{"type":"FieldOptions.FeatureSupport","id":4},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"ServiceOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":34},"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"MethodOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":33},"idempotencyLevel":{"type":"IdempotencyLevel","id":34,"options":{"default":"IDEMPOTENCY_UNKNOWN"}},"features":{"type":"FeatureSet","id":35},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"nested":{"IdempotencyLevel":{"values":{"IDEMPOTENCY_UNKNOWN":0,"NO_SIDE_EFFECTS":1,"IDEMPOTENT":2}}}},"UninterpretedOption":{"edition":"proto2","fields":{"name":{"rule":"repeated","type":"NamePart","id":2},"identifierValue":{"type":"string","id":3},"positiveIntValue":{"type":"uint64","id":4},"negativeIntValue":{"type":"int64","id":5},"doubleValue":{"type":"double","id":6},"stringValue":{"type":"bytes","id":7},"aggregateValue":{"type":"string","id":8}},"nested":{"NamePart":{"fields":{"namePart":{"rule":"required","type":"string","id":1},"isExtension":{"rule":"required","type":"bool","id":2}}}}},"FeatureSet":{"edition":"proto2","fields":{"fieldPresence":{"type":"FieldPresence","id":1,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_2023","edition_defaults.value":"EXPLICIT"}},"enumType":{"type":"EnumType","id":2,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"OPEN"}},"repeatedFieldEncoding":{"type":"RepeatedFieldEncoding","id":3,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"PACKED"}},"utf8Validation":{"type":"Utf8Validation","id":4,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"VERIFY"}},"messageEncoding":{"type":"MessageEncoding","id":5,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_LEGACY","edition_defaults.value":"LENGTH_PREFIXED"}},"jsonFormat":{"type":"JsonFormat","id":6,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"ALLOW"}},"enforceNamingStyle":{"type":"EnforceNamingStyle","id":7,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_METHOD","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"STYLE2024"}},"defaultSymbolVisibility":{"type":"VisibilityFeature.DefaultSymbolVisibility","id":8,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"EXPORT_TOP_LEVEL"}}},"extensions":[[1000,9994],[9995,9999],[10000,10000]],"reserved":[[999,999]],"nested":{"FieldPresence":{"values":{"FIELD_PRESENCE_UNKNOWN":0,"EXPLICIT":1,"IMPLICIT":2,"LEGACY_REQUIRED":3}},"EnumType":{"values":{"ENUM_TYPE_UNKNOWN":0,"OPEN":1,"CLOSED":2}},"RepeatedFieldEncoding":{"values":{"REPEATED_FIELD_ENCODING_UNKNOWN":0,"PACKED":1,"EXPANDED":2}},"Utf8Validation":{"values":{"UTF8_VALIDATION_UNKNOWN":0,"VERIFY":2,"NONE":3}},"MessageEncoding":{"values":{"MESSAGE_ENCODING_UNKNOWN":0,"LENGTH_PREFIXED":1,"DELIMITED":2}},"JsonFormat":{"values":{"JSON_FORMAT_UNKNOWN":0,"ALLOW":1,"LEGACY_BEST_EFFORT":2}},"EnforceNamingStyle":{"values":{"ENFORCE_NAMING_STYLE_UNKNOWN":0,"STYLE2024":1,"STYLE_LEGACY":2}},"VisibilityFeature":{"fields":{},"reserved":[[1,536870911]],"nested":{"DefaultSymbolVisibility":{"values":{"DEFAULT_SYMBOL_VISIBILITY_UNKNOWN":0,"EXPORT_ALL":1,"EXPORT_TOP_LEVEL":2,"LOCAL_ALL":3,"STRICT":4}}}}}},"FeatureSetDefaults":{"edition":"proto2","fields":{"defaults":{"rule":"repeated","type":"FeatureSetEditionDefault","id":1},"minimumEdition":{"type":"Edition","id":4},"maximumEdition":{"type":"Edition","id":5}},"nested":{"FeatureSetEditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"overridableFeatures":{"type":"FeatureSet","id":4},"fixedFeatures":{"type":"FeatureSet","id":5}},"reserved":[[1,1],[2,2],"features"]}}},"SourceCodeInfo":{"edition":"proto2","fields":{"location":{"rule":"repeated","type":"Location","id":1}},"extensions":[[536000000,536000000]],"nested":{"Location":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"span":{"rule":"repeated","type":"int32","id":2,"options":{"packed":true}},"leadingComments":{"type":"string","id":3},"trailingComments":{"type":"string","id":4},"leadingDetachedComments":{"rule":"repeated","type":"string","id":6}}}}},"GeneratedCodeInfo":{"edition":"proto2","fields":{"annotation":{"rule":"repeated","type":"Annotation","id":1}},"nested":{"Annotation":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"sourceFile":{"type":"string","id":2},"begin":{"type":"int32","id":3},"end":{"type":"int32","id":4},"semantic":{"type":"Semantic","id":5}},"nested":{"Semantic":{"values":{"NONE":0,"SET":1,"ALIAS":2}}}}}},"SymbolVisibility":{"edition":"proto2","values":{"VISIBILITY_UNSET":0,"VISIBILITY_LOCAL":1,"VISIBILITY_EXPORT":2}}}}}}}}')},100:(e,t,r)=>{Promise.resolve().then(r.bind(r,3112))},155:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isDuration=t.durationToMs=t.msToDuration=void 0,t.msToDuration=function(e){return{seconds:e/1e3|0,nanos:e%1e3*1e6|0}},t.durationToMs=function(e){return 1e3*e.seconds+e.nanos/1e6|0},t.isDuration=function(e){return"number"==typeof e.seconds&&"number"==typeof e.nanos}},158:e=>{"use strict";e.exports=d;var t=/[\s{}=;:[\],'"()<>]/g,r=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,n=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,i=/^ *[*/]+ */,s=/^\s*\*?\/*/,a=/\n/g,o=/\s/,l=/\\(.?)/g,c={0:"\0",r:"\r",n:"\n",t:"	"};function u(e){return e.replace(l,function(e,t){switch(t){case"\\":case"":return t;default:return c[t]||""}})}function d(e,l){e=e.toString();var c=0,d=e.length,h=1,p=0,f={},m=[],g=null;function y(e){return Error("illegal "+e+" (line "+h+")")}function v(){var t="'"===g?n:r;t.lastIndex=c-1;var i=t.exec(e);if(!i)throw y("string");return c=t.lastIndex,C(g),g=null,u(i[1])}function b(t){return e.charAt(t)}function S(t,r,n){var o,c={type:e.charAt(t++),lineEmpty:!1,leading:n},u=t-(l?2:3);do if(--u<0||"\n"===(o=e.charAt(u))){c.lineEmpty=!0;break}while(" "===o||"	"===o);for(var d=e.substring(t,r).split(a),m=0;m<d.length;++m)d[m]=d[m].replace(l?s:i,"").trim();c.text=d.join("\n").trim(),f[h]=c,p=h}function T(t){var r=E(t),n=e.substring(t,r);return/^\s*\/\//.test(n)}function E(e){for(var t=e;t<d&&"\n"!==b(t);)t++;return t}function w(){if(m.length>0)return m.shift();if(g)return v();var r,n,i,s,a,u=0===c;do{if(c===d)return null;for(r=!1;o.test(i=b(c));)if("\n"===i&&(u=!0,++h),++c===d)return null;if("/"===b(c)){if(++c===d)throw y("comment");if("/"===b(c))if(l){if(s=c,a=!1,T(c-1)){a=!0;do if((c=E(c))===d||(c++,!u))break;while(T(c))}else c=Math.min(d,E(c)+1);a&&(S(s,c,u),u=!0),h++,r=!0}else{for(a="/"===b(s=c+1);"\n"!==b(++c);)if(c===d)return null;++c,a&&(S(s,c-1,u),u=!0),++h,r=!0}else{if("*"!==(i=b(c)))return"/";s=c+1,a=l||"*"===b(s);do{if("\n"===i&&++h,++c===d)throw y("comment");n=i,i=b(c)}while("*"!==n||"/"!==i);++c,a&&(S(s,c-2,u),u=!0),r=!0}}}while(r);var p=c;if(t.lastIndex=0,!t.test(b(p++)))for(;p<d&&!t.test(b(p));)++p;var f=e.substring(c,c=p);return('"'===f||"'"===f)&&(g=f),f}function C(e){m.push(e)}function _(){if(!m.length){var e=w();if(null===e)return null;C(e)}return m[0]}function I(e,t){var r=_();if(r===e)return w(),!0;if(!t)throw y("token '"+r+"', '"+e+"' expected");return!1}function x(e){var t,r=null;return void 0===e?(t=f[h-1],delete f[h-1],t&&(l||"*"===t.type||t.lineEmpty)&&(r=t.leading?t.text:null)):(p<e&&_(),t=f[e],delete f[e],t&&!t.lineEmpty&&(l||"/"===t.type)&&(r=t.leading?null:t.text)),r}return Object.defineProperty({next:w,peek:_,push:C,skip:I,cmnt:x},"line",{get:function(){return h}})}d.unescape=u},300:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;let n=r(9123),i=r(3232),s=r(920),a=r(3122),o=r(9978),l=r(441),c=Symbol(),u=Symbol(),d=Symbol(),h=Symbol();function p(e){return"function"==typeof e}function f(e){return e.stack.split("\n").slice(1).join("\n")}class m{constructor(e,t,r={}){var n,s;if(r=Object.assign({},r),this[u]=null!=(n=r.interceptors)?n:[],delete r.interceptors,this[d]=null!=(s=r.interceptor_providers)?s:[],delete r.interceptor_providers,this[u].length>0&&this[d].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[h]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[c]=r.channelOverride;else if(r.channelFactoryOverride){let n=r.channelFactoryOverride;delete r.channelFactoryOverride,this[c]=n(e,t,r)}else this[c]=new i.ChannelImplementation(e,t,r)}close(){this[c].close()}getChannel(){return this[c]}waitForReady(e,t){let r=n=>{let i;if(n)return void t(Error("Failed to connect before the deadline"));try{i=this[c].getConnectivityState(!0)}catch(e){t(Error("The channel has been closed"));return}if(i===s.ConnectivityState.READY)t();else try{this[c].watchConnectivityState(i,e,r)}catch(e){t(Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(p(e))return{metadata:new o.Metadata,options:{},callback:e};if(p(t))if(e instanceof o.Metadata)return{metadata:e,options:{},callback:t};else return{metadata:new o.Metadata,options:e,callback:t};if(!(e instanceof o.Metadata&&t instanceof Object&&p(r)))throw Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,p){var m,g;let y=this.checkOptionalUnaryResponseArguments(s,o,p),v={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},b={argument:i,metadata:y.metadata,call:new n.ClientUnaryCallImpl,channel:this[c],methodDefinition:v,callOptions:y.options,callback:y.callback};this[h]&&(b=this[h](b));let S=b.call,T={clientInterceptors:this[u],clientInterceptorProviders:this[d],callInterceptors:null!=(m=b.callOptions.interceptors)?m:[],callInterceptorProviders:null!=(g=b.callOptions.interceptor_providers)?g:[]},E=(0,l.getInterceptingCall)(T,b.methodDefinition,b.callOptions,b.channel);S.call=E;let w=null,C=!1,_=Error();return E.start(b.metadata,{onReceiveMetadata:e=>{S.emit("metadata",e)},onReceiveMessage(e){null!==w&&E.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),w=e},onReceiveStatus(e){if(!C){if(C=!0,e.code===a.Status.OK)if(null===w){let t=f(_);b.callback((0,n.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else b.callback(null,w);else{let t=f(_);b.callback((0,n.callErrorFromStatus)(e,t))}_=null,S.emit("status",e)}}}),E.sendMessage(i),E.halfClose(),S}makeClientStreamRequest(e,t,r,i,s,o){var p,m;let g=this.checkOptionalUnaryResponseArguments(i,s,o),y={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},v={metadata:g.metadata,call:new n.ClientWritableStreamImpl(t),channel:this[c],methodDefinition:y,callOptions:g.options,callback:g.callback};this[h]&&(v=this[h](v));let b=v.call,S={clientInterceptors:this[u],clientInterceptorProviders:this[d],callInterceptors:null!=(p=v.callOptions.interceptors)?p:[],callInterceptorProviders:null!=(m=v.callOptions.interceptor_providers)?m:[]},T=(0,l.getInterceptingCall)(S,v.methodDefinition,v.callOptions,v.channel);b.call=T;let E=null,w=!1,C=Error();return T.start(v.metadata,{onReceiveMetadata:e=>{b.emit("metadata",e)},onReceiveMessage(e){null!==E&&T.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),E=e},onReceiveStatus(e){if(!w){if(w=!0,e.code===a.Status.OK)if(null===E){let t=f(C);v.callback((0,n.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else v.callback(null,E);else{let t=f(C);v.callback((0,n.callErrorFromStatus)(e,t))}C=null,b.emit("status",e)}}}),b}checkMetadataAndOptions(e,t){let r,n;return e instanceof o.Metadata?(r=e,n=t||{}):(n=e||{},r=new o.Metadata),{metadata:r,options:n}}makeServerStreamRequest(e,t,r,i,s,o){var p,m;let g=this.checkMetadataAndOptions(s,o),y={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},v={argument:i,metadata:g.metadata,call:new n.ClientReadableStreamImpl(r),channel:this[c],methodDefinition:y,callOptions:g.options};this[h]&&(v=this[h](v));let b=v.call,S={clientInterceptors:this[u],clientInterceptorProviders:this[d],callInterceptors:null!=(p=v.callOptions.interceptors)?p:[],callInterceptorProviders:null!=(m=v.callOptions.interceptor_providers)?m:[]},T=(0,l.getInterceptingCall)(S,v.methodDefinition,v.callOptions,v.channel);b.call=T;let E=!1,w=Error();return T.start(v.metadata,{onReceiveMetadata(e){b.emit("metadata",e)},onReceiveMessage(e){b.push(e)},onReceiveStatus(e){if(!E){if(E=!0,b.push(null),e.code!==a.Status.OK){let t=f(w);b.emit("error",(0,n.callErrorFromStatus)(e,t))}w=null,b.emit("status",e)}}}),T.sendMessage(i),T.halfClose(),b}makeBidiStreamRequest(e,t,r,i,s){var o,p;let m=this.checkMetadataAndOptions(i,s),g={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},y={metadata:m.metadata,call:new n.ClientDuplexStreamImpl(t,r),channel:this[c],methodDefinition:g,callOptions:m.options};this[h]&&(y=this[h](y));let v=y.call,b={clientInterceptors:this[u],clientInterceptorProviders:this[d],callInterceptors:null!=(o=y.callOptions.interceptors)?o:[],callInterceptorProviders:null!=(p=y.callOptions.interceptor_providers)?p:[]},S=(0,l.getInterceptingCall)(b,y.methodDefinition,y.callOptions,y.channel);v.call=S;let T=!1,E=Error();return S.start(y.metadata,{onReceiveMetadata(e){v.emit("metadata",e)},onReceiveMessage(e){v.push(e)},onReceiveStatus(e){if(!T){if(T=!0,v.push(null),e.code!==a.Status.OK){let t=f(E);v.emit("error",(0,n.callErrorFromStatus)(e,t))}E=null,v.emit("status",e)}}}),v}}t.Client=m},441:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInterceptingCall=t.InterceptingCall=t.RequesterBuilder=t.ListenerBuilder=t.InterceptorConfigurationError=void 0;let n=r(9978),i=r(4990),s=r(3122),a=r(2281);class o extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,o)}}t.InterceptorConfigurationError=o;class l{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}t.ListenerBuilder=l;class c{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}t.RequesterBuilder=c;let u={onReceiveMetadata:(e,t)=>{t(e)},onReceiveMessage:(e,t)=>{t(e)},onReceiveStatus:(e,t)=>{t(e)}},d={start:(e,t,r)=>{r(e,t)},sendMessage:(e,t)=>{t(e)},halfClose:e=>{e()},cancel:e=>{e()}};class h{constructor(e,t){var r,n,i,s;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:null!=(r=t.start)?r:d.start,sendMessage:null!=(n=t.sendMessage)?n:d.sendMessage,halfClose:null!=(i=t.halfClose)?i:d.halfClose,cancel:null!=(s=t.cancel)?s:d.cancel}:this.requester=d}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,n,s,a,o,l;let c={onReceiveMetadata:null!=(n=null==(r=null==t?void 0:t.onReceiveMetadata)?void 0:r.bind(t))?n:e=>{},onReceiveMessage:null!=(a=null==(s=null==t?void 0:t.onReceiveMessage)?void 0:s.bind(t))?a:e=>{},onReceiveStatus:null!=(l=null==(o=null==t?void 0:t.onReceiveStatus)?void 0:o.bind(t))?l:e=>{}};this.processingMetadata=!0,this.requester.start(e,c,(e,t)=>{var r,n,s;let a;if(this.processingMetadata=!1,(0,i.isInterceptingListener)(t))a=t;else{let e={onReceiveMetadata:null!=(r=t.onReceiveMetadata)?r:u.onReceiveMetadata,onReceiveMessage:null!=(n=t.onReceiveMessage)?n:u.onReceiveMessage,onReceiveStatus:null!=(s=t.onReceiveStatus)?s:u.onReceiveStatus};a=new i.InterceptingListenerImpl(e,c)}this.nextCall.start(e,a),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function p(e,t,r){var n,i;let s=null!=(n=r.deadline)?n:1/0,a=r.host,o=null!=(i=r.parent)?i:null,l=r.propagate_flags,c=r.credentials,u=e.createCall(t,s,a,o,l);return c&&u.setCredentials(c),u}t.InterceptingCall=h;class f{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(e){this.call.cancelWithStatus(s.Status.INTERNAL,`Request message serialization failure: ${(0,a.getErrorMessage)(e)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:e=>{var r;null==(r=null==t?void 0:t.onReceiveMetadata)||r.call(t,e)},onReceiveMessage:e=>{var i;let o;try{o=this.methodDefinition.responseDeserialize(e)}catch(e){r={code:s.Status.INTERNAL,details:`Response message parsing error: ${(0,a.getErrorMessage)(e)}`,metadata:new n.Metadata},this.call.cancelWithStatus(r.code,r.details);return}null==(i=null==t?void 0:t.onReceiveMessage)||i.call(t,o)},onReceiveStatus:e=>{var n,i;r?null==(n=null==t?void 0:t.onReceiveStatus)||n.call(t,r):null==(i=null==t?void 0:t.onReceiveStatus)||i.call(t,e)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class m extends f{constructor(e,t){super(e,t)}start(e,t){var r,n;let i=!1,s={onReceiveMetadata:null!=(n=null==(r=null==t?void 0:t.onReceiveMetadata)?void 0:r.bind(t))?n:e=>{},onReceiveMessage:e=>{var r;i=!0,null==(r=null==t?void 0:t.onReceiveMessage)||r.call(t,e)},onReceiveStatus:e=>{var r,n;i||null==(r=null==t?void 0:t.onReceiveMessage)||r.call(t,null),null==(n=null==t?void 0:t.onReceiveStatus)||n.call(t,e)}};super.start(e,s),this.call.startRead()}}class g extends f{}function y(e,t,r){let n=p(e,r.path,t);return r.responseStream?new g(n,r):new m(n,r)}t.getInterceptingCall=function(e,t,r,n){if(e.clientInterceptors.length>0&&e.clientInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(e.callInterceptors.length>0&&e.callInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];i=e.callInterceptors.length>0||e.callInterceptorProviders.length>0?[].concat(e.callInterceptors,e.callInterceptorProviders.map(e=>e(t))).filter(e=>e):[].concat(e.clientInterceptors,e.clientInterceptorProviders.map(e=>e(t))).filter(e=>e);let s=Object.assign({},r,{method_definition:t});return i.reduceRight((e,t)=>r=>t(r,e),e=>y(n,e,t))(s)}},561:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSubchannelPool=t.SubchannelPool=void 0;let n=r(8735),i=r(2090),s=r(8387),a=r(7213),o=r(6202),l=1e4;class c{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let r=this.pool[t].filter(e=>!e.subchannel.unrefIfOneRef());r.length>0&&(e=!1),this.pool[t]=r}e&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},l),null==(t=(e=this.cleanupTimer).unref)||t.call(e))}getOrCreateSubchannel(e,t,r,l){this.ensureCleanupTask();let c=(0,a.uriToString)(e);if(c in this.pool){for(let e of this.pool[c])if((0,s.subchannelAddressEqual)(t,e.subchannelAddress)&&(0,n.channelOptionsEqual)(r,e.channelArguments)&&l._equals(e.channelCredentials))return e.subchannel}let u=new i.Subchannel(e,t,r,l,new o.Http2SubchannelConnector(e));return c in this.pool||(this.pool[c]=[]),this.pool[c].push({subchannelAddress:t,channelArguments:r,channelCredentials:l,subchannel:u}),u.ref(),u}}t.SubchannelPool=c;let u=new c;t.getSubchannelPool=function(e){return e?u:new c}},598:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateLoadBalancingConfig=t.getFirstUsableConfig=t.isLoadBalancerNameRegistered=t.createLoadBalancer=t.registerDefaultLoadBalancerType=t.registerLoadBalancerType=t.createChildChannelControlHelper=void 0,t.createChildChannelControlHelper=function(e,t){var r,n,i,s,a,o,l,c,u,d;return{createSubchannel:null!=(n=null==(r=t.createSubchannel)?void 0:r.bind(t))?n:e.createSubchannel.bind(e),updateState:null!=(s=null==(i=t.updateState)?void 0:i.bind(t))?s:e.updateState.bind(e),requestReresolution:null!=(o=null==(a=t.requestReresolution)?void 0:a.bind(t))?o:e.requestReresolution.bind(e),addChannelzChild:null!=(c=null==(l=t.addChannelzChild)?void 0:l.bind(t))?c:e.addChannelzChild.bind(e),removeChannelzChild:null!=(d=null==(u=t.removeChannelzChild)?void 0:u.bind(t))?d:e.removeChannelzChild.bind(e)}};let r={},n=null;t.registerLoadBalancerType=function(e,t,n){r[e]={LoadBalancer:t,LoadBalancingConfig:n}},t.registerDefaultLoadBalancerType=function(e){n=e},t.createLoadBalancer=function(e,t){let n=e.getLoadBalancerName();return n in r?new r[n].LoadBalancer(t):null},t.isLoadBalancerNameRegistered=function(e){return e in r},t.getFirstUsableConfig=function(e,t=!1){for(let t of e)if(t.getLoadBalancerName()in r)return t;return t&&n?new r[n].LoadBalancingConfig:null},t.validateLoadBalancingConfig=function(e){if(null===e||"object"!=typeof e)throw Error("Load balancing config must be an object");let t=Object.keys(e);if(1!==t.length)throw Error("Provided load balancing config has multiple conflicting entries");let n=t[0];if(n in r)return r[n].LoadBalancingConfig.createFromJson(e[n]);throw Error(`Unrecognized load balancing config name ${n}`)}},653:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseFilter=void 0;class r{async sendMetadata(e){return e}receiveMetadata(e){return e}async sendMessage(e){return e}async receiveMessage(e){return e}receiveTrailers(e){return e}}t.BaseFilter=r},663:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerCredentials=void 0;let n=r(1866);class i{static createInsecure(){return new s}static createSsl(e,t,r=!1){if(null!==e&&!Buffer.isBuffer(e))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof r)throw TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let e=0;e<t.length;e++){let r=t[e];if(null===r||"object"!=typeof r)throw TypeError(`keyCertPair[${e}] must be an object`);if(!Buffer.isBuffer(r.private_key))throw TypeError(`keyCertPair[${e}].private_key must be a Buffer`);if(!Buffer.isBuffer(r.cert_chain))throw TypeError(`keyCertPair[${e}].cert_chain must be a Buffer`);i.push(r.cert_chain),s.push(r.private_key)}return new a({ca:e||(0,n.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:n.CIPHER_SUITES})}}t.ServerCredentials=i;class s extends i{_isSecure(){return!1}_getSettings(){return null}}class a extends i{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}},757:(e,t,r)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.QueuePicker=t.UnavailablePicker=t.PickResultType=void 0;let i=r(9978),s=r(3122);!function(e){e[e.COMPLETE=0]="COMPLETE",e[e.QUEUE=1]="QUEUE",e[e.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",e[e.DROP=3]="DROP"}(n||(t.PickResultType=n={}));class a{constructor(e){this.status=Object.assign({code:s.Status.UNAVAILABLE,details:"No connection established",metadata:new i.Metadata},e)}pick(e){return{pickResultType:n.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}t.UnavailablePicker=a;class o{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:n.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}t.QueuePicker=o},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},847:(e,t,r)=>{"use strict";e.exports=o;var n=r(2110),i=r(1810),s=r(3107);function a(e,t,r,n){return t.delimited?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",r,n,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",r,n,(t.id<<3|2)>>>0)}function o(e){for(var t,r,o=s.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),l=e.fieldsArray.slice().sort(s.compareFieldsById),t=0;t<l.length;++t){var c=l[t].resolve(),u=e._fieldsArray.indexOf(c),d=c.resolvedType instanceof n?"int32":c.type,h=i.basic[d];r="m"+s.safeProp(c.name),c.map?(o("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,c.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(c.id<<3|2)>>>0,8|i.mapKey[c.keyType],c.keyType),void 0===h?o("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",u,r):o(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|h,d,r),o("}")("}")):c.repeated?(o("if(%s!=null&&%s.length){",r,r),c.packed&&void 0!==i.packed[d]?o("w.uint32(%i).fork()",(c.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",d,r)("w.ldelim()"):(o("for(var i=0;i<%s.length;++i)",r),void 0===h?a(o,c,u,r+"[i]"):o("w.uint32(%i).%s(%s[i])",(c.id<<3|h)>>>0,d,r)),o("}")):(c.optional&&o("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,c.name),void 0===h?a(o,c,u,r):o("w.uint32(%i).%s(%s)",(c.id<<3|h)>>>0,d,r))}return o("return w")}},920:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectivityState=void 0,function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.READY=2]="READY",e[e.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",e[e.SHUTDOWN=4]="SHUTDOWN"}(r||(t.ConnectivityState=r={}))},948:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CompressionFilterFactory=t.CompressionFilter=void 0;let n=r(4075),i=r(5280),s=r(3122),a=r(653),o=r(3038),l=e=>"number"==typeof e&&"string"==typeof i.CompressionAlgorithms[e];class c{async writeMessage(e,t){let r=e;t&&(r=await this.compressMessage(r));let n=Buffer.allocUnsafe(r.length+5);return n.writeUInt8(+!!t,0),n.writeUInt32BE(r.length,1),r.copy(n,5),n}async readMessage(e){let t=1===e.readUInt8(0),r=e.slice(5);return t&&(r=await this.decompressMessage(r)),r}}class u extends c{async compressMessage(e){return e}async writeMessage(e,t){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r}decompressMessage(e){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class d extends c{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{n.deflate(e,(e,n)=>{e?r(e):t(n)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,a=[],o=n.createInflate();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class h extends c{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{n.gzip(e,(e,n)=>{e?r(e):t(n)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,a=[],o=n.createGunzip();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class p extends c{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function f(e,t){switch(e){case"identity":return new u;case"deflate":return new d(t);case"gzip":return new h(t);default:return new p(e)}}class m extends a.BaseFilter{constructor(e,t){var r,n;super(),this.sharedFilterConfig=t,this.sendCompression=new u,this.receiveCompression=new u,this.currentCompressionAlgorithm="identity";let a=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=null!=(r=e["grpc.max_receive_message_length"])?r:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,void 0!==a)if(l(a)){let e=i.CompressionAlgorithms[a],r=null==(n=t.serverSupportedEncodingHeader)?void 0:n.split(",");(!r||r.includes(e))&&(this.currentCompressionAlgorithm=e,this.sendCompression=f(this.currentCompressionAlgorithm,-1))}else o.log(s.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${a}`)}async sendMetadata(e){let t=await e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let e=t[0];"string"==typeof e&&(this.receiveCompression=f(e,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new u,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}async sendMessage(e){var t;let r,n=await e;return r=!(this.sendCompression instanceof u)&&((null!=(t=n.flags)?t:0)&2)==0,{message:await this.sendCompression.writeMessage(n.message,r),flags:n.flags}}async receiveMessage(e){return this.receiveCompression.readMessage(await e)}}t.CompressionFilter=m;class g{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new m(this.options,this.sharedFilterConfig)}}t.CompressionFilterFactory=g},959:(e,t,r)=>{"use strict";g={value:!0},g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=t.ex=g=g=g=g=g=g=t.OS=t.z3=void 0;let n=r(5628);g={enumerable:!0,get:function(){return n.CallCredentials}};let i=r(3232);g={enumerable:!0,get:function(){return i.ChannelImplementation}};let s=r(5280);g={enumerable:!0,get:function(){return s.CompressionAlgorithms}};let a=r(920);g={enumerable:!0,get:function(){return a.ConnectivityState}};let o=r(6551);g={enumerable:!0,get:function(){return o.ChannelCredentials}};let l=r(300);g={enumerable:!0,get:function(){return l.Client}};let c=r(3122);g={enumerable:!0,get:function(){return c.LogVerbosity}},g={enumerable:!0,get:function(){return c.Status}},g={enumerable:!0,get:function(){return c.Propagate}};let u=r(3038),d=r(3865);Object.defineProperty(t,"ex",{enumerable:!0,get:function(){return d.loadPackageDefinition}}),g={enumerable:!0,get:function(){return d.makeClientConstructor}},g={enumerable:!0,get:function(){return d.makeClientConstructor}};let h=r(9978);Object.defineProperty(t,"OS",{enumerable:!0,get:function(){return h.Metadata}});let p=r(8048);g={enumerable:!0,get:function(){return p.Server}};let f=r(663);g={enumerable:!0,get:function(){return f.ServerCredentials}};let m=r(7819);g={enumerable:!0,get:function(){return m.StatusBuilder}},t.z3={combineChannelCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),combineCallCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),createInsecure:o.ChannelCredentials.createInsecure,createSsl:o.ChannelCredentials.createSsl,createFromSecureContext:o.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:n.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:n.CallCredentials.createFromGoogleCredential,createEmpty:n.CallCredentials.createEmpty},g=e=>e.close(),g=(e,t,r)=>e.waitForReady(t,r),g=(e,t)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},g=(e,t,r)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},g=e=>{u.setLogger(e)},g=e=>{u.setLoggerVerbosity(e)};var g=e=>l.Client.prototype.getChannel.call(e),y=r(441);g={enumerable:!0,get:function(){return y.ListenerBuilder}},g={enumerable:!0,get:function(){return y.RequesterBuilder}},g={enumerable:!0,get:function(){return y.InterceptingCall}},g={enumerable:!0,get:function(){return y.InterceptorConfigurationError}};var v=r(7216);g={enumerable:!0,get:function(){return v.getChannelzServiceDefinition}},g={enumerable:!0,get:function(){return v.getChannelzHandlers}};var b=r(9780);g={enumerable:!0,get:function(){return b.addAdminServicesToServer}},g=r(3801);let S=r(2319),T=r(3322),E=r(4231),w=r(6601),C=r(8570),_=r(4189),I=r(7216);(()=>{S.setup(),T.setup(),E.setup(),w.setup(),C.setup(),_.setup(),I.setup()})()},1135:()=>{},1140:(e,t)=>{"use strict";var r=t,n=r.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},i=r.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),r=n(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)".."===t[s]?s>0&&".."!==t[s-1]?t.splice(--s,2):r?t.splice(s,1):++s:"."===t[s]?t.splice(s,1):++s;return i+t.join("/")};r.resolve=function(e,t,r){return(r||(t=i(t)),n(t))?t:(r||(e=i(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?i(e+"/"+t):t)}},1156:(e,t,r)=>{"use strict";e.exports=i;var n=r(8707);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/0x100000000>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>0xffffffff&&(r=0,++n>0xffffffff&&(n=0))),new i(r,n)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(n.isString(e))if(!n.Long)return i.fromNumber(parseInt(e,10));else e=n.Long.fromString(e);return e.low||e.high?new i(e.low>>>0,e.high>>>0):s},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+0x100000000*r)}return this.lo+0x100000000*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var o=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?s:new i((o.call(e,0)|o.call(e,1)<<8|o.call(e,2)<<16|o.call(e,3)<<24)>>>0,(o.call(e,4)|o.call(e,5)<<8|o.call(e,6)<<16|o.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},1202:(e,t,r)=>{"use strict";e.exports=s;var n=r(4824);((s.prototype=Object.create(n.prototype)).constructor=s).className="Method";var i=r(3107);function s(e,t,r,s,a,o,l,c,u){if(i.isObject(a)?(l=a,a=o=void 0):i.isObject(o)&&(l=o,o=void 0),!(void 0===t||i.isString(t)))throw TypeError("type must be a string");if(!i.isString(r))throw TypeError("requestType must be a string");if(!i.isString(s))throw TypeError("responseType must be a string");n.call(this,e,l),this.type=t||"rpc",this.requestType=r,this.requestStream=!!a||void 0,this.responseType=s,this.responseStream=!!o||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=c,this.parsedOptions=u}s.fromJSON=function(e,t){return new s(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},s.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},s.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),n.prototype.resolve.call(this))}},1204:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>n});let n=(0,r(2907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/atulya/Desktop/SplitExpense/expensee-splitter/src/app/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/atulya/Desktop/SplitExpense/expensee-splitter/src/app/page.tsx","default")},1421:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResolvingCall=void 0;let n=r(3122),i=r(4679),s=r(9978),a=r(3038),o=r(3908),l="resolving_call";class c{constructor(e,t,r,s,a,o){this.channel=e,this.method=t,this.filterStackFactory=s,this.credentials=a,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&n.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(n.Status.CANCELLED,"Cancelled by parent call")}),r.flags&n.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,i.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){a.trace(n.LogVerbosity.DEBUG,l,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,i.deadlineToString)(this.deadline));let e=(0,i.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(n.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(e=>e(t)),process.nextTick(()=>{var e;null==(e=this.listener)||e.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(t=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,t.message),this.pendingHalfClose&&r.halfClose()},e=>{this.cancelWithStatus(e.code,e.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if("NONE"===e.type)return void this.channel.queueCallForConfig(this);if("ERROR"===e.type)return void(this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error));let t=e.config;if(t.status!==n.Status.OK){let{code:e,details:r}=(0,o.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:e,details:r,metadata:new s.Metadata});return}if(t.methodConfig.timeout){let e=new Date;e.setSeconds(e.getSeconds()+t.methodConfig.timeout.seconds),e.setMilliseconds(e.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,i.minDeadline)(this.deadline,e),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(e=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(e,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(e))},onReceiveMessage:e=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(e).then(e=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(e),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},e=>{this.cancelWithStatus(e.code,e.details)})},onReceiveStatus:e=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=e:this.outputStatus(e)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},e=>{this.outputStatus(e)})}reportResolverError(e){var t;(null==(t=this.metadata)?void 0:t.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null==(r=this.child)||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new s.Metadata})}getPeer(){var e,t;return null!=(t=null==(e=this.child)?void 0:e.getPeer())?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}}t.ResolvingCall=c},1614:(e,t,r)=>{"use strict";var n=r(8474);e.exports=t=n.descriptor=n.Root.fromJSON(r(40)).lookup(".google.protobuf");var i=n.Namespace,s=n.Root,a=n.Enum,o=n.Type,l=n.Field,c=n.MapField,u=n.OneOf,d=n.Service,h=n.Method;function p(e,r,n){var c=t.FileDescriptorProto.create({name:e.filename||(e.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});R(n,c),e instanceof s||(c.package=e.fullName.substring(1));for(var u,h=0;h<e.nestedArray.length;++h)(u=e._nestedArray[h])instanceof o?c.messageType.push(u.toDescriptor(n)):u instanceof a?c.enumType.push(u.toDescriptor()):u instanceof l?c.extension.push(u.toDescriptor(n)):u instanceof d?c.service.push(u.toDescriptor()):u instanceof i&&p(u,r,n);c.options=I(e.options,t.FileOptions),c.messageType.length+c.enumType.length+c.extension.length+c.service.length&&r.push(c)}s.fromDescriptor=function(e){"number"==typeof e.length&&(e=t.FileDescriptorSet.decode(e));var r=new s;if(e.file)for(var n,i,c,u=0;u<e.file.length;++u){i=r,(n=e.file[u]).package&&n.package.length&&(i=r.define(n.package));var h=N(n);if(n.name&&n.name.length&&r.files.push(i.filename=n.name),n.messageType)for(c=0;c<n.messageType.length;++c)i.add(o.fromDescriptor(n.messageType[c],h));if(n.enumType)for(c=0;c<n.enumType.length;++c)i.add(a.fromDescriptor(n.enumType[c],h));if(n.extension)for(c=0;c<n.extension.length;++c)i.add(l.fromDescriptor(n.extension[c],h));if(n.service)for(c=0;c<n.service.length;++c)i.add(d.fromDescriptor(n.service[c],h));var p=C(n.options,t.FileOptions);if(p){var f=Object.keys(p);for(c=0;c<f.length;++c)i.setOption(f[c],p[f[c]])}}return r.resolveAll()},s.prototype.toDescriptor=function(e){var r=t.FileDescriptorSet.create();return p(this,r.file,e),r};var f=0;o.fromDescriptor=function(e,r,n){"number"==typeof e.length&&(e=t.DescriptorProto.decode(e));var i,s=new o(e.name.length?e.name:"Type"+f++,C(e.options,t.MessageOptions));if(n||(s._edition=r),e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)s.add(u.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var c=l.fromDescriptor(e.field[i],r,!0);s.add(c),e.field[i].hasOwnProperty("oneofIndex")&&s.oneofsArray[e.field[i].oneofIndex].add(c)}if(e.extension)for(i=0;i<e.extension.length;++i)s.add(l.fromDescriptor(e.extension[i],r,!0));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)s.add(o.fromDescriptor(e.nestedType[i],r,!0)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&s.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)s.add(a.fromDescriptor(e.enumType[i],r,!0));if(e.extensionRange&&e.extensionRange.length)for(i=0,s.extensions=[];i<e.extensionRange.length;++i)s.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(s.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)s.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)s.reserved.push(e.reservedName[i])}return s},o.prototype.toDescriptor=function(e){var r,n,i=t.DescriptorProto.create({name:this.name});for(n=0;n<this.fieldsArray.length;++n)if(i.field.push(r=this._fieldsArray[n].toDescriptor(e)),this._fieldsArray[n]instanceof c){var s=E(this._fieldsArray[n].keyType,this._fieldsArray[n].resolvedKeyType,!1),u=E(this._fieldsArray[n].type,this._fieldsArray[n].resolvedType,!1),d=11===u||14===u?this._fieldsArray[n].resolvedType&&x(this.parent,this._fieldsArray[n].resolvedType)||this._fieldsArray[n].type:void 0;i.nestedType.push(t.DescriptorProto.create({name:r.typeName,field:[t.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),t.FieldDescriptorProto.create({name:"value",number:2,label:1,type:u,typeName:d})],options:t.MessageOptions.create({mapEntry:!0})}))}for(n=0;n<this.oneofsArray.length;++n)i.oneofDecl.push(this._oneofsArray[n].toDescriptor());for(n=0;n<this.nestedArray.length;++n)this._nestedArray[n]instanceof l?i.field.push(this._nestedArray[n].toDescriptor(e)):this._nestedArray[n]instanceof o?i.nestedType.push(this._nestedArray[n].toDescriptor(e)):this._nestedArray[n]instanceof a&&i.enumType.push(this._nestedArray[n].toDescriptor());if(this.extensions)for(n=0;n<this.extensions.length;++n)i.extensionRange.push(t.DescriptorProto.ExtensionRange.create({start:this.extensions[n][0],end:this.extensions[n][1]}));if(this.reserved)for(n=0;n<this.reserved.length;++n)"string"==typeof this.reserved[n]?i.reservedName.push(this.reserved[n]):i.reservedRange.push(t.DescriptorProto.ReservedRange.create({start:this.reserved[n][0],end:this.reserved[n][1]}));return i.options=I(this.options,t.MessageOptions),i};var m=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;l.fromDescriptor=function(e,r,n){if("number"==typeof e.length&&(e=t.DescriptorProto.decode(e)),"number"!=typeof e.number)throw Error("missing field id");switch(i=e.typeName&&e.typeName.length?e.typeName:S(e.type),e.label){case 1:s=void 0;break;case 2:s="required";break;case 3:s="repeated";break;default:throw Error("illegal label: "+e.label)}var i,s,a=e.extendee;void 0!==e.extendee&&(a=a.length?a:void 0);var o=new l(e.name.length?e.name:"field"+e.number,e.number,i,s,a);if(n||(o._edition=r),o.options=C(e.options,t.FieldOptions),e.proto3_optional&&(o.options.proto3_optional=!0),e.defaultValue&&e.defaultValue.length){var c=e.defaultValue;switch(c){case"true":case"TRUE":c=!0;break;case"false":case"FALSE":c=!1;break;default:m.exec(c)&&(c=parseInt(c))}o.setOption("default",c)}return T(e.type)&&("proto3"===r?e.options&&!e.options.packed&&o.setOption("packed",!1):(!r||"proto2"===r)&&e.options&&e.options.packed&&o.setOption("packed",!0)),o},l.prototype.toDescriptor=function(e){var r=t.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)r.type=11,r.typeName=n.util.ucFirst(this.name),r.label=3;else{switch(r.type=E(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:r.typeName=this.resolvedType?x(this.parent,this.resolvedType):this.type}"repeated"===this.rule?r.label=3:this.required&&"proto2"===e?r.label=2:r.label=1}if(r.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(r.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(r.options=I(this.options,t.FieldOptions),null!=this.options.default&&(r.defaultValue=String(this.options.default)),this.options.proto3_optional&&(r.proto3_optional=!0)),"proto3"===e?this.packed||((r.options||(r.options=t.FieldOptions.create())).packed=!1):(!e||"proto2"===e)&&this.packed&&((r.options||(r.options=t.FieldOptions.create())).packed=!0),r};var g=0;a.fromDescriptor=function(e,r,n){"number"==typeof e.length&&(e=t.EnumDescriptorProto.decode(e));var i={};if(e.value)for(var s=0;s<e.value.length;++s){var o=e.value[s].name,l=e.value[s].number||0;i[o&&o.length?o:"NAME"+l]=l}var c=new a(e.name&&e.name.length?e.name:"Enum"+g++,i,C(e.options,t.EnumOptions));return n||(c._edition=r),c},a.prototype.toDescriptor=function(){for(var e=[],r=0,n=Object.keys(this.values);r<n.length;++r)e.push(t.EnumValueDescriptorProto.create({name:n[r],number:this.values[n[r]]}));return t.EnumDescriptorProto.create({name:this.name,value:e,options:I(this.options,t.EnumOptions)})};var y=0;u.fromDescriptor=function(e){return"number"==typeof e.length&&(e=t.OneofDescriptorProto.decode(e)),new u(e.name&&e.name.length?e.name:"oneof"+y++)},u.prototype.toDescriptor=function(){return t.OneofDescriptorProto.create({name:this.name})};var v=0;d.fromDescriptor=function(e,r,n){"number"==typeof e.length&&(e=t.ServiceDescriptorProto.decode(e));var i=new d(e.name&&e.name.length?e.name:"Service"+v++,C(e.options,t.ServiceOptions));if(n||(i._edition=r),e.method)for(var s=0;s<e.method.length;++s)i.add(h.fromDescriptor(e.method[s]));return i},d.prototype.toDescriptor=function(){for(var e=[],r=0;r<this.methodsArray.length;++r)e.push(this._methodsArray[r].toDescriptor());return t.ServiceDescriptorProto.create({name:this.name,method:e,options:I(this.options,t.ServiceOptions)})};var b=0;function S(e){switch(e){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+e)}function T(e){switch(e){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function E(e,t,r){switch(e){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(t instanceof a)return 14;if(t instanceof o)return r?10:11;throw Error("illegal type: "+e)}function w(e,t){for(var r,n,i={},s=0;s<t.fieldsArray.length;++s)if("uninterpretedOption"!==(n=(r=t._fieldsArray[s]).name)&&Object.prototype.hasOwnProperty.call(e,n)){var l=k(n);r.resolvedType instanceof o?i[l]=w(e[n],r.resolvedType):r.resolvedType instanceof a?i[l]=r.resolvedType.valuesById[e[n]]:i[l]=e[n]}return i}function C(e,t){if(e)return w(t.toObject(e),t)}function _(e,t){for(var r={},i=Object.keys(e),s=0;s<i.length;++s){var a=i[s],l=n.util.camelCase(a);if(Object.prototype.hasOwnProperty.call(t.fields,l)){var c=t.fields[l];c.resolvedType instanceof o?r[l]=_(e[a],c.resolvedType):r[l]=e[a],c.repeated&&!Array.isArray(r[l])&&(r[l]=[r[l]])}}return r}function I(e,t){if(e)return t.fromObject(_(e,t))}function x(e,t){var r=e.fullName.split("."),n=t.fullName.split("."),a=0,o=0,l=n.length-1;if(!(e instanceof s)&&t instanceof i)for(;a<r.length&&o<l&&r[a]===n[o];){var c=t.lookup(r[a++],!0);if(null!==c&&c!==t)break;++o}else for(;a<r.length&&o<l&&r[a]===n[o];++a,++o);return n.slice(o).join(".")}function k(e){return e.substring(0,1)+e.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}function N(e){if("editions"===e.syntax)if(e.edition===t.Edition.EDITION_2023)return"2023";else throw Error("Unsupported edition "+e.edition);return"proto3"===e.syntax?"proto3":"proto2"}function R(e,r){if(e)if("proto2"===e||"proto3"===e)r.syntax=e;else if(r.syntax="editions","2023"===e)r.edition=t.Edition.EDITION_2023;else throw Error("Unsupported edition "+e)}h.fromDescriptor=function(e){return"number"==typeof e.length&&(e=t.MethodDescriptorProto.decode(e)),new h(e.name&&e.name.length?e.name:"Method"+b++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,C(e.options,t.MethodOptions))},h.prototype.toDescriptor=function(){return t.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:I(this.options,t.MethodOptions)})}},1630:e=>{"use strict";e.exports=require("http")},1645:e=>{"use strict";e.exports=require("net")},1810:(e,t,r)=>{"use strict";var n=t,i=r(3107),s=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function a(e,t){var r=0,n={};for(t|=0;r<e.length;)n[s[r+t]]=e[r++];return n}n.basic=a([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),n.defaults=a([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),n.long=a([0,0,0,1,1],7),n.mapKey=a([0,0,0,5,5,0,0,0,1,1,0,2],2),n.packed=a([1,5,0,0,0,5,5,0,0,0,1,1,0])},1820:e=>{"use strict";e.exports=require("os")},1866:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultRootsData=t.CIPHER_SUITES=void 0;let n=r(9021);t.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let i=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,s=null;t.getDefaultRootsData=function(){return i?(null===s&&(s=n.readFileSync(i)),s):null}},1887:()=>{},1996:(e,t)=>{"use strict";var r=t;r.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:(64512&r)==55296&&(64512&e.charCodeAt(n+1))==56320?(++n,t+=4):t+=3;return t},r.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,s=[],a=0;t<r;)(n=e[t++])<128?s[a++]=n:n>191&&n<224?s[a++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[a++]=55296+(n>>10),s[a++]=56320+(1023&n)):s[a++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))},r.write=function(e,t,r){for(var n,i,s=r,a=0;a<e.length;++a)(n=e.charCodeAt(a))<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:((64512&n)==55296&&(64512&(i=e.charCodeAt(a+1)))==56320?(n=65536+((1023&n)<<10)+(1023&i),++a,t[r++]=n>>18|240,t[r++]=n>>12&63|128):t[r++]=n>>12|224,t[r++]=n>>6&63|128),t[r++]=63&n|128);return r-s}},2090:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Subchannel=void 0;let n=r(920),i=r(6693),s=r(3038),a=r(3122),o=r(7213),l=r(8387),c=r(7216),u="subchannel",d=0x7fffffff;class h{constructor(e,t,r,s,a){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=s,this.connector=a,this.connectivityState=n.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new c.ChannelzCallTracker,this.childrenTracker=new c.ChannelzChildrenTracker,this.streamTracker=new c.ChannelzCallTracker;let u={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new i.BackoffTimeout(()=>{this.handleBackoffTimer()},u),this.backoffTimeout.unref(),this.subchannelAddressString=(0,l.subchannelAddressToString)(t),this.keepaliveTime=null!=(o=r["grpc.keepalive_time_ms"])?o:-1,0===r["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new c.ChannelzTrace,this.channelzRef=(0,c.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){s.trace(a.LogVerbosity.DEBUG,u,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){s.trace(a.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.CONNECTING):this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,d);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(e=>{this.transitionToState([n.ConnectivityState.CONNECTING],n.ConnectivityState.READY)?(this.transport=e,this.channelzEnabled&&this.childrenTracker.refChild(e.getChannelzRef()),e.addDisconnectListener(e=>{this.transitionToState([n.ConnectivityState.READY],n.ConnectivityState.IDLE),e&&this.keepaliveTime>0&&(this.keepaliveTime*=2,s.log(a.LogVerbosity.ERROR,`Connection to ${(0,o.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):e.shutdown()},e=>{this.transitionToState([n.ConnectivityState.CONNECTING],n.ConnectivityState.TRANSIENT_FAILURE,`${e}`)})}transitionToState(e,t,r){var i,s;if(-1===e.indexOf(this.connectivityState))return!1;this.trace(n.ConnectivityState[this.connectivityState]+" -> "+n.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+n.ConnectivityState[t]);let a=this.connectivityState;switch(this.connectivityState=t,t){case n.ConnectivityState.READY:this.stopBackoff();break;case n.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case n.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(i=this.transport)||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case n.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null==(s=this.transport)||s.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let e of this.stateListeners)e(this,a,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,c.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([n.ConnectivityState.CONNECTING,n.ConnectivityState.READY],n.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(e,t,r,n){let i;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),i={onCallEnd:e=>{e.code===a.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):i={},this.transport.createCall(e,t,r,n,i)}startConnecting(){process.nextTick(()=>{this.transitionToState([n.ConnectivityState.IDLE],n.ConnectivityState.CONNECTING)||this.connectivityState!==n.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}}t.Subchannel=h},2110:(e,t,r)=>{"use strict";e.exports=a;var n=r(4824);((a.prototype=Object.create(n.prototype)).constructor=a).className="Enum";var i=r(7968),s=r(3107);function a(e,t,r,i,s,a){if(n.call(this,e,r),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=s||{},this.valuesOptions=a,this._valuesFeatures={},this.reserved=void 0,t)for(var o=Object.keys(t),l=0;l<o.length;++l)"number"==typeof t[o[l]]&&(this.valuesById[this.values[o[l]]=t[o[l]]]=o[l])}a.prototype._resolveFeatures=function(e){return e=this._edition||e,n.prototype._resolveFeatures.call(this,e),Object.keys(this.values).forEach(e=>{var t=Object.assign({},this._features);this._valuesFeatures[e]=Object.assign(t,this.valuesOptions&&this.valuesOptions[e]&&this.valuesOptions[e].features)}),this},a.fromJSON=function(e,t){var r=new a(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},a.prototype.add=function(e,t,r,n){if(!s.isString(e))throw TypeError("name must be a string");if(!s.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return n&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[e]=n||null),this.comments[e]=r||null,this},a.prototype.remove=function(e){if(!s.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this},a.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},a.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},2281:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorCode=t.getErrorMessage=void 0,t.getErrorMessage=function(e){return e instanceof Error?e.message:String(e)},t.getErrorCode=function(e){return"object"==typeof e&&null!==e&&"code"in e&&"number"==typeof e.code?e.code:null}},2319:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.DEFAULT_PORT=void 0;let n=r(8605),i=r(7366),s=r(8354),a=r(2487),o=r(3122),l=r(9978),c=r(3038),u=r(3122),d=r(7213),h=r(1645),p=r(6693),f="dns_resolver";function m(e){c.trace(u.LogVerbosity.DEBUG,f,e)}t.DEFAULT_PORT=443;let g=3e4,y=s.promisify(i.resolveTxt),v=s.promisify(i.lookup);function b(...e){let t=[];for(let r=0;r<Math.max.apply(null,e.map(e=>e.length));r++)for(let n of e)r<n.length&&t.push(n[r]);return t}class S{constructor(e,r,n){var i,s,a;this.target=e,this.listener=r,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,m("Resolver constructed for target "+(0,d.uriToString)(e));let c=(0,d.splitHostPort)(e.path);null===c?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,h.isIPv4)(c.host)||(0,h.isIPv6)(c.host)?(this.ipResult=[{host:c.host,port:null!=(i=c.port)?i:t.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=c.host,this.port=null!=(s=c.port)?s:t.DEFAULT_PORT),this.percentage=100*Math.random(),1===n["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:o.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,d.uriToString)(this.target)}`,metadata:new l.Metadata};let u={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoff=new p.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},u),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!=(a=n["grpc.dns_min_time_between_resolutions_ms"])?a:g,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(m("Returning IP address for target "+(0,d.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)m("Failed to parse DNS address "+(0,d.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:o.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,d.uriToString)(this.target)}`,metadata:new l.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;m("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=v(e,{all:!0}),this.pendingLookupPromise.then(e=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let t=e.filter(e=>4===e.family),r=e.filter(e=>6===e.family);this.latestLookupResult=b(r,t).map(e=>({host:e.address,port:+this.port}));let n="["+this.latestLookupResult.map(e=>e.host+":"+e.port).join(",")+"]";if(m("Resolved addresses for target "+(0,d.uriToString)(this.target)+": "+n),0===this.latestLookupResult.length)return void this.listener.onError(this.defaultResolutionError);this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},e=>{null!==this.pendingLookupPromise&&(m("Resolution error for target "+(0,d.uriToString)(this.target)+": "+e.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=y(e),this.pendingTxtPromise.then(e=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,a.extractAndSelectServiceConfig)(e,this.percentage)}catch(e){this.latestServiceConfigError={code:o.Status.UNAVAILABLE,details:`Parsing service config failed with error ${e.message}`,metadata:new l.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},e=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null==(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?m('resolution update delayed by "min time between resolutions" rate limit'):m("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}}t.setup=function(){(0,n.registerResolver)("dns",S),(0,n.registerDefaultScheme)("dns")}},2487:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractAndSelectServiceConfig=t.validateServiceConfig=t.validateRetryThrottling=void 0;let n=r(1820),i=r(3122),s=r(598),a=/^\d+(\.\d{1,9})?s$/,o="node";function l(e){if("service"in e&&""!==e.service){if("string"!=typeof e.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof e.service}`);if(!("method"in e)||""===e.method)return{service:e.service};if("string"!=typeof e.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof e.service}`);return{service:e.service,method:e.method}}if("method"in e&&void 0!==e.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function c(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in e)||"string"!=typeof e.initialBackoff||!a.test(e.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in e)||"string"!=typeof e.maxBackoff||!a.test(e.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in e)||"number"!=typeof e.backoffMultiplier||e.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in e&&Array.isArray(e.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===e.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let t of e.retryableStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:e.maxAttempts,initialBackoff:e.initialBackoff,maxBackoff:e.maxBackoff,backoffMultiplier:e.backoffMultiplier,retryableStatusCodes:e.retryableStatusCodes}}function u(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in e&&("string"!=typeof e.hedgingDelay||!a.test(e.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in e&&Array.isArray(e.nonFatalStatusCodes))for(let t of e.nonFatalStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let t={maxAttempts:e.maxAttempts};return e.hedgingDelay&&(t.hedgingDelay=e.hedgingDelay),e.nonFatalStatusCodes&&(t.nonFatalStatusCodes=e.nonFatalStatusCodes),t}function d(e){var t;let r={name:[]};if(!("name"in e)||!Array.isArray(e.name))throw Error("Invalid method config: invalid name array");for(let t of e.name)r.name.push(l(t));if("waitForReady"in e){if("boolean"!=typeof e.waitForReady)throw Error("Invalid method config: invalid waitForReady");r.waitForReady=e.waitForReady}if("timeout"in e)if("object"==typeof e.timeout){if(!("seconds"in e.timeout)||"number"!=typeof e.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in e.timeout)||"number"!=typeof e.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");r.timeout=e.timeout}else if("string"==typeof e.timeout&&a.test(e.timeout)){let n=e.timeout.substring(0,e.timeout.length-1).split(".");r.timeout={seconds:0|n[0],nanos:(null!=(t=n[1])?t:0)|0}}else throw Error("Invalid method config: invalid timeout");if("maxRequestBytes"in e){if("number"!=typeof e.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");r.maxRequestBytes=e.maxRequestBytes}if("maxResponseBytes"in e){if("number"!=typeof e.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");r.maxResponseBytes=e.maxResponseBytes}if("retryPolicy"in e)if("hedgingPolicy"in e)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");else r.retryPolicy=c(e.retryPolicy);else"hedgingPolicy"in e&&(r.hedgingPolicy=u(e.hedgingPolicy));return r}function h(e){if(!("maxTokens"in e)||"number"!=typeof e.maxTokens||e.maxTokens<=0||e.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in e)||"number"!=typeof e.tokenRatio||e.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+e.maxTokens.toFixed(3),tokenRatio:+e.tokenRatio.toFixed(3)}}function p(e){let t={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in e)if("string"==typeof e.loadBalancingPolicy)t.loadBalancingPolicy=e.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in e)if(Array.isArray(e.loadBalancingConfig))for(let r of e.loadBalancingConfig)t.loadBalancingConfig.push((0,s.validateLoadBalancingConfig)(r));else throw Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in e&&Array.isArray(e.methodConfig))for(let r of e.methodConfig)t.methodConfig.push(d(r));"retryThrottling"in e&&(t.retryThrottling=h(e.retryThrottling));let r=[];for(let e of t.methodConfig)for(let t of e.name){for(let e of r)if(t.service===e.service&&t.method===e.method)throw Error(`Invalid service config: duplicate name ${t.service}/${t.method}`);r.push(t)}return t}function f(e){if(!("serviceConfig"in e))throw Error("Invalid service config choice: missing service config");let t={serviceConfig:p(e.serviceConfig)};if("clientLanguage"in e)if(Array.isArray(e.clientLanguage))for(let r of(t.clientLanguage=[],e.clientLanguage))if("string"==typeof r)t.clientLanguage.push(r);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in e)if(Array.isArray(e.clientHostname))for(let r of(t.clientHostname=[],e.clientHostname))if("string"==typeof r)t.clientHostname.push(r);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname");if("percentage"in e)if("number"==typeof e.percentage&&0<=e.percentage&&e.percentage<=100)t.percentage=e.percentage;else throw Error("Invalid service config choice: invalid percentage");let r=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let t in e)if(!r.includes(t))throw Error(`Invalid service config choice: unexpected field ${t}`);return t}function m(e,t){if(!Array.isArray(e))throw Error("Invalid service config list");for(let r of e){let e=f(r);if("number"!=typeof e.percentage||!(t>e.percentage)){if(Array.isArray(e.clientHostname)){let t=!1;for(let r of e.clientHostname)r===n.hostname()&&(t=!0);if(!t)continue}if(Array.isArray(e.clientLanguage)){let t=!1;for(let r of e.clientLanguage)r===o&&(t=!0);if(!t)continue}return e.serviceConfig}}throw Error("No matching service config found")}t.validateRetryThrottling=h,t.validateServiceConfig=p,t.extractAndSelectServiceConfig=function(e,t){for(let r of e)if(r.length>0&&r[0].startsWith("grpc_config="))return m(JSON.parse(r.join("").substring(12)),t);return null}},2566:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Api":{"fields":{"name":{"type":"string","id":1},"methods":{"rule":"repeated","type":"Method","id":2},"options":{"rule":"repeated","type":"Option","id":3},"version":{"type":"string","id":4},"sourceContext":{"type":"SourceContext","id":5},"mixins":{"rule":"repeated","type":"Mixin","id":6},"syntax":{"type":"Syntax","id":7}}},"Method":{"fields":{"name":{"type":"string","id":1},"requestTypeUrl":{"type":"string","id":2},"requestStreaming":{"type":"bool","id":3},"responseTypeUrl":{"type":"string","id":4},"responseStreaming":{"type":"bool","id":5},"options":{"rule":"repeated","type":"Option","id":6},"syntax":{"type":"Syntax","id":7}}},"Mixin":{"fields":{"name":{"type":"string","id":1},"root":{"type":"string","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}}}}}}}}')},2567:()=>{},2630:(e,t,r)=>{"use strict";e.exports=a;var n=r(4824);((a.prototype=Object.create(n.prototype)).constructor=a).className="OneOf";var i=r(3267),s=r(3107);function a(e,t,r,i){if(Array.isArray(t)||(r=t,t=void 0),n.call(this,e,r),!(void 0===t||Array.isArray(t)))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function o(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}a.fromJSON=function(e,t){return new a(e,t.oneof,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},a.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,o(this),this},a.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},a.prototype.onAdd=function(e){n.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}o(this)},a.prototype.onRemove=function(e){for(var t,r=0;r<this.fieldsArray.length;++r)(t=this.fieldsArray[r]).parent&&t.parent.remove(t);n.prototype.onRemove.call(this,e)},Object.defineProperty(a.prototype,"isProto3Optional",{get:function(){if(null==this.fieldsArray||1!==this.fieldsArray.length)return!1;var e=this.fieldsArray[0];return null!=e.options&&!0===e.options.proto3_optional}}),a.d=function(){for(var e=Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,r){s.decorateType(t.constructor).add(new a(r,e)),Object.defineProperty(t,r,{get:s.oneOfGetter(e),set:s.oneOfSetter(e)})}}},2703:(e,t,r)=>{"use strict";e.exports=d;var n,i,s,a=r(7968);((d.prototype=Object.create(a.prototype)).constructor=d).className="Root";var o=r(3267),l=r(2110),c=r(2630),u=r(3107);function d(e){a.call(this,"",e),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}function h(){}d.fromJSON=function(e,t){return t||(t=new d),e.options&&t.setOptions(e.options),t.addJSON(e.nested).resolveAll()},d.prototype.resolvePath=u.path.resolve,d.prototype.fetch=u.fetch,d.prototype.load=function e(t,r,n){"function"==typeof r&&(n=r,r=void 0);var a=this;if(!n)return u.asPromise(e,a,t,r);var o=n===h;function l(e,t){if(n){if(o)throw e;t&&t.resolveAll();var r=n;n=null,r(e,t)}}function c(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var r=e.substring(t);if(r in s)return r}return null}function d(e,t){try{if(u.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),u.isString(t)){i.filename=e;var n,s=i(t,a,r),d=0;if(s.imports)for(;d<s.imports.length;++d)(n=c(s.imports[d])||a.resolvePath(e,s.imports[d]))&&p(n);if(s.weakImports)for(d=0;d<s.weakImports.length;++d)(n=c(s.weakImports[d])||a.resolvePath(e,s.weakImports[d]))&&p(n,!0)}else a.setOptions(t.options).addJSON(t.nested)}catch(e){l(e)}o||f||l(null,a)}function p(e,t){if(e=c(e)||e,!(a.files.indexOf(e)>-1)){if(a.files.push(e),e in s)return void(o?d(e,s[e]):(++f,setTimeout(function(){--f,d(e,s[e])})));if(o){var r;try{r=u.fs.readFileSync(e).toString("utf8")}catch(e){t||l(e);return}d(e,r)}else++f,a.fetch(e,function(r,i){if(--f,n){if(r)return void(t?f||l(null,a):l(r));d(e,i)}})}}var f=0;u.isString(t)&&(t=[t]);for(var m,g=0;g<t.length;++g)(m=a.resolvePath("",t[g]))&&p(m);return o?a.resolveAll():f||l(null,a),a},d.prototype.loadSync=function(e,t){if(!u.isNode)throw Error("not supported");return this.load(e,t,h)},d.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return a.prototype.resolveAll.call(this)};var p=/^[A-Z]/;function f(e,t){var r=t.parent.lookup(t.extend);if(r){var n=new o(t.fullName,t.id,t.type,t.rule,void 0,t.options);return!!r.get(n.name)||(n.declaringField=t,t.extensionField=n,r.add(n),!0)}return!1}d.prototype._handleAdd=function(e){if(e instanceof o)void 0===e.extend||e.extensionField||f(this,e)||this.deferred.push(e);else if(e instanceof l)p.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof c)){if(e instanceof n)for(var t=0;t<this.deferred.length;)f(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);p.test(e.name)&&(e.parent[e.name]=e)}(e instanceof n||e instanceof l||e instanceof o)&&(this._fullyQualifiedObjects[e.fullName]=e)},d.prototype._handleRemove=function(e){if(e instanceof o){if(void 0!==e.extend)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof l)p.test(e.name)&&delete e.parent[e.name];else if(e instanceof a){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);p.test(e.name)&&delete e.parent[e.name]}delete this._fullyQualifiedObjects[e.fullName]},d._configure=function(e,t,r){n=e,i=t,s=r}},2727:(e,t)=>{"use strict";var r=t;r.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var n=Array(64),i=Array(123),s=0;s<64;)i[n[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;r.encode=function(e,t,r){for(var i,s=null,a=[],o=0,l=0;t<r;){var c=e[t++];switch(l){case 0:a[o++]=n[c>>2],i=(3&c)<<4,l=1;break;case 1:a[o++]=n[i|c>>4],i=(15&c)<<2,l=2;break;case 2:a[o++]=n[i|c>>6],a[o++]=n[63&c],l=0}o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,a)),o=0)}return(l&&(a[o++]=n[i],a[o++]=61,1===l&&(a[o++]=61)),s)?(o&&s.push(String.fromCharCode.apply(String,a.slice(0,o))),s.join("")):String.fromCharCode.apply(String,a.slice(0,o))};var a="invalid encoding";r.decode=function(e,t,r){for(var n,s=r,o=0,l=0;l<e.length;){var c=e.charCodeAt(l++);if(61===c&&o>1)break;if(void 0===(c=i[c]))throw Error(a);switch(o){case 0:n=c,o=1;break;case 1:t[r++]=n<<2|(48&c)>>4,n=c,o=2;break;case 2:t[r++]=(15&n)<<4|(60&c)>>2,n=c,o=3;break;case 3:t[r++]=(3&n)<<6|c,o=0}}if(1===o)throw Error(a);return r-s},r.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},2823:(e,t,r)=>{"use strict";e.exports=o;var n=r(2110),i=r(1810),s=r(3107);function a(e){return"missing required '"+e.name+"'"}function o(e){for(var t=s.codegen(["r","l","e"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),r=0;r<e.fieldsArray.length;++r){var o=e._fieldsArray[r].resolve(),l=o.resolvedType instanceof n?"int32":o.type,c="m"+s.safeProp(o.name);t("case %i: {",o.id),o.map?(t("if(%s===util.emptyObject)",c)("%s={}",c)("var c2 = r.uint32()+r.pos"),void 0!==i.defaults[o.keyType]?t("k=%j",i.defaults[o.keyType]):t("k=null"),void 0!==i.defaults[l]?t("value=%j",i.defaults[l]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",o.keyType)("case 2:"),void 0===i.basic[l]?t("value=types[%i].decode(r,r.uint32())",r):t("value=r.%s()",l),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),t(void 0!==i.long[o.keyType]?'%s[typeof k==="object"?util.longToHash(k):k]=value':"%s[k]=value",c)):o.repeated?(t("if(!(%s&&%s.length))",c,c)("%s=[]",c),void 0!==i.packed[l]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",c,l)("}else"),void 0===i.basic[l]?t(o.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",c,r):t("%s.push(r.%s())",c,l)):void 0===i.basic[l]?t(o.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",c,r):t("%s=r.%s()",c,l),t("break")("}")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),r=0;r<e._fieldsArray.length;++r){var u=e._fieldsArray[r];u.required&&t("if(!m.hasOwnProperty(%j))",u.name)("throw util.ProtocolError(%j,{instance:m})",a(u))}return t("return m")}},2841:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2ServerCallStream=t.ServerDuplexStreamImpl=t.ServerWritableStreamImpl=t.ServerReadableStreamImpl=t.ServerUnaryCallImpl=void 0;let n=r(4735),i=r(3496),s=r(7910),a=r(4075),o=r(3122),l=r(9978),c=r(5678),u=r(3038),d=r(2281),h="server_call";function p(e){u.trace(o.LogVerbosity.DEBUG,h,e)}let f="grpc-message",m="grpc-status",g="grpc-timeout",y=/(\d{1,8})\s*([HMSmun])/,v={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},b={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},S={[i.constants.HTTP2_HEADER_STATUS]:i.constants.HTTP_STATUS_OK,[i.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},T={waitForTrailers:!0};class E extends n.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}t.ServerUnaryCallImpl=E;class w extends s.Readable{constructor(e,t,r,n){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,n)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}t.ServerReadableStreamImpl=w;class C extends s.Writable{constructor(e,t,r,n){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=n,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let t=this.call.serializeMessage(e);if(!this.call.write(t))return void this.call.once("drain",r)}catch(e){this.emit("error",{details:(0,d.getErrorMessage)(e),code:o.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:o.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}}t.ServerWritableStreamImpl=C;class _ extends s.Duplex{constructor(e,t,r,n,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=n,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}}t.ServerDuplexStreamImpl=_,_.prototype._read=w.prototype._read,_.prototype._write=C.prototype._write,_.prototype._final=C.prototype._final;class I extends n.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=o.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=o.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",e=>{}),this.stream.once("close",()=>{var e;p("Request to method "+(null==(e=this.handler)?void 0:e.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:o.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if("identity"===t)return r;if("deflate"!==t&&"gzip"!==t)return Promise.reject({code:o.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`});{let e;return e="deflate"===t?a.createInflate():a.createGunzip(),new Promise((t,n)=>{let i=0,s=[];e.on("data",t=>{s.push(t),i+=t.byteLength,-1!==this.maxReceiveMessageSize&&i>this.maxReceiveMessageSize&&(e.destroy(),n({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),e.on("end",()=>{t(Buffer.concat(s))}),e.write(r),e.end()})}}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},S),b),t);this.stream.respond(r,T)}receiveMetadata(e){let t=l.Metadata.fromHttp2Headers(e);u.isTracerEnabled(h)&&p("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(g);if(r.length>0){let e=r[0].toString().match(y);if(null===e){let e=Error("Invalid deadline");return e.code=o.Status.OUT_OF_RANGE,this.sendError(e),t}let n=e[1]*v[e[2]]|0,i=new Date;this.deadline=i.setMilliseconds(i.getMilliseconds()+n),this.deadlineTimer=setTimeout(x,n,this),t.remove(g)}return t.remove(i.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(i.constants.HTTP2_HEADER_TE),t.remove(i.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:n}=this,i=0,s=this,a=[],l=this.maxReceiveMessageSize;function c(e){if(i+=e.byteLength,-1!==l&&i>l){n.removeListener("data",c),n.removeListener("end",u),n.removeListener("error",u),r({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${i} vs. ${l})`});return}a.push(e)}function u(l){if(n.removeListener("data",c),n.removeListener("end",u),n.removeListener("error",u),void 0!==l)return void r({code:o.Status.INTERNAL,details:l.message});if(0===i)return void r({code:o.Status.INTERNAL,details:"received empty unary message"});s.emit("receiveMessage");let d=Buffer.concat(a,i),h=1===d.readUInt8(0)?e:"identity",p=s.getDecompressedMessage(d,h);if(Buffer.isBuffer(p))return void t(s.deserializeMessageWithInternalError(p));p.then(e=>t(s.deserializeMessageWithInternalError(e)),t=>r(t.code?t:{code:o.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u)})}async deserializeMessageWithInternalError(e){try{return this.deserializeMessage(e)}catch(e){throw{details:(0,d.getErrorMessage)(e),code:o.Status.INTERNAL}}}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,n=Buffer.allocUnsafe(r+5);return n.writeUInt8(0,0),n.writeUInt32BE(r,1),t.copy(n,5),n}deserializeMessage(e){return this.handler.deserialize(e)}async sendUnaryMessage(e,t,r,n){if(!this.checkCancelled()){if(void 0===r&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let e=this.serializeMessage(t);this.write(e),this.sendStatus({code:o.Status.OK,details:"OK",metadata:r})}catch(e){this.sendError({details:(0,d.getErrorMessage)(e),code:o.Status.INTERNAL})}}}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===o.Status.OK),!this.checkCancelled())if(p("Request to method "+(null==(t=this.handler)?void 0:t.path)+" ended with status code: "+o.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var t;let r=Object.assign({[m]:e.code,[f]:encodeURI(e.details)},null==(t=e.metadata)?void 0:t.toHttp2Headers());this.stream.sendTrailers(r),this.statusSent=!0}),this.stream.end());else{let t=Object.assign(Object.assign({[m]:e.code,[f]:encodeURI(e.details)},S),null==(r=e.metadata)?void 0:r.toHttp2Headers());this.stream.respond(t,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:o.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&void 0!==e.metadata?e.metadata:null};"code"in e&&"number"==typeof e.code&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&"string"==typeof e.details&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled())return -1!==this.maxSendMessageSize&&e.length>this.maxSendMessageSize?void this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`}):(this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e))}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new c.StreamDecoder(this.maxReceiveMessageSize),n=!1,i=!1,s=!1,a=async()=>{s||!n||i||(s=!0,await this.pushOrBufferMessage(e,null))};this.stream.on("data",async n=>{let s;try{s=r.write(n)}catch(e){this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:e.message});return}for(let r of(i=!0,this.stream.pause(),s)){let n;this.emit("receiveMessage");let i=1===r.readUInt8(0)?t:"identity";try{n=await this.getDecompressedMessage(r,i)}catch(e){this.sendError(e);return}if(!n)return;await this.pushOrBufferMessage(e,n)}i=!1,this.stream.resume(),await a()}),this.stream.once("end",async()=>{n=!0,await a()})}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(null===t||!1===r){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(e,t){this.isPushPending?this.bufferedMessages.push(t):await this.pushMessage(e,t)}async pushMessage(e,t){if(null===t){p("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}p("Received message of length "+t.length),this.isPushPending=!0;try{let r=await this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let t=(0,d.getErrorCode)(r);(null===t||t<o.Status.OK||t>o.Status.UNAUTHENTICATED)&&(t=o.Status.INTERNAL),e.emit("error",{details:(0,d.getErrorMessage)(r),code:t})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(e,this.bufferedMessages.shift())}getPeer(){var e;let t=null==(e=this.stream.session)?void 0:e.socket;return null!=t&&t.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function x(e){let t=Error("Deadline exceeded");t.code=o.Status.DEADLINE_EXCEEDED,e.sendError(t),e.cancelled=!0,e.emit("cancelled","deadline")}t.Http2ServerCallStream=I},2896:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,6444,23)),Promise.resolve().then(r.t.bind(r,6042,23)),Promise.resolve().then(r.t.bind(r,8170,23)),Promise.resolve().then(r.t.bind(r,9477,23)),Promise.resolve().then(r.t.bind(r,9345,23)),Promise.resolve().then(r.t.bind(r,2089,23)),Promise.resolve().then(r.t.bind(r,6577,23)),Promise.resolve().then(r.t.bind(r,1307,23))},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3038:(e,t,r)=>{"use strict";var n,i,s,a;Object.defineProperty(t,"__esModule",{value:!0}),t.isTracerEnabled=t.trace=t.log=t.setLoggerVerbosity=t.setLogger=t.getLogger=void 0;let o=r(3122),l=r(9771),c=r(6243).rE,u={error:(e,...t)=>{console.error("E "+e,...t)},info:(e,...t)=>{console.error("I "+e,...t)},debug:(e,...t)=>{console.error("D "+e,...t)}},d=o.LogVerbosity.ERROR;switch((null!=(i=null!=(n=process.env.GRPC_NODE_VERBOSITY)?n:process.env.GRPC_VERBOSITY)?i:"").toUpperCase()){case"DEBUG":d=o.LogVerbosity.DEBUG;break;case"INFO":d=o.LogVerbosity.INFO;break;case"ERROR":d=o.LogVerbosity.ERROR;break;case"NONE":d=o.LogVerbosity.NONE}t.getLogger=()=>u,t.setLogger=e=>{u=e},t.setLoggerVerbosity=e=>{d=e},t.log=(e,...t)=>{let r;if(e>=d){switch(e){case o.LogVerbosity.DEBUG:r=u.debug;break;case o.LogVerbosity.INFO:r=u.info;break;case o.LogVerbosity.ERROR:r=u.error}r||(r=u.error),r&&r.bind(u)(...t)}};let h=null!=(a=null!=(s=process.env.GRPC_NODE_TRACE)?s:process.env.GRPC_TRACE)?a:"",p=new Set,f=new Set;for(let e of h.split(","))e.startsWith("-")?f.add(e.substring(1)):p.add(e);let m=p.has("all");function g(e,r,n){y(r)&&(0,t.log)(e,new Date().toISOString()+" | v"+c+" "+l.pid+" | "+r+" | "+n)}function y(e){return!f.has(e)&&(m||p.has(e))}t.trace=g,t.isTracerEnabled=y},3076:(e,t,r)=>{"use strict";e.exports=o;var n=r(7968);((o.prototype=Object.create(n.prototype)).constructor=o).className="Service";var i=r(1202),s=r(3107),a=r(7236);function o(e,t){n.call(this,e,t),this.methods={},this._methodsArray=null}function l(e){return e._methodsArray=null,e}o.fromJSON=function(e,t){var r=new o(e,t.options);if(t.methods)for(var n=Object.keys(t.methods),s=0;s<n.length;++s)r.add(i.fromJSON(n[s],t.methods[n[s]]));return t.nested&&r.addJSON(t.nested),t.edition&&(r._edition=t.edition),r.comment=t.comment,r._defaultEdition="proto3",r},o.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"methods",n.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},Object.defineProperty(o.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=s.toArray(this.methods))}}),o.prototype.get=function(e){return this.methods[e]||n.prototype.get.call(this,e)},o.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;n.prototype.resolve.call(this);for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return this},o.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(e=this._edition||e,n.prototype._resolveFeaturesRecursive.call(this,e),this.methodsArray.forEach(t=>{t._resolveFeaturesRecursive(e)})),this},o.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,l(this)):n.prototype.add.call(this,e)},o.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,l(this)}return n.prototype.remove.call(this,e)},o.prototype.create=function(e,t,r){for(var n,i=new a.Service(e,t,r),o=0;o<this.methodsArray.length;++o){var l=s.lcFirst((n=this._methodsArray[o]).resolve().name).replace(/[^$\w_]/g,"");i[l]=s.codegen(["r","c"],s.isReserved(l)?l+"_":l)("return this.rpcCall(m,q,s,r,c)")({m:n,q:n.resolvedRequestType.ctor,s:n.resolvedResponseType.ctor})}return i}},3107:(e,t,r)=>{"use strict";var n,i,s=e.exports=r(8707),a=r(6642);s.codegen=r(8344),s.fetch=r(7757),s.path=r(1140),s.fs=s.inquire("fs"),s.toArray=function(e){if(e){for(var t=Object.keys(e),r=Array(t.length),n=0;n<t.length;)r[n]=e[t[n++]];return r}return[]},s.toObject=function(e){for(var t={},r=0;r<e.length;){var n=e[r++],i=e[r++];void 0!==i&&(t[n]=i)}return t};var o=/\\/g,l=/"/g;s.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},s.safeProp=function(e){return!/^[$\w_]+$/.test(e)||s.isReserved(e)?'["'+e.replace(o,"\\\\").replace(l,'\\"')+'"]':"."+e},s.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var c=/_([a-z])/g;s.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(c,function(e,t){return t.toUpperCase()})},s.compareFieldsById=function(e,t){return e.id-t.id},s.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(s.decorateRoot.remove(e.$type),e.$type.name=t,s.decorateRoot.add(e.$type)),e.$type;n||(n=r(4351));var i=new n(t||e.name);return s.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var u=0;s.decorateEnum=function(e){if(e.$type)return e.$type;i||(i=r(2110));var t=new i("Enum"+u++,e);return s.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t},s.setProperty=function(e,t,r,n){function i(e,t,r){var s=t.shift();if("__proto__"===s||"prototype"===s)return e;if(t.length>0)e[s]=i(e[s]||{},t,r);else{var a=e[s];if(a&&n)return e;a&&(r=[].concat(a).concat(r)),e[s]=r}return e}if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return i(e,t=t.split("."),r)},Object.defineProperty(s,"decorateRoot",{get:function(){return a.decorated||(a.decorated=new(r(2703)))}})},3112:(e,t,r)=>{"use strict";let n,i;r.r(t),r.d(t,{default:()=>Tw});var s,a,o,l,c,u=r(687),d=r(3210);let h=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),p=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),f=e=>{let t=p(e);return t.charAt(0).toUpperCase()+t.slice(1)},m=(...e)=>e.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim(),g=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};var y={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let v=(0,d.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:r=2,absoluteStrokeWidth:n,className:i="",children:s,iconNode:a,...o},l)=>(0,d.createElement)("svg",{ref:l,...y,width:t,height:t,stroke:e,strokeWidth:n?24*Number(r)/Number(t):r,className:m("lucide",i),...!s&&!g(o)&&{"aria-hidden":"true"},...o},[...a.map(([e,t])=>(0,d.createElement)(e,t)),...Array.isArray(s)?s:[s]])),b=(e,t)=>{let r=(0,d.forwardRef)(({className:r,...n},i)=>(0,d.createElement)(v,{ref:i,iconNode:t,className:m(`lucide-${h(f(e))}`,`lucide-${e}`,r),...n}));return r.displayName=f(e),r},S=b("receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]),T=b("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),E=b("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),w=b("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),C=b("trash-2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),_=b("calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]),I=b("pen-line",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]),x=()=>void 0,k={NODE_CLIENT:!1,SDK_VERSION:"${JSCORE_VERSION}"},N=function(e){return Error("Firebase Database ("+k.SDK_VERSION+") INTERNAL ASSERT FAILED: "+e)},R=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},A=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=e[r++],a=((7&i)<<18|(63&s)<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(a>>10)),t[n++]=String.fromCharCode(56320+(1023&a))}else{let s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},D={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,c=i>>2,u=(3&i)<<4|a>>4,d=(15&a)<<2|l>>6,h=63&l;!o&&(h=64,s||(d=64)),n.push(r[c],r[u],r[d],r[h])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(R(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):A(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new O;let l=i<<2|s>>4;if(n.push(l),64!==a){let e=s<<4&240|a>>2;if(n.push(e),64!==o){let e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class O extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let P=function(e){let t=R(e);return D.encodeByteArray(t,!0)},M=function(e){return P(e).replace(/\./g,"")},L=function(e){try{return D.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function F(e){return"__proto__"!==e}function B(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("Unable to locate global object.")}let j=()=>B().__FIREBASE_DEFAULTS__,U=()=>{if("undefined"==typeof process||void 0===process.env)return;let e=process.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},V=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&L(e[1]);return t&&JSON.parse(t)},z=()=>{try{return x()||j()||U()||V()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},q=e=>{var t,r;return null==(r=null==(t=z())?void 0:t.emulatorHosts)?void 0:r[e]},$=e=>{let t=q(e);if(!t)return;let r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]},G=()=>{var e;return null==(e=z())?void 0:e.config};class K{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function W(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(e){return!1}}async function H(e){return(await fetch(e,{credentials:"include"})).ok}function Q(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let r={alg:"none",type:"JWT"},n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let a=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e),o="";return[M(JSON.stringify(r)),M(JSON.stringify(a)),o].join(".")}let Y={};function J(){let e={prod:[],emulator:[]};for(let t of Object.keys(Y))Y[t]?e.emulator.push(t):e.prod.push(t);return e}function X(e){let t=document.getElementById(e),r=!1;return t||((t=document.createElement("div")).setAttribute("id",e),r=!0),{created:r,element:t}}let Z=!1;function ee(e,t){if("undefined"==typeof window||"undefined"==typeof document||!W(window.location.host)||Y[e]===t||Y[e]||Z)return;function r(e){return`__firebase__banner__${e}`}Y[e]=t;let n="__firebase__banner",i=J().prod.length>0;function s(){let e=document.getElementById(n);e&&e.remove()}function a(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}function o(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}function l(){let e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{Z=!0,s()},e}function c(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}function u(){let e=X(n),t=r("text"),s=document.getElementById(t)||document.createElement("span"),u=r("learnmore"),d=document.getElementById(u)||document.createElement("a"),h=r("preprendIcon"),p=document.getElementById(h)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){let t=e.element;a(t),c(d,u);let r=l();o(p,h),t.append(p,s,d,r),document.body.appendChild(t)}i?(s.innerText="Preview backend disconnected.",p.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(p.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,s.innerText="Preview backend running in this workspace."),s.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",u):u()}function et(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function er(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(et())}function en(){var e;let t=null==(e=z())?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function ei(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function es(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function ea(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function eo(){return!en()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function el(){return!en()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function ec(){try{return"object"==typeof indexedDB}catch(e){return!1}}function eu(){return new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{var e;t((null==(e=i.error)?void 0:e.message)||"")}}catch(e){t(e)}})}let ed="FirebaseError";class eh extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=ed,Object.setPrototypeOf(this,eh.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ep.prototype.create)}}class ep{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},n=`${this.service}/${e}`,i=this.errors[e],s=i?ef(i,r):"Error",a=`${this.serviceName}: ${s} (${n}).`;return new eh(n,a,r)}}function ef(e,t){return e.replace(em,(e,r)=>{let n=t[r];return null!=n?String(n):`<${r}?>`})}let em=/\{\$([^}]+)}/g;function eg(e){return JSON.parse(e)}function ey(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let i of r){if(!n.includes(i))return!1;let r=e[i],s=t[i];if(ev(r)&&ev(s)){if(!ey(r,s))return!1}else if(r!==s)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function ev(e){return null!==e&&"object"==typeof e}function eb(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function eS(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function eT(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}function eE(e,t){let r=new ew(e,t);return r.subscribe.bind(r)}class ew{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(n=eC(e,["next","error","complete"])?e:{next:e,error:t,complete:r}).next&&(n.next=e_),void 0===n.error&&(n.error=e_),void 0===n.complete&&(n.complete=e_);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function eC(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}function e_(){}function eI(e){return e&&e._delegate?e._delegate:e}k.NODE_CLIENT=!0;class ex{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let ek="[DEFAULT]";class eN{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new K;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),n=null!=(t=null==e?void 0:e.optional)&&t;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(e){if(n)return null;throw e}if(n)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(eA(e))try{this.getOrInitializeService({instanceIdentifier:ek})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=ek){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=ek){return this.instances.has(e)}getOptions(e=ek){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(n);return n}onInit(e,t){var r;let n=this.normalizeInstanceIdentifier(t),i=null!=(r=this.onInitCallbacks.get(n))?r:new Set;i.add(e),this.onInitCallbacks.set(n,i);let s=this.instances.get(n);return s&&e(s,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let n of r)try{n(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:eR(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch(e){}return r||null}normalizeInstanceIdentifier(e=ek){return this.component?this.component.multipleInstances?e:ek:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}function eR(e){return e===ek?void 0:e}function eA(e){return"EAGER"===e.instantiationMode}class eD{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new eN(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let eO=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(s||(s={}));let eP={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},eM=s.INFO,eL={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},eF=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=eL[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eB{constructor(e){this.name=e,this._logLevel=eM,this._logHandler=eF,this._userLogHandler=null,eO.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in s))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?eP[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...e),this._logHandler(this,s.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...e),this._logHandler(this,s.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,s.INFO,...e),this._logHandler(this,s.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,s.WARN,...e),this._logHandler(this,s.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,s.ERROR,...e),this._logHandler(this,s.ERROR,...e)}}let ej=(e,t)=>t.some(t=>e instanceof t);function eU(){return n||(n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function eV(){return i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let ez=new WeakMap,eq=new WeakMap,e$=new WeakMap,eG=new WeakMap,eK=new WeakMap;function eW(e){let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(eZ(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&ez.set(t,e)}).catch(()=>{}),eK.set(t,e),t}function eH(e){if(eq.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});eq.set(e,t)}let eQ={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return eq.get(e);if("objectStoreNames"===t)return e.objectStoreNames||e$.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return eZ(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eY(e){eQ=e(eQ)}function eJ(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?eV().includes(e)?function(...t){return e.apply(e0(this),t),eZ(ez.get(this))}:function(...t){return eZ(e.apply(e0(this),t))}:function(t,...r){let n=e.call(e0(this),t,...r);return e$.set(n,t.sort?t.sort():[t]),eZ(n)}}function eX(e){return"function"==typeof e?eJ(e):(e instanceof IDBTransaction&&eH(e),ej(e,eU()))?new Proxy(e,eQ):e}function eZ(e){if(e instanceof IDBRequest)return eW(e);if(eG.has(e))return eG.get(e);let t=eX(e);return t!==e&&(eG.set(e,t),eK.set(t,e)),t}let e0=e=>eK.get(e);function e1(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,t),o=eZ(a);return n&&a.addEventListener("upgradeneeded",e=>{n(eZ(a.result),e.oldVersion,e.newVersion,eZ(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}let e2=["get","getKey","getAll","getAllKeys","count"],e3=["put","add","delete","clear"],e6=new Map;function e4(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(e6.get(t))return e6.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=e3.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||e2.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return e6.set(t,s),s}eY(e=>({...e,get:(t,r,n)=>e4(t,r)||e.get(t,r,n),has:(t,r)=>!!e4(t,r)||e.has(t,r)}));class e5{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!e8(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}function e8(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}let e7="@firebase/app",e9="0.13.2",te=new eB("@firebase/app"),tt="11.10.0",tr="[DEFAULT]",tn={[e7]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},ti=new Map,ts=new Map,ta=new Map;function to(e,t){try{e.container.addComponent(t)}catch(r){te.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function tl(e){let t=e.name;if(ta.has(t))return te.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(ta.set(t,e),ti.values()))to(r,e);for(let t of ts.values())to(t,e);return!0}function tc(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function tu(e){return null!=e&&void 0!==e.settings}let td=new ep("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class th{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ex("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw td.create("app-deleted",{appName:this._name})}}function tp(e,t){let r=L(e.split(".")[1]);return null===r?void console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(r).exp?void console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):void(1e3*JSON.parse(r).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`))}let tf=tt;function tm(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let n=Object.assign({name:tr,automaticDataCollectionEnabled:!0},t),i=n.name;if("string"!=typeof i||!i)throw td.create("bad-app-name",{appName:String(i)});if(r||(r=G()),!r)throw td.create("no-options");let s=ti.get(i);if(s)if(ey(r,s.options)&&ey(n,s.config))return s;else throw td.create("duplicate-app",{appName:i});let a=new eD(i);for(let e of ta.values())a.addComponent(e);let o=new th(r,n,a);return ti.set(i,o),o}function tg(e=tr){let t=ti.get(e);if(!t&&e===tr&&G())return tm();if(!t)throw td.create("no-app",{appName:e});return t}async function ty(e){let t=!1,r=e.name;ti.has(r)?(t=!0,ti.delete(r)):ts.has(r)&&0>=e.decRefCount()&&(ts.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function tv(e,t,r){var n;let i=null!=(n=tn[e])?n:e;r&&(i+=`-${r}`);let s=i.match(/\s|\//),a=t.match(/\s|\//);if(s||a){let e=[`Unable to register library "${i}" with version "${t}":`];s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),te.warn(e.join(" "));return}tl(new ex(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}let tb="firebase-heartbeat-database",tS=1,tT="firebase-heartbeat-store",tE=null;function tw(){return tE||(tE=e1(tb,tS,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(tT)}catch(e){console.warn(e)}}}).catch(e=>{throw td.create("idb-open",{originalErrorMessage:e.message})})),tE}async function tC(e){try{let t=(await tw()).transaction(tT),r=await t.objectStore(tT).get(tI(e));return await t.done,r}catch(e){if(e instanceof eh)te.warn(e.message);else{let t=td.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});te.warn(t.message)}}}async function t_(e,t){try{let r=(await tw()).transaction(tT,"readwrite"),n=r.objectStore(tT);await n.put(t,tI(e)),await r.done}catch(e){if(e instanceof eh)te.warn(e.message);else{let t=td.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});te.warn(t.message)}}}function tI(e){return`${e.name}!${e.options.appId}`}let tx=1024,tk=30;class tN{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new tD(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{let r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=tR();if((null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(e=>e.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:r}),this._heartbeatsCache.heartbeats.length>tk){let e=tP(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){te.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=tR(),{heartbeatsToSend:r,unsentEntries:n}=tA(this._heartbeatsCache.heartbeats),i=M(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return te.warn(e),""}}}function tR(){return new Date().toISOString().substring(0,10)}function tA(e,t=tx){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),tO(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),tO(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}class tD{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!ec()&&eu().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await tC(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let r=await this.read();return t_(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let r=await this.read();return t_(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}}}function tO(e){return M(JSON.stringify({version:2,heartbeats:e})).length}function tP(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(function(e){tl(new ex("platform-logger",e=>new e5(e),"PRIVATE")),tl(new ex("heartbeat",e=>new tN(e),"PRIVATE")),tv(e7,e9,""),tv(e7,e9,"esm2017"),tv("fire-js","")})(""),tv("firebase","11.10.0","app");var tM=function(e,t){return(tM=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function tL(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,n=Object.getOwnPropertySymbols(e);i<n.length;i++)0>t.indexOf(n[i])&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]]);return r}var tF=Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]};function tB(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function tj(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,s=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return a}function tU(e){return this instanceof tU?(this.v=e,this):new tU(e)}var tV=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},tz=function(e){return(tz=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t})(e)},tq="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var n=Error(r);return n.name="SuppressedError",n.error=e,n.suppressed=t,n};function t$(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}let tG=t$,tK=new ep("auth","Firebase",t$()),tW=new eB("@firebase/auth");function tH(e,...t){tW.logLevel<=s.WARN&&tW.warn(`Auth (${tf}): ${e}`,...t)}function tQ(e,...t){tW.logLevel<=s.ERROR&&tW.error(`Auth (${tf}): ${e}`,...t)}function tY(e,...t){throw t0(e,...t)}function tJ(e,...t){return t0(e,...t)}function tX(e,t,r){return new ep("auth","Firebase",Object.assign(Object.assign({},tG()),{[t]:r})).create(t,{appName:e.name})}function tZ(e){return tX(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function t0(e,...t){if("string"!=typeof e){let r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return tK.create(e,...t)}function t1(e,t,...r){if(!e)throw t0(t,...r)}function t2(e){let t="INTERNAL ASSERTION FAILED: "+e;throw tQ(t),Error(t)}function t3(e,t){e||t2(t)}function t6(){return"http:"===t4()||"https:"===t4()}function t4(){var e;return"undefined"!=typeof self&&(null==(e=self.location)?void 0:e.protocol)||null}function t5(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(t6()||es()||"connection"in navigator))||navigator.onLine}function t8(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}class t7{constructor(e,t){this.shortDelay=e,this.longDelay=t,t3(t>e,"Short delay should be less than long delay!"),this.isMobile=er()||ea()}get(){return t5()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function t9(e,t){t3(e.emulator,"Emulator should always be set here");let{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}class re{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void t2("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void t2("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void t2("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let rt={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},rr=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],rn=new t7(3e4,6e4);function ri(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function rs(e,t,r,n,i={}){return ra(e,i,async()=>{let i={},s={};n&&("GET"===t?s=n:i={body:JSON.stringify(n)});let a=eb(Object.assign({key:e.config.apiKey},s)).slice(1),o=await e._getAdditionalHeaders();o["Content-Type"]="application/json",e.languageCode&&(o["X-Firebase-Locale"]=e.languageCode);let l=Object.assign({method:t,headers:o},i);return ei()||(l.referrerPolicy="no-referrer"),e.emulatorConfig&&W(e.emulatorConfig.host)&&(l.credentials="include"),re.fetch()(await rl(e,e.config.apiHost,r,a),l)})}async function ra(e,t,r){e._canInitEmulator=!1;let n=Object.assign(Object.assign({},rt),t);try{let t=new ru(e),i=await Promise.race([r(),t.promise]);t.clearNetworkTimeout();let s=await i.json();if("needConfirmation"in s)throw rd(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{let[t,r]=(i.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw rd(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw rd(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw rd(e,"user-disabled",s);let a=n[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(r)throw tX(e,a,r);tY(e,a)}}catch(t){if(t instanceof eh)throw t;tY(e,"network-request-failed",{message:String(t)})}}async function ro(e,t,r,n,i={}){let s=await rs(e,t,r,n,i);return"mfaPendingCredential"in s&&tY(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function rl(e,t,r,n){let i=`${t}${r}?${n}`,s=e,a=s.config.emulator?t9(e.config,i):`${e.config.apiScheme}://${i}`;return rr.includes(r)&&(await s._persistenceManagerAvailable,"COOKIE"===s._getPersistenceType())?s._getPersistence()._getFinalTarget(a).toString():a}function rc(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class ru{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(tJ(this.auth,"network-request-failed")),rn.get())})}}function rd(e,t,r){let n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);let i=tJ(e,t,n);return i.customData._tokenResponse=r,i}function rh(e){return void 0!==e&&void 0!==e.enterprise}class rp{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return rc(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function rf(e,t){return rs(e,"GET","/v2/recaptchaConfig",ri(e,t))}async function rm(e,t){return rs(e,"POST","/v1/accounts:delete",t)}async function rg(e,t){return rs(e,"POST","/v1/accounts:lookup",t)}function ry(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function rv(e,t=!1){let r=eI(e),n=await r.getIdToken(t),i=rS(n);t1(i&&i.exp&&i.auth_time&&i.iat,r.auth,"internal-error");let s="object"==typeof i.firebase?i.firebase:void 0,a=null==s?void 0:s.sign_in_provider;return{claims:i,token:n,authTime:ry(rb(i.auth_time)),issuedAtTime:ry(rb(i.iat)),expirationTime:ry(rb(i.exp)),signInProvider:a||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}function rb(e){return 1e3*Number(e)}function rS(e){let[t,r,n]=e.split(".");if(void 0===t||void 0===r||void 0===n)return tQ("JWT malformed, contained fewer than 3 sections"),null;try{let e=L(r);if(!e)return tQ("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return tQ("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function rT(e){let t=rS(e);return t1(t,"internal-error"),t1(void 0!==t.exp,"internal-error"),t1(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function rE(e,t,r=!1){if(r)return t;try{return await t}catch(t){throw t instanceof eh&&rw(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}function rw({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}class rC{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(!e)return this.errorBackoff=3e4,Math.max(0,(null!=(t=this.user.stsTokenManager.expirationTime)?t:0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(null==e?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class r_{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ry(this.lastLoginAt),this.creationTime=ry(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function rI(e){var t;let r=e.auth,n=await e.getIdToken(),i=await rE(e,rg(r,{idToken:n}));t1(null==i?void 0:i.users.length,r,"internal-error");let s=i.users[0];e._notifyReloadListener(s);let a=(null==(t=s.providerUserInfo)?void 0:t.length)?rN(s.providerUserInfo):[],o=rk(e.providerData,a),l=e.isAnonymous,c=!(e.email&&s.passwordHash)&&!(null==o?void 0:o.length),u=!!l&&c;Object.assign(e,{uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new r_(s.createdAt,s.lastLoginAt),isAnonymous:u})}async function rx(e){let t=eI(e);await rI(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function rk(e,t){return[...e.filter(e=>!t.some(t=>t.providerId===e.providerId)),...t]}function rN(e){return e.map(e=>{var{providerId:t}=e,r=tL(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}async function rR(e,t){let r=await ra(e,{},async()=>{let r=eb({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:i}=e.config,s=await rl(e,n,"/v1/token",`key=${i}`),a=await e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let o={method:"POST",headers:a,body:r};return e.emulatorConfig&&W(e.emulatorConfig.host)&&(o.credentials="include"),re.fetch()(s,o)});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function rA(e,t){return rs(e,"POST","/v2/accounts:revokeToken",ri(e,t))}class rD{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){t1(e.idToken,"internal-error"),t1(void 0!==e.idToken,"internal-error"),t1(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):rT(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){t1(0!==e.length,"internal-error");let t=rT(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(t1(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:r,refreshToken:n,expiresIn:i}=await rR(e,t);this.updateTokensAndExpiration(r,n,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){let{refreshToken:r,accessToken:n,expirationTime:i}=t,s=new rD;return r&&(t1("string"==typeof r,"internal-error",{appName:e}),s.refreshToken=r),n&&(t1("string"==typeof n,"internal-error",{appName:e}),s.accessToken=n),i&&(t1("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new rD,this.toJSON())}_performRefresh(){return t2("not implemented")}}function rO(e,t){t1("string"==typeof e||void 0===e,"internal-error",{appName:t})}class rP{constructor(e){var{uid:t,auth:r,stsTokenManager:n}=e,i=tL(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new rC(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new r_(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){let t=await rE(this,this.stsTokenManager.getToken(this.auth,e));return t1(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return rv(this,e)}reload(){return rx(this)}_assign(e){this!==e&&(t1(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>Object.assign({},e)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new rP(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){t1(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await rI(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(tu(this.auth.app))return Promise.reject(tZ(this.auth));let e=await this.getIdToken();return await rE(this,rm(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,n,i,s,a,o,l,c;let u=null!=(r=t.displayName)?r:void 0,d=null!=(n=t.email)?n:void 0,h=null!=(i=t.phoneNumber)?i:void 0,p=null!=(s=t.photoURL)?s:void 0,f=null!=(a=t.tenantId)?a:void 0,m=null!=(o=t._redirectEventId)?o:void 0,g=null!=(l=t.createdAt)?l:void 0,y=null!=(c=t.lastLoginAt)?c:void 0,{uid:v,emailVerified:b,isAnonymous:S,providerData:T,stsTokenManager:E}=t;t1(v&&E,e,"internal-error");let w=rD.fromJSON(this.name,E);t1("string"==typeof v,e,"internal-error"),rO(u,e.name),rO(d,e.name),t1("boolean"==typeof b,e,"internal-error"),t1("boolean"==typeof S,e,"internal-error"),rO(h,e.name),rO(p,e.name),rO(f,e.name),rO(m,e.name),rO(g,e.name),rO(y,e.name);let C=new rP({uid:v,auth:e,email:d,emailVerified:b,displayName:u,isAnonymous:S,photoURL:p,phoneNumber:h,tenantId:f,stsTokenManager:w,createdAt:g,lastLoginAt:y});return T&&Array.isArray(T)&&(C.providerData=T.map(e=>Object.assign({},e))),m&&(C._redirectEventId=m),C}static async _fromIdTokenResponse(e,t,r=!1){let n=new rD;n.updateFromServerResponse(t);let i=new rP({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:r});return await rI(i),i}static async _fromGetAccountInfoResponse(e,t,r){let n=t.users[0];t1(void 0!==n.localId,"internal-error");let i=void 0!==n.providerUserInfo?rN(n.providerUserInfo):[],s=!(n.email&&n.passwordHash)&&!(null==i?void 0:i.length),a=new rD;a.updateFromIdToken(r);let o=new rP({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:s});return Object.assign(o,{uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new r_(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!(null==i?void 0:i.length)}),o}}let rM=new Map;function rL(e){t3(e instanceof Function,"Expected a class definition");let t=rM.get(e);return t?t3(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,rM.set(e,t)),t}class rF{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}rF.type="NONE";let rB=rF;function rj(e,t,r){return`firebase:${e}:${t}:${r}`}class rU{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:n,name:i}=this.auth;this.fullUserKey=rj(this.userKey,n.apiKey,i),this.fullPersistenceKey=rj("persistence",n.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await rg(this.auth,{idToken:e}).catch(()=>void 0);return t?rP._fromGetAccountInfoResponse(this.auth,t,e):null}return rP._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new rU(rL(rB),e,r);let n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=n[0]||rL(rB),s=rj(r,e.config.apiKey,e.name),a=null;for(let r of t)try{let t=await r._get(s);if(t){let n;if("string"==typeof t){let r=await rg(e,{idToken:t}).catch(()=>void 0);if(!r)break;n=await rP._fromGetAccountInfoResponse(e,r,t)}else n=rP._fromJSON(e,t);r!==i&&(a=n),i=r;break}}catch(e){}let o=n.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length&&(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch(e){}}))),new rU(i,e,r)}}function rV(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(rG(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(rz(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(rW(t))return"Blackberry";if(rH(t))return"Webos";if(rq(t))return"Safari";if((t.includes("chrome/")||r$(t))&&!t.includes("edge/"))return"Chrome";if(rK(t))return"Android";let r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(r);if((null==n?void 0:n.length)===2)return n[1]}return"Other"}function rz(e=et()){return/firefox\//i.test(e)}function rq(e=et()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function r$(e=et()){return/crios\//i.test(e)}function rG(e=et()){return/iemobile/i.test(e)}function rK(e=et()){return/android/i.test(e)}function rW(e=et()){return/blackberry/i.test(e)}function rH(e=et()){return/webos/i.test(e)}function rQ(e,t=[]){let r;switch(e){case"Browser":r=rV(et());break;case"Worker":r=`${rV(et())}-${e}`;break;default:r=e}let n=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${tf}/${n}`}class rY{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=t=>new Promise((r,n)=>{try{let n=e(t);r(n)}catch(e){n(e)}});r.onAbort=t,this.queue.push(r);let n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}async function rJ(e,t={}){return rs(e,"GET","/v2/passwordPolicy",ri(e,t))}let rX=6;class rZ{constructor(e){var t,r,n,i;let s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!=(t=s.minPasswordLength)?t:rX,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),void 0!==s.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),void 0!==s.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),void 0!==s.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),void 0!==s.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!=(n=null==(r=e.allowedNonAlphanumericCharacters)?void 0:r.join(""))?n:"",this.forceUpgradeOnSignin=null!=(i=e.forceUpgradeOnSignin)&&i,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,n,i,s,a;let o={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,o),this.validatePasswordCharacterOptions(e,o),o.isValid&&(o.isValid=null==(t=o.meetsMinPasswordLength)||t),o.isValid&&(o.isValid=null==(r=o.meetsMaxPasswordLength)||r),o.isValid&&(o.isValid=null==(n=o.containsLowercaseLetter)||n),o.isValid&&(o.isValid=null==(i=o.containsUppercaseLetter)||i),o.isValid&&(o.isValid=null==(s=o.containsNumericCharacter)||s),o.isValid&&(o.isValid=null==(a=o.containsNonAlphanumericCharacter)||a),o}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)r=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,n,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class r0{constructor(e,t,r,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new r2(this),this.idTokenSubscription=new r2(this),this.beforeStateQueue=new rY(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=tK,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=rL(t)),this._initializationPromise=this.queue(async()=>{var r,n,i;if(!this._deleted){if(this.persistenceManager=await rU.create(this,e),null==(r=this._resolvePersistenceManagerAvailable)||r.call(this),!this._deleted){if(null==(n=this._popupRedirectResolver)?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null==(i=this.currentUser)?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await rg(this,{idToken:e}),r=await rP._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(tu(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let r=await this.assertedPersistence.getCurrentUser(),n=r,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let r=null==(t=this.redirectUser)?void 0:t._redirectEventId,s=null==n?void 0:n._redirectEventId,a=await this.tryRedirectSignIn(e);(!r||r===s)&&(null==a?void 0:a.user)&&(n=a.user,i=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(n)}catch(e){n=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return(t1(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId)?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await rI(e)}catch(e){if((null==e?void 0:e.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=t8()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(tu(this.app))return Promise.reject(tZ(this));let t=e?eI(e):null;return t&&t1(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&t1(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return tu(this.app)?Promise.reject(tZ(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return tu(this.app)?Promise.reject(tZ(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(rL(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new rZ(await rJ(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ep("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await rA(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null==(e=this._currentUser)?void 0:e.toJSON()}}async _setRedirectUser(e,t){let r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&rL(e)||this._popupRedirectResolver;t1(t,this,"argument-error"),this.redirectPersistenceManager=await rU.create(this,[rL(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return(this._isInitialized&&await this.queue(async()=>{}),(null==(t=this._currentUser)?void 0:t._redirectEventId)===e)?this._currentUser:(null==(r=this.redirectUser)?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let r=null!=(t=null==(e=this.currentUser)?void 0:e.uid)?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,n){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(t1(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),"function"==typeof t){let i=e.addObserver(t,r,n);return()=>{s=!0,i()}}{let r=e.addObserver(t);return()=>{s=!0,r()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return t1(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=rQ(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let r=await (null==(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);let n=await this._getAppCheckToken();return n&&(t["X-Firebase-AppCheck"]=n),t}async _getAppCheckToken(){var e;if(tu(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=await (null==(e=this.appCheckServiceProvider.getImmediate({optional:!0}))?void 0:e.getToken());return(null==t?void 0:t.error)&&tH(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function r1(e){return eI(e)}class r2{constructor(e){this.auth=e,this.observer=null,this.addObserver=eE(e=>this.observer=e)}get next(){return t1(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let r3={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function r6(e){return r3.loadJS(e)}function r4(){return r3.recaptchaEnterpriseScript}class r5{constructor(){this.enterprise=new r8}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class r8{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let r7="recaptcha-enterprise",r9="NO_RECAPTCHA";class ne{constructor(e){this.type=r7,this.auth=r1(e)}async verify(e="verify",t=!1){async function r(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,r)=>{rf(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(n=>{if(void 0===n.recaptchaKey)r(Error("recaptcha Enterprise site key undefined"));else{let r=new rp(n);return null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,t(r.siteKey)}}).catch(e=>{r(e)})})}function n(t,r,n){let i=window.grecaptcha;rh(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{r(e)}).catch(()=>{r(r9)})}):n(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new r5().execute("siteKey",{action:"verify"}):new Promise((e,i)=>{r(this.auth).then(r=>{if(!t&&rh(window.grecaptcha))n(r,e,i);else{if("undefined"==typeof window)return void i(Error("RecaptchaVerifier is only supported in browser"));let t=r4();0!==t.length&&(t+=r),r6(t).then(()=>{n(r,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function nt(e,t,r,n=!1,i=!1){let s,a=new ne(e);if(i)s=r9;else try{s=await a.verify(r)}catch(e){s=await a.verify(r,!0)}let o=Object.assign({},t);if("mfaSmsEnrollment"===r||"mfaSmsSignIn"===r){if("phoneEnrollmentInfo"in o){let e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){let e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return n?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function nr(e,t,r,n,i){var s,a;if("EMAIL_PASSWORD_PROVIDER"===i)if(null==(s=e._getRecaptchaConfig())||!s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return n(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let i=await nt(e,t,r,"getOobCode"===r);return n(e,i)}});else{let i=await nt(e,t,r,"getOobCode"===r);return n(e,i)}if("PHONE_PROVIDER"!==i)return Promise.reject(i+" provider is not supported.");if(null==(a=e._getRecaptchaConfig())?void 0:a.isProviderEnabled("PHONE_PROVIDER")){let i=await nt(e,t,r);return n(e,i).catch(async i=>{var s;if((null==(s=e._getRecaptchaConfig())?void 0:s.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${r} flow.`);let i=await nt(e,t,r,!1,!0);return n(e,i)}return Promise.reject(i)})}{let i=await nt(e,t,r,!1,!0);return n(e,i)}}function nn(e,t){let r=tc(e,"auth");if(r.isInitialized()){let e=r.getImmediate();if(ey(r.getOptions(),null!=t?t:{}))return e;tY(e,"already-initialized")}return r.initialize({options:t})}function ni(e,t){let r=(null==t?void 0:t.persistence)||[],n=(Array.isArray(r)?r:[r]).map(rL);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(n,null==t?void 0:t.popupRedirectResolver)}function ns(e,t,r){let n=r1(e);t1(/^https?:\/\//.test(t),n,"invalid-emulator-scheme");let i=!!(null==r?void 0:r.disableWarnings),s=na(t),{host:a,port:o}=no(t),l=null===o?"":`:${o}`,c={url:`${s}//${a}${l}/`},u=Object.freeze({host:a,port:o,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!n._canInitEmulator){t1(n.config.emulator&&n.emulatorConfig,n,"emulator-config-failed"),t1(ey(c,n.config.emulator)&&ey(u,n.emulatorConfig),n,"emulator-config-failed");return}n.config.emulator=c,n.emulatorConfig=u,n.settings.appVerificationDisabledForTesting=!0,W(a)?(H(`${s}//${a}${l}`),ee("Auth",!0)):i||nc()}function na(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function no(e){let t=na(e),r=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!r)return{host:"",port:null};let n=r[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(n);if(i){let e=i[1];return{host:e,port:nl(n.substr(e.length+1))}}{let[e,t]=n.split(":");return{host:e,port:nl(t)}}}function nl(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}function nc(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}class nu{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return t2("not implemented")}_getIdTokenResponse(e){return t2("not implemented")}_linkToIdToken(e,t){return t2("not implemented")}_getReauthenticationResolver(e){return t2("not implemented")}}async function nd(e,t){return rs(e,"POST","/v1/accounts:resetPassword",ri(e,t))}async function nh(e,t){return rs(e,"POST","/v1/accounts:update",t)}async function np(e,t){return rs(e,"POST","/v1/accounts:signUp",t)}async function nf(e,t){return ro(e,"POST","/v1/accounts:signInWithPassword",ri(e,t))}async function nm(e,t){return rs(e,"POST","/v1/accounts:sendOobCode",ri(e,t))}async function ng(e,t){return ro(e,"POST","/v1/accounts:signInWithEmailLink",ri(e,t))}async function ny(e,t){return ro(e,"POST","/v1/accounts:signInWithEmailLink",ri(e,t))}class nv extends nu{constructor(e,t,r,n=null){super("password",r),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new nv(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new nv(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return nr(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",nf,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return ng(e,{email:this._email,oobCode:this._password});default:tY(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return nr(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",np,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return ny(e,{idToken:t,email:this._email,oobCode:this._password});default:tY(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function nb(e,t){return ro(e,"POST","/v1/accounts:signInWithIdp",ri(e,t))}let nS="http://localhost";class nT extends nu{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new nT(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):tY("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e,{providerId:r,signInMethod:n}=t,i=tL(t,["providerId","signInMethod"]);if(!r||!n)return null;let s=new nT(r,n);return s.idToken=i.idToken||void 0,s.accessToken=i.accessToken||void 0,s.secret=i.secret,s.nonce=i.nonce,s.pendingToken=i.pendingToken||null,s}_getIdTokenResponse(e){return nb(e,this.buildRequest())}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,nb(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,nb(e,t)}buildRequest(){let e={requestUri:nS,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=eb(t)}return e}}async function nE(e,t){return ro(e,"POST","/v1/accounts:signInWithPhoneNumber",ri(e,t))}async function nw(e,t){let r=await ro(e,"POST","/v1/accounts:signInWithPhoneNumber",ri(e,t));if(r.temporaryProof)throw rd(e,"account-exists-with-different-credential",r);return r}let nC={USER_NOT_FOUND:"user-not-found"};async function n_(e,t){return ro(e,"POST","/v1/accounts:signInWithPhoneNumber",ri(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),nC)}class nI extends nu{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new nI({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new nI({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return nE(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return nw(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return n_(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:n}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:n}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}=e;return r||t||n||i?new nI({verificationId:t,verificationCode:r,phoneNumber:n,temporaryProof:i}):null}}function nx(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function nk(e){let t=eS(eT(e)).link,r=t?eS(eT(t)).deep_link_id:null,n=eS(eT(e)).deep_link_id;return(n?eS(eT(n)).link:null)||n||r||t||e}class nN{constructor(e){var t,r,n,i,s,a;let o=eS(eT(e)),l=null!=(t=o.apiKey)?t:null,c=null!=(r=o.oobCode)?r:null,u=nx(null!=(n=o.mode)?n:null);t1(l&&c&&u,"argument-error"),this.apiKey=l,this.operation=u,this.code=c,this.continueUrl=null!=(i=o.continueUrl)?i:null,this.languageCode=null!=(s=o.lang)?s:null,this.tenantId=null!=(a=o.tenantId)?a:null}static parseLink(e){let t=nk(e);try{return new nN(t)}catch(e){return null}}}class nR{constructor(){this.providerId=nR.PROVIDER_ID}static credential(e,t){return nv._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let r=nN.parseLink(t);return t1(r,"argument-error"),nv._fromEmailAndCode(e,r.code,r.tenantId)}}nR.PROVIDER_ID="password",nR.EMAIL_PASSWORD_SIGN_IN_METHOD="password",nR.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class nA{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class nD extends nA{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class nO extends null{static credentialFromJSON(e){let t="string"==typeof e?JSON.parse(e):e;return t1("providerId"in t&&"signInMethod"in t,"argument-error"),nT._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return t1(e.idToken||e.accessToken,"argument-error"),nT._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return nO.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return nO.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:n,pendingToken:i,nonce:s,providerId:a}=e;if(!r&&!n&&!t&&!i||!a)return null;try{return new nO(a)._credential({idToken:t,accessToken:r,nonce:s,pendingToken:i})}catch(e){return null}}}class nP extends nD{constructor(){super("facebook.com")}static credential(e){return nT._fromParams({providerId:nP.PROVIDER_ID,signInMethod:nP.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return nP.credentialFromTaggedObject(e)}static credentialFromError(e){return nP.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return nP.credential(e.oauthAccessToken)}catch(e){return null}}}nP.FACEBOOK_SIGN_IN_METHOD="facebook.com",nP.PROVIDER_ID="facebook.com";class nM extends nD{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return nT._fromParams({providerId:nM.PROVIDER_ID,signInMethod:nM.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return nM.credentialFromTaggedObject(e)}static credentialFromError(e){return nM.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return nM.credential(t,r)}catch(e){return null}}}nM.GOOGLE_SIGN_IN_METHOD="google.com",nM.PROVIDER_ID="google.com";class nL extends nD{constructor(){super("github.com")}static credential(e){return nT._fromParams({providerId:nL.PROVIDER_ID,signInMethod:nL.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return nL.credentialFromTaggedObject(e)}static credentialFromError(e){return nL.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return nL.credential(e.oauthAccessToken)}catch(e){return null}}}nL.GITHUB_SIGN_IN_METHOD="github.com",nL.PROVIDER_ID="github.com";let nF="http://localhost";class nB extends nu{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){return nb(e,this.buildRequest())}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,nb(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,nb(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){let{providerId:t,signInMethod:r,pendingToken:n}="string"==typeof e?JSON.parse(e):e;return t&&r&&n&&t===r?new nB(t,n):null}static _create(e,t){return new nB(e,t)}buildRequest(){return{requestUri:nF,returnSecureToken:!0,pendingToken:this.pendingToken}}}let nj="saml.";class nU extends nA{constructor(e){t1(e.startsWith(nj),"argument-error"),super(e)}static credentialFromResult(e){return nU.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return nU.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){let t=nB.fromJSON(e);return t1(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return nB._create(r,t)}catch(e){return null}}}class nV extends nD{constructor(){super("twitter.com")}static credential(e,t){return nT._fromParams({providerId:nV.PROVIDER_ID,signInMethod:nV.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return nV.credentialFromTaggedObject(e)}static credentialFromError(e){return nV.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return nV.credential(t,r)}catch(e){return null}}}async function nz(e,t){return ro(e,"POST","/v1/accounts:signUp",ri(e,t))}nV.TWITTER_SIGN_IN_METHOD="twitter.com",nV.PROVIDER_ID="twitter.com";class nq{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,n=!1){return new nq({user:await rP._fromIdTokenResponse(e,r,n),providerId:n$(r),_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){return await e._updateTokensIfNecessary(r,!0),new nq({user:e,providerId:n$(r),_tokenResponse:r,operationType:t})}}function n$(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}async function nG(e){var t;if(tu(e.app))return Promise.reject(tZ(e));let r=r1(e);if(await r._initializationPromise,null==(t=r.currentUser)?void 0:t.isAnonymous)return new nq({user:r.currentUser,providerId:null,operationType:"signIn"});let n=await nz(r,{returnSecureToken:!0}),i=await nq._fromIdTokenResponse(r,"signIn",n,!0);return await r._updateCurrentUser(i.user),i}class nK extends eh{constructor(e,t,r,n){var i;super(t.code,t.message),this.operationType=r,this.user=n,Object.setPrototypeOf(this,nK.prototype),this.customData={appName:e.name,tenantId:null!=(i=e.tenantId)?i:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,n){return new nK(e,t,r,n)}}function nW(e,t,r,n){return("reauthenticate"===t?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(r=>{if("auth/multi-factor-auth-required"===r.code)throw nK._fromErrorAndOperation(e,r,t,n);throw r})}function nH(e){return new Set(e.map(({providerId:e})=>e).filter(e=>!!e))}async function nQ(e,t,r=!1){if(_isFirebaseServerApp(e.app))return Promise.reject(tZ(e));let n="signIn",i=await nW(e,n,t),s=await nq._fromIdTokenResponse(e,n,i);return r||await e._updateCurrentUser(s.user),s}class nY{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?nJ._fromServerResponse(e,t):"totpInfo"in t?nX._fromServerResponse(e,t):tY(e,"internal-error")}}class nJ extends nY{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new nJ(t)}}class nX extends nY{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new nX(t)}}class nZ{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class n0 extends nZ{constructor(e,t,r,n){super(e,t,r),this.username=n}}class n1 extends nZ{constructor(e,t){super(e,"facebook.com",t)}}class n2 extends n0{constructor(e,t){super(e,"github.com",t,"string"==typeof(null==t?void 0:t.login)?null==t?void 0:t.login:null)}}class n3 extends nZ{constructor(e,t){super(e,"google.com",t)}}class n6 extends n0{constructor(e,t,r){super(e,"twitter.com",t,r)}}function n4(e,t,r,n){return eI(e).onAuthStateChanged(t,r,n)}class n5{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new n5("enroll",e,t)}static _fromMfaPendingCredential(e){return new n5("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(null==e?void 0:e.multiFactorSession){if(null==(t=e.multiFactorSession)?void 0:t.pendingCredential)return n5._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);else if(null==(r=e.multiFactorSession)?void 0:r.idToken)return n5._fromIdtoken(e.multiFactorSession.idToken)}return null}}class n8{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){let r=r1(e),n=t.customData._serverResponse,i=(n.mfaInfo||[]).map(e=>nY._fromServerResponse(r,e));t1(n.mfaPendingCredential,r,"internal-error");let s=n5._fromMfaPendingCredential(n.mfaPendingCredential);return new n8(s,i,async e=>{let i=await e._process(r,s);delete n.mfaInfo,delete n.mfaPendingCredential;let a=Object.assign(Object.assign({},n),{idToken:i.idToken,refreshToken:i.refreshToken});switch(t.operationType){case"signIn":let o=await nq._fromIdTokenResponse(r,t.operationType,a);return await r._updateCurrentUser(o.user),o;case"reauthenticate":return t1(t.user,r,"internal-error"),nq._forOperation(t.user,t.operationType,a);default:tY(r,"internal-error")}})}async resolveSignIn(e){let t=e;return this.signInResolver(t)}}function n7(e,t){return rs(e,"POST","/v2/accounts/mfaEnrollment:start",ri(e,t))}function n9(e,t){return rs(e,"POST","/v2/accounts/mfaEnrollment:finalize",ri(e,t))}function ie(e,t){return rs(e,"POST","/v2/accounts/mfaEnrollment:withdraw",ri(e,t))}class it{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>nY._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new it(e)}async getSession(){return n5._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){let r=e,n=await this.getSession(),i=await rE(this.user,r._process(this.user.auth,n,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){let t="string"==typeof e?e:e.uid,r=await this.user.getIdToken();try{let e=await rE(this.user,ie(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}}}new WeakMap;var ir="@firebase/auth",ii="1.10.8";class is{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null==(e=this.auth.currentUser)?void 0:e.uid)||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){t1(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function ia(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function io(e){tl(new ex("auth",(t,{options:r})=>{let n=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=n.options;t1(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});let l=new r0(n,i,s,{apiKey:a,authDomain:o,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:rQ(e)});return ni(l,r),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),tl(new ex("auth-internal",e=>new is(r1(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),tv(ir,ii,ia(e)),tv(ir,ii,"esm2017")}function il(e=tg()){let t=tc(e,"auth");if(t.isInitialized())return t.getImmediate();let r=nn(e),n=q("auth");return n&&ns(r,`http://${n}`),r}function ic(e,t){return rs(e,"POST","/v2/accounts/mfaSignIn:finalize",ri(e,t))}re.initialize(fetch,Headers,Response),io("Node"),tJ("operation-not-supported-in-this-environment"),r0.prototype.setPersistence=async()=>{};class iu{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return t2("unexpected MultiFactorSessionType")}}}class id{static assertionForEnrollment(e,t){return ih._fromSecret(e,t)}static assertionForSignIn(e,t){return ih._fromEnrollmentId(e,t)}static async generateSecret(e){var t;let r=e;t1(void 0!==(null==(t=r.user)?void 0:t.auth),"internal-error");let n=await n7(r.user.auth,{idToken:r.credential,totpEnrollmentInfo:{}});return ip._fromStartTotpMfaEnrollmentResponse(n,r.user.auth)}}id.FACTOR_ID="totp";class ih extends iu{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new ih(t,void 0,e)}static _fromEnrollmentId(e,t){return new ih(t,e)}async _finalizeEnroll(e,t,r){return t1(void 0!==this.secret,e,"argument-error"),n9(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){t1(void 0!==this.enrollmentId&&void 0!==this.otp,e,"argument-error");let r={verificationCode:this.otp};return ic(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class ip{constructor(e,t,r,n,i,s,a){this.sessionInfo=s,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=n,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new ip(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){var r;let n=!1;return(im(e)||im(t))&&(n=!0),n&&(im(e)&&(e=(null==(r=this.auth.currentUser)?void 0:r.email)||"unknownuser"),im(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function im(e){return void 0===e||(null==e?void 0:e.length)===0}var ig=r(8354),iy="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},iv={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function t(e,t,r){r||(r=0);var n=Array(16);if("string"==typeof t)for(var i=0;16>i;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;16>i;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];var s=e.g[3],a=t+(s^r&(i^s))+n[0]+0xd76aa478|0;a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[1]+0xe8c7b756|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[2]+0x242070db|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[3]+0xc1bdceee|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[4]+0xf57c0faf|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[5]+0x4787c62a|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[6]+0xa8304613|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[7]+0xfd469501|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[8]+0x698098d8|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[9]+0x8b44f7af|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[10]+0xffff5bb1|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[11]+0x895cd7be|0,a=t+(s^(r=i+(a<<22|a>>>10))&(i^s))+n[12]+0x6b901122|0,a=s+(i^(t=r+(a<<7|a>>>25))&(r^i))+n[13]+0xfd987193|0,a=i+(r^(s=t+(a<<12|a>>>20))&(t^r))+n[14]+0xa679438e|0,a=r+(t^(i=s+(a<<17|a>>>15))&(s^t))+n[15]+0x49b40821|0,r=i+(a<<22|a>>>10),a=t+(i^s&(r^i))+n[1]+0xf61e2562|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[6]+0xc040b340|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[11]+0x265e5a51|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[0]+0xe9b6c7aa|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[5]+0xd62f105d|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[10]+0x2441453|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[15]+0xd8a1e681|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[4]+0xe7d3fbc8|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[9]+0x21e1cde6|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[14]+0xc33707d6|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[3]+0xf4d50d87|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[8]+0x455a14ed|0,r=i+(a<<20|a>>>12),a=t+(i^s&(r^i))+n[13]+0xa9e3e905|0,t=r+(a<<5|a>>>27),a=s+(r^i&(t^r))+n[2]+0xfcefa3f8|0,s=t+(a<<9|a>>>23),a=i+(t^r&(s^t))+n[7]+0x676f02d9|0,i=s+(a<<14|a>>>18),a=r+(s^t&(i^s))+n[12]+0x8d2a4c8a|0,a=t+((r=i+(a<<20|a>>>12))^i^s)+n[5]+0xfffa3942|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[8]+0x8771f681|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[11]+0x6d9d6122|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[14]+0xfde5380c|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[1]+0xa4beea44|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[4]+0x4bdecfa9|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[7]+0xf6bb4b60|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[10]+0xbebfbc70|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[13]+0x289b7ec6|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[0]+0xeaa127fa|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[3]+0xd4ef3085|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[6]+0x4881d05|0,a=t+((r=i+(a<<23|a>>>9))^i^s)+n[9]+0xd9d4d039|0,a=s+((t=r+(a<<4|a>>>28))^r^i)+n[12]+0xe6db99e5|0,a=i+((s=t+(a<<11|a>>>21))^t^r)+n[15]+0x1fa27cf8|0,a=r+((i=s+(a<<16|a>>>16))^s^t)+n[2]+0xc4ac5665|0,r=i+(a<<23|a>>>9),a=t+(i^(r|~s))+n[0]+0xf4292244|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[7]+0x432aff97|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[14]+0xab9423a7|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[5]+0xfc93a039|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[12]+0x655b59c3|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[3]+0x8f0ccc92|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[10]+0xffeff47d|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[1]+0x85845dd1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[8]+0x6fa87e4f|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[15]+0xfe2ce6e0|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[6]+0xa3014314|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[13]+0x4e0811a1|0,r=i+(a<<21|a>>>11),a=t+(i^(r|~s))+n[4]+0xf7537e82|0,t=r+(a<<6|a>>>26),a=s+(r^(t|~i))+n[11]+0xbd3af235|0,s=t+(a<<10|a>>>22),a=i+(t^(s|~r))+n[2]+0x2ad7d2bb|0,i=s+(a<<15|a>>>17),a=r+(s^(i|~t))+n[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(a<<21|a>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function r(e,t){var r=s;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=t(e)}function n(e,t){this.h=t;for(var r=[],n=!0,i=e.length-1;0<=i;i--){var s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}(function(e,t){function r(){}r.prototype=t.prototype,e.D=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.C=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}})(e,function(){this.blockSize=-1}),e.prototype.s=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.u=function(e,r){void 0===r&&(r=e.length);for(var n=r-this.blockSize,i=this.B,s=this.h,a=0;a<r;){if(0==s)for(;a<=n;)t(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<r;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){t(this,i),s=0;break}}else for(;a<r;)if(i[s++]=e[a++],s==this.blockSize){t(this,i),s=0;break}}this.h=s,this.o+=r},e.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var r=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&r,r/=256;for(this.u(e),e=Array(16),t=r=0;4>t;++t)for(var n=0;32>n;n+=8)e[r++]=this.g[t]>>>n&255;return e};var i,s={};function l(e){return -128<=e&&128>e?r(e,function(e){return new n([0|e],0>e?-1:0)}):new n([0|e],0>e?-1:0)}function c(e){if(isNaN(e)||!isFinite(e))return d;if(0>e)return g(c(-e));for(var t=[],r=1,i=0;e>=r;i++)t[i]=e/r|0,r*=0x100000000;return new n(t,0)}function u(e,t){if(0==e.length)throw Error("number format error: empty string");if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if("-"==e.charAt(0))return g(u(e.substring(1),t));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=c(Math.pow(t,8)),n=d,i=0;i<e.length;i+=8){var s=Math.min(8,e.length-i),a=parseInt(e.substring(i,i+s),t);8>s?(s=c(Math.pow(t,s)),n=n.j(s).add(c(a))):n=(n=n.j(r)).add(c(a))}return n}var d=l(0),h=l(1),p=l(0x1000000);function f(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function m(e){return -1==e.h}function g(e){for(var t=e.g.length,r=[],i=0;i<t;i++)r[i]=~e.g[i];return new n(r,~e.h).add(h)}function y(e,t){return e.add(g(t))}function v(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function b(e,t){this.g=e,this.h=t}function S(e,t){if(f(t))throw Error("division by zero");if(f(e))return new b(d,d);if(m(e))return t=S(g(e),t),new b(g(t.g),g(t.h));if(m(t))return t=S(e,g(t)),new b(g(t.g),t.h);if(30<e.g.length){if(m(e)||m(t))throw Error("slowDivide_ only works with positive integers.");for(var r=h,n=t;0>=n.l(e);)r=T(r),n=T(n);var i=E(r,1),s=E(n,1);for(n=E(n,2),r=E(r,2);!f(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=E(n,1),r=E(r,1)}return t=y(e,i.j(t)),new b(i,t)}for(i=d;0<=e.l(t);){for(n=48>=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))?1:Math.pow(2,n-48),a=(s=c(r)).j(t);m(a)||0<a.l(e);)r-=n,a=(s=c(r)).j(t);f(s)&&(s=h),i=i.add(s),e=y(e,a)}return new b(i,e)}function T(e){for(var t=e.g.length+1,r=[],i=0;i<t;i++)r[i]=e.i(i)<<1|e.i(i-1)>>>31;return new n(r,e.h)}function E(e,t){var r=t>>5;t%=32;for(var i=e.g.length-r,s=[],a=0;a<i;a++)s[a]=0<t?e.i(a+r)>>>t|e.i(a+r+1)<<32-t:e.i(a+r);return new n(s,e.h)}(i=n.prototype).m=function(){if(m(this))return-g(this).m();for(var e=0,t=1,r=0;r<this.g.length;r++){var n=this.i(r);e+=(0<=n?n:0x100000000+n)*t,t*=0x100000000}return e},i.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(f(this))return"0";if(m(this))return"-"+g(this).toString(e);for(var t=c(Math.pow(e,6)),r=this,n="";;){var i=S(r,t).g,s=((0<(r=y(r,i.j(t))).g.length?r.g[0]:r.h)>>>0).toString(e);if(f(r=i))return s+n;for(;6>s.length;)s="0"+s;n=s+n}},i.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},i.l=function(e){return m(e=y(this,e))?-1:+!f(e)},i.abs=function(){return m(this)?g(this):this},i.add=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],i=0,s=0;s<=t;s++){var a=i+(65535&this.i(s))+(65535&e.i(s)),o=(a>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);i=o>>>16,a&=65535,o&=65535,r[s]=o<<16|a}return new n(r,-0x80000000&r[r.length-1]?-1:0)},i.j=function(e){if(f(this)||f(e))return d;if(m(this))return m(e)?g(this).j(g(e)):g(g(this).j(e));if(m(e))return g(this.j(g(e)));if(0>this.l(p)&&0>e.l(p))return c(this.m()*e.m());for(var t=this.g.length+e.g.length,r=[],i=0;i<2*t;i++)r[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<e.g.length;s++){var a=this.i(i)>>>16,o=65535&this.i(i),l=e.i(s)>>>16,u=65535&e.i(s);r[2*i+2*s]+=o*u,v(r,2*i+2*s),r[2*i+2*s+1]+=a*u,v(r,2*i+2*s+1),r[2*i+2*s+1]+=o*l,v(r,2*i+2*s+1),r[2*i+2*s+2]+=a*l,v(r,2*i+2*s+2)}for(i=0;i<t;i++)r[i]=r[2*i+1]<<16|r[2*i];for(i=t;i<2*t;i++)r[i]=0;return new n(r,0)},i.A=function(e){return S(this,e).h},i.and=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],i=0;i<t;i++)r[i]=this.i(i)&e.i(i);return new n(r,this.h&e.h)},i.or=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],i=0;i<t;i++)r[i]=this.i(i)|e.i(i);return new n(r,this.h|e.h)},i.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),r=[],i=0;i<t;i++)r[i]=this.i(i)^e.i(i);return new n(r,this.h^e.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,o=iv.Md5=e,n.prototype.add=n.prototype.add,n.prototype.multiply=n.prototype.j,n.prototype.modulo=n.prototype.A,n.prototype.compare=n.prototype.l,n.prototype.toNumber=n.prototype.m,n.prototype.toString=n.prototype.toString,n.prototype.getBits=n.prototype.i,n.fromNumber=c,n.fromString=u,a=iv.Integer=n}).apply(void 0!==iy?iy:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});let ib=require("crypto");var iS=r(959),iT=r(7587);let iE="@firebase/firestore",iw="4.8.0";class iC{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}iC.UNAUTHENTICATED=new iC(null),iC.GOOGLE_CREDENTIALS=new iC("google-credentials-uid"),iC.FIRST_PARTY=new iC("first-party-uid"),iC.MOCK_USER=new iC("mock-user");let i_="11.10.0";function iI(e){i_=e}function ix(e){return(0,ig.inspect)(e,{depth:100})}let ik=new eB("@firebase/firestore");function iN(){return ik.logLevel}function iR(e,...t){if(ik.logLevel<=s.DEBUG){let r=t.map(iO);ik.debug(`Firestore (${i_}): ${e}`,...r)}}function iA(e,...t){if(ik.logLevel<=s.ERROR){let r=t.map(iO);ik.error(`Firestore (${i_}): ${e}`,...r)}}function iD(e,...t){if(ik.logLevel<=s.WARN){let r=t.map(iO);ik.warn(`Firestore (${i_}): ${e}`,...r)}}function iO(e){if("string"==typeof e)return e;try{return ix(e)}catch(t){return e}}function iP(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,iM(e,n,r)}function iM(e,t,r){let n=`FIRESTORE (${i_}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{let e=JSON.stringify(r);n+=" CONTEXT: "+e}catch(e){n+=" CONTEXT: "+r}throw iA(n),Error(n)}function iL(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||iM(t,i,n)}function iF(e,t){return e}let iB={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ij extends eh{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class iU{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class iV{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class iz{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(iC.UNAUTHENTICATED))}shutdown(){}}class iq{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class i${constructor(e){this.authProvider=e,this.currentUser=iC.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){iL(void 0===this.tokenListener,42304);let r=this.tokenCounter,n=e=>this.tokenCounter!==r?(r=this.tokenCounter,t(e)):Promise.resolve(),i=new iU;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),i.resolve(),i=new iU,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{iR("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),s())};this.authProvider.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.authProvider.getImmediate({optional:!0});e?a(e):(iR("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new iU)}},0),s()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(t).then(t=>this.tokenCounter!==e?(iR("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(iL("string"==typeof t.accessToken,31837,{tokenData:t}),new iV(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return iL(null===e||"string"==typeof e,2055,{currentUid:e}),new iC(e)}}class iG{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=iC.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class iK{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new iG(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(iC.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class iW{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class iH{constructor(e,t){this.appCheckProvider=t,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,tu(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken)}start(e,t){iL(void 0===this.tokenListener,3512);let r=e=>{null!=e.error&&iR("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.latestAppCheckToken;return this.latestAppCheckToken=e.token,iR("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.tokenListener=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{iR("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.appCheckProvider.getImmediate({optional:!0});e?n(e):iR("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new iW(this.serverAppAppCheckToken));let e=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(e).then(e=>e?(iL("string"==typeof e.token,44558,{tokenResult:e}),this.latestAppCheckToken=e.token,new iW(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}}function iQ(e){if(!e)return new iz;switch(e.type){case"firstParty":return new iK(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new ij(iB.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function iY(e){return(0,ib.randomBytes)(e)}function iJ(){return new ig.TextEncoder}function iX(){return new TextDecoder("utf-8")}class iZ{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",n=20;for(;r.length<n;){let i=iY(40);for(let s=0;s<i.length;++s)r.length<n&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function i0(e,t){return e<t?-1:+(e>t)}function i1(e,t){let r=0;for(;r<e.length&&r<t.length;){let n=e.codePointAt(r),i=t.codePointAt(r);if(n!==i)if(n<128&&i<128)return i0(n,i);else{let s=iJ(),a=i3(s.encode(i2(e,r)),s.encode(i2(t,r)));if(0!==a)return a;return i0(n,i)}r+=n>65535?2:1}return i0(e.length,t.length)}function i2(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function i3(e,t){for(let r=0;r<e.length&&r<t.length;++r)if(e[r]!==t[r])return i0(e[r],t[r]);return i0(e.length,t.length)}function i6(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}function i4(e){return e+"\0"}let i5="__name__";class i8{constructor(e,t,r){void 0===t?t=0:t>e.length&&iP(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&iP(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===i8.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof i8?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=i8.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return i0(e.length,t.length)}static compareSegments(e,t){let r=i8.isNumericId(e),n=i8.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?i8.extractNumericId(e).compare(i8.extractNumericId(t)):i1(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return a.fromString(e.substring(4,e.length-2))}}class i7 extends i8{construct(e,t,r){return new i7(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new ij(iB.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new i7(t)}static emptyPath(){return new i7([])}}let i9=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class se extends i8{construct(e,t,r){return new se(e,t,r)}static isValidIdentifier(e){return i9.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),se.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===i5}static keyField(){return new se([i5])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new ij(iB.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new ij(iB.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new ij(iB.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new ij(iB.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new se(t)}static emptyPath(){return new se([])}}class st{constructor(e){this.path=e}static fromPath(e){return new st(i7.fromString(e))}static fromName(e){return new st(i7.fromString(e).popFirst(5))}static empty(){return new st(i7.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===i7.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return i7.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new st(new i7(e.slice()))}}function sr(e,t,r){if(!r)throw new ij(iB.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function sn(e,t,r,n){if(!0===t&&!0===n)throw new ij(iB.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)}function si(e){if(!st.isDocumentKey(e))throw new ij(iB.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function ss(e){if(st.isDocumentKey(e))throw new ij(iB.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function sa(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function so(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e)if(e instanceof Array)return"an array";else{let t=sl(e);return t?`a custom ${t} object`:"an object"}else if("function"==typeof e)return"a function";else return iP(12329,{type:typeof e})}function sl(e){return e.constructor?e.constructor.name:null}function sc(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t))if(t.name===e.constructor.name)throw new ij(iB.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");else{let r=so(e);throw new ij(iB.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}return e}function su(e,t){let r={typeString:e};return t&&(r.value=t),r}function sd(e,t){let r;if(!sa(e))throw new ij(iB.INVALID_ARGUMENT,"JSON must be an object");for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new ij(iB.INVALID_ARGUMENT,r);return!0}let sh=-0xe7791f700,sp=1e6;class sf{static now(){return sf.fromMillis(Date.now())}static fromDate(e){return sf.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*sp);return new sf(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new ij(iB.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<sh||e>=0x3afff44180)throw new ij(iB.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/sp}_compareTo(e){return this.seconds===e.seconds?i0(this.nanoseconds,e.nanoseconds):i0(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:sf._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(sd(e,sf._jsonSchema))return new sf(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds-sh).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}sf._jsonSchemaVersion="firestore/timestamp/1.0",sf._jsonSchema={type:su("string",sf._jsonSchemaVersion),seconds:su("number"),nanoseconds:su("number")};class sm{static fromTimestamp(e){return new sm(e)}static min(){return new sm(new sf(0,0))}static max(){return new sm(new sf(0x3afff4417f,1e9-1))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let sg=-1,sy=0;class sv{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function sb(e){return e.fields.find(e=>2===e.kind)}function sS(e){return e.fields.filter(e=>2!==e.kind)}function sT(e){let t=sS(e);return 0===t.length?0:t[t.length-1].kind}function sE(e,t){let r=i0(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=s_(e.fields[n],t.fields[n])))return r;return i0(e.fields.length,t.fields.length)}function sw(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}sv.UNKNOWN_ID=-1;class sC{constructor(e,t){this.fieldPath=e,this.kind=t}}function s_(e,t){let r=se.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:i0(e.kind,t.kind)}class sI{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new sI(sy,sN.min())}}function sx(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new sN(sm.fromTimestamp(1e9===n?new sf(r+1,0):new sf(r,n)),st.empty(),t)}function sk(e){return new sN(e.readTime,e.key,sg)}class sN{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new sN(sm.min(),st.empty(),sg)}static max(){return new sN(sm.max(),st.empty(),sg)}}function sR(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=st.comparator(e.documentKey,t.documentKey))?r:i0(e.largestBatchId,t.largestBatchId)}let sA="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class sD{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function sO(e){if(e.code===iB.FAILED_PRECONDITION&&e.message===sA)iR("LocalStore","Unexpectedly lost primary lease");else throw e}class sP{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return(this.callbackAttached&&iP(59440),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new sP((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();if(t instanceof sP)return t;return sP.resolve(t)}catch(e){return sP.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):sP.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):sP.reject(t)}static resolve(e){return new sP((t,r)=>{t(e)})}static reject(e){return new sP((t,r)=>{r(e)})}static waitFor(e){return new sP((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=sP.resolve(!1);for(let r of e)t=t.next(e=>e?sP.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new sP((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new sP((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}let sM="SimpleDb",sL=3;class sF{static open(e,t,r,n){try{return new sF(t,e.transaction(n,r))}catch(e){throw new sV(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new iU,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new sV(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=t=>{let r=sK(t.target.error);this.completionDeferred.reject(new sV(e,r))}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(iR(sM,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new sq(this.transaction.objectStore(e))}}class sB{static delete(e){return iR(sM,"Removing database:",e),s$(B().indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!ec())return!1;if(sB.isMockPersistence())return!0;let e=et(),t=sB.getIOSVersion(e),r=0<t&&t<10,n=sj(e),i=0<n&&n<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0)&&!r&&!i}static isMockPersistence(){var e;return"undefined"!=typeof process&&(null==(e=process.env)?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,this.lastClosedDbVersion=null,12.2===sB.getIOSVersion(et())&&iA("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async ensureDb(e){return this.db||(iR(sM,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new sV(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new ij(iB.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new ij(iB.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new sV(e,n))},n.onupgradeneeded=e=>{iR(sM,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;if(null!==this.lastClosedDbVersion&&this.lastClosedDbVersion!==e.oldVersion)throw Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.lastClosedDbVersion}, event.oldVersion=${e.oldVersion}, event.newVersion=${e.newVersion}, db.version=${t.version}`);this.schemaConverter.createOrUpgrade(t,n.transaction,e.oldVersion,this.version).next(()=>{iR(sM,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",e=>{let t=e.target;this.lastClosedDbVersion=t.version},{passive:!0})),this.db.addEventListener("versionchange",e=>{var t;null===e.newVersion&&(iD('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),null==(t=this.databaseDeletedListener)||t.call(this))},{passive:!0}),this.db}setDatabaseDeletedListener(e){if(this.databaseDeletedListener)throw Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=e}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.ensureDb(e);let t=sF.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.maybeCommit(),e)).catch(e=>(t.abort(e),sP.reject(e))).toPromise();return s.catch(()=>{}),await t.completionPromise,s}catch(r){let e=r,t="FirebaseError"!==e.name&&s<sL;if(iR(sM,"Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}function sj(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class sU{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return s$(this.dbCursor.delete())}}class sV extends ij{constructor(e,t){super(iB.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function sz(e){return"IndexedDbTransactionError"===e.name}class sq{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(iR(sM,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(iR(sM,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),s$(r)}add(e){return iR(sM,"ADD",this.store.name,e,e),s$(this.store.add(e))}get(e){return s$(this.store.get(e)).next(t=>(void 0===t&&(t=null),iR(sM,"GET",this.store.name,e,t),t))}delete(e){return iR(sM,"DELETE",this.store.name,e),s$(this.store.delete(e))}count(){return iR(sM,"COUNT",this.store.name),s$(this.store.count())}loadAll(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new sP((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.iterateCursor(e,(e,r)=>{t.push(r)}).next(()=>t)}}loadFirst(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new sP((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}deleteAll(e,t){iR(sM,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let n=this.cursor(r);return this.iterateCursor(n,(e,t,r)=>r.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.iterateCursor(n,t)}iterateSerial(e){let t=this.cursor({});return new sP((r,n)=>{t.onerror=e=>{n(sK(e.target.error))},t.onsuccess=t=>{let n=t.target.result;if(!n)return void r();e(n.primaryKey,n.value).next(e=>{e?n.continue():r()})}})}iterateCursor(e,t){let r=[];return new sP((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i)return void n();let s=new sU(i),a=t(i.primaryKey,i.value,s);if(a instanceof sP){let e=a.catch(e=>(s.done(),sP.reject(e)));r.push(e)}s.isDone?n():null===s.skipToKey?i.continue():i.continue(s.skipToKey)}}).next(()=>sP.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),!e.index)return this.store.openCursor(e.range,t);{let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}}}function s$(e){return new sP((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(sK(e.target.error))}})}let sG=!1;function sK(e){let t=sB.getIOSVersion(et());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new ij("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return sG||(sG=!0,setTimeout(()=>{throw e},0)),e}}return e}let sW="IndexBackfiller",sH=15e3,sQ=6e4,sY=50;class sJ{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(sH)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(e){iR(sW,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.backfiller.backfill();iR(sW,`Documents written: ${e}`)}catch(e){sz(e)?iR(sW,"Ignoring IndexedDB error during index backfill: ",e):await sO(e)}await this.schedule(sQ)})}}class sX{constructor(e,t){this.localStore=e,this.persistence=t}async backfill(e=sY){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))}writeIndexEntries(e,t){let r=new Set,n=t,i=!0;return sP.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(!(null===t||r.has(t)))return iR(sW,`Processing collection: ${t}`),this.writeEntriesForCollectionGroup(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.getNewOffset(n,r)).next(r=>(iR(sW,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=sk(t);sR(n,r)>0&&(r=n)}),new sN(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class sZ{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.setPreviousValue(e),this.writeNewSequenceNumber=e=>t.writeSequenceNumber(e))}setPreviousValue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(e),e}}sZ.INVALID=-1;let s0="\x01",s1="\x01",s2="\x10",s3="\x11";function s6(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t=s5(t)),t=s4(e.get(r),t);return s5(t)}function s4(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+=s0+s2;break;case s0:r+=s0+s3;break;default:r+=n}}return r}function s5(e){return e+s0+s1}function s8(e){let t=e.length;if(iL(t>=2,64408,{path:e}),2===t)return iL(e.charAt(0)===s0&&e.charAt(1)===s1,56145,{path:e}),i7.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf(s0,s);switch((t<0||t>r)&&iP(50515,{path:e}),e.charAt(t+1)){case s1:let a,o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case s2:i+=e.substring(s,t),i+="\0";break;case s3:i+=e.substring(s,t+1);break;default:iP(61167,{path:e})}s=t+2}return new i7(n)}let s7="remoteDocuments",s9="owner",ae="owner",at="mutationQueues",ar="userId",an="mutations",ai="batchId",as="userMutationsIndex",aa=["userId","batchId"];function ao(e){return[e]}function al(e,t){return[e,s6(t)]}function ac(e,t,r){return[e,s6(t),r]}let au={},ad="documentMutations",ah="remoteDocumentsV14",ap=["prefixPath","collectionGroup","readTime","documentId"],af="documentKeyIndex",am=["prefixPath","collectionGroup","documentId"],ag="collectionGroupIndex",ay=["collectionGroup","readTime","prefixPath","documentId"],av="remoteDocumentGlobal",ab="remoteDocumentGlobalKey",aS="targets",aT="targetId",aE="queryTargetsIndex",aw=["canonicalId","targetId"],aC="targetDocuments",a_=["targetId","path"],aI="documentTargetsIndex",ax=["path","targetId"],ak="targetGlobalKey",aN="targetGlobal",aR="collectionParents",aA=["collectionId","parent"],aD="clientMetadata",aO="clientId",aP="bundles",aM="bundleId",aL="namedQueries",aF="name",aB="indexConfiguration",aj="indexId",aU="collectionGroupIndex",aV="collectionGroup",az="indexState",aq=["indexId","uid"],a$="sequenceNumberIndex",aG=["uid","sequenceNumber"],aK="indexEntries",aW=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],aH="documentKeyIndex",aQ=["indexId","uid","orderedDocumentKey"],aY="documentOverlays",aJ=["userId","collectionPath","documentId"],aX="collectionPathOverlayIndex",aZ=["userId","collectionPath","largestBatchId"],a0="collectionGroupOverlayIndex",a1=["userId","collectionGroup","largestBatchId"],a2="globals",a3="name",a6=[at,an,ad,s7,aS,s9,aN,aC,aD,av,aR,aP,aL],a4=[...a6,aY],a5=[at,an,ad,ah,aS,s9,aN,aC,aD,av,aR,aP,aL,aY],a8=a5,a7=[...a8,aB,az,aK],a9=a7,oe=[...a7,a2],ot=oe;function or(e){return 18===e?ot:17===e?oe:16===e?a9:15===e?a7:14===e?a8:13===e?a5:12===e?a4:11===e?a6:void iP(60245)}class on extends sD{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}}function oi(e,t){let r=iF(e);return sB.getStore(r.simpleDbTransaction,t)}function os(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function oa(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function oo(e,t){let r=[];for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&r.push(t(e[n],n,e));return r}function ol(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class oc{constructor(e,t){this.comparator=e,this.root=t||od.EMPTY}insert(e,t){return new oc(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,od.BLACK,null,null))}remove(e){return new oc(this.comparator,this.root.remove(e,this.comparator).copy(null,null,od.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ou(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ou(this.root,e,this.comparator,!1)}getReverseIterator(){return new ou(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ou(this.root,e,this.comparator,!0)}}class ou{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else if(0===i){this.nodeStack.push(e);break}else this.nodeStack.push(e),e=this.isReverse?e.right:e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class od{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:od.RED,this.left=null!=n?n:od.EMPTY,this.right=null!=i?i:od.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new od(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return od.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r,n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key))if(n.right.isEmpty())return od.EMPTY;else r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,od.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,od.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw iP(43730,{key:this.key,value:this.value});if(this.right.isRed())throw iP(14113,{key:this.key,value:this.value});let e=this.left.check();if(e===this.right.check())return e+ +!this.isRed();throw iP(27949)}}od.EMPTY=null,od.RED=!0,od.BLACK=!1;class oh{constructor(){this.size=0}get key(){throw iP(57766)}get value(){throw iP(16141)}get color(){throw iP(16727)}get left(){throw iP(29726)}get right(){throw iP(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new od(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}od.EMPTY=new oh;class op{constructor(e){this.comparator=e,this.data=new oc(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new of(this.data.getIterator())}getIteratorFrom(e){return new of(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof op)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new op(this.comparator);return t.data=e,t}}class of{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function om(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=og(s),l=og(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=og(a)):t?(i(o),o=og(s)):(o=og(s),l=og(a))}}function og(e){return e.hasNext()?e.getNext():void 0}class oy{constructor(e){this.fields=e,e.sort(se.comparator)}static empty(){return new oy([])}unionWith(e){let t=new op(se.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new oy(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return i6(this.fields,e.fields,(e,t)=>e.isEqual(t))}}function ov(e){return Buffer.from(e,"base64").toString("binary")}function ob(e){return Buffer.from(e,"binary").toString("base64")}class oS{constructor(e){this.binaryString=e}static fromBase64String(e){return new oS(ov(e))}static fromUint8Array(e){return new oS(oT(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return ob(this.binaryString)}toUint8Array(){return oE(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return i0(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}function oT(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}function oE(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}oS.EMPTY_BYTE_STRING=new oS("");let ow=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function oC(e){if(iL(!!e,39018),"string"==typeof e){let t=0,r=ow.exec(e);if(iL(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:o_(e.seconds),nanos:o_(e.nanos)}}function o_(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function oI(e){return"string"==typeof e?oS.fromBase64String(e):oS.fromUint8Array(e)}let ox="server_timestamp",ok="__type__",oN="__previous_value__",oR="__local_write_time__";function oA(e){var t,r;return(null==(r=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[ok])?void 0:r.stringValue)===ox}function oD(e,t){let r={fields:{[ok]:{stringValue:ox},[oR]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&oA(t)&&(t=oO(t)),t&&(r.fields[oN]=t),{mapValue:r}}function oO(e){let t=e.mapValue.fields[oN];return oA(t)?oO(t):t}function oP(e){let t=oC(e.mapValue.fields[oR].timestampValue);return new sf(t.seconds,t.nanos)}class oM{constructor(e,t,r,n,i,s,a,o,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=c}}let oL="(default)";class oF{constructor(e,t){this.projectId=e,this.database=t||oL}static empty(){return new oF("","")}get isDefaultDatabase(){return this.database===oL}isEqual(e){return e instanceof oF&&e.projectId===this.projectId&&e.database===this.database}}function oB(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new ij(iB.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new oF(e.options.projectId,t)}let oj=-1;function oU(e){return null==e}function oV(e){return 0===e&&1/e==-1/0}function oz(e){return"number"==typeof e&&Number.isInteger(e)&&!oV(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}let oq="__type__",o$="__max__",oG={mapValue:{fields:{__type__:{stringValue:o$}}}},oK="__vector__",oW="value",oH={nullValue:"NULL_VALUE"};function oQ(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?oA(e)?4:lw(e)?0x1fffffffffffff:lT(e)?10:11:iP(28295,{value:e})}function oY(e,t){if(e===t)return!0;let r=oQ(e);if(r!==oQ(t))return!1;switch(r){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return oP(e).isEqual(oP(t));case 3:return oJ(e,t);case 5:return e.stringValue===t.stringValue;case 6:return oZ(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return oX(e,t);case 2:return o0(e,t);case 9:return i6(e.arrayValue.values||[],t.arrayValue.values||[],oY);case 10:case 11:return o1(e,t);default:return iP(52216,{left:e})}}function oJ(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=oC(e.timestampValue),n=oC(t.timestampValue);return r.seconds===n.seconds&&r.nanos===n.nanos}function oX(e,t){return o_(e.geoPointValue.latitude)===o_(t.geoPointValue.latitude)&&o_(e.geoPointValue.longitude)===o_(t.geoPointValue.longitude)}function oZ(e,t){return oI(e.bytesValue).isEqual(oI(t.bytesValue))}function o0(e,t){if("integerValue"in e&&"integerValue"in t)return o_(e.integerValue)===o_(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=o_(e.doubleValue),n=o_(t.doubleValue);return r===n?oV(r)===oV(n):isNaN(r)&&isNaN(n)}return!1}function o1(e,t){let r=e.mapValue.fields||{},n=t.mapValue.fields||{};if(os(r)!==os(n))return!1;for(let e in r)if(r.hasOwnProperty(e)&&(void 0===n[e]||!oY(r[e],n[e])))return!1;return!0}function o2(e,t){return void 0!==(e.values||[]).find(e=>oY(e,t))}function o3(e,t){if(e===t)return 0;let r=oQ(e),n=oQ(t);if(r!==n)return i0(r,n);switch(r){case 0:case 0x1fffffffffffff:return 0;case 1:return i0(e.booleanValue,t.booleanValue);case 2:return o6(e,t);case 3:return o4(e.timestampValue,t.timestampValue);case 4:return o4(oP(e),oP(t));case 5:return i1(e.stringValue,t.stringValue);case 6:return o7(e.bytesValue,t.bytesValue);case 7:return o5(e.referenceValue,t.referenceValue);case 8:return o8(e.geoPointValue,t.geoPointValue);case 9:return o9(e.arrayValue,t.arrayValue);case 10:return le(e.mapValue,t.mapValue);case 11:return lt(e.mapValue,t.mapValue);default:throw iP(23264,{leftType:r})}}function o6(e,t){let r=o_(e.integerValue||e.doubleValue),n=o_(t.integerValue||t.doubleValue);return r<n?-1:r>n?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1}function o4(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return i0(e,t);let r=oC(e),n=oC(t),i=i0(r.seconds,n.seconds);return 0!==i?i:i0(r.nanos,n.nanos)}function o5(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=i0(r[e],n[e]);if(0!==t)return t}return i0(r.length,n.length)}function o8(e,t){let r=i0(o_(e.latitude),o_(t.latitude));return 0!==r?r:i0(o_(e.longitude),o_(t.longitude))}function o7(e,t){let r=oI(e),n=oI(t);return r.compareTo(n)}function o9(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=o3(r[e],n[e]);if(t)return t}return i0(r.length,n.length)}function le(e,t){var r,n,i,s;let a=e.fields||{},o=t.fields||{},l=null==(r=a[oW])?void 0:r.arrayValue,c=null==(n=o[oW])?void 0:n.arrayValue,u=i0((null==(i=null==l?void 0:l.values)?void 0:i.length)||0,(null==(s=null==c?void 0:c.values)?void 0:s.length)||0);return 0!==u?u:o9(l,c)}function lt(e,t){if(e===oG.mapValue&&t===oG.mapValue)return 0;if(e===oG.mapValue)return 1;if(t===oG.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=i1(n[e],s[e]);if(0!==t)return t;let a=o3(r[n[e]],i[s[e]]);if(0!==a)return a}return i0(n.length,s.length)}function lr(e){return ln(e)}function ln(e){if("nullValue"in e)return"null";if("booleanValue"in e)return""+e.booleanValue;if("integerValue"in e)return""+e.integerValue;if("doubleValue"in e)return""+e.doubleValue;if("timestampValue"in e)return ls(e.timestampValue);else if("stringValue"in e)return e.stringValue;else if("bytesValue"in e)return li(e.bytesValue);else if("referenceValue"in e)return lo(e.referenceValue);else if("geoPointValue"in e)return la(e.geoPointValue);else if("arrayValue"in e)return lc(e.arrayValue);else if("mapValue"in e)return ll(e.mapValue);else return iP(61005,{value:e})}function li(e){return oI(e).toBase64()}function ls(e){let t=oC(e);return`time(${t.seconds},${t.nanos})`}function la(e){return`geo(${e.latitude},${e.longitude})`}function lo(e){return st.fromName(e).toString()}function ll(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${ln(e.fields[i])}`;return r+"}"}function lc(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=ln(n);return t+"]"}function lu(e){switch(oQ(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=oO(e);return t?16+lu(t):16;case 5:return 2*e.stringValue.length;case 6:return oI(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return lh(e.arrayValue);case 10:case 11:return ld(e.mapValue);default:throw iP(13486,{value:e})}}function ld(e){let t=0;return oa(e.fields,(e,r)=>{t+=e.length+lu(r)}),t}function lh(e){return(e.values||[]).reduce((e,t)=>e+lu(t),0)}function lp(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function lf(e){return!!e&&"integerValue"in e}function lm(e){return!!e&&"doubleValue"in e}function lg(e){return lf(e)||lm(e)}function ly(e){return!!e&&"arrayValue"in e}function lv(e){return!!e&&"nullValue"in e}function lb(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function lS(e){return!!e&&"mapValue"in e}function lT(e){var t,r;return(null==(r=((null==(t=null==e?void 0:e.mapValue)?void 0:t.fields)||{})[oq])?void 0:r.stringValue)===oK}function lE(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){let t={mapValue:{fields:{}}};return oa(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=lE(r)),t}{if(!e.arrayValue)return Object.assign({},e);let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=lE(e.arrayValue.values[r]);return t}}function lw(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===o$}let lC={mapValue:{fields:{[oq]:{stringValue:oK},[oW]:{arrayValue:{}}}}};function l_(e){if("nullValue"in e)return oH;if("booleanValue"in e)return{booleanValue:!1};if("integerValue"in e||"doubleValue"in e)return{doubleValue:NaN};if("timestampValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in e)return{stringValue:""};else if("bytesValue"in e)return{bytesValue:""};else if("referenceValue"in e)return lp(oF.empty(),st.empty());else if("geoPointValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in e)return{arrayValue:{}};else if(!("mapValue"in e))return iP(35942,{value:e});else return lT(e)?lC:{mapValue:{}}}function lI(e){if("nullValue"in e)return{booleanValue:!1};if("booleanValue"in e)return{doubleValue:NaN};if("integerValue"in e||"doubleValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in e)return{stringValue:""};if("stringValue"in e)return{bytesValue:""};else if("bytesValue"in e)return lp(oF.empty(),st.empty());else if("referenceValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in e)return{arrayValue:{}};else if("arrayValue"in e)return lC;else if(!("mapValue"in e))return iP(61959,{value:e});else return lT(e)?{mapValue:{}}:oG}function lx(e,t){let r=o3(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function lk(e,t){let r=o3(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class lN{constructor(e){this.value=e}static empty(){return new lN({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!lS(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=lE(t)}setAll(e){let t=se.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=lE(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());lS(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return oY(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];lS(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(oa(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new lN(lE(this.value))}}function lR(e){let t=[];return oa(e.fields,(e,r)=>{let n=new se([e]);if(lS(r)){let e=lR(r.mapValue).fields;if(0===e.length)t.push(n);else for(let r of e)t.push(n.child(r))}else t.push(n)}),new oy(t)}class lA{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new lA(e,0,sm.min(),sm.min(),sm.min(),lN.empty(),0)}static newFoundDocument(e,t,r,n){return new lA(e,1,t,sm.min(),r,n,0)}static newNoDocument(e,t){return new lA(e,2,t,sm.min(),sm.min(),lN.empty(),0)}static newUnknownDocument(e,t){return new lA(e,3,t,sm.min(),sm.min(),lN.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(sm.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=lN.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=lN.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=sm.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof lA&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new lA(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function lD(e,t,r){let n=t.data.field(e),i=r.data.field(e);return null!==n&&null!==i?o3(n,i):iP(42886)}class lO{constructor(e,t){this.position=e,this.inclusive=t}}function lP(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?st.comparator(st.fromName(a.referenceValue),r.key):o3(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function lM(e,t,r){let n=lP(e,t,r);return e.inclusive?n>=0:n>0}function lL(e,t,r){let n=lP(e,t,r);return e.inclusive?n<=0:n<0}function lF(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!oY(e.position[r],t.position[r]))return!1;return!0}class lB{constructor(e,t="asc"){this.field=e,this.dir=t}}function lj(e){return e.field.canonicalString()+e.dir}function lU(e){return`${e.field.canonicalString()} (${e.dir})`}function lV(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class lz{}class lq extends lz{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){if(e.isKeyField())if("in"===t||"not-in"===t)return this.createKeyFieldInFilter(e,t,r);else return new l3(e,t,r);if("array-contains"===t)return new l8(e,r);if("in"===t)return new l7(e,r);if("not-in"===t)return new l9(e,r);if("array-contains-any"===t)return new ce(e,r);else return new lq(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new l6(e,r):new l4(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(o3(t,this.value)):null!==t&&oQ(this.value)===oQ(t)&&this.matchesComparison(o3(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return iP(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class l$ extends lz{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new l$(e,t)}matches(e){return lG(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function lG(e){return"and"===e.op}function lK(e){return"or"===e.op}function lW(e){return lH(e)&&lG(e)}function lH(e){for(let t of e.filters)if(t instanceof l$)return!1;return!0}function lQ(e){if(e instanceof lq)return e.field.canonicalString()+e.op.toString()+lr(e.value);{if(lW(e))return e.filters.map(e=>lQ(e)).join(",");let t=e.filters.map(e=>lQ(e)).join(",");return`${e.op}(${t})`}}function lY(e,t){return e instanceof lq?lJ(e,t):e instanceof l$?lX(e,t):void iP(19439)}function lJ(e,t){return t instanceof lq&&e.op===t.op&&e.field.isEqual(t.field)&&oY(e.value,t.value)}function lX(e,t){return t instanceof l$&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,r,n)=>e&&lY(r,t.filters[n]),!0)}function lZ(e,t){let r=e.filters.concat(t);return l$.create(r,e.op)}function l0(e){return e instanceof lq?l2(e):e instanceof l$?l1(e):"Filter"}function l1(e){return e.op.toString()+" {"+e.getFilters().map(l0).join(" ,")+"}"}function l2(e){return`${e.field.canonicalString()} ${e.op} ${lr(e.value)}`}class l3 extends lq{constructor(e,t,r){super(e,t,r),this.key=st.fromName(r.referenceValue)}matches(e){let t=st.comparator(e.key,this.key);return this.matchesComparison(t)}}class l6 extends lq{constructor(e,t){super(e,"in",t),this.keys=l5("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class l4 extends lq{constructor(e,t){super(e,"not-in",t),this.keys=l5("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function l5(e,t){var r;return((null==(r=t.arrayValue)?void 0:r.values)||[]).map(e=>st.fromName(e.referenceValue))}class l8 extends lq{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return ly(t)&&o2(t.arrayValue,this.value)}}class l7 extends lq{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&o2(this.value.arrayValue,t)}}class l9 extends lq{constructor(e,t){super(e,"not-in",t)}matches(e){if(o2(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!o2(this.value.arrayValue,t)}}class ce extends lq{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!!ly(t)&&!!t.arrayValue.values&&t.arrayValue.values.some(e=>o2(this.value.arrayValue,e))}}class ct{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.memoizedCanonicalId=null}}function cr(e,t=null,r=[],n=[],i=null,s=null,a=null){return new ct(e,t,r,n,i,s,a)}function cn(e){let t=iF(e);if(null===t.memoizedCanonicalId){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>lQ(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>lj(e)).join(","),oU(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>lr(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>lr(e)).join(",")),t.memoizedCanonicalId=e}return t.memoizedCanonicalId}function ci(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>l0(e)).join(", ")}]`),oU(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>lU(e)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>lr(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>lr(e)).join(",")),`Target(${t})`}function cs(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++)if(!lV(e.orderBy[r],t.orderBy[r]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!lY(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!lF(e.startAt,t.startAt)&&lF(e.endAt,t.endAt)}function ca(e){return st.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function co(e,t){return e.filters.filter(e=>e instanceof lq&&e.field.isEqual(t))}function cl(e,t){let r=sb(t);if(void 0===r)return null;for(let t of co(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}function cc(e,t){let r=new Map;for(let n of sS(t))for(let t of co(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}function cu(e,t){let r=[],n=!0;for(let i of sS(t)){let t=0===i.kind?ch(e,i.fieldPath,e.startAt):cp(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new lO(r,n)}function cd(e,t){let r=[],n=!0;for(let i of sS(t)){let t=0===i.kind?cp(e,i.fieldPath,e.endAt):ch(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new lO(r,n)}function ch(e,t,r){let n=oH,i=!0;for(let r of co(e,t)){let e=oH,t=!0;switch(r.op){case"<":case"<=":e=l_(r.value);break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=oH}0>lx({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>lx({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function cp(e,t,r){let n=oG,i=!0;for(let r of co(e,t)){let e=oG,t=!0;switch(r.op){case">=":case">":e=lI(r.value),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=oG}lk({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];lk({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function cf(e){let t=new op(se.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+ +!!r}function cm(e){return null!==e.limit}class cg{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function cy(e,t,r,n,i,s,a,o){return new cg(e,t,r,n,i,s,a,o)}function cv(e){return new cg(e)}function cb(e,t){return new cg(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function cS(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function cT(e){let t=new op(se.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}function cE(e){return st.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function cw(e){return null!==e.collectionGroup}function cC(e){let t=iF(e);if(null===t.memoizedNormalizedOrderBy){t.memoizedNormalizedOrderBy=[];let e=new Set;for(let r of t.explicitOrderBy)t.memoizedNormalizedOrderBy.push(r),e.add(r.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";cT(t).forEach(n=>{e.has(n.canonicalString())||n.isKeyField()||t.memoizedNormalizedOrderBy.push(new lB(n,r))}),e.has(se.keyField().canonicalString())||t.memoizedNormalizedOrderBy.push(new lB(se.keyField(),r))}return t.memoizedNormalizedOrderBy}function c_(e){let t=iF(e);return t.memoizedTarget||(t.memoizedTarget=cx(t,cC(e))),t.memoizedTarget}function cI(e){let t=iF(e);return t.memoizedAggregateTarget||(t.memoizedAggregateTarget=cx(t,e.explicitOrderBy)),t.memoizedAggregateTarget}function cx(e,t){if("F"===e.limitType)return cr(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new lB(e.field,t)});let r=e.endAt?new lO(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new lO(e.startAt.position,e.startAt.inclusive):null;return cr(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function ck(e,t){let r=e.filters.concat([t]);return new cg(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function cN(e,t){let r=e.explicitOrderBy.concat([t]);return new cg(e.path,e.collectionGroup,r,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function cR(e,t,r){return new cg(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function cA(e,t){return new cg(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}function cD(e,t){return new cg(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}function cO(e,t){return cs(c_(e),c_(t))&&e.limitType===t.limitType}function cP(e){return`${cn(c_(e))}|lt:${e.limitType}`}function cM(e){return`Query(target=${ci(c_(e))}; limitType=${e.limitType})`}function cL(e,t){return t.isFoundDocument()&&cF(e,t)&&cB(e,t)&&cj(e,t)&&cU(e,t)}function cF(e,t){let r=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(r):st.isDocumentKey(e.path)?e.path.isEqual(r):e.path.isImmediateParentOf(r)}function cB(e,t){for(let r of cC(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}function cj(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}function cU(e,t){return(!e.startAt||!!lL(e.startAt,cC(e),t))&&(!e.endAt||!!lM(e.endAt,cC(e),t))}function cV(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function cz(e){return(t,r)=>{let n=!1;for(let i of cC(e)){let e=cq(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}function cq(e,t,r){let n=e.field.isKeyField()?st.comparator(t.key,r.key):lD(e.field,t,r);switch(e.dir){case"asc":return n;case"desc":return -1*n;default:return iP(19790,{direction:e.dir})}}class c${constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n){this.inner[r]=[[e,t]],this.innerSize++;return}for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e)){n[r]=[e,t];return}n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){oa(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return ol(this.inner)}size(){return this.innerSize}}let cG=new oc(st.comparator);function cK(){return cG}let cW=new oc(st.comparator);function cH(...e){let t=cW;for(let r of e)t=t.insert(r.key,r);return t}function cQ(){return cZ()}function cY(e){let t=cW;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function cJ(){return cZ()}function cX(){return cZ()}function cZ(){return new c$(e=>e.toString(),(e,t)=>e.isEqual(t))}let c0=new oc(st.comparator);function c1(){return c0}let c2=new op(st.comparator);function c3(...e){let t=c2;for(let r of e)t=t.add(r);return t}let c6=new op(i0);function c4(){return c6}function c5(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};else if(t===1/0)return{doubleValue:"Infinity"};else if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:oV(t)?"-0":t}}function c8(e){return{integerValue:""+e}}function c7(e,t){return oz(t)?c8(t):c5(e,t)}class c9{constructor(){this._=void 0}}function ue(e,t,r){return e instanceof ui?oD(r,t):e instanceof us?ua(e,t):e instanceof uo?ul(e,t):uu(e,t)}function ut(e,t,r){return e instanceof us?ua(e,t):e instanceof uo?ul(e,t):r}function ur(e,t){return e instanceof uc?lg(t)?t:{integerValue:0}:null}function un(e,t){return e instanceof us&&t instanceof us||e instanceof uo&&t instanceof uo?i6(e.elements,t.elements,oY):e instanceof uc&&t instanceof uc?oY(e.operand,t.operand):e instanceof ui&&t instanceof ui}class ui extends c9{}class us extends c9{constructor(e){super(),this.elements=e}}function ua(e,t){let r=uh(t);for(let t of e.elements)r.some(e=>oY(e,t))||r.push(t);return{arrayValue:{values:r}}}class uo extends c9{constructor(e){super(),this.elements=e}}function ul(e,t){let r=uh(t);for(let t of e.elements)r=r.filter(e=>!oY(e,t));return{arrayValue:{values:r}}}class uc extends c9{constructor(e,t){super(),this.serializer=e,this.operand=t}}function uu(e,t){let r=ur(e,t),n=ud(r)+ud(e.operand);return lf(r)&&lf(e.operand)?c8(n):c5(e.serializer,n)}function ud(e){return o_(e.integerValue||e.doubleValue)}function uh(e){return ly(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class up{constructor(e,t){this.field=e,this.transform=t}}function uf(e,t){return e.field.isEqual(t.field)&&un(e.transform,t.transform)}function um(e,t){return void 0===e&&void 0===t||!!e&&!!t&&i6(e,t,(e,t)=>uf(e,t))}class ug{constructor(e,t){this.version=e,this.transformResults=t}}class uy{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new uy}static exists(e){return new uy(void 0,e)}static updateTime(e){return new uy(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function uv(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ub{}function uS(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)if(e.isNoDocument())return new uP(e.key,uy.none());else return new u_(e.key,e.data,uy.none());{let r=e.data,n=lN.empty(),i=new op(se.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new uk(e.key,n,new oy(i.toArray()),uy.none())}}function uT(e,t,r){e instanceof u_?uI(e,t,r):e instanceof uk?uN(e,t,r):uM(e,t,r)}function uE(e,t,r,n){return e instanceof u_?ux(e,t,r,n):e instanceof uk?uR(e,t,r,n):uL(e,t,r)}function uw(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=ur(n.transform,e||null);null!=i&&(null===r&&(r=lN.empty()),r.set(n.field,i))}return r||null}function uC(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!um(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class u_ extends ub{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}function uI(e,t,r){let n=e.value.clone(),i=uD(e.fieldTransforms,t,r.transformResults);n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()}function ux(e,t,r,n){if(!uv(e.precondition,t))return r;let i=e.value.clone(),s=uO(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}class uk extends ub{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function uN(e,t,r){if(!uv(e.precondition,t))return void t.convertToUnknownDocument(r.version);let n=uD(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(uA(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}function uR(e,t,r,n){if(!uv(e.precondition,t))return r;let i=uO(e.fieldTransforms,n,t),s=t.data;return(s.setAll(uA(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}function uA(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function uD(e,t,r){let n=new Map;iL(e.length===r.length,32656,{serverTransformResultCount:r.length,fieldTransformCount:e.length});for(let i=0;i<r.length;i++){let s=e[i],a=s.transform,o=t.data.field(s.field);n.set(s.field,ut(a,o,r[i]))}return n}function uO(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,ue(e,s,t))}return n}class uP extends ub{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function uM(e,t,r){t.convertToNoDocument(r.version).setHasCommittedMutations()}function uL(e,t,r){return uv(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}class uF extends ub{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class uB{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&uT(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=uE(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=uE(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=cX();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=uS(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(sm.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),c3())}isEqual(e){return this.batchId===e.batchId&&i6(this.mutations,e.mutations,(e,t)=>uC(e,t))&&i6(this.baseMutations,e.baseMutations,(e,t)=>uC(e,t))}}class uj{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){iL(e.mutations.length===r.length,58842,{mutationsSent:e.mutations.length,resultsReceived:r.length});let n=c1(),i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new uj(e,t,r,n)}}class uU{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class uV{constructor(e,t){this.count=e,this.unchangedNames=t}}function uz(e){switch(e){case iB.OK:return iP(64938);case iB.CANCELLED:case iB.UNKNOWN:case iB.DEADLINE_EXCEEDED:case iB.RESOURCE_EXHAUSTED:case iB.INTERNAL:case iB.UNAVAILABLE:case iB.UNAUTHENTICATED:return!1;case iB.INVALID_ARGUMENT:case iB.NOT_FOUND:case iB.ALREADY_EXISTS:case iB.PERMISSION_DENIED:case iB.FAILED_PRECONDITION:case iB.ABORTED:case iB.OUT_OF_RANGE:case iB.UNIMPLEMENTED:case iB.DATA_LOSS:return!0;default:return iP(15467,{code:e})}}function uq(e){return uz(e)&&e!==iB.ABORTED}function u$(e){if(void 0===e)return iA("GRPC error has no .code"),iB.UNKNOWN;switch(e){case l.OK:return iB.OK;case l.CANCELLED:return iB.CANCELLED;case l.UNKNOWN:return iB.UNKNOWN;case l.DEADLINE_EXCEEDED:return iB.DEADLINE_EXCEEDED;case l.RESOURCE_EXHAUSTED:return iB.RESOURCE_EXHAUSTED;case l.INTERNAL:return iB.INTERNAL;case l.UNAVAILABLE:return iB.UNAVAILABLE;case l.UNAUTHENTICATED:return iB.UNAUTHENTICATED;case l.INVALID_ARGUMENT:return iB.INVALID_ARGUMENT;case l.NOT_FOUND:return iB.NOT_FOUND;case l.ALREADY_EXISTS:return iB.ALREADY_EXISTS;case l.PERMISSION_DENIED:return iB.PERMISSION_DENIED;case l.FAILED_PRECONDITION:return iB.FAILED_PRECONDITION;case l.ABORTED:return iB.ABORTED;case l.OUT_OF_RANGE:return iB.OUT_OF_RANGE;case l.UNIMPLEMENTED:return iB.UNIMPLEMENTED;case l.DATA_LOSS:return iB.DATA_LOSS;default:return iP(39323,{code:e})}}!function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS"}(l||(l={}));class uG extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}let uK=null;function uW(e){if(uK)throw Error("a TestingHooksSpi instance is already set");uK=e}let uH=new a([0xffffffff,0xffffffff],0);function uQ(e){let t=iJ().encode(e),r=new o;return r.update(t),new Uint8Array(r.digest())}function uY(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new a([r,n],0),new a([i,s],0)]}class uJ{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new uX(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new uX(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new uX(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=8*e.length-t,this.bitCountInInteger=a.fromNumber(this.bitCount)}getBitIndex(e,t,r){let n=e.add(t.multiply(a.fromNumber(r)));return 1===n.compare(uH)&&(n=new a([n.getBits(0),n.getBits(1)],0)),n.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(0===this.bitCount)return!1;let[t,r]=uY(uQ(e));for(let e=0;e<this.hashCount;e++){let n=this.getBitIndex(t,r,e);if(!this.isBitSet(n))return!1}return!0}static create(e,t,r){let n=e%8==0?0:8-e%8,i=new uJ(new Uint8Array(Math.ceil(e/8)),n,t);return r.forEach(e=>i.insert(e)),i}insert(e){if(0===this.bitCount)return;let[t,r]=uY(uQ(e));for(let e=0;e<this.hashCount;e++){let n=this.getBitIndex(t,r,e);this.setBit(n)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class uX extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class uZ{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,u0.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new uZ(sm.min(),n,new oc(i0),cK(),c3())}}class u0{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new u0(r,t,c3(),c3(),c3())}}class u1{constructor(e,t,r,n){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=n}}class u2{constructor(e,t){this.targetId=e,this.existenceFilter=t}}class u3{constructor(e,t,r=oS.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class u6{constructor(){this.pendingResponses=0,this.documentChanges=u7(),this._resumeToken=oS.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=c3(),t=c3(),r=c3();return this.documentChanges.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:iP(38017,{changeType:i})}}),new u0(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=u7()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,iL(this.pendingResponses>=0,3241,{pendingResponses:this.pendingResponses})}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let u4="WatchChangeAggregator";class u5{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=cK(),this.pendingDocumentUpdatesByTarget=u8(),this.pendingDocumentTargetMapping=u8(),this.pendingTargetResets=new oc(i0)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:iP(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((e,r)=>{this.isActiveTarget(r)&&t(r)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,n=this.targetDataForActiveTarget(t);if(n){let i=n.target;if(ca(i))if(0===r){let e=new st(i.path);this.removeDocumentFromTarget(t,e,lA.newNoDocument(e,sm.min()))}else iL(1===r,20013,{expectedCount:r});else{let n=this.getCurrentDocumentCountForTarget(t);if(n!==r){let r=this.parseBloomFilter(e),i=r?this.applyBloomFilter(r,e,n):1;if(0!==i){this.resetTarget(t);let e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,e)}null==uK||uK.notifyOnExistenceFilterMismatch(u9(n,e.existenceFilter,this.metadataProvider.getDatabaseId(),r,i))}}}}parseBloomFilter(e){let t,r,n=e.existenceFilter.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=oI(i).toUint8Array()}catch(e){if(e instanceof uG)return iD("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new uJ(t,s,a)}catch(e){return e instanceof uX?iD("BloomFilter error: ",e):iD("Applying bloom filter failed: ",e),null}return 0===r.bitCount?null:r}applyBloomFilter(e,t,r){return 2*(t.existenceFilter.count!==r-this.filterRemovedDocuments(e,t.targetId))}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.metadataProvider.getDatabaseId(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;!e.mightContain(s)&&(this.removeDocumentFromTarget(t,r,null),n++)}),n}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((r,n)=>{let i=this.targetDataForActiveTarget(n);if(i){if(r.current&&ca(i.target)){let t=new st(i.target.path);this.ensureDocumentUpdateByTarget(t).has(n)||this.targetContainsDocument(n,t)||this.removeDocumentFromTarget(n,t,lA.newNoDocument(t,e))}r.hasPendingChanges&&(t.set(n,r.toTargetChange()),r.clearPendingChanges())}});let r=c3();this.pendingDocumentTargetMapping.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.targetDataForActiveTarget(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.pendingDocumentUpdates.forEach((t,r)=>r.setReadTime(e));let n=new uZ(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=cK(),this.pendingDocumentUpdatesByTarget=u8(),this.pendingDocumentTargetMapping=u8(),this.pendingTargetResets=new oc(i0),n}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=2*!!this.targetContainsDocument(e,t.key);this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(t.key,this.ensureDocumentUpdateByTarget(t.key).add(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let n=this.ensureTargetState(e);this.targetContainsDocument(e,t)?n.addDocumentChange(t,1):n.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).add(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let t=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new u6,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new op(i0),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}ensureDocumentUpdateByTarget(e){let t=this.pendingDocumentUpdatesByTarget.get(e);return t||(t=new op(i0),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(e,t)),t}isActiveTarget(e){let t=null!==this.targetDataForActiveTarget(e);return t||iR(u4,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new u6),this.metadataProvider.getRemoteKeysForTarget(e).forEach(t=>{this.removeDocumentFromTarget(e,t,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}}function u8(){return new oc(st.comparator)}function u7(){return new oc(st.comparator)}function u9(e,t,r,n,i){var s,a,o,l,c,u;let d={localCacheCount:e,existenceFilterCount:t.count,databaseId:r.database,projectId:r.projectId},h=t.unchangedNames;return h&&(d.bloomFilter={applied:0===i,hashCount:null!=(s=null==h?void 0:h.hashCount)?s:0,bitmapLength:null!=(l=null==(o=null==(a=null==h?void 0:h.bits)?void 0:a.bitmap)?void 0:o.length)?l:0,padding:null!=(u=null==(c=null==h?void 0:h.bits)?void 0:c.padding)?u:0,mightContain:e=>{var t;return null!=(t=null==n?void 0:n.mightContain(e))&&t}}),d}let de=(()=>{let e={};return e.asc="ASCENDING",e.desc="DESCENDING",e})(),dt=(()=>{let e={};return e["<"]="LESS_THAN",e["<="]="LESS_THAN_OR_EQUAL",e[">"]="GREATER_THAN",e[">="]="GREATER_THAN_OR_EQUAL",e["=="]="EQUAL",e["!="]="NOT_EQUAL",e["array-contains"]="ARRAY_CONTAINS",e.in="IN",e["not-in"]="NOT_IN",e["array-contains-any"]="ARRAY_CONTAINS_ANY",e})(),dr=(()=>{let e={};return e.and="AND",e.or="OR",e})();class dn{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function di(e){return new ij(void 0===e.code?iB.UNKNOWN:u$(e.code),e.message||"")}function ds(e,t){return e.useProto3Json||oU(t)?t:{value:t}}function da(e){let t;return oU(t="object"==typeof e?e.value:e)?null:t}function dl(e,t){if(!e.useProto3Json)return{seconds:""+t.seconds,nanos:t.nanoseconds};{let e=new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),r=("000000000"+t.nanoseconds).slice(-9);return`${e}.${r}Z`}}function dc(e){let t=oC(e);return new sf(t.seconds,t.nanos)}function du(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function dd(e,t){return e.useProto3Json?(iL(void 0===t||"string"==typeof t,58123),oS.fromBase64String(t||"")):(iL(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),oS.fromUint8Array(t||new Uint8Array))}function dh(e,t){return dl(e,t.toTimestamp())}function dp(e){return iL(!!e,49232),sm.fromTimestamp(dc(e))}function df(e,t){return dm(e,t).canonicalString()}function dm(e,t){let r=dE(e).child("documents");return void 0===t?r:r.child(t)}function dg(e){let t=i7.fromString(e);return iL(hp(t),10190,{key:t.toString()}),t}function dy(e,t){return df(e.databaseId,t.path)}function dv(e,t){let r=dg(t);if(r.get(1)!==e.databaseId.projectId)throw new ij(iB.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new ij(iB.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new st(dw(r))}function db(e,t){return df(e.databaseId,t)}function dS(e){let t=dg(e);return 4===t.length?i7.emptyPath():dw(t)}function dT(e){return new i7(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function dE(e){return new i7(["projects",e.projectId,"databases",e.database])}function dw(e){return iL(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function dC(e,t,r){return{name:dy(e,t),fields:r.value.mapValue.fields}}function d_(e,t){return{name:dy(e,t.key),fields:t.data.value.mapValue.fields,updateTime:dl(e,t.version.toTimestamp()),createTime:dl(e,t.createTime.toTimestamp())}}function dI(e,t,r){let n=dv(e,t.name),i=dp(t.updateTime),s=t.createTime?dp(t.createTime):sm.min(),a=new lN({mapValue:{fields:t.fields}}),o=lA.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function dx(e,t){iL(!!t.found,43571),t.found.name,t.found.updateTime;let r=dv(e,t.found.name),n=dp(t.found.updateTime),i=t.found.createTime?dp(t.found.createTime):sm.min(),s=new lN({mapValue:{fields:t.found.fields}});return lA.newFoundDocument(r,n,i,s)}function dk(e,t){iL(!!t.missing,3894),iL(!!t.readTime,22933);let r=dv(e,t.missing),n=dp(t.readTime);return lA.newNoDocument(r,n)}function dN(e,t){return"found"in t?dx(e,t):"missing"in t?dk(e,t):iP(7234,{result:t})}function dR(e,t){let r;if("targetChange"in t){t.targetChange;let n=dA(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=dd(e,t.targetChange.resumeToken),a=t.targetChange.cause;r=new u3(n,i,s,a&&di(a)||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=dv(e,n.document.name),s=dp(n.document.updateTime),a=n.document.createTime?dp(n.document.createTime):sm.min(),o=new lN({mapValue:{fields:n.document.fields}}),l=lA.newFoundDocument(i,s,a,o);r=new u1(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=dv(e,n.document),s=n.readTime?dp(n.readTime):sm.min(),a=lA.newNoDocument(i,s);r=new u1([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=dv(e,n.document);r=new u1([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return iP(11601,{change:t});t.filter;let e=t.filter;e.targetId;let{count:n=0,unchangedNames:i}=e,s=new uV(n,i);r=new u2(e.targetId,s)}return r}function dA(e){if("NO_CHANGE"===e)return 0;if("ADD"===e)return 1;if("REMOVE"===e)return 2;if("CURRENT"===e)return 3;if("RESET"===e)return 4;else return iP(39313,{state:e})}function dD(e){if(!("targetChange"in e))return sm.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length||!t.readTime?sm.min():dp(t.readTime)}function dO(e,t){let r;if(t instanceof u_)r={update:dC(e,t.key,t.value)};else if(t instanceof uP)r={delete:dy(e,t.key)};else if(t instanceof uk)r={update:dC(e,t.key,t.data),updateMask:hd(t.fieldMask)};else{if(!(t instanceof uF))return iP(16599,{mutationType:t.type});r={verify:dy(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(t=>dj(e,t))),t.precondition.isNone||(r.currentDocument=dM(e,t.precondition)),r}function dP(e,t){let r=t.currentDocument?dL(t.currentDocument):uy.none(),n=t.updateTransforms?t.updateTransforms.map(t=>dU(e,t)):[];if(t.update){t.update.name;let i=dv(e,t.update.name),s=new lN({mapValue:{fields:t.update.fields}});return t.updateMask?new uk(i,s,hh(t.updateMask),r,n):new u_(i,s,r,n)}return t.delete?new uP(dv(e,t.delete),r):t.verify?new uF(dv(e,t.verify),r):iP(1463,{proto:t})}function dM(e,t){return void 0!==t.updateTime?{updateTime:dh(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:iP(27497)}function dL(e){return void 0!==e.updateTime?uy.updateTime(dp(e.updateTime)):void 0!==e.exists?uy.exists(e.exists):uy.none()}function dF(e,t){let r=e.updateTime?dp(e.updateTime):dp(t);return r.isEqual(sm.min())&&(r=dp(t)),new ug(r,e.transformResults||[])}function dB(e,t){return e&&e.length>0?(iL(void 0!==t,14353),e.map(e=>dF(e,t))):[]}function dj(e,t){let r=t.transform;if(r instanceof ui)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof us)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof uo)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof uc)return{fieldPath:t.field.canonicalString(),increment:r.operand};throw iP(20930,{transform:t.transform})}function dU(e,t){let r=null;return"setToServerValue"in t?(iL("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new ui):"appendMissingElements"in t?r=new us(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new uo(t.removeAllFromArray.values||[]):"increment"in t?r=new uc(e,t.increment):iP(16584,{proto:t}),new up(se.fromServerFormat(t.fieldPath),r)}function dV(e,t){return{documents:[db(e,t.path)]}}function dz(e){let t=e.documents.length;return iL(1===t,1966,{count:t}),c_(cv(dS(e.documents[0])))}function dq(e,t){let r,n={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(r=i,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=db(e,r);let s=dY(t.filters);s&&(n.structuredQuery.where=s);let a=dZ(t.orderBy);a&&(n.structuredQuery.orderBy=a);let o=ds(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=d1(t.startAt)),t.endAt&&(n.structuredQuery.endAt=d2(t.endAt)),{queryTarget:n,parent:r}}function d$(e,t,r,n){let{queryTarget:i,parent:s}=dq(e,t),a={},o=[],l=0;return r.forEach(e=>{let t=n?e.alias:`aggregate_${l++}`;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:ht(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:ht(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},aliasMap:a,parent:s}}function dG(e){let t=dS(e.parent),r=e.structuredQuery,n=r.from?r.from.length:0,i=null;if(n>0){iL(1===n,65062);let e=r.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];r.where&&(s=dJ(r.where));let a=[];r.orderBy&&(a=d0(r.orderBy));let o=null;r.limit&&(o=da(r.limit));let l=null;r.startAt&&(l=d3(r.startAt));let c=null;return r.endAt&&(c=d6(r.endAt)),cy(t,i,a,s,o,"F",l,c)}function dK(e){return c_(dG(e))}function dW(e,t){let r=dH(t.purpose);return null==r?null:{"goog-listen-tags":r}}function dH(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return iP(28987,{purpose:e})}}function dQ(e,t){let r,n=t.target;if((r=ca(n)?{documents:dV(e,n)}:{query:dq(e,n).queryTarget}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=du(e,t.resumeToken);let n=ds(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(sm.min())>0){r.readTime=dl(e,t.snapshotVersion.toTimestamp());let n=ds(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}function dY(e){if(0!==e.length)return hs(l$.create(e,"and"))}function dJ(e){let t=dX(e);return t instanceof l$&&lW(t)?t.getFilters():[t]}function dX(e){return void 0!==e.unaryFilter?hl(e):void 0!==e.fieldFilter?hc(e):void 0!==e.compositeFilter?hu(e):iP(30097,{filter:e})}function dZ(e){if(0!==e.length)return e.map(e=>hn(e))}function d0(e){return e.map(e=>hi(e))}function d1(e){return{before:e.inclusive,values:e.position}}function d2(e){return{before:!e.inclusive,values:e.position}}function d3(e){let t=!!e.before;return new lO(e.values||[],t)}function d6(e){let t=!e.before;return new lO(e.values||[],t)}function d4(e){return de[e]}function d5(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function d8(e){return dt[e]}function d7(e){return dr[e]}function d9(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return iP(58110);default:return iP(50506)}}function he(e){switch(e){case"AND":return"and";case"OR":return"or";default:return iP(1026)}}function ht(e){return{fieldPath:e.canonicalString()}}function hr(e){return se.fromServerFormat(e.fieldPath)}function hn(e){return{field:ht(e.field),direction:d4(e.dir)}}function hi(e){return new lB(hr(e.field),d5(e.direction))}function hs(e){return e instanceof lq?ho(e):e instanceof l$?ha(e):iP(54877,{filter:e})}function ha(e){let t=e.getFilters().map(e=>hs(e));return 1===t.length?t[0]:{compositeFilter:{op:d7(e.op),filters:t}}}function ho(e){if("=="===e.op){if(lb(e.value))return{unaryFilter:{field:ht(e.field),op:"IS_NAN"}};else if(lv(e.value))return{unaryFilter:{field:ht(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(lb(e.value))return{unaryFilter:{field:ht(e.field),op:"IS_NOT_NAN"}};else if(lv(e.value))return{unaryFilter:{field:ht(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ht(e.field),op:d8(e.op),value:e.value}}}function hl(e){switch(e.unaryFilter.op){case"IS_NAN":let t=hr(e.unaryFilter.field);return lq.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=hr(e.unaryFilter.field);return lq.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=hr(e.unaryFilter.field);return lq.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=hr(e.unaryFilter.field);return lq.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return iP(61313);default:return iP(60726)}}function hc(e){return lq.create(hr(e.fieldFilter.field),d9(e.fieldFilter.op),e.fieldFilter.value)}function hu(e){return l$.create(e.compositeFilter.filters.map(e=>dX(e)),he(e.compositeFilter.op))}function hd(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function hh(e){return new oy((e.fieldPaths||[]).map(e=>se.fromServerFormat(e)))}function hp(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class hf{constructor(e,t,r,n,i=sm.min(),s=sm.min(),a=oS.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new hf(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new hf(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new hf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new hf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class hm{constructor(e){this.remoteSerializer=e}}function hg(e,t){let r;if(t.document)r=dI(e.remoteSerializer,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=st.fromSegments(t.noDocument.path),n=hT(t.noDocument.readTime);r=lA.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return iP(56709);let e=st.fromSegments(t.unknownDocument.path),n=hT(t.unknownDocument.version);r=lA.newUnknownDocument(e,n)}return t.readTime&&r.setReadTime(hb(t.readTime)),r}function hy(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:hv(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=d_(e.remoteSerializer,t);else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:hS(t.version)};else{if(!t.isUnknownDocument())return iP(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:hS(t.version)}}return n}function hv(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function hb(e){let t=new sf(e[0],e[1]);return sm.fromTimestamp(t)}function hS(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function hT(e){let t=new sf(e.seconds,e.nanoseconds);return sm.fromTimestamp(t)}function hE(e,t,r){let n=r.baseMutations.map(t=>dO(e.remoteSerializer,t)),i=r.mutations.map(t=>dO(e.remoteSerializer,t));return{userId:t,batchId:r.batchId,localWriteTimeMs:r.localWriteTime.toMillis(),baseMutations:n,mutations:i}}function hw(e,t){let r=(t.baseMutations||[]).map(t=>dP(e.remoteSerializer,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform&&(r.updateTransforms=t.mutations[e+1].transform.fieldTransforms,t.mutations.splice(e+1,1),++e)}let n=t.mutations.map(t=>dP(e.remoteSerializer,t)),i=sf.fromMillis(t.localWriteTimeMs);return new uB(t.batchId,i,r,n)}function hC(e){let t,r=hT(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?hT(e.lastLimboFreeSnapshotVersion):sm.min();return new hf(t=hI(e.query)?dz(e.query):dK(e.query),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,n,oS.fromBase64String(e.resumeToken))}function h_(e,t){let r,n=hS(t.snapshotVersion),i=hS(t.lastLimboFreeSnapshotVersion);r=ca(t.target)?dV(e.remoteSerializer,t.target):dq(e.remoteSerializer,t.target).queryTarget;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:cn(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function hI(e){return void 0!==e.documents}function hx(e){return{id:e.bundleId,createTime:hT(e.createTime),version:e.version}}function hk(e){return{bundleId:e.id,createTime:hS(dp(e.createTime)),version:e.version}}function hN(e){return{name:e.name,query:hA(e.bundledQuery),readTime:hT(e.readTime)}}function hR(e){return{name:e.name,readTime:hS(dp(e.readTime)),bundledQuery:e.bundledQuery}}function hA(e){let t=dG({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?cR(t,t.limit,"L"):t}function hD(e){return{name:e.name,query:hA(e.bundledQuery),readTime:dp(e.readTime)}}function hO(e){return{id:e.id,version:e.version,createTime:dp(e.createTime)}}function hP(e,t){return new uU(t.largestBatchId,dP(e.remoteSerializer,t.overlayMutation))}function hM(e,t,r){let[n,i,s]=hL(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:dO(e.remoteSerializer,r.mutation)}}function hL(e,t){let r=t.path.lastSegment();return[e,s6(t.path.popLast()),r]}function hF(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function hB(e,t){let r=t?new sI(t.sequenceNumber,new sN(hT(t.readTime),new st(s8(t.documentKey)),t.largestBatchId)):sI.empty(),n=e.fields.map(([e,t])=>new sC(se.fromServerFormat(e),t));return new sv(e.indexId,e.collectionGroup,n,r)}function hj(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:hS(n.readTime),documentKey:s6(n.documentKey.path),largestBatchId:n.largestBatchId}}class hU{getBundleMetadata(e,t){return hV(e).get(t).next(e=>{if(e)return hx(e)})}saveBundleMetadata(e,t){return hV(e).put(hk(t))}getNamedQuery(e,t){return hz(e).get(t).next(e=>{if(e)return hN(e)})}saveNamedQuery(e,t){return hz(e).put(hR(t))}}function hV(e){return oi(e,aP)}function hz(e){return oi(e,aL)}class hq{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){return new hq(e,t.uid||"")}getOverlay(e,t){return h$(e).get(hL(this.userId,t)).next(e=>e?hP(this.serializer,e):null)}getOverlays(e,t){let r=cJ();return sP.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new uU(t,i);n.push(this.saveOverlay(e,s))}),sP.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(s6(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(h$(e).deleteAll(aX,n))}),sP.waitFor(i)}getOverlaysForCollection(e,t,r){let n=cJ(),i=s6(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return h$(e).loadAll(aX,s).next(e=>{for(let t of e){let e=hP(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i,s=cJ(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return h$(e).iterate({index:a0,range:a},(e,t,r)=>{let a=hP(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}saveOverlay(e,t){return h$(e).put(hM(this.serializer,this.userId,t))}}function h$(e){return oi(e,aY)}class hG{globalsStore(e){return oi(e,a2)}getSessionToken(e){return this.globalsStore(e).get("sessionToken").next(e=>{let t=null==e?void 0:e.value;return t?oS.fromUint8Array(t):oS.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.globalsStore(e).put({name:"sessionToken",value:t.toUint8Array()})}}let hK=5,hW=10,hH=13,hQ=15,hY=20,hJ=25,hX=30,hZ=37,h0=45,h1=50,h2=53,h3=55,h6=60,h4=2;class h5{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,hK);else if("booleanValue"in e)this.writeValueTypeLabel(t,hW),t.writeNumber(+!!e.booleanValue);else if("integerValue"in e)this.writeValueTypeLabel(t,hQ),t.writeNumber(o_(e.integerValue));else if("doubleValue"in e){let r=o_(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,hH):(this.writeValueTypeLabel(t,hQ),oV(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,hY),"string"==typeof r&&(r=oC(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,hX),t.writeBytes(oI(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,h0),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?lw(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):lT(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):iP(19022,{indexValue:e})}writeIndexString(e,t){this.writeValueTypeLabel(t,hJ),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};for(let e of(this.writeValueTypeLabel(t,h3),Object.keys(r)))this.writeIndexString(e,t),this.writeIndexValueAux(r[e],t)}writeIndexVector(e,t){var r,n;let i=e.fields||{};this.writeValueTypeLabel(t,h2);let s=oW,a=(null==(n=null==(r=i[s].arrayValue)?void 0:r.values)?void 0:n.length)||0;this.writeValueTypeLabel(t,hQ),t.writeNumber(o_(a)),this.writeIndexString(s,t),this.writeIndexValueAux(i[s],t)}writeIndexArray(e,t){let r=e.values||[];for(let e of(this.writeValueTypeLabel(t,h1),r))this.writeIndexValueAux(e,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,hZ),st.fromName(e).path.forEach(e=>{this.writeValueTypeLabel(t,h6),this.writeUnlabeledIndexString(e,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(h4)}}h5.INSTANCE=new h5;let h8="\uD800",h7="\uDBFF",h9=0,pe=255,pt=1,pr=255,pn=255,pi=0,ps=64,pa=8,po=1024;function pl(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}function pc(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function pu(e){let t=0;for(let r=0;r<8;++r){let n=pc(255&e[r]);if(t+=n,8!==n)break}return t}function pd(e){return Math.ceil((ps-pu(e))/pa)}class ph{constructor(){this.buffer=new Uint8Array(po),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteAscending(e);else if(e<2048)this.writeByteAscending(960|e>>>6),this.writeByteAscending(128|63&e);else if(t<h8||h7<t)this.writeByteAscending(480|e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e);else{let e=t.codePointAt(0);this.writeByteAscending(240|e>>>18),this.writeByteAscending(128|63&e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteDescending(e);else if(e<2048)this.writeByteDescending(960|e>>>6),this.writeByteDescending(128|63&e);else if(t<h8||h7<t)this.writeByteDescending(480|e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e);else{let e=t.codePointAt(0);this.writeByteDescending(240|e>>>18),this.writeByteDescending(128|63&e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=pd(t);this.ensureAvailable(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}writeNumberDescending(e){let t=this.toOrderedBits(e),r=pd(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}writeInfinityAscending(){this.writeEscapedByteAscending(pr),this.writeEscapedByteAscending(pn)}writeInfinityDescending(){this.writeEscapedByteDescending(pr),this.writeEscapedByteDescending(pn)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=pl(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let e=1;e<t.length;++e)t[e]^=255*!!r;return t}writeByteAscending(e){let t=255&e;t===h9?(this.writeEscapedByteAscending(h9),this.writeEscapedByteAscending(pe)):t===pr?(this.writeEscapedByteAscending(pr),this.writeEscapedByteAscending(pi)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=255&e;t===h9?(this.writeEscapedByteDescending(h9),this.writeEscapedByteDescending(pe)):t===pr?(this.writeEscapedByteDescending(pr),this.writeEscapedByteDescending(pi)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(h9),this.writeEscapedByteAscending(pt)}writeSeparatorDescending(){this.writeEscapedByteDescending(h9),this.writeEscapedByteDescending(pt)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class pp{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class pf{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class pm{constructor(){this.orderedCode=new ph,this.ascending=new pp(this.orderedCode),this.descending=new pf(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return 0===e?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}class pg{constructor(e,t,r,n){this._indexId=e,this._documentKey=t,this._arrayValue=r,this._directionalValue=n}successor(){let e=this._directionalValue.length,t=0===e||255===this._directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this._directionalValue,0),t!==e?r.set([0],this._directionalValue.length):++r[r.length-1],new pg(this._indexId,this._documentKey,this._arrayValue,r)}dbIndexEntry(e,t,r){return{indexId:this._indexId,uid:e,arrayValue:pb(this._arrayValue),directionalValue:pb(this._directionalValue),orderedDocumentKey:pb(t),documentKey:r.path.toArray()}}dbIndexEntryKey(e,t,r){let n=this.dbIndexEntry(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function py(e,t){let r=e._indexId-t._indexId;return 0!==r||0!==(r=pv(e._arrayValue,t._arrayValue))||0!==(r=pv(e._directionalValue,t._directionalValue))?r:st.comparator(e._documentKey,t._documentKey)}function pv(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function pb(e){return el()?pT(e):e}function pS(e){return"string"!=typeof e?e:pE(e)}function pT(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}function pE(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}class pw{constructor(e){for(let t of(this.inequalityFilters=new op((e,t)=>se.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[],e.filters)){let e=t;e.isInequality()?this.inequalityFilters=this.inequalityFilters.add(e):this.equalityFilters.push(e)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(iL(e.collectionGroup===this.collectionId,49279),this.hasMultipleInequality)return!1;let t=sb(e);if(void 0!==t&&!this.hasMatchingEqualityFilter(t))return!1;let r=sS(e),n=new Set,i=0,s=0;for(;i<r.length;++i)if(this.hasMatchingEqualityFilter(r[i]))n=n.add(r[i].fieldPath.canonicalString());else break;if(i===r.length)return!0;if(this.inequalityFilters.size>0){let e=this.inequalityFilters.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.matchesFilter(e,t)||!this.matchesOrderBy(this.orderBys[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[s++],e))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new op(se.comparator),t=[];for(let r of this.equalityFilters)if(!r.field.isKeyField())if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new sC(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new sC(r.field,0))}for(let r of this.orderBys)!r.field.isKeyField()&&(e.has(r.field)||(e=e.add(r.field),t.push(new sC(r.field,+("asc"!==r.dir)))));return new sv(sv.UNKNOWN_ID,this.collectionId,t,sI.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}matchesOrderBy(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function pC(e){var t,r;if(iL(e instanceof lq||e instanceof l$,20012),e instanceof lq)if(!(e instanceof l7))return e;else{let n=(null==(r=null==(t=e.value.arrayValue)?void 0:t.values)?void 0:r.map(t=>lq.create(e.field,"==",t)))||[];return l$.create(n,"or")}let n=e.filters.map(e=>pC(e));return l$.create(n,e.op)}function p_(e){if(0===e.getFilters().length)return[];let t=pR(pC(e));return(iL(pk(t),7391),pI(t)||px(t))?[t]:t.getFilters()}function pI(e){return e instanceof lq}function px(e){return e instanceof l$&&lW(e)}function pk(e){return pI(e)||px(e)||pN(e)}function pN(e){if(e instanceof l$&&lK(e)){for(let t of e.getFilters())if(!pI(t)&&!px(t))return!1;return!0}return!1}function pR(e){if(iL(e instanceof lq||e instanceof l$,34018),e instanceof lq)return e;if(1===e.filters.length)return pR(e.filters[0]);let t=e.filters.map(e=>pR(e)),r=l$.create(t,e.op);return pk(r=pM(r))?r:(iL(r instanceof l$,64498),iL(lG(r),40251),iL(r.filters.length>1,57927),r.filters.reduce((e,t)=>pA(e,t)))}function pA(e,t){let r;return iL(e instanceof lq||e instanceof l$,38388),iL(t instanceof lq||t instanceof l$,25473),pM(r=e instanceof lq?t instanceof lq?pD(e,t):pP(e,t):t instanceof lq?pP(t,e):pO(e,t))}function pD(e,t){return l$.create([e,t],"and")}function pO(e,t){if(iL(e.filters.length>0&&t.filters.length>0,48005),lG(e)&&lG(t))return lZ(e,t.getFilters());let r=lK(e)?e:t,n=lK(e)?t:e,i=r.filters.map(e=>pA(e,n));return l$.create(i,"or")}function pP(e,t){if(lG(t))return lZ(t,e.getFilters());{let r=t.filters.map(t=>pA(e,t));return l$.create(r,"or")}}function pM(e){if(iL(e instanceof lq||e instanceof l$,11850),e instanceof lq)return e;let t=e.getFilters();if(1===t.length)return pM(t[0]);if(lH(e))return e;let r=t.map(e=>pM(e)),n=[];return(r.forEach(t=>{t instanceof lq?n.push(t):t instanceof l$&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length)?n[0]:l$.create(n,e.op)}class pL{constructor(){this.collectionParentIndex=new pF}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),sP.resolve()}getCollectionParents(e,t){return sP.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return sP.resolve()}deleteFieldIndex(e,t){return sP.resolve()}deleteAllFieldIndexes(e){return sP.resolve()}createTargetIndexes(e,t){return sP.resolve()}getDocumentsMatchingTarget(e,t){return sP.resolve(null)}getIndexType(e,t){return sP.resolve(0)}getFieldIndexes(e,t){return sP.resolve([])}getNextCollectionGroupToUpdate(e){return sP.resolve(null)}getMinOffset(e,t){return sP.resolve(sN.min())}getMinOffsetFromCollectionGroup(e,t){return sP.resolve(sN.min())}updateCollectionGroup(e,t,r){return sP.resolve()}updateIndexEntries(e,t){return sP.resolve()}}class pF{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new op(i7.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new op(i7.comparator)).toArray()}}let pB="IndexedDbIndexManager",pj=new Uint8Array(0);class pU{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new pF,this.targetToDnfSubTargets=new c$(e=>cn(e),(e,t)=>cs(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let i={collectionId:r,parent:s6(n)};return pV(e).put(i)}return sP.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[i4(t),""],!1,!0);return pV(e).loadAll(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(s8(n.parent))}return r})}addFieldIndex(e,t){let r=pq(e),n=hF(t);delete n.indexId;let i=r.add(n);if(!t.indexState)return i.next();{let r=p$(e);return i.next(e=>{r.put(hj(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}}deleteFieldIndex(e,t){let r=pq(e),n=p$(e),i=pz(e);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=pq(e),r=pz(e),n=p$(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>n.deleteAll())}createTargetIndexes(e,t){return sP.forEach(this.getSubTargets(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new pw(t).buildTargetIndex();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=pz(e),n=!0,i=new Map;return sP.forEach(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(!n)return sP.resolve(null);{let e=c3(),n=[];return sP.forEach(i,(i,s)=>{iR(pB,`Using index ${sw(i)} to execute ${cn(t)}`);let a=cl(s,i),o=cc(s,i),l=cu(s,i),c=cd(s,i),u=this.encodeBound(i,s,l),d=this.encodeBound(i,s,c),h=this.encodeValues(i,s,o),p=this.generateIndexRanges(i.indexId,a,u,l.inclusive,d,c.inclusive,h);return sP.forEach(p,i=>r.loadFirst(i,t.limit).next(t=>{t.forEach(t=>{let r=st.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(t=0===e.filters.length?[e]:p_(l$.create(e.filters,"and")).map(t=>cr(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t)),t}generateIndexRanges(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),c=[];for(let u=0;u<o;++u){let o=t?this.encodeSingleElement(t[u/l]):pj,d=this.generateLowerBound(e,o,r[u%l],n),h=this.generateUpperBound(e,o,i[u%l],s),p=a.map(t=>this.generateLowerBound(e,o,t,!0));c.push(...this.createRange(d,h,p))}return c}generateLowerBound(e,t,r,n){let i=new pg(e,st.empty(),t,r);return n?i:i.successor()}generateUpperBound(e,t,r,n){let i=new pg(e,st.empty(),t,r);return n?i.successor():i}getFieldIndex(e,t){let r=new pw(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.servedByIndex(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.getSubTargets(t);return sP.forEach(n,t=>this.getFieldIndex(e,t).next(e=>{e?0!==r&&e.fields.length<cf(t)&&(r=1):r=0})).next(()=>cm(t)&&n.length>1&&2===r?1:r)}encodeDirectionalElements(e,t){let r=new pm;for(let n of sS(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.forKind(n.kind);h5.INSTANCE.writeIndexValue(e,i)}return r.encodedBytes()}encodeSingleElement(e){let t=new pm;return h5.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new pm;return h5.INSTANCE.writeIndexValue(lp(this.databaseId,t),r.forKind(sT(e))),r.encodedBytes()}encodeValues(e,t,r){if(null===r)return[];let n=[];n.push(new pm);let i=0;for(let s of sS(e)){let e=r[i++];for(let r of n)if(this.isInFilter(t,s.fieldPath)&&ly(e))n=this.expandIndexValues(n,s,e);else{let t=r.forKind(s.kind);h5.INSTANCE.writeIndexValue(e,t)}}return this.getEncodedBytes(n)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new pm;n.seed(r.encodedBytes()),h5.INSTANCE.writeIndexValue(e,n.forKind(t.kind)),i.push(n)}return i}isInFilter(e,t){return!!e.filters.find(e=>e instanceof lq&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=pq(e),n=p$(e);return(t?r.loadAll(aU,IDBKeyRange.bound(t,t)):r.loadAll()).next(e=>{let t=[];return sP.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{t.push(hB(e,r))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:i0(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=pq(e),i=p$(e);return this.getNextSequenceNumber(e).next(e=>n.loadAll(aU,IDBKeyRange.bound(t,t)).next(t=>sP.forEach(t,t=>i.put(hj(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return sP.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?sP.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),sP.forEach(i,r=>this.getExistingIndexEntries(e,t,r).next(t=>{let i=this.computeIndexEntries(n,r);return t.isEqual(i)?sP.resolve():this.updateEntries(e,n,r,t,i)}))))})}addIndexEntry(e,t,r,n){return pz(e).put(n.dbIndexEntry(this.uid,this.encodeDirectionalKey(r,t.key),t.key))}deleteIndexEntry(e,t,r,n){return pz(e).delete(n.dbIndexEntryKey(this.uid,this.encodeDirectionalKey(r,t.key),t.key))}getExistingIndexEntries(e,t,r){let n=pz(e),i=new op(py);return n.iterate({index:aH,range:IDBKeyRange.only([r.indexId,this.uid,pb(this.encodeDirectionalKey(r,t))])},(e,n)=>{i=i.add(new pg(r.indexId,t,pS(n.arrayValue),pS(n.directionalValue)))}).next(()=>i)}computeIndexEntries(e,t){let r=new op(py),n=this.encodeDirectionalElements(t,e);if(null==n)return r;let i=sb(t);if(null!=i){let s=e.data.field(i.fieldPath);if(ly(s))for(let i of s.arrayValue.values||[])r=r.add(new pg(t.indexId,e.key,this.encodeSingleElement(i),n))}else r=r.add(new pg(t.indexId,e.key,pj,n));return r}updateEntries(e,t,r,n,i){iR(pB,"Updating index entries for document '%s'",t.key);let s=[];return om(n,i,py,n=>{s.push(this.addIndexEntry(e,t,r,n))},n=>{s.push(this.deleteIndexEntry(e,t,r,n))}),sP.waitFor(s)}getNextSequenceNumber(e){let t=1;return p$(e).iterate({index:a$,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>py(e,t)).filter((e,t,r)=>!t||0!==py(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=py(i,e),s=py(i,t);if(0===r)n[0]=e.successor();else if(r>0&&s<0)n.push(i),n.push(i.successor());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.isRangeMatchable(n[e],n[e+1]))return[];let t=n[e].dbIndexEntryKey(this.uid,pj,st.empty()),r=n[e+1].dbIndexEntryKey(this.uid,pj,st.empty());i.push(IDBKeyRange.bound(t,r))}return i}isRangeMatchable(e,t){return py(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(pG)}getMinOffset(e,t){return sP.mapArray(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>e||iP(44426))).next(pG)}}function pV(e){return oi(e,aR)}function pz(e){return oi(e,aK)}function pq(e){return oi(e,aB)}function p$(e){return oi(e,az)}function pG(e){iL(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>sR(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new sN(t.readTime,t.documentKey,r)}function pK(e,t,r){let n=e.store(an),i=e.store(ad),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.iterate({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{iL(1===o,47070,{batchId:r.batchId})}));let c=[];for(let e of r.mutations){let n=ac(t,e.key.path,r.batchId);s.push(i.delete(n)),c.push(e.key)}return sP.waitFor(s).next(()=>c)}function pW(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else if(e.noDocument)t=e.noDocument;else throw iP(14731);return JSON.stringify(t).length}class pH{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.documentKeysByBatchId={}}static forUser(e,t,r,n){return iL(""!==e.uid,64387),new pH(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return pJ(e).iterate({index:as,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=pX(e),s=pJ(e);return s.add({}).next(a=>{iL("number"==typeof a,49019);let o=new uB(a,t,r,n),l=hE(this.serializer,this.userId,o),c=[],u=new op((e,t)=>i0(e.canonicalString(),t.canonicalString()));for(let e of n){let t=ac(this.userId,e.key.path,a);u=u.add(e.key.path.popLast()),c.push(s.put(l)),c.push(i.put(t,au))}return u.forEach(t=>{c.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=o.keys()}),sP.waitFor(c).next(()=>o)})}lookupMutationBatch(e,t){return pJ(e).get(t).next(e=>e?(iL(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),hw(this.serializer,e)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?sP.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(e=>{if(!e)return null;{let r=e.keys();return this.documentKeysByBatchId[t]=r,r}})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return pJ(e).iterate({index:as,range:n},(e,t,n)=>{t.userId===this.userId&&(iL(t.batchId>=r,47524,{nextBatchId:r}),i=hw(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=oj;return pJ(e).iterate({index:as,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,oj],[this.userId,Number.POSITIVE_INFINITY]);return pJ(e).loadAll(as,t).next(e=>e.map(e=>hw(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=al(this.userId,t.path),n=IDBKeyRange.lowerBound(r),i=[];return pX(e).iterate({range:n},(r,n,s)=>{let[a,o,l]=r,c=s8(o);return a===this.userId&&t.path.isEqual(c)?pJ(e).get(l).next(e=>{if(!e)throw iP(61480,{indexKey:r,batchId:l});iL(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(hw(this.serializer,e))}):void s.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new op(i0),n=[];return t.forEach(t=>{let i=al(this.userId,t.path),s=IDBKeyRange.lowerBound(i),a=pX(e).iterate({range:s},(e,n,i)=>{let[s,a,o]=e,l=s8(a);if(s!==this.userId||!t.path.isEqual(l))return void i.done();r=r.add(o)});n.push(a)}),sP.waitFor(n).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=al(this.userId,r),s=IDBKeyRange.lowerBound(i),a=new op(i0);return pX(e).iterate({range:s},(e,t,i)=>{let[s,o,l]=e,c=s8(o);if(s!==this.userId||!r.isPrefixOf(c))return void i.done();c.length===n&&(a=a.add(l))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],n=[];return t.forEach(t=>{n.push(pJ(e).get(t).next(e=>{if(null===e)throw iP(35274,{batchId:t});iL(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(hw(this.serializer,e))}))}),sP.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return pK(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),sP.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return sP.resolve();let r=IDBKeyRange.lowerBound(ao(this.userId)),n=[];return pX(e).iterate({range:r},(e,t,r)=>{if(e[0]!==this.userId)return void r.done();{let t=s8(e[1]);n.push(t)}}).next(()=>{iL(0===n.length,56720,{danglingKeys:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return pQ(e,this.userId,t)}getMutationQueueMetadata(e){return pZ(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:oj,lastStreamToken:""})}}function pQ(e,t,r){let n=al(t,r.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return pX(e).iterate({range:s,keysOnly:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function pY(e,t){let r=!1;return pZ(e).iterateSerial(n=>pQ(e,n,t).next(e=>(e&&(r=!0),sP.resolve(!e)))).next(()=>r)}function pJ(e){return oi(e,an)}function pX(e){return oi(e,ad)}function pZ(e){return oi(e,at)}let p0=2;class p1{constructor(e){this.lastId=e}next(){return this.lastId+=p0,this.lastId}static forTargetCache(){return new p1(2-p0)}static forSyncEngine(){return new p1(1-p0)}}class p2{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new p1(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(e=>sm.fromTimestamp(new sf(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.saveMetadata(e,n)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>p3(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(t=>(iL(t.targetCount>0,8065),t.targetCount-=1,this.saveMetadata(e,t)))}removeTargets(e,t,r){let n=0,i=[];return p3(e).iterate((s,a)=>{let o=hC(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>sP.waitFor(i)).next(()=>n)}forEachTarget(e,t){return p3(e).iterate((e,r)=>{t(hC(r))})}retrieveMetadata(e){return p6(e).get(ak).next(e=>(iL(null!==e,2888),e))}saveMetadata(e,t){return p6(e).put(ak,t)}saveTargetData(e,t){return p3(e).put(h_(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(e=>e.targetCount)}getTargetData(e,t){let r=cn(t),n=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),i=null;return p3(e).iterate({range:n,index:aE},(e,r,n)=>{let s=hC(r);cs(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=p4(e);return t.forEach(t=>{let s=s6(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),sP.waitFor(n)}removeMatchingKeys(e,t,r){let n=p4(e);return sP.forEach(t,t=>{let i=s6(t.path);return sP.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=p4(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=p4(e),i=c3();return n.iterate({range:r,keysOnly:!0},(e,t,r)=>{let n=new st(s8(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=s6(t.path),n=IDBKeyRange.bound([r],[i4(r)],!1,!0),i=0;return p4(e).iterate({index:aI,keysOnly:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}getTargetDataForTarget(e,t){return p3(e).get(t).next(e=>e?hC(e):null)}}function p3(e){return oi(e,aS)}function p6(e){return oi(e,aN)}function p4(e){return oi(e,aC)}let p5={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},p8=-1,p7=0x2800000;class p9{static withCacheSize(e){return new p9(e,p9.DEFAULT_COLLECTION_PERCENTILE,p9.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}p9.DEFAULT_COLLECTION_PERCENTILE=10,p9.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,p9.DEFAULT=new p9(p7,p9.DEFAULT_COLLECTION_PERCENTILE,p9.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),p9.DISABLED=new p9(p8,0,0);let fe="LruGarbageCollector",ft=1048576,fr=6e4,fn=3e5;function fi([e,t],[r,n]){let i=i0(e,r);return 0===i?i0(t,n):i}class fs{constructor(e){this.maxElements=e,this.buffer=new op(fi),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>fi(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class fa{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==p8&&this.scheduleGC(fr)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(e){iR(fe,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){sz(e)?iR(fe,"Ignoring IndexedDB error during garbage collection: ",e):await sO(e)}await this.scheduleGC(fn)})}}class fo{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return sP.resolve(sZ.INVALID);let r=new fs(t);return this.delegate.forEachTarget(e,e=>r.addElement(e.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,e=>r.addElement(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===p8?(iR("LruGarbageCollector","Garbage collection skipped; disabled"),sP.resolve(p5)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(iR("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),p5):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,n,i,a,o,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(iR("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,a=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,o=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(c=Date.now(),iN()<=s.DEBUG&&iR("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-u}ms
	Determined least recently used ${n} in ${o-a}ms
	Removed ${i} targets in ${l-o}ms
	Removed ${e} documents in ${c-l}ms
Total Duration: ${c-u}ms`),sP.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}function fl(e,t){return new fo(e,t)}class fc{constructor(e,t){this.db=e,this.garbageCollector=fl(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(e,r)=>t(r))}addReference(e,t,r){return fh(e,r)}removeReference(e,t,r){return fh(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return fh(e,t)}isPinned(e,t){return pY(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.forEachOrphanedDocument(e,(s,a)=>{if(a<=t){let t=this.isPinned(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,sm.min()),p4(e).delete(fu(s))))});n.push(t)}}).next(()=>sP.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return fh(e,t)}forEachOrphanedDocument(e,t){let r,n=p4(e),i=sZ.INVALID;return n.iterate({index:aI},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==sZ.INVALID&&t(new st(s8(r)),i),i=a,r=s):i=sZ.INVALID}).next(()=>{i!==sZ.INVALID&&t(new st(s8(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function fu(e){return[0,s6(e.path)]}function fd(e,t){return{targetId:0,path:s6(e.path),sequenceNumber:t}}function fh(e,t){return p4(e).put(fd(t,e.currentSequenceNumber))}class fp{constructor(){this.changes=new c$(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,lA.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?sP.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ff{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return fv(e).put(r)}removeEntry(e,t,r){return fv(e).delete(fS(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=lA.newInvalidDocument(t);return fv(e).iterate({index:af,range:IDBKeyRange.only(fb(t))},(e,n)=>{r=this.maybeDecodeDocument(t,n)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:lA.newInvalidDocument(t)};return fv(e).iterate({index:af,range:IDBKeyRange.only(fb(t))},(e,n)=>{r={document:this.maybeDecodeDocument(t,n),size:pW(n)}}).next(()=>r)}getEntries(e,t){let r=cK();return this.forEachDbEntry(e,t,(e,t)=>{let n=this.maybeDecodeDocument(e,t);r=r.insert(e,n)}).next(()=>r)}getSizedEntries(e,t){let r=cK(),n=new oc(st.comparator);return this.forEachDbEntry(e,t,(e,t)=>{let i=this.maybeDecodeDocument(e,t);r=r.insert(e,i),n=n.insert(e,pW(t))}).next(()=>({documents:r,sizeMap:n}))}forEachDbEntry(e,t,r){if(t.isEmpty())return sP.resolve();let n=new op(fE);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(fb(n.first()),fb(n.last())),s=n.getIterator(),a=s.getNext();return fv(e).iterate({index:af,range:i},(e,t,n)=>{let i=st.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>fE(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.skip(fb(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),hv(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return fv(e).loadAll(IDBKeyRange.bound(a,o,!0)).next(e=>{null==i||i.incrementDocumentReadCount(e.length);let r=cK();for(let i of e){let e=this.maybeDecodeDocument(st.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(cL(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=cK(),s=fT(t,r),a=fT(t,sN.max());return fv(e).iterate({index:ag,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.maybeDecodeDocument(st.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new fg(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return fy(e).get(ab).next(e=>(iL(!!e,20021),e))}setMetadata(e,t){return fy(e).put(ab,t)}maybeDecodeDocument(e,t){if(t){let e=hg(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(sm.min())))return e}return lA.newInvalidDocument(e)}}function fm(e){return new ff(e)}class fg extends fp{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new c$(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new op((e,t)=>i0(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.documentStates.get(i);if(t.push(this.documentCache.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=hy(this.documentCache.serializer,s);n=n.add(i.path.popLast());let l=pW(o);r+=l-a.size,t.push(this.documentCache.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=hy(this.documentCache.serializer,s.convertToNoDocument(sm.min()));t.push(this.documentCache.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.documentCache.updateMetadata(e,r)),sP.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(e=>(this.documentStates.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:e,sizeMap:t})=>(t.forEach((t,r)=>{this.documentStates.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function fy(e){return oi(e,av)}function fv(e){return oi(e,ah)}function fb(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function fS(e,t){let r=e.path.toArray();return[r.slice(0,r.length-2),r[r.length-2],hv(t),r[r.length-1]]}function fT(e,t){let r=t.documentKey.path.toArray();return[e,hv(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function fE(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=i0(r[e],n[e]))return i;return(i=i0(r.length,n.length))||(i=i0(r[r.length-2],n[n.length-2]))?i:i0(r[r.length-1],n[n.length-1])}let fw=18;class fC{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class f_{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&uE(r.mutation,e,oy.empty(),sf.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,c3()).next(()=>t))}getLocalViewOfDocuments(e,t,r=c3()){let n=cJ();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=cH();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=cJ();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,c3()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=cK(),s=cZ(),a=cQ();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof uk)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),uE(a.mutation,t,a.mutation.getFieldMask(),sf.now())):s.set(t.key,oy.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var r;return a.set(e,new fC(t,null!=(r=s.get(e))?r:null))}),a))}recalculateAndSaveOverlays(e,t){let r=cZ(),n=new oc((e,t)=>e-t),i=c3();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||oy.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||c3()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,c=cX();l.forEach(e=>{if(!i.has(e)){let n=uS(t.get(e),r.get(e));null!==n&&c.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,c))}return sP.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return cE(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):cw(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):sP.resolve(cJ()),a=sg,o=i;return s.next(t=>sP.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t))?sP.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)})).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,c3())).next(e=>({batchId:a,changes:cY(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new st(t)).next(e=>{let t=cH();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=cH();return this.indexManager.getCollectionParents(e,i).next(a=>sP.forEach(a,a=>{let o=cb(t,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,lA.newInvalidDocument(n)))});let r=cH();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&uE(s.mutation,n,oy.empty(),sf.now()),cL(t,n)&&(r=r.insert(e,n))}),r})}}class fI{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return sP.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,hO(t)),sP.resolve()}getNamedQuery(e,t){return sP.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,hD(t)),sP.resolve()}}class fx{constructor(){this.overlays=new oc(st.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return sP.resolve(this.overlays.get(t))}getOverlays(e,t){let r=cJ();return sP.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.saveOverlay(e,t,n)}),sP.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.overlayByBatchId.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.overlayByBatchId.delete(r)),sP.resolve()}getOverlaysForCollection(e,t,r){let n=cJ(),i=t.length+1,s=new st(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return sP.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new oc((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=cJ(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=cJ(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return sP.resolve(a)}saveOverlay(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.overlayByBatchId.get(n.largestBatchId).delete(r.key);this.overlayByBatchId.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new uU(t,r));let i=this.overlayByBatchId.get(t);void 0===i&&(i=c3(),this.overlayByBatchId.set(t,i)),this.overlayByBatchId.set(t,i.add(r.key))}}class fk{constructor(){this.sessionToken=oS.EMPTY_BYTE_STRING}getSessionToken(e){return sP.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,sP.resolve()}}class fN{constructor(){this.refsByKey=new op(fR.compareByKey),this.refsByTarget=new op(fR.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new fR(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.removeRef(new fR(e,t))}removeReferences(e,t){e.forEach(e=>this.removeReference(e,t))}removeReferencesForId(e){let t=new st(new i7([])),r=new fR(t,e),n=new fR(t,e+1),i=[];return this.refsByTarget.forEachInRange([r,n],e=>{this.removeRef(e),i.push(e.key)}),i}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new st(new i7([])),r=new fR(t,e),n=new fR(t,e+1),i=c3();return this.refsByTarget.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new fR(e,0),r=this.refsByKey.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class fR{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return st.comparator(e.key,t.key)||i0(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return i0(e.targetOrBatchId,t.targetOrBatchId)||st.comparator(e.key,t.key)}}class fA{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new op(fR.compareByKey)}checkEmpty(e){return sP.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new uB(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new fR(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return sP.resolve(s)}lookupMutationBatch(e,t){return sP.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=this.indexOfBatchId(r),i=n<0?0:n;return sP.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return sP.resolve(0===this.mutationQueue.length?oj:this.nextBatchId-1)}getAllMutationBatches(e){return sP.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new fR(t,0),n=new fR(t,Number.POSITIVE_INFINITY),i=[];return this.batchesByDocumentKey.forEachInRange([r,n],e=>{let t=this.findMutationBatch(e.targetOrBatchId);i.push(t)}),sP.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new op(i0);return t.forEach(e=>{let t=new fR(e,0),n=new fR(e,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([t,n],e=>{r=r.add(e.targetOrBatchId)})}),sP.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;st.isDocumentKey(i)||(i=i.child(""));let s=new fR(new st(i),0),a=new op(i0);return this.batchesByDocumentKey.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.targetOrBatchId)),!0)},s),sP.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(e=>{let r=this.findMutationBatch(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){iL(0===this.indexOfExistingBatchId(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.batchesByDocumentKey;return sP.forEach(t.mutations,n=>{let i=new fR(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.batchesByDocumentKey=r})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new fR(t,0),n=this.batchesByDocumentKey.firstAfterOrEqual(r);return sP.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,sP.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}let fD="-9223372036854775808";function fO(){return new oc(st.comparator)}class fP{constructor(e){this.sizer=e,this.docs=fO(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return sP.resolve(r?r.document.mutableCopy():lA.newInvalidDocument(t))}getEntries(e,t){let r=cK();return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():lA.newInvalidDocument(e))}),sP.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=cK(),s=t.path,a=new st(s.child("__id"+fD+"__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;!(e.path.length>s.length+1||0>=sR(sk(a),r))&&(n.has(a.key)||cL(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return sP.resolve(i)}getAllFromCollectionGroup(e,t,r,n){iP(9500)}forEachDocumentKey(e,t){return sP.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new fL(this)}getSize(e){return sP.resolve(this.size)}}function fM(e){return new fP(e)}class fL extends fp{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.documentCache.addEntry(e,n)):this.documentCache.removeEntry(r)}),sP.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}}class fF{constructor(e){this.persistence=e,this.targets=new c$(e=>cn(e),cs),this.lastRemoteSnapshotVersion=sm.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new fN,this.targetCount=0,this.targetIdGenerator=p1.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((e,r)=>t(r)),sP.resolve()}getLastRemoteSnapshotVersion(e){return sP.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return sP.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),sP.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),sP.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new p1(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,sP.resolve()}updateTargetData(e,t){return this.saveTargetData(t),sP.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,sP.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.targets.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.targets.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),sP.waitFor(i).next(()=>n)}getTargetCount(e){return sP.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return sP.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),sP.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),sP.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),sP.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return sP.resolve(r)}containsKey(e,t){return sP.resolve(this.references.containsKey(t))}}let fB="MemoryPersistence";class fj{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new sZ(0),this._started=!1,this._started=!0,this.globalsCache=new fk,this.referenceDelegate=e(this),this.targetCache=new fF(this);let r=e=>this.referenceDelegate.documentSize(e);this.indexManager=new pL,this.remoteDocumentCache=fM(r),this.serializer=new hm(t),this.bundleCache=new fI(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new fx,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new fA(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){iR(fB,"Starting transaction:",e);let n=new fU(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(n).next(e=>this.referenceDelegate.onTransactionCommitted(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}mutationQueuesContainKey(e,t){return sP.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}}class fU extends sD{constructor(e){super(),this.currentSequenceNumber=e}}class fV{constructor(e){this.persistence=e,this.localViewReferences=new fN,this._orphanedDocuments=null}static factory(e){return new fV(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw iP(60996)}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),sP.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),sP.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),sP.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(e=>this.orphanedDocuments.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.orphanedDocuments.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return sP.forEach(this.orphanedDocuments,r=>{let n=st.fromPath(r);return this.isReferenced(e,n).next(e=>{e||t.removeEntry(n,sm.min())})}).next(()=>(this._orphanedDocuments=null,t.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(e=>{e?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return sP.or([()=>sP.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}}class fz{constructor(e,t){this.persistence=e,this.orphanedSequenceNumbers=new c$(e=>s6(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=fl(this,t)}static factory(e,t){return new fz(e,t)}onTransactionStarted(){}onTransactionCommitted(e){return sP.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachOrphanedDocumentSequenceNumber(e,t){return sP.forEach(this.orphanedSequenceNumbers,(r,n)=>this.isPinned(e,r,n).next(e=>e?sP.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.forEachDocumentKey(e,n=>this.isPinned(e,n,t).next(e=>{e||(r++,i.removeEntry(n,sm.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),sP.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),sP.resolve()}removeReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),sP.resolve()}updateLimboDocument(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),sP.resolve()}documentSize(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=lu(e.data.value)),t}isPinned(e,t,r){return sP.or([()=>this.persistence.mutationQueuesContainKey(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.orphanedSequenceNumbers.get(t);return sP.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class fq{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,n){let i=new sF("createOrUpgrade",t);r<1&&n>=1&&(fG(e),fK(e),fJ(e),fH(e));let s=sP.resolve();return r<3&&n>=3&&(0!==r&&(fX(e),fJ(e)),s=s.next(()=>f0(i))),r<4&&n>=4&&(0!==r&&(s=s.next(()=>fW(e,i))),s=s.next(()=>{f1(e)})),r<5&&n>=5&&(s=s.next(()=>this.removeAcknowledgedMutations(i))),r<6&&n>=6&&(s=s.next(()=>(fY(e),this.addDocumentGlobal(i)))),r<7&&n>=7&&(s=s.next(()=>this.ensureSequenceNumbers(i))),r<8&&n>=8&&(s=s.next(()=>this.createCollectionParentIndex(e,i))),r<9&&n>=9&&(s=s.next(()=>{fZ(e)})),r<10&&n>=10&&(s=s.next(()=>this.rewriteCanonicalIds(i))),r<11&&n>=11&&(s=s.next(()=>{f2(e),f3(e)})),r<12&&n>=12&&(s=s.next(()=>{f4(e)})),r<13&&n>=13&&(s=s.next(()=>fQ(e)).next(()=>this.rewriteRemoteDocumentCache(e,i)).next(()=>e.deleteObjectStore(s7))),r<14&&n>=14&&(s=s.next(()=>this.runOverlayMigration(e,i))),r<15&&n>=15&&(s=s.next(()=>f6(e))),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(az).clear()}).next(()=>{t.objectStore(aK).clear()})),r<17&&n>=17&&(s=s.next(()=>{f5(e)})),r<18&&n>=18&&el()&&(s=s.next(()=>{t.objectStore(az).clear()}).next(()=>{t.objectStore(aK).clear()})),s}addDocumentGlobal(e){let t=0;return e.store(s7).iterate((e,r)=>{t+=pW(r)}).next(()=>{let r={byteSize:t};return e.store(av).put(ab,r)})}removeAcknowledgedMutations(e){let t=e.store(at),r=e.store(an);return t.loadAll().next(t=>sP.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,oj],[t.userId,t.lastAcknowledgedBatchId]);return r.loadAll(as,n).next(r=>sP.forEach(r,r=>{iL(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=hw(this.serializer,r);return pK(e,t.userId,n).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(aC),r=e.store(s7);return e.store(aN).get(ak).next(e=>{let n=r=>t.put({targetId:0,path:s6(r),sequenceNumber:e.highestListenSequenceNumber}),i=[];return r.iterate((e,r)=>{let s=new i7(e),a=f$(s);i.push(t.get(a).next(e=>e?sP.resolve():n(s)))}).next(()=>sP.waitFor(i))})}createCollectionParentIndex(e,t){e.createObjectStore(aR,{keyPath:aA});let r=t.store(aR),n=new pF,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:s6(n)})}};return t.store(s7).iterate({keysOnly:!0},(e,t)=>i(new i7(e).popLast())).next(()=>t.store(ad).iterate({keysOnly:!0},([e,t,r],n)=>i(s8(t).popLast())))}rewriteCanonicalIds(e){let t=e.store(aS);return t.iterate((e,r)=>{let n=hC(r),i=h_(this.serializer,n);return t.put(i)})}rewriteRemoteDocumentCache(e,t){let r=t.store(s7),n=[];return r.iterate((e,r)=>{let i=t.store(ah),s=f8(r).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>sP.waitFor(n))}runOverlayMigration(e,t){let r=t.store(an),n=fm(this.serializer),i=new fj(fV.factory,this.serializer.remoteSerializer);return r.loadAll().next(e=>{let r=new Map;return e.forEach(e=>{var t;let n=null!=(t=r.get(e.userId))?t:c3();hw(this.serializer,e).keys().forEach(e=>n=n.add(e)),r.set(e.userId,n)}),sP.forEach(r,(e,r)=>{let s=new iC(r),a=hq.forUser(this.serializer,s),o=i.getIndexManager(s);return new f_(n,pH.forUser(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new on(t,sZ.INVALID),e).next()})})}}function f$(e){return[0,s6(e)]}function fG(e){e.createObjectStore(s9)}function fK(e){e.createObjectStore(at,{keyPath:ar}),e.createObjectStore(an,{keyPath:ai,autoIncrement:!0}).createIndex(as,aa,{unique:!0}),e.createObjectStore(ad)}function fW(e,t){return t.store(an).loadAll().next(r=>{e.deleteObjectStore(an),e.createObjectStore(an,{keyPath:ai,autoIncrement:!0}).createIndex(as,aa,{unique:!0});let n=t.store(an),i=r.map(e=>n.put(e));return sP.waitFor(i)})}function fH(e){e.createObjectStore(s7)}function fQ(e){let t=e.createObjectStore(ah,{keyPath:ap});t.createIndex(af,am),t.createIndex(ag,ay)}function fY(e){e.createObjectStore(av)}function fJ(e){e.createObjectStore(aC,{keyPath:a_}).createIndex(aI,ax,{unique:!0}),e.createObjectStore(aS,{keyPath:aT}).createIndex(aE,aw,{unique:!0}),e.createObjectStore(aN)}function fX(e){e.deleteObjectStore(aC),e.deleteObjectStore(aS),e.deleteObjectStore(aN)}function fZ(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}function f0(e){let t=e.store(aN),r={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:sm.min().toTimestamp(),targetCount:0};return t.put(ak,r)}function f1(e){e.createObjectStore(aD,{keyPath:aO})}function f2(e){e.createObjectStore(aP,{keyPath:aM})}function f3(e){e.createObjectStore(aL,{keyPath:aF})}function f6(e){e.createObjectStore(aB,{keyPath:aj,autoIncrement:!0}).createIndex(aU,aV,{unique:!1}),e.createObjectStore(az,{keyPath:aq}).createIndex(a$,aG,{unique:!1}),e.createObjectStore(aK,{keyPath:aW}).createIndex(aH,aQ,{unique:!1})}function f4(e){let t=e.createObjectStore(aY,{keyPath:aJ});t.createIndex(aX,aZ,{unique:!1}),t.createIndex(a0,a1,{unique:!1})}function f5(e){e.createObjectStore(a2,{keyPath:a3})}function f8(e){return e.document?new st(i7.fromString(e.document.name).popFirst(5)):e.noDocument?st.fromSegments(e.noDocument.path):e.unknownDocument?st.fromSegments(e.unknownDocument.path):iP(36783)}let f7="IndexedDbPersistence",f9=18e5,me=5e3,mt=4e3,mr="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",mn="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",mi="firestore_zombie",ms="main";class ma{constructor(e,t,r,n,i,s,a,o,l,c,u=fw){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=i,this.window=s,this.document=a,this.sequenceNumberSyncer=l,this.forceOwningTab=c,this.schemaVersion=u,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=e=>Promise.resolve(),!ma.isAvailable())throw new ij(iB.UNIMPLEMENTED,mn);this.referenceDelegate=new fc(this,n),this.dbName=t+ms,this.serializer=new hm(o),this.simpleDb=new sB(this.dbName,this.schemaVersion,new fq(this.serializer)),this.globalsCache=new hG,this.targetCache=new p2(this.referenceDelegate,this.serializer),this.remoteDocumentCache=fm(this.serializer),this.bundleCache=new hU,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===c&&iA(f7,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ij(iB.FAILED_PRECONDITION,mr);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new sZ(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setDatabaseDeletedListener(e)}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ml(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(e=>{e||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(t=>this.isPrimary&&!t?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):!!t&&this.acquireOrExtendPrimaryLease(e).next(()=>!0))).catch(e=>{if(sz(e))return iR(f7,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return iR(f7,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return mo(e).get(ae).next(e=>sP.resolve(this.isLocalClient(e)))}removeClientMetadata(e){return ml(e).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,f9)){this.lastGarbageCollectionTime=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=oi(e,aD);return t.loadAll().next(e=>{let r=this.filterActiveClients(e,f9),n=e.filter(e=>-1===r.indexOf(e));return sP.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",mt,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return!!e&&e.ownerId===this.clientId}canActAsPrimary(e){return this.forceOwningTab?sP.resolve(!0):mo(e).get(ae).next(t=>{if(null!==t&&this.isWithinAge(t.leaseTimestampMs,me)&&!this.isClientZombied(t.ownerId)){if(this.isLocalClient(t)&&this.networkEnabled)return!0;if(!this.isLocalClient(t)){if(!t.allowTabSynchronization)throw new ij(iB.FAILED_PRECONDITION,mr);return!1}}return!!this.networkEnabled&&!!this.inForeground||ml(e).loadAll().next(e=>void 0===this.filterActiveClients(e,me).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&iR(f7,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[s9,aD],e=>{let t=new on(e,sZ.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(e,t){return e.filter(e=>this.isWithinAge(e.updateTimeMs,t)&&!this.isClientZombied(e.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>ml(e).loadAll().next(e=>this.filterActiveClients(e,f9).map(e=>e.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(e,t){return pH.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new pU(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return hq.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){let n;iR(f7,"Starting transaction:",e);let i="readonly"===t?"readonly":"readwrite",s=or(this.schemaVersion);return this.simpleDb.runTransaction(e,i,s,i=>(n=new on(i,this.listenSequence?this.listenSequence.next():sZ.INVALID),"readwrite-primary"===t)?this.verifyPrimaryLease(n).next(e=>!!e||this.canActAsPrimary(n)).next(t=>{if(!t)throw iA(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new ij(iB.FAILED_PRECONDITION,sA);return r(n)}).next(e=>this.acquireOrExtendPrimaryLease(n).next(()=>e)):this.verifyAllowTabSynchronization(n).next(()=>r(n))).then(e=>(n.raiseOnCommittedEvent(),e))}verifyAllowTabSynchronization(e){return mo(e).get(ae).next(e=>{if(null!==e&&this.isWithinAge(e.leaseTimestampMs,me)&&!this.isClientZombied(e.ownerId)&&!this.isLocalClient(e)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!e.allowTabSynchronization))throw new ij(iB.FAILED_PRECONDITION,mr)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return mo(e).put(ae,t)}static isAvailable(){return sB.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=mo(e);return t.get(ae).next(e=>this.isLocalClient(e)?(iR(f7,"Releasing primary lease."),t.delete(ae)):sP.resolve())}isWithinAge(e,t){let r=Date.now(),n=r-t,i=r;return!(e<n)&&(!(e>i)||(iA(`Detected an update time that is in the future: ${e} > ${i}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;"function"==typeof(null==(e=this.window)?void 0:e.addEventListener)&&(this.windowUnloadHandler=()=>{this.markClientZombied();let e=/(?:Version|Mobile)\/1[456]/;eo()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let r=(null==(t=this.webStorage)?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return iR(f7,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(e){return iA(f7,"Failed to get zombied client id.",e),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){iA("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(e){}}zombiedClientLocalStorageKey(e){return`${mi}_${this.persistenceKey}_${e}`}}function mo(e){return oi(e,s9)}function ml(e){return oi(e,aD)}function mc(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}function mu(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=r(e[l],t[o]);s<0?i(e[l++]):s>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<s;)i(e[l++])}function md(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}let mh="LocalStore",mp=3e8;class mf{constructor(e,t,r,n){this.persistence=e,this.queryEngine=t,this.serializer=n,this.targetDataByTarget=new oc(i0),this.targetIdByTarget=new c$(e=>cn(e),cs),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new f_(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}}function mm(e,t,r,n){return new mf(e,t,r,n)}async function mg(e,t){let r=iF(e);return await r.persistence.runTransaction("Handle user change","readonly",e=>{let n;return r.mutationQueue.getAllMutationBatches(e).next(i=>(n=i,r.initializeUserComponents(t),r.mutationQueue.getAllMutationBatches(e))).next(t=>{let i=[],s=[],a=c3();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return r.localDocuments.getDocuments(e,a).next(e=>({affectedDocuments:e,removedBatchIds:i,addedBatchIds:s}))})})}function my(e,t){let r,n,i=iF(e),s=sf.now(),a=t.reduce((e,t)=>e.add(t.key),c3());return i.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=cK(),l=c3();return i.remoteDocuments.getEntries(e,a).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(e,o)).next(n=>{r=n;let a=[];for(let e of t){let t=uw(e,r.get(e.key).overlayedDocument);null!=t&&a.push(new uk(e.key,t,lR(t.value.mapValue),uy.exists(!0)))}return i.mutationQueue.addMutationBatch(e,s,a,t)}).next(t=>{n=t;let s=t.applyToLocalDocumentSet(r,l);return i.documentOverlayCache.saveOverlays(e,t.batchId,s)})}).then(()=>({batchId:n.batchId,changes:cY(r)}))}function mv(e,t){let r=iF(e);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n=t.batch.keys(),i=r.remoteDocuments.newChangeBuffer({trackRemovals:!0});return mO(r,e,t,i).next(()=>i.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,mb(t))).next(()=>r.localDocuments.getDocuments(e,n))})}function mb(e){let t=c3();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}function mS(e,t){let r=iF(e);return r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(iL(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))})}function mT(e){let t=iF(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}function mE(e){let t=iF(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.targetCache.getLastRemoteSnapshotVersion(e))}function mw(e,t){let r=iF(e),n=t.snapshotVersion,i=r.targetDataByTarget;return r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=r.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=r.targetDataByTarget;let a=[];t.targetChanges.forEach((s,o)=>{let l=i.get(o);if(!l)return;a.push(r.targetCache.removeMatchingKeys(e,s.removedDocuments,o).next(()=>r.targetCache.addMatchingKeys(e,s.addedDocuments,o)));let c=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?c=c.withResumeToken(oS.EMPTY_BYTE_STRING,sm.min()).withLastLimboFreeSnapshotVersion(sm.min()):s.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(s.resumeToken,n)),i=i.insert(o,c),m_(l,c,s)&&a.push(r.targetCache.updateTargetData(e,c))});let o=cK(),l=c3();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(mC(e,s,t.documentUpdates).next(e=>{o=e.changedDocuments,l=e.existenceChangedKeys})),!n.isEqual(sm.min())){let t=r.targetCache.getLastRemoteSnapshotVersion(e).next(t=>r.targetCache.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return sP.waitFor(a).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.targetDataByTarget=i,e))}function mC(e,t,r){let n=c3(),i=c3();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=cK();return r.forEach((r,s)=>{let a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(sm.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):iR(mh,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{changedDocuments:n,existenceChangedKeys:i}})}function m_(e,t,r){return!!(0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=mp)||r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size>0}async function mI(e,t){let r=iF(e);try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>sP.forEach(t,t=>sP.forEach(t.addedKeys,n=>r.persistence.referenceDelegate.addReference(e,t.targetId,n)).next(()=>sP.forEach(t.removedKeys,n=>r.persistence.referenceDelegate.removeReference(e,t.targetId,n)))))}catch(e){if(sz(e))iR(mh,"Failed to update sequence numbers: "+e);else throw e}for(let e of t){let t=e.targetId;if(!e.fromCache){let e=r.targetDataByTarget.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.targetDataByTarget=r.targetDataByTarget.insert(t,i)}}}function mx(e,t){let r=iF(e);return r.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=oj),r.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function mk(e,t){let r=iF(e);return r.persistence.runTransaction("read document","readonly",e=>r.localDocuments.getDocument(e,t))}function mN(e,t){let r=iF(e);return r.persistence.runTransaction("Allocate target","readwrite",e=>{let n;return r.targetCache.getTargetData(e,t).next(i=>i?(n=i,sP.resolve(n)):r.targetCache.allocateTargetId(e).next(i=>(n=new hf(t,i,"TargetPurposeListen",e.currentSequenceNumber),r.targetCache.addTargetData(e,n).next(()=>n))))}).then(e=>{let n=r.targetDataByTarget.get(e.targetId);return(null===n||e.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(r.targetDataByTarget=r.targetDataByTarget.insert(e.targetId,e),r.targetIdByTarget.set(t,e.targetId)),e})}function mR(e,t,r){let n=iF(e),i=n.targetIdByTarget.get(r);return void 0!==i?sP.resolve(n.targetDataByTarget.get(i)):n.targetCache.getTargetData(t,r)}async function mA(e,t,r){let n=iF(e),i=n.targetDataByTarget.get(t),s=r?"readwrite":"readwrite-primary";try{r||await n.persistence.runTransaction("Release target",s,e=>n.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(sz(e))iR(mh,`Failed to update sequence numbers for target ${t}: ${e}`);else throw e}n.targetDataByTarget=n.targetDataByTarget.remove(t),n.targetIdByTarget.delete(i.target)}function mD(e,t,r){let n=iF(e),i=sm.min(),s=c3();return n.persistence.runTransaction("Execute query","readwrite",e=>mR(n,e,c_(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,n.targetCache.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>n.queryEngine.getDocumentsMatchingQuery(e,t,r?i:sm.min(),r?s:c3())).next(e=>(mj(n,cV(t),e),{documents:e,remoteKeys:s})))}function mO(e,t,r,n){let i=r.batch,s=i.keys(),a=sP.resolve();return s.forEach(e=>{a=a.next(()=>n.getEntry(t,e)).next(t=>{let s=r.docVersions.get(e);iL(null!==s,48541),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,r),t.isValidDocument()&&(t.setReadTime(r.commitVersion),n.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))}function mP(e,t){let r=iF(e),n=iF(r.mutationQueue);return r.persistence.runTransaction("Lookup mutation documents","readonly",e=>n.lookupMutationKeys(e,t).next(t=>t?r.localDocuments.getDocuments(e,t):sP.resolve(null)))}function mM(e,t){iF(iF(e,mf).mutationQueue).removeCachedMutationKeys(t)}function mL(e){return iF(iF(e,mf).persistence).getActiveClients()}function mF(e,t){let r=iF(e),n=iF(r.targetCache),i=r.targetDataByTarget.get(t);return i?Promise.resolve(i.target):r.persistence.runTransaction("Get target data","readonly",e=>n.getTargetDataForTarget(e,t).next(e=>e?e.target:null))}function mB(e,t){let r=iF(e),n=r.collectionGroupReadTime.get(t)||sm.min();return r.persistence.runTransaction("Get new document changes","readonly",e=>r.remoteDocuments.getAllFromCollectionGroup(e,t,sx(n,sg),Number.MAX_SAFE_INTEGER)).then(e=>(mj(r,t,e),e))}function mj(e,t,r){let n=e.collectionGroupReadTime.get(t)||sm.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.collectionGroupReadTime.set(t,n)}function mU(e){return c_(cv(i7.fromString(`__bundle__/docs/${e}`)))}async function mV(e,t,r,n){let i=iF(e),s=c3(),a=cK();for(let e of r){let r=t.toDocumentKey(e.metadata.name);e.document&&(s=s.add(r));let n=t.toMutableDocument(e);n.setReadTime(t.toSnapshotVersion(e.metadata.readTime)),a=a.insert(r,n)}let o=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=await mN(i,mU(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",e=>mC(e,o,a).next(t=>(o.apply(e),t)).next(t=>i.targetCache.removeMatchingKeysForTargetId(e,l.targetId).next(()=>i.targetCache.addMatchingKeys(e,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(e,t.changedDocuments,t.existenceChangedKeys)).next(()=>t.changedDocuments)))}function mz(e,t){let r=iF(e),n=dp(t.createTime);return r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.bundleCache.getBundleMetadata(e,t.id)).then(e=>!!e&&e.createTime.compareTo(n)>=0)}function mq(e,t){let r=iF(e);return r.persistence.runTransaction("Save bundle","readwrite",e=>r.bundleCache.saveBundleMetadata(e,t))}function m$(e,t){let r=iF(e);return r.persistence.runTransaction("Get named query","readonly",e=>r.bundleCache.getNamedQuery(e,t))}async function mG(e,t,r=c3()){let n=await mN(e,c_(hA(t.bundledQuery))),i=iF(e);return i.persistence.runTransaction("Save named query","readwrite",e=>{let s=dp(t.readTime);if(n.snapshotVersion.compareTo(s)>=0)return i.bundleCache.saveNamedQuery(e,t);let a=n.withResumeToken(oS.EMPTY_BYTE_STRING,s);return i.targetDataByTarget=i.targetDataByTarget.insert(a.targetId,a),i.targetCache.updateTargetData(e,a).next(()=>i.targetCache.removeMatchingKeysForTargetId(e,n.targetId)).next(()=>i.targetCache.addMatchingKeys(e,r,n.targetId)).next(()=>i.bundleCache.saveNamedQuery(e,t))})}async function mK(e,t){let r=iF(e),n=r.indexManager,i=[];return r.persistence.runTransaction("Configure indexes","readwrite",e=>n.getFieldIndexes(e).next(r=>mu(r,t,sE,t=>{i.push(n.addFieldIndex(e,t))},t=>{i.push(n.deleteFieldIndex(e,t))})).next(()=>sP.waitFor(i)))}function mW(e,t){iF(e).queryEngine.indexAutoCreationEnabled=t}function mH(e){let t=iF(e),r=t.indexManager;return t.persistence.runTransaction("Delete All Indexes","readwrite",e=>r.deleteAllFieldIndexes(e))}class mQ{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}let mY=100;function mJ(){return eo()?8:sj(et())>0?6:4}class mX{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=mY,this.relativeIndexReadCostPerDocument=mJ()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.performQueryUsingIndex(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.performQueryUsingRemoteKeys(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new mQ;return this.executeFullCollectionScan(e,t,r).next(n=>{if(i.result=n,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,r,n.size)})}).next(()=>i.result)}createCacheIndexes(e,t,r,n){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(iN()<=s.DEBUG&&iR("QueryEngine","SDK will not create cache indexes for query:",cM(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),sP.resolve()):(iN()<=s.DEBUG&&iR("QueryEngine","Query:",cM(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*n)?(iN()<=s.DEBUG&&iR("QueryEngine","The SDK decides to create cache indexes for query:",cM(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,c_(t))):sP.resolve()}performQueryUsingIndex(e,t){if(cS(t))return sP.resolve(null);let r=c_(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=c_(t=cR(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=c3(...n);return this.localDocumentsView.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.applyQuery(t,n);return this.needsRefill(t,s,i,r.readTime)?this.performQueryUsingIndex(e,cR(t,null,"F")):this.appendRemainingResults(e,s,t,r)}))})))}performQueryUsingRemoteKeys(e,t,r,n){return cS(t)||n.isEqual(sm.min())?sP.resolve(null):this.localDocumentsView.getDocuments(e,r).next(i=>{let a=this.applyQuery(t,i);return this.needsRefill(t,a,r,n)?sP.resolve(null):(iN()<=s.DEBUG&&iR("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),cM(t)),this.appendRemainingResults(e,a,t,sx(n,sg)).next(e=>e))})}applyQuery(e,t){let r=new op(cz(e));return t.forEach((t,n)=>{cL(e,n)&&(r=r.add(n))}),r}needsRefill(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}executeFullCollectionScan(e,t,r){return iN()<=s.DEBUG&&iR("QueryEngine","Using full collection scan to execute query:",cM(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,sN.min(),r)}appendRemainingResults(e,t,r,n){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let mZ="firestore_clients";function m0(e,t){return`${mZ}_${e}_${t}`}let m1="firestore_mutations";function m2(e,t,r){let n=`${m1}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let m3="firestore_targets";function m6(e,t){return`${m3}_${e}_${t}`}let m4="firestore_online_state";function m5(e){return`${m4}_${e}`}let m8="firestore_bundle_loaded_v2";function m7(e){return`${m8}_${e}`}let m9="firestore_sequence_number";function ge(e){return`${m9}_${e}`}let gt="SharedClientState";class gr{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static fromWebStorageEntry(e,t,r){let n,i=JSON.parse(r),s="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return(s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(n=new ij(i.error.code,i.error.message)),s)?new gr(e,t,i.state,n):(iA(gt,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class gn{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r,n=JSON.parse(t),i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return(i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new ij(n.error.code,n.error.message)),i)?new gn(e,n.state,r):(iA(gt,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class gi{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=c4();for(let e=0;n&&e<r.activeTargetIds.length;++e)n=oz(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new gi(e,i):(iA(gt,`Failed to parse client data for instance '${e}': ${t}`),null)}}class gs{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new gs(t.clientId,t.onlineState):(iA(gt,`Failed to parse online state: ${e}`),null)}}class ga{constructor(){this.activeTargetIds=c4()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class go{constructor(e,t,r,n,i){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new oc(i0),this.started=!1,this.earlyEvents=[];let s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.localClientStorageKey=m0(this.persistenceKey,this.localClientId),this.sequenceNumberKey=ge(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new ga),this.clientStateKeyRe=RegExp(`^${mZ}_${s}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${m1}_${s}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${m3}_${s}_(\\d+)$`),this.onlineStateKey=m5(this.persistenceKey),this.bundleLoadedKey=m7(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}async start(){for(let e of(await this.syncEngine.getActiveClients())){if(e===this.localClientId)continue;let t=this.getItem(m0(this.persistenceKey,e));if(t){let r=gi.fromWebStorageEntry(e,t);r&&(this.activeClients=this.activeClients.insert(r.clientId,r))}}this.persistClientState();let e=this.storage.getItem(this.onlineStateKey);if(e){let t=this.fromWebStorageOnlineState(e);t&&this.handleOnlineStateEvent(t)}for(let e of this.earlyEvents)this.handleWebStorageEvent(e);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(m6(this.persistenceKey,e));if(t){let n=gn.fromWebStorageEntry(e,t);n&&(r=n.state)}}return t&&this.localClientState.addQueryTarget(e),this.persistClientState(),r}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(m6(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.removeMutationState(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return iR(gt,"READ",e,t),t}setItem(e,t){iR(gt,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){iR(gt,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(iR(gt,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void iA("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueRetryable(async()=>{if(!this.started)return void this.earlyEvents.push(t);if(null!==t.key){if(this.clientStateKeyRe.test(t.key))if(null!=t.newValue){let e=this.fromWebStorageClientState(t.key,t.newValue);if(e)return this.handleClientStateEvent(e.clientId,e)}else{let e=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(e,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(e)return this.handleMutationBatchEvent(e)}}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(e)return this.handleQueryTargetEvent(e)}}else if(t.key===this.onlineStateKey){if(null!==t.newValue){let e=this.fromWebStorageOnlineState(t.newValue);if(e)return this.handleOnlineStateEvent(e)}}else if(t.key===this.sequenceNumberKey){let e=gl(t.newValue);e!==sZ.INVALID&&this.sequenceNumberHandler(e)}else if(t.key===this.bundleLoadedKey){let e=this.fromWebStoreBundleLoadedState(t.newValue);await Promise.all(e.map(e=>this.syncEngine.synchronizeWithChangedDocuments(e)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let n=new gr(this.currentUser,e,t,r),i=m2(this.persistenceKey,this.currentUser,e);this.setItem(i,n.toWebStorageJSON())}removeMutationState(e){let t=m2(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let n=m6(this.persistenceKey,e),i=new gn(e,t,r);this.setItem(n,i.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return gi.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return gr.fromWebStorageEntry(new iC(i),n,t)}fromWebStorageQueryTargetMetadata(e,t){let r=Number(this.queryTargetKeyRe.exec(e)[1]);return gn.fromWebStorageEntry(r,t)}fromWebStorageOnlineState(e){return gs.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}async handleMutationBatchEvent(e){return e.user.uid!==this.currentUser.uid?void iR(gt,`Ignoring mutation for non-active user ${e.user.uid}`):this.syncEngine.applyBatchState(e.batchId,e.state,e.error)}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),n=this.extractActiveQueryTargets(this.activeClients),i=this.extractActiveQueryTargets(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.applyActiveTargetsChange(s,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=c4();return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}function gl(e){let t=sZ.INVALID;if(null!=e)try{let r=JSON.parse(e);iL("number"==typeof r,30636,{seqString:e}),t=r}catch(e){iA(gt,"Failed to read sequence number from WebStorage",e)}return t}class gc{constructor(){this.localState=new ga,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new ga,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class gu{addCallback(e){}shutdown(){}}class gd{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}}let gh=null;function gp(){return 0x10000000+Math.round(0x80000000*Math.random())}function gf(){return null===gh?gh=gp():gh++,"0x"+gh.toString(16)}function gm(e){return new Promise((t,r)=>{e((e,n)=>{e?r(e):t(n)})})}let gg="1.9.15",gy="GrpcConnection",gv=`gl-node/${process.versions.node} fire/${i_} grpc/${gg}`;function gb(e,t,r,n){iL(null===t||"OAuth"===t.type,36936);let i=new iS.OS;return t&&t.headers.forEach((e,t)=>i.set(t,e)),r&&r.headers.forEach((e,t)=>i.set(t,e)),n&&i.set("X-Firebase-GMPID",n),i.set("X-Goog-Api-Client",gv),i.set("Google-Cloud-Resource-Prefix",e),i.set("x-goog-request-params",e),i}class gS{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){iR(gy,"Creating Firestore stub.");let e=this.databaseInfo.ssl?iS.z3.createSsl():iS.z3.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,n,i){let s=gf(),a=this.ensureActiveStub(),o=gb(this.databasePath,n,i,this.databaseInfo.appId),l=Object.assign({database:this.databasePath},r);return gm(t=>(iR(gy,`RPC '${e}' ${s} invoked with request:`,r),a[e](l,o,(r,n)=>{r?(iR(gy,`RPC '${e}' ${s} failed with error:`,r),t(new ij(u$(r.code),r.message))):(iR(gy,`RPC '${e}' ${s} completed with response:`,n),t(void 0,n))})))}invokeStreamingRPC(e,t,r,n,i,s){let a=gf(),o=[],l=new iU;iR(gy,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let c=this.ensureActiveStub(),u=gb(this.databasePath,n,i,this.databaseInfo.appId),d=Object.assign(Object.assign({},r),{database:this.databasePath}),h=c[e](d,u),p=!1;return h.on("data",t=>{iR(gy,`RPC ${e} ${a} received result:`,t),o.push(t),void 0!==s&&o.length===s&&(p=!0,l.resolve(o))}),h.on("end",()=>{iR(gy,`RPC '${e}' ${a} completed.`),p||(p=!0,l.resolve(o))}),h.on("error",t=>{iR(gy,`RPC '${e}' ${a} failed with error:`,t);let r=u$(t.code);l.reject(new ij(r,t.message))}),l.promise}openStream(e,t,r){let n=gf(),i=this.ensureActiveStub(),s=gb(this.databasePath,t,r,this.databaseInfo.appId),a=i[e](s),o=!1,l=e=>{o||(o=!0,c.callOnClose(e),a.end())},c=new gd({sendFn:t=>{if(o)iR(gy,`RPC '${e}' stream ${n} not sending because gRPC stream is closed:`,t);else{iR(gy,`RPC '${e}' stream ${n} sending:`,t);try{a.write(t)}catch(e){throw iA("Failure sending:",t),iA("Error:",e),e}}},closeFn:()=>{iR(gy,`RPC '${e}' stream ${n} closed locally via close().`),l()}}),u=!1;return a.on("data",t=>{o||(iR(gy,`RPC '${e}' stream ${n} received:`,t),u||(c.callOnConnected(),u=!0),c.callOnMessage(t))}),a.on("end",()=>{iR(gy,`RPC '${e}' stream ${n} ended.`),l()}),a.on("error",t=>{o||(iD(gy,`RPC '${e}' stream ${n} error. Code:`,t.code,"Message:",t.message),l(new ij(u$(t.code),t.message)))}),iR(gy,`Opening RPC '${e}' stream ${n} to ${this.databaseInfo.host}`),setTimeout(()=>{c.callOnOpen()},0),c}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}}let gT={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,0x1fffffff]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:0x44f2530,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var gE={nested:gT},gw=Object.freeze({__proto__:null,nested:gT,default:gE});let gC={longs:String,enums:String,defaults:!0,oneofs:!1};function g_(){let e=iT.rS(gw,gC);return iS.ex(e)}function gI(e){return new gS(g_(),e)}function gx(){return new gu}function gk(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function gN(){return null}function gR(e){return new dn(e,!1)}let gA="ExponentialBackoff",gD=1e3,gO=1.5,gP=6e4;class gM{constructor(e,t,r=gD,n=gO,i=gP){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=n,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),n=Math.max(0,t-r);n>0&&iR(gA,`Backing off for ${n} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,n,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}let gL="PersistentStream",gF=6e4,gB=1e4;class gj{constructor(e,t,r,n,i,s,a,o){this.queue=e,this.idleTimerId=r,this.healthTimerId=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new gM(e,t)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){if(this.responseCount=0,4===this.state)return void this.performBackoff();this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,gF,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(e,t){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==e?this.backoff.reset():t&&t.code===iB.RESOURCE_EXHAUSTED?(iA(t.toString()),iA("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===iB.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,await this.listener.onClose(t)}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.closeCount===t&&this.startStream(e,r)},t=>{e(()=>{let e=new ij(iB.UNKNOWN,"Fetching auth token failed: "+t.message);return this.handleStreamClose(e)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,gB,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(e=>{r(()=>this.handleStreamClose(e))}),this.stream.onMessage(e=>{r(()=>1==++this.responseCount?this.onFirst(e):this.onNext(e))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(e){return iR(gL,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(iR(gL,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class gU extends gj{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=dR(this.serializer,e),r=dD(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=dT(this.serializer),t.addTarget=dQ(this.serializer,e);let r=dW(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=dT(this.serializer),t.removeTarget=e,this.sendRequest(t)}}class gV extends gj{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return iL(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,iL(!e.writeResults||0===e.writeResults.length,55816),this.listener.onHandshakeComplete()}onNext(e){iL(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=dB(e.writeResults,e.commitTime),r=dp(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=dT(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>dO(this.serializer,e))};this.sendRequest(t)}}class gz{}class gq extends gz{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new ij(iB.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,n){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.invokeRPC(e,dm(t,r),n,i,s)).catch(e=>{if("FirebaseError"===e.name)throw e.code===iB.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new ij(iB.UNKNOWN,e.toString())})}invokeStreamingRPC(e,t,r,n,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.invokeStreamingRPC(e,dm(t,r),n,s,a,i)).catch(e=>{if("FirebaseError"===e.name)throw e.code===iB.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new ij(iB.UNKNOWN,e.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}}function g$(e,t,r,n){return new gq(e,t,r,n)}async function gG(e,t){let r=iF(e),n={writes:t.map(e=>dO(r.serializer,e))};await r.invokeRPC("Commit",r.serializer.databaseId,i7.emptyPath(),n)}async function gK(e,t){let r=iF(e),n={documents:t.map(e=>dy(r.serializer,e))},i=await r.invokeStreamingRPC("BatchGetDocuments",r.serializer.databaseId,i7.emptyPath(),n,t.length),s=new Map;i.forEach(e=>{let t=dN(r.serializer,e);s.set(t.key.toString(),t)});let a=[];return t.forEach(e=>{let t=s.get(e.toString());iL(!!t,55234,{key:e}),a.push(t)}),a}async function gW(e,t,r){var n;let i=iF(e),{request:s,aliasMap:a,parent:o}=d$(i.serializer,cI(t),r);i.connection.shouldResourcePathBeIncludedInRequest||delete s.parent;let l=(await i.invokeStreamingRPC("RunAggregationQuery",i.serializer.databaseId,o,s,1)).filter(e=>!!e.result);iL(1===l.length,64727);let c=null==(n=l[0].result)?void 0:n.aggregateFields;return Object.keys(c).reduce((e,t)=>(e[a[t]]=c[t],e),{})}function gH(e,t,r){let n=iF(e);return n.verifyInitialized(),new gV(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}function gQ(e,t,r){let n=iF(e);return n.verifyInitialized(),new gU(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}let gY="OnlineStateTracker",gJ=1,gX=1e4;class gZ{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",gX,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${gX/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=gJ&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${gJ} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===e&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(iA(t),this.shouldWarnClientIsOffline=!1):iR(gY,t)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}let g0="RemoteStore",g1=10;class g2{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=i,this.connectivityMonitor.addCallback(e=>{r.enqueueAndForget(async()=>{ys(this)&&(iR(g0,"Restarting streams for network reachability change."),await y_(this))})}),this.onlineStateTracker=new gZ(r,n)}}function g3(e,t,r,n,i){return new g2(e,t,r,n,i)}function g6(e){let t=iF(e);return t.offlineCauses.delete(0),g4(t)}async function g4(e){if(ys(e))for(let t of e.onNetworkStatusChange)await t(!0)}async function g5(e){let t=iF(e);t.offlineCauses.add(0),await g8(t),t.onlineStateTracker.set("Offline")}async function g8(e){for(let t of e.onNetworkStatusChange)await t(!1)}async function g7(e){let t=iF(e);iR(g0,"RemoteStore shutting down."),t.offlineCauses.add(5),await g8(t),t.connectivityMonitor.shutdown(),t.onlineStateTracker.set("Unknown")}function g9(e,t){let r=iF(e);!r.listenTargets.has(t.targetId)&&(r.listenTargets.set(t.targetId,t),yi(r)?yn(r):yk(r).isOpen()&&yt(r,t))}function ye(e,t){let r=iF(e),n=yk(r);r.listenTargets.delete(t),n.isOpen()&&yr(r,t),0===r.listenTargets.size&&(n.isOpen()?n.markIdle():ys(r)&&r.onlineStateTracker.set("Unknown"))}function yt(e,t){if(e.watchChangeAggregator.recordPendingTargetRequest(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(sm.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}yk(e).watch(t)}function yr(e,t){e.watchChangeAggregator.recordPendingTargetRequest(t),yk(e).unwatch(t)}function yn(e){e.watchChangeAggregator=new u5({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),getTargetDataForTarget:t=>e.listenTargets.get(t)||null,getDatabaseId:()=>e.datastore.serializer.databaseId}),yk(e).start(),e.onlineStateTracker.handleWatchStreamStart()}function yi(e){return ys(e)&&!yk(e).isStarted()&&e.listenTargets.size>0}function ys(e){return 0===iF(e).offlineCauses.size}function ya(e){e.watchChangeAggregator=void 0}async function yo(e){e.onlineStateTracker.set("Online")}async function yl(e){e.listenTargets.forEach((t,r)=>{yt(e,t)})}async function yc(e,t){ya(e),yi(e)?(e.onlineStateTracker.handleWatchStreamFailure(t),yn(e)):e.onlineStateTracker.set("Unknown")}async function yu(e,t,r){if(e.onlineStateTracker.set("Online"),t instanceof u3&&2===t.state&&t.cause){try{await yf(e,t)}catch(r){iR(g0,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await yd(e,r)}return}if(t instanceof u1?e.watchChangeAggregator.handleDocumentChange(t):t instanceof u2?e.watchChangeAggregator.handleExistenceFilter(t):e.watchChangeAggregator.handleTargetChange(t),!r.isEqual(sm.min()))try{let t=await mE(e.localStore);r.compareTo(t)>=0&&await yp(e,r)}catch(t){iR(g0,"Failed to raise snapshot:",t),await yd(e,t)}}async function yd(e,t,r){if(sz(t))e.offlineCauses.add(1),await g8(e),e.onlineStateTracker.set("Offline"),r||(r=()=>mE(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{iR(g0,"Retrying IndexedDB access"),await r(),e.offlineCauses.delete(1),await g4(e)});else throw t}function yh(e,t){return t().catch(r=>yd(e,r,t))}function yp(e,t){let r=e.watchChangeAggregator.createRemoteEvent(t);return r.targetChanges.forEach((r,n)=>{if(r.resumeToken.approximateByteSize()>0){let i=e.listenTargets.get(n);i&&e.listenTargets.set(n,i.withResumeToken(r.resumeToken,t))}}),r.targetMismatches.forEach((t,r)=>{let n=e.listenTargets.get(t);n&&(e.listenTargets.set(t,n.withResumeToken(oS.EMPTY_BYTE_STRING,n.snapshotVersion)),yr(e,t),yt(e,new hf(n.target,t,r,n.sequenceNumber)))}),e.remoteSyncer.applyRemoteEvent(r)}async function yf(e,t){let r=t.cause;for(let n of t.targetIds)e.listenTargets.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.listenTargets.delete(n),e.watchChangeAggregator.removeTarget(n))}async function ym(e){let t=iF(e),r=yN(t),n=t.writePipeline.length>0?t.writePipeline[t.writePipeline.length-1].batchId:oj;for(;yg(t);)try{let e=await mx(t.localStore,n);if(null===e){0===t.writePipeline.length&&r.markIdle();break}n=e.batchId,yy(t,e)}catch(e){await yd(t,e)}yv(t)&&yb(t)}function yg(e){return ys(e)&&e.writePipeline.length<g1}function yy(e,t){e.writePipeline.push(t);let r=yN(e);r.isOpen()&&r.handshakeComplete&&r.writeMutations(t.mutations)}function yv(e){return ys(e)&&!yN(e).isStarted()&&e.writePipeline.length>0}function yb(e){yN(e).start()}async function yS(e){yN(e).writeHandshake()}async function yT(e){let t=yN(e);for(let r of e.writePipeline)t.writeMutations(r.mutations)}async function yE(e,t,r){let n=e.writePipeline.shift(),i=uj.from(n,t,r);await yh(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await ym(e)}async function yw(e,t){t&&yN(e).handshakeComplete&&await yC(e,t),yv(e)&&yb(e)}async function yC(e,t){if(uq(t.code)){let r=e.writePipeline.shift();yN(e).inhibitBackoff(),await yh(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await ym(e)}}async function y_(e){let t=iF(e);t.offlineCauses.add(4),await g8(t),t.onlineStateTracker.set("Unknown"),t.offlineCauses.delete(4),await g4(t)}async function yI(e,t){let r=iF(e);r.asyncQueue.verifyOperationInProgress(),iR(g0,"RemoteStore received new credentials");let n=ys(r);r.offlineCauses.add(3),await g8(r),n&&r.onlineStateTracker.set("Unknown"),await r.remoteSyncer.handleCredentialChange(t),r.offlineCauses.delete(3),await g4(r)}async function yx(e,t){let r=iF(e);t?(r.offlineCauses.delete(2),await g4(r)):t||(r.offlineCauses.add(2),await g8(r),r.onlineStateTracker.set("Unknown"))}function yk(e){return e.watchStream||(e.watchStream=gQ(e.datastore,e.asyncQueue,{onConnected:yo.bind(null,e),onOpen:yl.bind(null,e),onClose:yc.bind(null,e),onWatchChange:yu.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.watchStream.inhibitBackoff(),yi(e)?yn(e):e.onlineStateTracker.set("Unknown")):(await e.watchStream.stop(),ya(e))})),e.watchStream}function yN(e){return e.writeStream||(e.writeStream=gH(e.datastore,e.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:yS.bind(null,e),onClose:yw.bind(null,e),onHandshakeComplete:yT.bind(null,e),onMutationResult:yE.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.writeStream.inhibitBackoff(),await ym(e)):(await e.writeStream.stop(),e.writePipeline.length>0&&(iR(g0,`Stopping write stream with ${e.writePipeline.length} pending writes`),e.writePipeline=[]))})),e.writeStream}let yR="AsyncQueue";class yA{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new iU,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new yA(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ij(iB.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function yD(e,t){if(iA(yR,`${t}: ${e}`),sz(e))return new ij(iB.UNAVAILABLE,`${t}: ${e}`);throw e}class yO{static emptySet(e){return new yO(e.comparator)}constructor(e){e?this.comparator=(t,r)=>e(t,r)||st.comparator(t.key,r.key):this.comparator=(e,t)=>st.comparator(e.key,t.key),this.keyedMap=cH(),this.sortedSet=new oc(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof yO)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return(this.forEach(t=>{e.push(t.toString())}),0===e.length)?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new yO;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class yP{constructor(){this.changeMap=new oc(st.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}0!==e.type&&3===r.type?this.changeMap=this.changeMap.insert(t,e):3===e.type&&1!==r.type?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.changeMap=this.changeMap.remove(t):1===e.type&&2===r.type?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):iP(63341,{change:e,oldChange:r})}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}}class yM{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new yM(e,t,yO.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!cO(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class yL{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}}function yF(){return new yB}class yB{constructor(){this.queries=yj(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){yW(this,new ij(iB.ABORTED,"Firestore shutting down"))}}function yj(){return new c$(e=>cP(e),cO)}async function yU(e,t){let r=iF(e),n=3,i=t.query,s=r.queries.get(i);s?!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(n=2):(s=new yL,n=+!t.listensToRemoteStore());try{switch(n){case 0:s.viewSnap=await r.onListen(i,!0);break;case 1:s.viewSnap=await r.onListen(i,!1);break;case 2:await r.onFirstRemoteStoreListen(i)}}catch(r){let e=yD(r,`Initialization of query '${cM(t.query)}' failed`);t.onError(e);return}r.queries.set(i,s),s.listeners.push(t),t.applyOnlineStateChange(r.onlineState),s.viewSnap&&t.onViewSnapshot(s.viewSnap)&&yH(r)}async function yV(e,t){let r=iF(e),n=t.query,i=3,s=r.queries.get(n);if(s){let e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),0===s.listeners.length?i=+!t.listensToRemoteStore():!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(i=2))}switch(i){case 0:return r.queries.delete(n),r.onUnlisten(n,!0);case 1:return r.queries.delete(n),r.onUnlisten(n,!1);case 2:return r.onLastRemoteStoreUnlisten(n);default:return}}function yz(e,t){let r=iF(e),n=!1;for(let e of t){let t=e.query,i=r.queries.get(t);if(i){for(let t of i.listeners)t.onViewSnapshot(e)&&(n=!0);i.viewSnap=e}}n&&yH(r)}function yq(e,t,r){let n=iF(e),i=n.queries.get(t);if(i)for(let e of i.listeners)e.onError(r);n.queries.delete(t)}function y$(e,t){let r=iF(e);r.onlineState=t;let n=!1;r.queries.forEach((e,r)=>{for(let e of r.listeners)e.applyOnlineStateChange(t)&&(n=!0)}),n&&yH(r)}function yG(e,t){iF(e).snapshotsInSyncListeners.add(t),t.next()}function yK(e,t){iF(e).snapshotsInSyncListeners.delete(t)}function yW(e,t){let r=iF(e),n=r.queries;r.queries=yj(),n.forEach((e,r)=>{for(let e of r.listeners)e.onError(t)})}function yH(e){e.snapshotsInSyncListeners.forEach(e=>{e.next()})}!function(e){e.Default="default",e.Cache="cache"}(c||(c={}));class yQ{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new yM(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r="Offline"!==t;return(!this.options.waitForSyncWhenOnline||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return(!!e.syncStateChanged||!!t)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(e){e=yM.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==c.Cache}}class yY{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=n}static fromSnapshot(e,t){let r=c3(),n=c3();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new yY(e,t.fromCache,r,n)}}class yJ{constructor(e){this.serializer=e}toDocumentKey(e){return dv(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?dI(this.serializer,e.document,!1):lA.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return dp(e)}}class yX{constructor(e,t){this.bundleMetadata=e,this.serializer=t,this._queries=[],this._documents=[],this.collectionGroups=new Set,this.progress=yZ(e)}get queries(){return this._queries}get documents(){return this._documents}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this._queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this._documents.push({metadata:e.payload.documentMetadata}),!e.payload.documentMetadata.exists&&++t;let r=i7.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this._documents[this._documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,r=new yJ(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.toDocumentKey(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||c3()).add(e);t.set(r,n)}}return t}async completeAndStoreAsync(e){let t=await mV(e,new yJ(this.serializer),this._documents,this.bundleMetadata.id),r=this.getQueryDocumentMapping(this.documents);for(let t of this._queries)await mG(e,t,r.get(t.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:t}}}function yZ(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}function y0(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class y1{constructor(e){this.key=e}}class y2{constructor(e){this.key=e}}class y3{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=c3(),this.mutatedKeys=c3(),this.docComparator=cz(e),this.documentSet=new yO(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new yP,n=t?t.documentSet:this.documentSet,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let c=n.get(e),u=cL(this.query,t)?t:null,d=!!c&&this.mutatedKeys.has(c.key),h=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations),p=!1;c&&u?c.data.isEqual(u.data)?d!==h&&(r.track({type:3,doc:u}),p=!0):!this.shouldWaitForSyncedDocument(c,u)&&(r.track({type:2,doc:u}),p=!0,(o&&this.docComparator(u,o)>0||l&&0>this.docComparator(u,l))&&(a=!0)):!c&&u?(r.track({type:0,doc:u}),p=!0):c&&!u&&(r.track({type:1,doc:c}),p=!0,(o||l)&&(a=!0)),p&&(u?(s=s.add(u),i=h?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{documentSet:s,changeSet:r,needsRefill:a,mutatedKeys:i}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let s=e.changeSet.getChanges();s.sort((e,t)=>y6(e.type,t.type)||this.docComparator(e.doc,t.doc)),this.applyTargetChange(r),n=null!=n&&n;let a=t&&!n?this.updateLimboDocuments():[],o=+!!(0===this.limboDocuments.size&&this.current&&!n),l=o!==this.syncState;return(this.syncState=o,0!==s.length||l)?{snapshot:new yM(this.query,e.documentSet,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),limboChanges:a}:{limboChanges:a}}applyOnlineStateChange(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new yP,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!this._syncedDocuments.has(e)&&!!this.documentSet.has(e)&&!this.documentSet.get(e).hasLocalMutations}applyTargetChange(e){e&&(e.addedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.delete(e)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=c3(),this.documentSet.forEach(e=>{this.shouldBeInLimbo(e.key)&&(this.limboDocuments=this.limboDocuments.add(e.key))});let t=[];return e.forEach(e=>{this.limboDocuments.has(e)||t.push(new y2(e))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new y1(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=c3();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return yM.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function y6(e,t){let r=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return iP(20277,{change:e})}};return r(e)-r(t)}let y4="SyncEngine";class y5{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class y8{constructor(e){this.key=e,this.receivedDocument=!1}}class y7{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.syncEngineListener={},this.queryViewsByQuery=new c$(e=>cP(e),cO),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new oc(st.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new fN,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=p1.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function y9(e,t,r,n,i,s,a){let o=new y7(e,t,r,n,i,s);return a&&(o._isPrimaryClient=!0),o}async function ve(e,t,r=!0){let n,i=vL(e),s=i.queryViewsByQuery.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.computeInitialSnapshot()):n=await vr(i,t,r,!0),n}async function vt(e,t){let r=vL(e);await vr(r,t,!0,!1)}async function vr(e,t,r,n){let i,s=await mN(e.localStore,c_(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await vn(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&g9(e.remoteStore,s),i}async function vn(e,t,r,n,i){e.applyDocChanges=(t,r,n)=>vw(e,t,r,n);let s=await mD(e.localStore,t,!0),a=new y3(t,s.remoteKeys),o=a.computeDocChanges(s.documents),l=u0.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),c=a.applyChanges(o,e.isPrimaryClient,l);vb(e,r,c.limboChanges);let u=new y5(t,r,a);return e.queryViewsByQuery.set(t,u),e.queriesByTarget.has(r)?e.queriesByTarget.get(r).push(t):e.queriesByTarget.set(r,[t]),c.snapshot}async function vi(e,t,r){let n=iF(e),i=n.queryViewsByQuery.get(t),s=n.queriesByTarget.get(i.targetId);if(s.length>1){n.queriesByTarget.set(i.targetId,s.filter(e=>!cO(e,t))),n.queryViewsByQuery.delete(t);return}n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await mA(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),r&&ye(n.remoteStore,i.targetId),vy(n,i.targetId)}).catch(sO)):(vy(n,i.targetId),await mA(n.localStore,i.targetId,!0))}async function vs(e,t){let r=iF(e),n=r.queryViewsByQuery.get(t),i=r.queriesByTarget.get(n.targetId);r.isPrimaryClient&&1===i.length&&(r.sharedClientState.removeLocalQueryTarget(n.targetId),ye(r.remoteStore,n.targetId))}async function va(e,t,r){let n=vF(e);try{let e=await my(n.localStore,t);n.sharedClientState.addPendingMutation(e.batchId),vm(n,e.batchId,r),await vE(n,e.changes),await ym(n.remoteStore)}catch(t){let e=yD(t,"Failed to persist write");r.reject(e)}}async function vo(e,t){let r=iF(e);try{let e=await mw(r.localStore,t);t.targetChanges.forEach((e,t)=>{let n=r.activeLimboResolutionsByTarget.get(t);n&&(iL(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?n.receivedDocument=!0:e.modifiedDocuments.size>0?iL(n.receivedDocument,14607):e.removedDocuments.size>0&&(iL(n.receivedDocument,42227),n.receivedDocument=!1))}),await vE(r,e,t)}catch(e){await sO(e)}}function vl(e,t,r){let n=iF(e);if(n.isPrimaryClient&&0===r||!n.isPrimaryClient&&1===r){let e=[];n.queryViewsByQuery.forEach((r,n)=>{let i=n.view.applyOnlineStateChange(t);i.snapshot&&e.push(i.snapshot)}),y$(n.eventManager,t),e.length&&n.syncEngineListener.onWatchChange(e),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function vc(e,t,r){let n=iF(e);n.sharedClientState.updateQueryState(t,"rejected",r);let i=n.activeLimboResolutionsByTarget.get(t),s=i&&i.key;if(s){let e=new oc(st.comparator);e=e.insert(s,lA.newNoDocument(s,sm.min()));let r=c3().add(s),i=new uZ(sm.min(),new Map,new oc(i0),e,r);await vo(n,i),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(s),n.activeLimboResolutionsByTarget.delete(t),vT(n)}else await mA(n.localStore,t,!1).then(()=>vy(n,t,r)).catch(sO)}async function vu(e,t){let r=iF(e),n=t.batch.batchId;try{let e=await mv(r.localStore,t);vg(r,n,null),vp(r,n),r.sharedClientState.updateMutationState(n,"acknowledged"),await vE(r,e)}catch(e){await sO(e)}}async function vd(e,t,r){let n=iF(e);try{let e=await mS(n.localStore,t);vg(n,t,r),vp(n,t),n.sharedClientState.updateMutationState(t,"rejected",r),await vE(n,e)}catch(e){await sO(e)}}async function vh(e,t){let r=iF(e);ys(r.remoteStore)||iR(y4,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let e=await mT(r.localStore);if(e===oj)return void t.resolve();let n=r.pendingWritesCallbacks.get(e)||[];n.push(t),r.pendingWritesCallbacks.set(e,n)}catch(r){let e=yD(r,"Initialization of waitForPendingWrites() operation failed");t.reject(e)}}function vp(e,t){(e.pendingWritesCallbacks.get(t)||[]).forEach(e=>{e.resolve()}),e.pendingWritesCallbacks.delete(t)}function vf(e,t){e.pendingWritesCallbacks.forEach(e=>{e.forEach(e=>{e.reject(new ij(iB.CANCELLED,t))})}),e.pendingWritesCallbacks.clear()}function vm(e,t,r){let n=e.mutationUserCallbacks[e.currentUser.toKey()];n||(n=new oc(i0)),n=n.insert(t,r),e.mutationUserCallbacks[e.currentUser.toKey()]=n}function vg(e,t,r){let n=iF(e),i=n.mutationUserCallbacks[n.currentUser.toKey()];if(i){let e=i.get(t);e&&(r?e.reject(r):e.resolve(),i=i.remove(t)),n.mutationUserCallbacks[n.currentUser.toKey()]=i}}function vy(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.queriesByTarget.get(t)))e.queryViewsByQuery.delete(n),r&&e.syncEngineListener.onWatchError(n,r);e.queriesByTarget.delete(t),e.isPrimaryClient&&e.limboDocumentRefs.removeReferencesForId(t).forEach(t=>{e.limboDocumentRefs.containsKey(t)||vv(e,t)})}function vv(e,t){e.enqueuedLimboResolutions.delete(t.path.canonicalString());let r=e.activeLimboTargetsByKey.get(t);null!==r&&(ye(e.remoteStore,r),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.remove(t),e.activeLimboResolutionsByTarget.delete(r),vT(e))}function vb(e,t,r){for(let n of r)n instanceof y1?(e.limboDocumentRefs.addReference(n.key,t),vS(e,n)):n instanceof y2?(iR(y4,"Document no longer in limbo: "+n.key),e.limboDocumentRefs.removeReference(n.key,t),e.limboDocumentRefs.containsKey(n.key)||vv(e,n.key)):iP(19791,{limboChange:n})}function vS(e,t){let r=t.key,n=r.path.canonicalString();e.activeLimboTargetsByKey.get(r)||e.enqueuedLimboResolutions.has(n)||(iR(y4,"New document in limbo: "+r),e.enqueuedLimboResolutions.add(n),vT(e))}function vT(e){for(;e.enqueuedLimboResolutions.size>0&&e.activeLimboTargetsByKey.size<e.maxConcurrentLimboResolutions;){let t=e.enqueuedLimboResolutions.values().next().value;e.enqueuedLimboResolutions.delete(t);let r=new st(i7.fromString(t)),n=e.limboTargetIdGenerator.next();e.activeLimboResolutionsByTarget.set(n,new y8(r)),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.insert(r,n),g9(e.remoteStore,new hf(c_(cv(r.path)),n,"TargetPurposeLimboResolution",sZ.INVALID))}}async function vE(e,t,r){let n=iF(e),i=[],s=[],a=[];n.queryViewsByQuery.isEmpty()||(n.queryViewsByQuery.forEach((e,o)=>{a.push(n.applyDocChanges(o,t,r).then(e=>{var t;if((e||r)&&n.isPrimaryClient){let i=e?!e.fromCache:null==(t=null==r?void 0:r.targetChanges.get(o.targetId))?void 0:t.current;n.sharedClientState.updateQueryState(o.targetId,i?"current":"not-current")}if(e){i.push(e);let t=yY.fromSnapshot(o.targetId,e);s.push(t)}}))}),await Promise.all(a),n.syncEngineListener.onWatchChange(i),await mI(n.localStore,s))}async function vw(e,t,r,n){let i=t.view.computeDocChanges(r);i.needsRefill&&(i=await mD(e.localStore,t.query,!1).then(({documents:e})=>t.view.computeDocChanges(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return vb(e,t.targetId,o.limboChanges),o.snapshot}async function vC(e,t){let r=iF(e);if(!r.currentUser.isEqual(t)){iR(y4,"User change. New user:",t.toKey());let e=await mg(r.localStore,t);r.currentUser=t,vf(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await vE(r,e.affectedDocuments)}}function v_(e,t){let r=iF(e),n=r.activeLimboResolutionsByTarget.get(t);if(n&&n.receivedDocument)return c3().add(n.key);{let e=c3(),n=r.queriesByTarget.get(t);if(!n)return e;for(let t of n){let n=r.queryViewsByQuery.get(t);e=e.unionWith(n.view.syncedDocuments)}return e}}async function vI(e,t){let r=iF(e),n=await mD(r.localStore,t.query,!0),i=t.view.synchronizeWithPersistedState(n);return r.isPrimaryClient&&vb(r,t.targetId,i.limboChanges),i}async function vx(e,t){let r=iF(e);return mB(r.localStore,t).then(e=>vE(r,e))}async function vk(e,t,r,n){let i=iF(e),s=await mP(i.localStore,t);if(null===s)return void iR(y4,"Cannot apply mutation batch with id: "+t);"pending"===r?await ym(i.remoteStore):"acknowledged"===r||"rejected"===r?(vg(i,t,n||null),vp(i,t),mM(i.localStore,t)):iP(6720,"Unknown batchState",{batchState:r}),await vE(i,s)}async function vN(e,t){let r=iF(e);if(vL(r),vF(r),!0===t&&!0!==r._isPrimaryClient){let e=r.sharedClientState.getAllActiveQueryTargets(),t=await vA(r,e.toArray());for(let e of(r._isPrimaryClient=!0,await yx(r.remoteStore,!0),t))g9(r.remoteStore,e)}else if(!1===t&&!1!==r._isPrimaryClient){let e=[],t=Promise.resolve();r.queriesByTarget.forEach((n,i)=>{r.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then(()=>(vy(r,i),mA(r.localStore,i,!0))),ye(r.remoteStore,i)}),await t,await vA(r,e),vR(r),r._isPrimaryClient=!1,await yx(r.remoteStore,!1)}}function vR(e){let t=iF(e);t.activeLimboResolutionsByTarget.forEach((e,r)=>{ye(t.remoteStore,r)}),t.limboDocumentRefs.removeAllReferences(),t.activeLimboResolutionsByTarget=new Map,t.activeLimboTargetsByKey=new oc(st.comparator)}async function vA(e,t,r){let n=iF(e),i=[],s=[];for(let e of t){let t,r=n.queriesByTarget.get(e);if(r&&0!==r.length)for(let e of(t=await mN(n.localStore,c_(r[0])),r)){let t=n.queryViewsByQuery.get(e),r=await vI(n,t);r.snapshot&&s.push(r.snapshot)}else{let r=await mF(n.localStore,e);t=await mN(n.localStore,r),await vn(n,vD(r),e,!1,t.resumeToken)}i.push(t)}return n.syncEngineListener.onWatchChange(s),i}function vD(e){return cy(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function vO(e){return mL(iF(e).localStore)}async function vP(e,t,r,n){let i=iF(e);if(i._isPrimaryClient)return void iR(y4,"Ignoring unexpected query state notification.");let s=i.queriesByTarget.get(t);if(s&&s.length>0)switch(r){case"current":case"not-current":{let e=await mB(i.localStore,cV(s[0])),n=uZ.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,oS.EMPTY_BYTE_STRING);await vE(i,e,n);break}case"rejected":await mA(i.localStore,t,!0),vy(i,t,n);break;default:iP(64155,r)}}async function vM(e,t,r){let n=vL(e);if(n._isPrimaryClient){for(let e of t){if(n.queriesByTarget.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){iR(y4,"Adding an already active target "+e);continue}let t=await mF(n.localStore,e),r=await mN(n.localStore,t);await vn(n,vD(t),r.targetId,!1,r.resumeToken),g9(n.remoteStore,r)}for(let e of r)n.queriesByTarget.has(e)&&await mA(n.localStore,e,!1).then(()=>{ye(n.remoteStore,e),vy(n,e)}).catch(sO)}}function vL(e){let t=iF(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=vo.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=v_.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=vc.bind(null,t),t.syncEngineListener.onWatchChange=yz.bind(null,t.eventManager),t.syncEngineListener.onWatchError=yq.bind(null,t.eventManager),t}function vF(e){let t=iF(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=vu.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=vd.bind(null,t),t}function vB(e,t,r){let n=iF(e);vj(n,t,r).then(e=>{n.sharedClientState.notifyBundleLoaded(e)})}async function vj(e,t,r){try{let n=await t.getMetadata();if(await mz(e.localStore,n))return await t.close(),r._completeWith(y0(n)),Promise.resolve(new Set);r._updateProgress(yZ(n));let i=new yX(n,t.serializer),s=await t.nextElement();for(;s;){let e=await i.addSizedElement(s);e&&r._updateProgress(e),s=await t.nextElement()}let a=await i.completeAndStoreAsync(e.localStore);return await vE(e,a.changedDocs,void 0),await mq(e.localStore,n),r._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(e){return iD(y4,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}}class vU{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=gR(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return mm(this.persistence,new mX,e.initialUser,this.serializer)}createPersistence(e){return new fj(fV.factory,this.serializer)}createSharedClientState(e){return new gc}async terminate(){var e,t;null==(e=this.gcScheduler)||e.stop(),null==(t=this.indexBackfillerScheduler)||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}vU.provider={build:()=>new vU};class vV extends vU{constructor(e){super(),this.cacheSizeBytes=e}createGarbageCollectionScheduler(e,t){return iL(this.persistence.referenceDelegate instanceof fz,46915),new fa(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createPersistence(e){let t=void 0!==this.cacheSizeBytes?p9.withCacheSize(this.cacheSizeBytes):p9.DEFAULT;return new fj(e=>fz.factory(e,t),this.serializer)}}class vz extends vU{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.onlineComponentProvider.initialize(this,e),await vF(this.onlineComponentProvider.syncEngine),await ym(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return mm(this.persistence,new mX,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new fa(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new sX(t,this.persistence);return new sJ(e.asyncQueue,r)}createPersistence(e){let t=mc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?p9.withCacheSize(this.cacheSizeBytes):p9.DEFAULT;return new ma(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,gk(),gN(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new gc}}class vq extends vz{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof go&&(this.sharedClientState.syncEngine={applyBatchState:vk.bind(null,t),applyTargetState:vP.bind(null,t),applyActiveTargetsChange:vM.bind(null,t),getActiveClients:vO.bind(null,t),synchronizeWithChangedDocuments:vx.bind(null,t)},await this.sharedClientState.start()),await this.persistence.setPrimaryStateListener(async e=>{await vN(this.onlineComponentProvider.syncEngine,e),this.gcScheduler&&(e&&!this.gcScheduler.started?this.gcScheduler.start():e||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(e&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():e||this.indexBackfillerScheduler.stop())})}createSharedClientState(e){let t=gk();if(!go.isAvailable(t))throw new ij(iB.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=mc(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new go(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class v${async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>vl(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=vC.bind(null,this.syncEngine),await yx(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return yF()}createDatastore(e){let t=gR(e.databaseInfo.databaseId),r=gI(e.databaseInfo);return g$(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return g3(this.localStore,this.datastore,e.asyncQueue,e=>vl(this.syncEngine,e,0),gx())}createSyncEngine(e,t){return y9(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await g7(this.remoteStore),null==(e=this.datastore)||e.terminate(),null==(t=this.eventManager)||t.terminate()}}v$.provider={build:()=>new v$};let vG=10240;function vK(e,t=vG){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}function vW(e,t){if(!(e instanceof Uint8Array))throw new ij(iB.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${so(e)}`);return vK(e,t)}class vH{constructor(e){this.observer=e,this.muted=!1}next(e){!this.muted&&this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):iA("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class vQ{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}}class vY{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new iU,this.buffer=new Uint8Array,this.textDecoder=iX(),this.nextElementImpl().then(e=>{e&&e.isBundleMetadata()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(null==e?void 0:e.payload)}`))},e=>this.metadata.reject(e))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let e=await this.readLength();if(null===e)return null;let t=this.textDecoder.decode(e),r=Number(t);return isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`),new vQ(JSON.parse(await this.readJsonString(r)),e.length+r)}indexOfOpenBracket(){return this.buffer.findIndex(e=>123===e)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async readJsonString(e){for(;this.buffer.length<e;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}raiseError(e){throw this.reader.cancel(),Error(`Invalid bundle format: ${e}`)}async pullMoreDataToBuffer(){let e=await this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}function vJ(e,t){return new vY(e,t)}class vX{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.nextElement();if(r&&r.isBundleMetadata())this.metadata=r;else throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(null==r?void 0:r.payload)}`);do null!==(r=this.nextElement())&&this.elements.push(r);while(null!==r)}getMetadata(){return this.metadata}getElements(){return this.elements}nextElement(){if(this.cursor===this.bundleData.length)return null;let e=this.readLength();return new vQ(JSON.parse(this.readJsonString(e)),e)}readJsonString(e){if(this.cursor+e>this.bundleData.length)throw new ij(iB.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}readLength(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}function vZ(e,t){return new vX(e,t)}class v0{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new ij(iB.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await gK(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new uP(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=st.fromPath(t);this.mutations.push(new uF(r,this.precondition(r)))}),await gG(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=sm.min();else throw iP(50498,{documentName:e.constructor.name});let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new ij(iB.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return this.writtenDocs.has(e.toString())||!t?uy.none():t.isEqual(sm.min())?uy.exists(!1):uy.updateTime(t)}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return uy.exists(!0);if(t.isEqual(sm.min()))throw new ij(iB.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return uy.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class v1{constructor(e,t,r,n,i){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=n,this.deferred=i,this.attemptsRemaining=r.maxAttempts,this.backoff=new gM(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(async()=>{let e=new v0(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(t=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(t)}).catch(e=>{this.handleTransactionError(e)}))}).catch(e=>{this.handleTransactionError(e)})})}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);if(oU(t)||!t.catch||!t.then)return this.deferred.reject(Error("Transaction callback must return a Promise")),null;return t}catch(e){return this.deferred.reject(e),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if("FirebaseError"===e.name){let t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!uz(t)}return!1}}let v2="FirestoreClient",v3=100,v6=11,v4=20,v5=22;class v8{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=n,this.user=iC.UNAUTHENTICATED,this.clientId=iZ.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{iR(v2,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(iR(v2,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:v3}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new iU;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=yD(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function v7(e,t){e.asyncQueue.verifyOperationInProgress(),iR(v2,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await mg(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>{iD("Terminating Firestore due to IndexedDb database deletion"),e.terminate().then(()=>{iR("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(e=>{iD("Terminating Firestore due to IndexedDb database deletion failed",e)})}),e._offlineComponents=t}async function v9(e,t){e.asyncQueue.verifyOperationInProgress();let r=await bt(e);iR(v2,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>yI(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>yI(t.remoteStore,r)),e._onlineComponents=t}function be(e){return"FirebaseError"===e.name?e.code===iB.FAILED_PRECONDITION||e.code===iB.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||e.code===v5||e.code===v4||e.code===v6}async function bt(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){iR(v2,"Using user provided OfflineComponentProvider");try{await v7(e,e._uninitializedComponentsProvider._offline)}catch(r){let t=r;if(!be(t))throw t;iD("Error using user provided cache. Falling back to memory cache: "+t),await v7(e,new vU)}}else iR(v2,"Using default OfflineComponentProvider"),await v7(e,new vV(void 0));return e._offlineComponents}async function br(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(iR(v2,"Using user provided OnlineComponentProvider"),await v9(e,e._uninitializedComponentsProvider._online)):(iR(v2,"Using default OnlineComponentProvider"),await v9(e,new v$))),e._onlineComponents}function bn(e){return bt(e).then(e=>e.persistence)}function bi(e){return bt(e).then(e=>e.localStore)}function bs(e){return br(e).then(e=>e.remoteStore)}function ba(e){return br(e).then(e=>e.syncEngine)}function bo(e){return br(e).then(e=>e.datastore)}async function bl(e){let t=await br(e),r=t.eventManager;return r.onListen=ve.bind(null,t.syncEngine),r.onUnlisten=vi.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=vt.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=vs.bind(null,t.syncEngine),r}function bc(e,t,r,n){let i=new vH(n),s=new yQ(t,i,r);return e.asyncQueue.enqueueAndForget(async()=>yU(await bl(e),s)),()=>{i.mute(),e.asyncQueue.enqueueAndForget(async()=>yV(await bl(e),s))}}function bu(e,t,r){let n=new iU;return e.asyncQueue.enqueueAndForget(async()=>{try{let i=await bo(e);n.resolve(gW(i,t,r))}catch(e){n.reject(e)}}),n.promise}function bd(e,t){let r=new iU;return e.asyncQueue.enqueueAndForget(async()=>va(await ba(e),t,r)),r.promise}async function bh(e,t,r){try{let n=await mk(e,t);n.isFoundDocument()?r.resolve(n):n.isNoDocument()?r.resolve(null):r.reject(new ij(iB.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(n){let e=yD(n,`Failed to get document '${t} from cache`);r.reject(e)}}function bp(e,t,r,n,i){let s=new vH({next:o=>{s.mute(),t.enqueueAndForget(()=>yV(e,a));let l=o.docs.has(r);!l&&o.fromCache?i.reject(new ij(iB.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&n&&"server"===n.source?i.reject(new ij(iB.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),a=new yQ(cv(r.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return yU(e,a)}async function bf(e,t,r){try{let n=await mD(e,t,!0),i=new y3(t,n.remoteKeys),s=i.computeDocChanges(n.documents),a=i.applyChanges(s,!1);r.resolve(a.snapshot)}catch(n){let e=yD(n,`Failed to execute query '${t} against cache`);r.reject(e)}}function bm(e,t,r,n,i){let s=new vH({next:r=>{s.mute(),t.enqueueAndForget(()=>yV(e,a)),r.fromCache&&"server"===n.source?i.reject(new ij(iB.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(r)},error:e=>i.reject(e)}),a=new yQ(r,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return yU(e,a)}function bg(e,t,r,n){let i=bv(r,gR(t));e.asyncQueue.enqueueAndForget(async()=>{vB(await ba(e),i,n)})}function by(e,t){return e.asyncQueue.enqueue(async()=>m$(await bi(e),t))}function bv(e,t){let r;return vJ(vW(r="string"==typeof e?iJ().encode(e):e),t)}function bb(e,t){return e.asyncQueue.enqueue(async()=>mW(await bi(e),t))}function bS(e,t){return e.timeoutSeconds===t.timeoutSeconds}function bT(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let bE="ComponentProvider",bw=new Map;function bC(e){let t=bw.get(e);t&&(iR(bE,"Removing Datastore"),bw.delete(e),t.terminate())}function b_(e,t,r,n){return new oM(e,t,r,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling,bT(n.experimentalLongPollingOptions),n.useFetchStreams,n.isUsingEmulator)}let bI="firestore.googleapis.com",bx=!0,bk=5,bN=30,bR=!0;class bA{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new ij(iB.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=bI,this.ssl=bx}else this.host=e.host,this.ssl=null!=(t=e.ssl)?t:bx;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=p7;else if(e.cacheSizeBytes!==p8&&e.cacheSizeBytes<ft)throw new ij(iB.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${ft}`);else this.cacheSizeBytes=e.cacheSizeBytes;sn("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=bR:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=bT(null!=(r=e.experimentalLongPollingOptions)?r:{}),bD(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&bS(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}function bD(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new ij(iB.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<bk)throw new ij(iB.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is ${bk})`);if(e.timeoutSeconds>bN)throw new ij(iB.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is ${bN})`)}}class bO{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new bA({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ij(iB.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new ij(iB.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new bA(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=iQ(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return bC(this),Promise.resolve()}}function bP(e,t,r,n={}){var i;e=sc(e,bO);let s=W(t),a=e._getSettings(),o=Object.assign(Object.assign({},a),{emulatorOptions:e._getEmulatorOptions()}),l=`${t}:${r}`;s&&(H(`https://${l}`),ee("Firestore",!0)),a.host!==bI&&a.host!==l&&iD("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let c=Object.assign(Object.assign({},a),{host:l,ssl:s,emulatorOptions:n});if(!ey(c,o)&&(e._setSettings(c),n.mockUserToken)){let t,r;if("string"==typeof n.mockUserToken)t=n.mockUserToken,r=iC.MOCK_USER;else{t=Q(n.mockUserToken,null==(i=e._app)?void 0:i.options.projectId);let s=n.mockUserToken.sub||n.mockUserToken.user_id;if(!s)throw new ij(iB.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new iC(s)}e._authCredentials=new iq(new iV(t,r))}}class bM{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new bM(this.firestore,e,this._query)}}class bL{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new bF(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new bL(this.firestore,e,this._key)}toJSON(){return{type:bL._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(sd(t,bL._jsonSchema))return new bL(e,r||null,new st(i7.fromString(t.referencePath)))}}bL._jsonSchemaVersion="firestore/documentReference/1.0",bL._jsonSchema={type:su("string",bL._jsonSchemaVersion),referencePath:su("string")};class bF extends bM{constructor(e,t,r){super(e,t,cv(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new bL(this.firestore,null,new st(e))}withConverter(e){return new bF(this.firestore,e,this._path)}}function bB(e,t,...r){if(e=eI(e),sr("collection","path",t),e instanceof bO){let n=i7.fromString(t,...r);return ss(n),new bF(e,null,n)}{if(!(e instanceof bL)&&!(e instanceof bF))throw new ij(iB.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(i7.fromString(t,...r));return ss(n),new bF(e.firestore,null,n)}}function bj(e,t,...r){if(e=eI(e),1==arguments.length&&(t=iZ.newId()),sr("doc","path",t),e instanceof bO){let n=i7.fromString(t,...r);return si(n),new bL(e,null,new st(n))}{if(!(e instanceof bL)&&!(e instanceof bF))throw new ij(iB.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(i7.fromString(t,...r));return si(n),new bL(e.firestore,e instanceof bF?e.converter:null,new st(n))}}let bU="AsyncQueue";class bV{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new gM(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new iU;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(sz(e))iR(bU,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(e=>{throw this.failure=e,this.operationInProgress=!1,iA("INTERNAL UNHANDLED ERROR: ",bz(e)),e}).then(e=>(this.operationInProgress=!1,e))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let n=yA.createAndSchedule(this,e,t,r,e=>this.removeDelayedOperation(e));return this.delayedOperations.push(n),n}verifyNotFailed(){this.failure&&iP(47125,{messageOrStack:bz(this.failure)})}verifyOperationInProgress(){}async drain(){let e;do e=this.tail,await e;while(e!==this.tail)}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{for(let t of(this.delayedOperations.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.delayedOperations))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}}function bz(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class bq{constructor(){this._progressObserver={},this._taskCompletionResolver=new iU,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class b$ extends bO{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new bV,this._persistenceKey=(null==n?void 0:n.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new bV(e),this._firestoreClient=void 0,await e}}}function bG(e,t){let r="object"==typeof e?e:tg(),n="string"==typeof e?e:t||oL,i=tc(r,"firestore").getImmediate({identifier:n});if(!i._initialized){let e=$("firestore");e&&bP(i,...e)}return i}function bK(e){if(e._terminated)throw new ij(iB.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||bW(e),e._firestoreClient}function bW(e){var t,r,n;let i=e._freezeSettings(),s=b_(e._databaseId,(null==(t=e._app)?void 0:t.options.appId)||"",e._persistenceKey,i);!e._componentsProvider&&(null==(r=i.localCache)?void 0:r._offlineComponentProvider)&&(null==(n=i.localCache)?void 0:n._onlineComponentProvider)&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new v8(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&&bH(e._componentsProvider))}function bH(e){let t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}function bQ(e,t){let r=bK(e=sc(e,b$)),n=new bq;return bg(r,e._databaseId,t,n),n}function bY(e,t){return by(bK(e=sc(e,b$)),t).then(t=>t?new bM(e,null,t.query):null)}function bJ(e,t=!0){iI(tf),tl(new ex("firestore",(e,{instanceIdentifier:r,options:n})=>{let i=e.getProvider("app").getImmediate(),s=new b$(new i$(e.getProvider("auth-internal")),new iH(i,e.getProvider("app-check-internal")),oB(i,r),i);return n=Object.assign({useFetchStreams:t},n),s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),tv(iE,iw,e),tv(iE,iw,"esm2017")}class bX{constructor(e,t,r){this.alias=e,this.aggregateType=t,this.fieldPath=r}}class bZ{constructor(e="count",t){this._internalFieldPath=t,this.type="AggregateField",this.aggregateType=e}}class b0{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class b1{constructor(e){this._byteString=e}static fromBase64String(e){try{return new b1(oS.fromBase64String(e))}catch(e){throw new ij(iB.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new b1(oS.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:b1._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(sd(e,b1._jsonSchema))return b1.fromBase64String(e.bytes)}}b1._jsonSchemaVersion="firestore/bytes/1.0",b1._jsonSchema={type:su("string",b1._jsonSchemaVersion),bytes:su("string")};class b2{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new ij(iB.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new se(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class b3{constructor(e){this._methodName=e}}class b6{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new ij(iB.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new ij(iB.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return i0(this._lat,e._lat)||i0(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:b6._jsonSchemaVersion}}static fromJSON(e){if(sd(e,b6._jsonSchema))return new b6(e.latitude,e.longitude)}}b6._jsonSchemaVersion="firestore/geoPoint/1.0",b6._jsonSchema={type:su("string",b6._jsonSchemaVersion),latitude:su("number"),longitude:su("number")};class b4{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return md(this._values,e._values)}toJSON(){return{type:b4._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(sd(e,b4._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new b4(e.vectorValues);throw new ij(iB.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}b4._jsonSchemaVersion="firestore/vectorValue/1.0",b4._jsonSchema={type:su("string",b4._jsonSchemaVersion),vectorValues:su("object")};let b5=/^__.*__$/;class b8{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new uk(e,this.data,this.fieldMask,t,this.fieldTransforms):new u_(e,this.data,t,this.fieldTransforms)}}class b7{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new uk(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function b9(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw iP(40011,{dataSource:e})}}class Se{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new Se(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=null==(t=this.path)?void 0:t.child(e),n=this.contextWith({path:r,arrayElement:!1});return n.validatePathSegment(e),n}childContextForFieldPath(e){var t;let r=null==(t=this.path)?void 0:t.child(e),n=this.contextWith({path:r,arrayElement:!1});return n.validatePath(),n}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return SC(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(b9(this.dataSource)&&b5.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class St{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||gR(e)}createContext(e,t,r,n=!1){return new Se({dataSource:e,methodName:t,targetDoc:r,path:se.emptyPath(),arrayElement:!1,hasConverter:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Sr(e){let t=e._freezeSettings(),r=gR(e._databaseId);return new St(e._databaseId,!!t.ignoreUndefinedProperties,r)}function Sn(e,t,r,n,i,s={}){let a,o,l=e.createContext(s.merge||s.mergeFields?2:0,t,r,i);SS("Data must be an object, but it was:",l,n);let c=Sf(n,l);if(s.merge)a=new oy(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=ST(t,n,r);if(!l.contains(i))throw new ij(iB.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);S_(e,i)||e.push(i)}a=new oy(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new b8(new lN(c),a,o)}class Si extends b3{_toFieldTransform(e){if(2===e.dataSource)e.fieldMask.push(e.path);else if(1===e.dataSource)throw e.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof Si}}function Ss(e,t,r){return new Se({dataSource:3,targetDoc:t.settings.targetDoc,methodName:e._methodName,arrayElement:r},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class Sa extends null{_toFieldTransform(e){return new up(e.path,new ui)}isEqual(e){return e instanceof Sa}}class So extends b3{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=Ss(this,e,!0),r=new us(this._elements.map(e=>Sp(e,t)));return new up(e.path,r)}isEqual(e){return e instanceof So&&ey(this._elements,e._elements)}}class Sl extends b3{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=Ss(this,e,!0),r=new uo(this._elements.map(e=>Sp(e,t)));return new up(e.path,r)}isEqual(e){return e instanceof Sl&&ey(this._elements,e._elements)}}class Sc extends b3{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new uc(e.serializer,c7(e.serializer,this._operand));return new up(e.path,t)}isEqual(e){return e instanceof Sc&&this._operand===e._operand}}function Su(e,t,r,n){let i=e.createContext(1,t,r);SS("Data must be an object, but it was:",i,n);let s=[],a=lN.empty();return oa(n,(e,n)=>{let o=Sw(t,e,r);n=eI(n);let l=i.childContextForFieldPath(o);if(n instanceof Si)s.push(o);else{let e=Sp(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new b7(a,new oy(s),i.fieldTransforms)}function Sd(e,t,r,n,i,s){let a=e.createContext(1,t,r),o=[ST(t,n,r)],l=[i];if(s.length%2!=0)throw new ij(iB.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(ST(t,s[e])),l.push(s[e+1]);let c=[],u=lN.empty();for(let e=o.length-1;e>=0;--e)if(!S_(c,o[e])){let t=o[e],r=l[e];r=eI(r);let n=a.childContextForFieldPath(t);if(r instanceof Si)c.push(t);else{let e=Sp(r,n);null!=e&&(c.push(t),u.set(t,e))}}return new b7(u,new oy(c),a.fieldTransforms)}function Sh(e,t,r,n=!1){return Sp(r,e.createContext(n?4:3,t))}function Sp(e,t){if(Sb(e=eI(e)))return SS("Unsupported field value:",t,e),Sf(e,t);if(e instanceof b3)return Sg(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),!(e instanceof Array))return Sy(e,t);if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");return Sm(e,t)}function Sf(e,t){let r={};return ol(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):oa(e,(e,n)=>{let i=Sp(n,t.childContextForField(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function Sm(e,t){let r=[],n=0;for(let i of e){let e=Sp(i,t.childContextForArray(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}function Sg(e,t){if(!b9(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}function Sy(e,t){if(null===(e=eI(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return c7(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=sf.fromDate(e);return{timestampValue:dl(t.serializer,r)}}else if(e instanceof sf){let r=new sf(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:dl(t.serializer,r)}}else if(e instanceof b6)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};else if(e instanceof b1)return{bytesValue:du(t.serializer,e._byteString)};else if(e instanceof bL){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.createError(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:df(e.firestore._databaseId||t.databaseId,e._key.path)}}else if(e instanceof b4)return Sv(e,t);else throw t.createError(`Unsupported field value: ${so(e)}`)}function Sv(e,t){return{mapValue:{fields:{[oq]:{stringValue:oK},[oW]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return c5(t.serializer,e)})}}}}}}function Sb(e){return"object"==typeof e&&null!==e&&!(e instanceof Array)&&!(e instanceof Date)&&!(e instanceof sf)&&!(e instanceof b6)&&!(e instanceof b1)&&!(e instanceof bL)&&!(e instanceof b3)&&!(e instanceof b4)}function SS(e,t,r){if(!Sb(r)||!sa(r)){let n=so(r);if("an object"===n)throw t.createError(e+" a custom object");throw t.createError(e+" "+n)}}function ST(e,t,r){if((t=eI(t))instanceof b2)return t._internalPath;if("string"==typeof t)return Sw(e,t);throw SC("Field path arguments must be of type string or ",e,!1,void 0,r)}let SE=RegExp("[~\\*/\\[\\]]");function Sw(e,t,r){if(t.search(SE)>=0)throw SC(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new b2(...t.split("."))._internalPath}catch(n){throw SC(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function SC(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new ij(iB.INVALID_ARGUMENT,o+e+l)}function S_(e,t){return e.some(e=>e.isEqual(t))}class SI{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new bL(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let e=new Sx(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}}}get(e){if(this._document){let t=this._document.data.field(Sk("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Sx extends SI{data(){return super.data()}}function Sk(e,t){return"string"==typeof t?Sw(e,t):t instanceof b2?t._internalPath:t._delegate._internalPath}function SN(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new ij(iB.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class SR{}class SA extends SR{}class SD extends SA{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new SD(e,t,r)}_apply(e){let t=this._parse(e);return SK(e._query,t),new bM(e.firestore,e.converter,ck(e._query,t))}_parse(e){let t=Sr(e.firestore);return Sj(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class SO extends SR{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new SO(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:l$.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(SW(e._query,t),new bM(e.firestore,e.converter,ck(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class SP extends SA{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new SP(e,t)}_apply(e){let t=SU(e._query,this._field,this._direction);return new bM(e.firestore,e.converter,cN(e._query,t))}}class SM extends SA{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new SM(e,t,r)}_apply(e){return new bM(e.firestore,e.converter,cR(e._query,this._limit,this._limitType))}}class SL extends SA{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new SL(e,t,r)}_apply(e){let t=SB(e,this.type,this._docOrFields,this._inclusive);return new bM(e.firestore,e.converter,cA(e._query,t))}}class SF extends SA{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new SF(e,t,r)}_apply(e){let t=SB(e,this.type,this._docOrFields,this._inclusive);return new bM(e.firestore,e.converter,cD(e._query,t))}}function SB(e,t,r,n){if(r[0]=eI(r[0]),r[0]instanceof SI)return SV(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=Sr(e.firestore);return Sz(e._query,e.firestore._databaseId,i,t,r,n)}}function Sj(e,t,r,n,i,s,a){let o;if(i.isKeyField())if("array-contains"===s||"array-contains-any"===s)throw new ij(iB.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);else if("in"===s||"not-in"===s){S$(a,s);let t=[];for(let r of a)t.push(Sq(n,e,r));o={arrayValue:{values:t}}}else o=Sq(n,e,a);else("in"===s||"not-in"===s||"array-contains-any"===s)&&S$(a,s),o=Sh(r,t,a,"in"===s||"not-in"===s);return lq.create(i,s,o)}function SU(e,t,r){if(null!==e.startAt)throw new ij(iB.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new ij(iB.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new lB(t,r)}function SV(e,t,r,n,i){if(!n)throw new ij(iB.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let s=[];for(let r of cC(e))if(r.field.isKeyField())s.push(lp(t,n.key));else{let e=n.data.field(r.field);if(oA(e))throw new ij(iB.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==e)s.push(e);else{let e=r.field.canonicalString();throw new ij(iB.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}}return new lO(s,i)}function Sz(e,t,r,n,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new ij(iB.INVALID_ARGUMENT,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new ij(iB.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!cw(e)&&-1!==l.indexOf("/"))throw new ij(iB.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(i7.fromString(l));if(!st.isDocumentKey(r))throw new ij(iB.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new st(r);o.push(lp(t,i))}else{let e=Sh(r,n,l);o.push(e)}}return new lO(o,s)}function Sq(e,t,r){if("string"==typeof(r=eI(r))){if(""===r)throw new ij(iB.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!cw(t)&&-1!==r.indexOf("/"))throw new ij(iB.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(i7.fromString(r));if(!st.isDocumentKey(n))throw new ij(iB.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return lp(e,new st(n))}if(r instanceof bL)return lp(e,r._key);throw new ij(iB.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${so(r)}.`)}function S$(e,t){if(!Array.isArray(e)||0===e.length)throw new ij(iB.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function SG(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function SK(e,t){let r=SH(e.filters,SG(t.op));if(null!==r)if(r===t.op)throw new ij(iB.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`);else throw new ij(iB.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}function SW(e,t){let r=e;for(let e of t.getFlattenedFilters())SK(r,e),r=ck(r,e)}function SH(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}class SQ{convertValue(e,t="none"){switch(oQ(e)){case 0:return null;case 1:return e.booleanValue;case 2:return o_(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(oI(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw iP(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return oa(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){var t,r,n;return new b4(null==(n=null==(r=null==(t=e.fields)?void 0:t[oW].arrayValue)?void 0:r.values)?void 0:n.map(e=>o_(e.doubleValue)))}convertGeoPoint(e){return new b6(o_(e.latitude),o_(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=oO(e);if(null==r)return null;return this.convertValue(r,t);case"estimate":return this.convertTimestamp(oP(e));default:return null}}convertTimestamp(e){let t=oC(e);return new sf(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=i7.fromString(e);iL(hp(r),9688,{name:e});let n=new oF(r.get(1),r.get(3)),i=new st(r.popFirst(5));return n.isEqual(t)||iA(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function SY(e,t,r){let n;return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class SJ extends SQ{constructor(e){super(),this.firestore=e}convertBytes(e){return new b1(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new bL(this.firestore,null,t)}}function SX(e){return SZ(e,["next","error","complete"])}function SZ(e,t){if("object"!=typeof e||null===e)return!1;let r=e;for(let e of t)if(e in r&&"function"==typeof r[e])return!0;return!1}let S0=iJ();function S1(e){let t=JSON.stringify(e),r=S0.encode(t).byteLength;return`${r}${t}`}S1({metadata:{id:"test-bundle",createTime:{seconds:0x5e0be105,nanos:6},version:1,totalDocuments:1,totalBytes:416}}),S1({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",readTime:{seconds:5,nanos:6},exists:!0}}),S1({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value"},bar:{integerValue:-42}}}}),S1({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",readTime:{seconds:5,nanos:6},exists:!0}}),S1({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value1"},bar:{integerValue:42},emptyArray:{arrayValue:{}},emptyMap:{mapValue:{}}}}}),S1({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/nodoc",readTime:{seconds:5,nanos:6},exists:!1}}),S1({namedQuery:{name:"limitQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"DESCENDING"}],limit:{value:1}},limitType:"FIRST"},readTime:{seconds:0x5ec5a5f3,nanos:191164e3}}}),S1({namedQuery:{name:"limitToLastQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"ASCENDING"}],limit:{value:1}},limitType:"LAST"},readTime:{seconds:0x5ec5a5f3,nanos:543063e3}}});let S2=1;class S3{constructor(e,t){this.firestore=e,this.bundleId=t,this.documents=new Map,this.namedQueries=new Map,this.latestReadTime=new sf(0,0),this.databaseId=e._databaseId,this.serializer=new dn(this.databaseId,!0),this.userDataReader=new St(this.databaseId,!0,this.serializer)}addBundleDocument(e,t){let r=this.documents.get(e.documentPath),n=null==r?void 0:r.metadata.queries,i=e.readTime,s=(null==r?void 0:r.metadata.readTime)?dc(r.metadata.readTime):null,a=!i&&null==s,o=void 0!==i&&(null==s||s<i);if((a||o)&&this.documents.set(e.documentPath,{document:this.toBundleDocument(e),metadata:{name:dy(this.serializer,e.documentKey),readTime:i?dl(this.serializer,i):void 0,exists:e.documentExists}}),i&&i>this.latestReadTime&&(this.latestReadTime=i),t){let r=this.documents.get(e.documentPath);r.metadata.queries=n||[],r.metadata.queries.push(t)}}addBundleQuery(e){if(this.namedQueries.has(e.name))throw Error(`Query name conflict: ${name} has already been added.`);let t=new sf(0,0);for(let r of e.docBundleDataArray)this.addBundleDocument(r,e.name),r.readTime&&r.readTime>t&&(t=r.readTime);let r=dq(this.serializer,c_(e.query)),n={parent:e.parent,structuredQuery:r.queryTarget.structuredQuery};this.namedQueries.set(e.name,{name:e.name,bundledQuery:n,readTime:dl(this.serializer,t)})}toBundleDocument(e){let t=this.userDataReader.createContext(4,"internal toBundledDocument"),r=Sf(e.documentData,t);return{name:dy(this.serializer,e.documentKey),fields:r.mapValue.fields,updateTime:dl(this.serializer,e.versionTime),createTime:dl(this.serializer,e.createdTime)}}lengthPrefixedString(e){let t=JSON.stringify(e),r=S0.encode(t).byteLength;return`${r}${t}`}build(){let e="";for(let t of this.namedQueries.values())e+=this.lengthPrefixedString({namedQuery:t});for(let t of this.documents.values()){let r=t.metadata;e+=this.lengthPrefixedString({documentMetadata:r});let n=t.document;n&&(e+=this.lengthPrefixedString({document:n}))}let t={id:this.bundleId,createTime:dl(this.serializer,this.latestReadTime),version:S2,totalDocuments:this.documents.size,totalBytes:S0.encode(e).length};return this.lengthPrefixedString({metadata:t})+e}}function S6(e,t,r,n){let i=new S3(e,iZ.newId());return i.addBundleDocument(S5(n,r,t)),i.build()}function S4(e,t,r,n,i,s,a){let o=[];for(let e=0;e<s.length;e++)o.push(S5(i[e],a[e],s[e]));let l={name:r,query:t,parent:n,docBundleDataArray:o},c=new S3(e,r);return c.addBundleQuery(l),c.build()}function S5(e,t,r){return{documentData:t,documentKey:r.mutableCopy().key,documentPath:e,documentExists:!0,createdTime:r.createTime.toTimestamp(),readTime:r.readTime.toTimestamp(),versionTime:r.version.toTimestamp()}}class S8{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class S7 extends SI{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);{let t=new S9(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}}}get(e,t={}){if(this._document){let r=this._document.data.field(Sk("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new ij(iB.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};if(t.type=S7._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument())return t;let r=this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous");return t.bundle=S6(this._firestore,e,r,this.ref.path),t}}S7._jsonSchemaVersion="firestore/documentSnapshot/1.0",S7._jsonSchema={type:su("string",S7._jsonSchemaVersion),bundleSource:su("string","DocumentSnapshot"),bundleName:su("string"),bundle:su("string")};class S9 extends S7{data(e={}){return super.data(e)}}class Te{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new S8(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new S9(this._firestore,this._userDataWriter,r.key,r,new S8(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new ij(iB.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=Tt(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new ij(iB.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=Te._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=iZ.newId();let t=this._firestore._databaseId.database,r=this._firestore._databaseId.projectId,n=`projects/${r}/databases/${t}/documents`,i=[],s=[],a=[];return this.docs.forEach(e=>{null!==e._document&&(i.push(e._document),s.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),a.push(e.ref.path))}),e.bundle=S4(this._firestore,this.query._query,e.bundleName,n,a,i,s),e}}function Tt(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new S9(e._firestore,e._userDataWriter,r.doc.key,r.doc,new S8(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new S9(e._firestore,e._userDataWriter,t.doc.key,t.doc,new S8(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:Tr(t.type),doc:n,oldIndex:i,newIndex:s}})}}function Tr(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return iP(61501,{type:e})}}Te._jsonSchemaVersion="firestore/querySnapshot/1.0",Te._jsonSchema={type:su("string",Te._jsonSchemaVersion),bundleSource:su("string","QuerySnapshot"),bundleName:su("string"),bundle:su("string")};class Tn extends SQ{constructor(e){super(),this.firestore=e}convertBytes(e){return new b1(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new bL(this.firestore,null,t)}}function Ti(e,t,r,...n){let i;e=sc(e,bL);let s=sc(e.firestore,b$),a=Sr(s);return Tl(s,[(i="string"==typeof(t=eI(t))||t instanceof b2?Sd(a,"updateDoc",e._key,t,r,n):Su(a,"updateDoc",e._key,t)).toMutation(e._key,uy.exists(!0))])}function Ts(e){return Tl(sc(e.firestore,b$),[new uP(e._key,uy.none())])}function Ta(e,t){let r=sc(e.firestore,b$),n=bj(e),i=SY(e.converter,t);return Tl(r,[Sn(Sr(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,uy.exists(!1))]).then(()=>n)}function To(e,...t){var r,n,i;let s,a,o;e=eI(e);let l={includeMetadataChanges:!1,source:"default"},c=0;"object"!=typeof t[0]||SX(t[c])||(l=t[c++]);let u={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(SX(t[c])){let e=t[c];t[c]=null==(r=e.next)?void 0:r.bind(e),t[c+1]=null==(n=e.error)?void 0:n.bind(e),t[c+2]=null==(i=e.complete)?void 0:i.bind(e)}if(e instanceof bL)a=sc(e.firestore,b$),o=cv(e._key.path),s={next:r=>{t[c]&&t[c](Tc(a,e,r))},error:t[c+1],complete:t[c+2]};else{let r=sc(e,bM);a=sc(r.firestore,b$),o=r._query;let n=new Tn(a);s={next:e=>{t[c]&&t[c](new Te(a,n,r,e))},error:t[c+1],complete:t[c+2]},SN(e._query)}return bc(bK(a),o,u,s)}function Tl(e,t){return bd(bK(e),t)}function Tc(e,t,r){let n=r.docs.get(t._key),i=new Tn(e);return new S7(e,i,t._key,n,new S8(r.hasPendingWrites,r.fromCache),t.converter)}function Tu(e,t,r){return new b0(t,new Tn(e),r)}class Td{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=v$.provider,this._offlineComponentProvider={build:t=>new vz(t,null==e?void 0:e.cacheSizeBytes,this.forceOwnership)}}}function Th(e){return new Td(null==e?void 0:e.forceOwnership)}function Tp(e,t){if((e=eI(e)).firestore===t)return e;throw new ij(iB.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.")}class Tf{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Sr(e)}get(e){let t=Tp(e,this._firestore),r=new SJ(this._firestore);return this._transaction.lookup([t._key]).then(e=>{if(!e||1!==e.length)return iP(24041);let n=e[0];if(n.isFoundDocument())return new SI(this._firestore,r,n.key,n,t.converter);if(n.isNoDocument())return new SI(this._firestore,r,t._key,null,t.converter);throw iP(18433,{doc:n})})}set(e,t,r){let n=Tp(e,this._firestore),i=SY(n.converter,t,r),s=Sn(this._dataReader,"Transaction.set",n._key,i,null!==n.converter,r);return this._transaction.set(n._key,s),this}update(e,t,r,...n){let i,s=Tp(e,this._firestore);return i="string"==typeof(t=eI(t))||t instanceof b2?Sd(this._dataReader,"Transaction.update",s._key,t,r,n):Su(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,i),this}delete(e){let t=Tp(e,this._firestore);return this._transaction.delete(t._key),this}}function Tm(e){try{return JSON.parse(e)}catch(e){throw new ij(iB.INVALID_ARGUMENT,"Failed to parse JSON: "+(null==e?void 0:e.message))}}function Tg(e,t){if("string"!=typeof e[t])throw new ij(iB.INVALID_ARGUMENT,"Missing string value for: "+t);return e[t]}new WeakMap;class Ty{constructor(){this.existenceFilterMismatchCallbacksById=new Map}static get instance(){return Tv||uW(Tv=new Ty),Tv}notifyOnExistenceFilterMismatch(e){this.existenceFilterMismatchCallbacksById.forEach(t=>t(e))}onExistenceFilterMismatch(e){let t=Symbol(),r=this.existenceFilterMismatchCallbacksById;return r.set(t,e),()=>r.delete(t)}}let Tv=null;bJ("node");let Tb=({onSubmit:e,onClose:t})=>{let[r,n]=(0,d.useState)({name:"",description:""}),i=()=>{r.name.trim()&&(e(r),n({name:"",description:""}))};return(0,u.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,u.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[(0,u.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Create New Group"}),(0,u.jsxs)("div",{children:[(0,u.jsxs)("div",{className:"mb-4",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Group Name"}),(0,u.jsx)("input",{type:"text",value:r.name,onChange:e=>n({...r,name:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"e.g., Weekend Trip, Flatmates"})]}),(0,u.jsxs)("div",{className:"mb-6",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description (Optional)"}),(0,u.jsx)("textarea",{value:r.description,onChange:e=>n({...r,description:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-y",placeholder:"Brief description of the group",rows:3})]}),(0,u.jsxs)("div",{className:"flex space-x-3",children:[(0,u.jsx)("button",{onClick:i,className:"flex-1 bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-lg transition-colors",children:"Create Group"}),(0,u.jsx)("button",{onClick:t,className:"flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg transition-colors",children:"Cancel"})]})]})]})})},TS=({onSubmit:e,onClose:t})=>{let[r,n]=(0,d.useState)({name:"",email:""}),i=()=>{r.name.trim()&&r.email.trim()&&(e(r),n({name:"",email:""}))};return(0,u.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,u.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-md",children:[(0,u.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add Member"}),(0,u.jsxs)("div",{children:[(0,u.jsxs)("div",{className:"mb-4",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Name"}),(0,u.jsx)("input",{type:"text",value:r.name,onChange:e=>n({...r,name:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Member's name"})]}),(0,u.jsxs)("div",{className:"mb-6",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),(0,u.jsx)("input",{type:"email",value:r.email,onChange:e=>n({...r,email:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"Member's email (optional)"})]}),(0,u.jsxs)("div",{className:"flex space-x-3",children:[(0,u.jsx)("button",{onClick:i,className:"flex-1 bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-lg transition-colors",children:"Add Member"}),(0,u.jsx)("button",{onClick:t,className:"flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg transition-colors",children:"Cancel"})]})]})]})})},TT=({members:e,expense:t,onSubmit:r,onClose:n})=>{let[i,s]=(0,d.useState)({description:t?.description||"",amount:t?.amount||"",paidBy:t?.paidBy||e[0]?.id||"",splitWith:t?.splitWith||e.map(e=>e.id),splitType:t?.splitType||"equal",date:t?.date||new Date().toISOString().split("T")[0],category:t?.category||""});(0,d.useEffect)(()=>{if(e.length>0){i.paidBy&&e.some(e=>e.id===i.paidBy)||s(t=>({...t,paidBy:e[0].id}));let t=i.splitWith.filter(t=>e.some(e=>e.id===t));t.length!==i.splitWith.length&&s(e=>({...e,splitWith:t}))}},[e,i.paidBy,i.splitWith]);let a=e=>{s({...i,splitWith:i.splitWith.includes(e)?i.splitWith.filter(t=>t!==e):[...i.splitWith,e]})},o=()=>{i.description.trim()&&i.amount&&i.splitWith.length>0&&r(i)};return(0,u.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,u.jsxs)("div",{className:"bg-white rounded-xl p-6 w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[(0,u.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:t?"Edit Expense":"Add Expense"}),(0,u.jsxs)("div",{children:[(0,u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[(0,u.jsxs)("div",{className:"md:col-span-2",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,u.jsx)("input",{type:"text",value:i.description,onChange:e=>s({...i,description:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"What was this expense for?"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount ($)"}),(0,u.jsx)("input",{type:"number",step:"0.01",value:i.amount,onChange:e=>s({...i,amount:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",placeholder:"0.00"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Date"}),(0,u.jsx)("input",{type:"date",value:i.date,onChange:e=>s({...i,date:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Paid By"}),(0,u.jsx)("select",{value:i.paidBy,onChange:e=>s({...i,paidBy:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:e.map(e=>(0,u.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,u.jsxs)("div",{children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),(0,u.jsxs)("select",{value:i.category,onChange:e=>s({...i,category:e.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,u.jsx)("option",{value:"",children:"Select category..."}),(0,u.jsx)("option",{value:"Food",children:"Food"}),(0,u.jsx)("option",{value:"Accommodation",children:"Accommodation"}),(0,u.jsx)("option",{value:"Transportation",children:"Transportation"}),(0,u.jsx)("option",{value:"Entertainment",children:"Entertainment"}),(0,u.jsx)("option",{value:"Utilities",children:"Utilities"}),(0,u.jsx)("option",{value:"Other",children:"Other"})]})]})]}),(0,u.jsxs)("div",{className:"mb-4",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Split With"}),(0,u.jsx)("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:e.map(e=>(0,u.jsxs)("label",{className:"flex items-center space-x-3 p-2 rounded-lg hover:bg-gray-50",children:[(0,u.jsx)("input",{type:"checkbox",checked:i.splitWith.includes(e.id),onChange:()=>a(e.id),className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),(0,u.jsx)("span",{className:"text-gray-900",children:e.name})]},e.id))})]}),(0,u.jsxs)("div",{className:"flex space-x-3",children:[(0,u.jsx)("button",{onClick:o,className:"flex-1 bg-indigo-600 hover:bg-indigo-700 text-white py-2 px-4 rounded-lg transition-colors",children:t?"Update Expense":"Add Expense"}),(0,u.jsx)("button",{onClick:n,className:"flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg transition-colors",children:"Cancel"})]})]})]})})},TE=()=>{let[e,t]=(0,d.useState)([]),[r,n]=(0,d.useState)(null),[i,s]=(0,d.useState)(!1),[a,o]=(0,d.useState)(!1),[l,c]=(0,d.useState)(!1),[h,p]=(0,d.useState)(null),[f,m]=(0,d.useState)(null),[g,y]=(0,d.useState)(null),[v,b]=(0,d.useState)(null),[x,k]=(0,d.useState)(!0),[N,R]=(0,d.useState)(null);(0,d.useEffect)(()=>{try{let e={apiKey:"AIzaSyAse2I0D2TlfyXXzhoHTraG5R6QEphllVE",authDomain:"spliy-expense-app.firebaseapp.com",projectId:"spliy-expense-app",storageBucket:"spliy-expense-app.firebasestorage.app",messagingSenderId:"530776942195",appId:"1:530776942195:web:5838e23c250d5e721e2c06",measurementId:"G-9ZCE53653E"};if(!Object.keys(e).length||!e.apiKey){R("Firebase configuration is missing or incomplete. Please check the hardcoded values."),k(!1);return}let t=tm(e),r=bG(t),n=il(t);m(r),y(n);let i=n4(n,async e=>{if(e)b(e.uid),k(!1);else try{await nG(n)}catch(e){console.error("Firebase authentication error:",e),R(`Authentication failed: ${e.message}`),k(!1)}});return()=>i()}catch(e){console.error("Error initializing Firebase:",e),R(`Firebase initialization failed: ${e.message}`),k(!1)}},[]),(0,d.useEffect)(()=>{if(!f||!v)return;k(!0);let e="spliy-expense-app",i=To(bB(f,`artifacts/${e}/public/data/groups`),e=>{let i=e.docs.map(e=>({id:e.id,...e.data()}));if(t(i),!r&&i.length>0)n(i[0]);else if(r){let e=i.find(e=>e.id===r.id);e?n(e):n(null)}k(!1)},e=>{console.error("Error fetching groups:",e),R(`Failed to load groups: ${e.message}`),k(!1)});return()=>i()},[f,v,r?.id]),(0,d.useEffect)(()=>{if(!f||!r?.id)return void n(e=>e?{...e,members:[],expenses:[]}:null);let e="spliy-expense-app",t=bj(f,`artifacts/${e}/public/data/groups`,r.id),i=bB(t,"members"),s=bB(t,"expenses"),a=To(i,e=>{let t=e.docs.map(e=>({id:e.id,...e.data()}));n(e=>({...e,members:t}))},e=>{console.error("Error fetching members:",e),R(`Failed to load members: ${e.message}`)}),o=To(s,e=>{let t=e.docs.map(e=>({id:e.id,...e.data()}));n(e=>({...e,expenses:t}))},e=>{console.error("Error fetching expenses:",e),R(`Failed to load expenses: ${e.message}`)});return()=>{a(),o()}},[f,r?.id]);let A=async e=>{if(f&&v)try{k(!0);let t="spliy-expense-app",r=bB(f,`artifacts/${t}/public/data/groups`),n=await Ta(r,{name:e.name,description:e.description,createdAt:new Date().toISOString(),createdBy:v}),i=bB(n,"members");await Ta(i,{name:`User ${v.substring(0,5)}`,email:"",userId:v}),s(!1),k(!1)}catch(e){console.error("Error creating group:",e),R(`Failed to create group: ${e.message}`),k(!1)}},D=async e=>{if(f&&r?.id)try{k(!0);let t="spliy-expense-app",n=bB(f,`artifacts/${t}/public/data/groups/${r.id}/members`);await Ta(n,{name:e.name,email:e.email}),c(!1),k(!1)}catch(e){console.error("Error adding member:",e),R(`Failed to add member: ${e.message}`),k(!1)}},O=async e=>{if(f&&r?.id)try{k(!0);let t="spliy-expense-app",n=bj(f,`artifacts/${t}/public/data/groups/${r.id}/members`,e);await Ts(n),k(!1)}catch(e){console.error("Error removing member:",e),R(`Failed to remove member: ${e.message}`),k(!1)}},P=async e=>{if(f&&r?.id)try{k(!0);let t="spliy-expense-app",n=bB(f,`artifacts/${t}/public/data/groups/${r.id}/expenses`);await Ta(n,{description:e.description,amount:parseFloat(e.amount),paidBy:e.paidBy,splitType:e.splitType,splitWith:e.splitWith,date:e.date,category:e.category,createdAt:new Date().toISOString(),createdBy:v}),o(!1),k(!1)}catch(e){console.error("Error adding expense:",e),R(`Failed to add expense: ${e.message}`),k(!1)}},M=async e=>{if(f&&r?.id&&h?.id)try{k(!0);let t="spliy-expense-app",n=bj(f,`artifacts/${t}/public/data/groups/${r.id}/expenses`,h.id);await Ti(n,{description:e.description,amount:parseFloat(e.amount),paidBy:e.paidBy,splitType:e.splitType,splitWith:e.splitWith,date:e.date,category:e.category}),p(null),k(!1)}catch(e){console.error("Error updating expense:",e),R(`Failed to update expense: ${e.message}`),k(!1)}},L=async e=>{if(f&&r?.id)try{k(!0);let t="spliy-expense-app",n=bj(f,`artifacts/${t}/public/data/groups/${r.id}/expenses`,e);await Ts(n),k(!1)}catch(e){console.error("Error deleting expense:",e),R(`Failed to delete expense: ${e.message}`),k(!1)}},F=(0,d.useCallback)(()=>{if(!r||!r.members||!r.expenses)return[];let e={};return r.members.forEach(t=>{e[t.id]={name:t.name,balance:0,paid:0,owes:0}}),r.expenses.forEach(t=>{let{paidBy:r,amount:n,splitWith:i,splitType:s}=t;e[r]&&(e[r].paid+=n);let a=0;"equal"===s?a=n/i.length:"custom"===s&&(a=n/i.length),i.forEach(t=>{e[t]&&(e[t].owes+=a,e[t].balance=e[t].paid-e[t].owes)})}),Object.values(e)},[r]),B=(0,d.useCallback)(()=>{let e=F(),t=e.filter(e=>e.balance>.01).sort((e,t)=>t.balance-e.balance),r=e.filter(e=>e.balance<-.01).sort((e,t)=>e.balance-t.balance),n=[],i=0,s=0;for(;i<t.length&&s<r.length;){let e=t[i],a=r[s],o=Math.min(e.balance,-a.balance);o>.01&&n.push({from:a.name,to:e.name,amount:o.toFixed(2)}),e.balance-=o,a.balance+=o,e.balance<.01&&i++,a.balance>-.01&&s++}return n},[F]),j=(0,d.useCallback)(e=>{let t=r?.members.find(t=>t.id===e);return t?t.name:"Unknown"},[r?.members]);return x?(0,u.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100",children:(0,u.jsx)("div",{className:"text-indigo-600 text-xl font-semibold",children:"Loading Expense System..."})}):N?(0,u.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-red-50",children:(0,u.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-lg text-red-700",children:[(0,u.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Error:"}),(0,u.jsx)("p",{children:N}),(0,u.jsx)("p",{className:"text-sm mt-2",children:"Please ensure Firebase is correctly configured and your network is stable."})]})}):(0,u.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 font-inter",children:(0,u.jsxs)("div",{className:"max-w-6xl mx-auto",children:[(0,u.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-6 mb-6",children:[(0,u.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,u.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,u.jsx)("div",{className:"p-3 bg-indigo-100 rounded-full",children:(0,u.jsx)(S,{className:"h-8 w-8 text-indigo-600"})}),(0,u.jsxs)("div",{children:[(0,u.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Expense Splitter"}),(0,u.jsx)("p",{className:"text-gray-600",children:"Split bills fairly among friends"})]})]}),(0,u.jsxs)("button",{onClick:()=>s(!0),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors",children:[(0,u.jsx)(T,{className:"h-5 w-5"}),(0,u.jsx)("span",{children:"New Group"})]})]}),v&&(0,u.jsxs)("div",{className:"mb-4 text-sm text-gray-700 bg-gray-100 p-3 rounded-lg flex items-center justify-between",children:[(0,u.jsxs)("span",{children:["Your User ID: ",(0,u.jsx)("span",{className:"font-mono font-semibold text-indigo-700 break-all",children:v})]}),(0,u.jsx)("span",{className:"text-xs text-gray-500 ml-2",children:"(Share this ID for group identification)"})]}),(0,u.jsxs)("div",{className:"mb-6",children:[(0,u.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Group"}),(0,u.jsxs)("select",{value:r?.id||"",onChange:t=>n(e.find(e=>e.id===t.target.value)),className:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",children:[(0,u.jsx)("option",{value:"",children:"Choose a group..."}),e.map(e=>(0,u.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),r?(0,u.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,u.jsxs)("div",{className:"space-y-6",children:[(0,u.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[(0,u.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,u.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,u.jsx)(E,{className:"h-5 w-5 text-indigo-600"}),(0,u.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Members"})]}),(0,u.jsx)("button",{onClick:()=>c(!0),className:"bg-green-600 hover:bg-green-700 text-white p-2 rounded-lg transition-colors",children:(0,u.jsx)(w,{className:"h-4 w-4"})})]}),(0,u.jsx)("div",{className:"space-y-3",children:r.members&&r.members.length>0?r.members.map(e=>(0,u.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("div",{className:"font-medium text-gray-900",children:e.name}),(0,u.jsx)("div",{className:"text-sm text-gray-600",children:e.email})]}),(0,u.jsx)("button",{onClick:()=>O(e.id),className:"text-red-600 hover:text-red-800 p-1",children:(0,u.jsx)(C,{className:"h-4 w-4"})})]},e.id)):(0,u.jsx)("div",{className:"text-center text-gray-500 py-4",children:"No members yet. Add some!"})})]}),(0,u.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[(0,u.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,u.jsx)(_,{className:"h-5 w-5 text-indigo-600"}),(0,u.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Balances"})]}),(0,u.jsx)("div",{className:"space-y-3",children:F().map((e,t)=>(0,u.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,u.jsx)("span",{className:"font-medium text-gray-900",children:e.name}),(0,u.jsxs)("span",{className:`font-bold ${e.balance>=0?"text-green-600":"text-red-600"}`,children:["$",Math.abs(e.balance).toFixed(2)," ",e.balance>=0?"gets back":"owes"]})]},t))})]}),(0,u.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[(0,u.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Suggested Settlements"}),(0,u.jsxs)("div",{className:"space-y-3",children:[B().map((e,t)=>(0,u.jsx)("div",{className:"p-3 bg-blue-50 rounded-lg border-l-4 border-blue-400",children:(0,u.jsxs)("div",{className:"text-sm text-gray-900",children:[(0,u.jsx)("span",{className:"font-medium",children:e.from})," owes"," ",(0,u.jsx)("span",{className:"font-medium",children:e.to})," ",(0,u.jsxs)("span",{className:"font-bold text-blue-600",children:["$",e.amount]})]})},t)),0===B().length&&(0,u.jsx)("div",{className:"text-center text-gray-500 py-4",children:"All settled up! \uD83C\uDF89"})]})]})]}),(0,u.jsx)("div",{className:"lg:col-span-2",children:(0,u.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[(0,u.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,u.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Expenses"}),(0,u.jsxs)("button",{onClick:()=>o(!0),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors",children:[(0,u.jsx)(T,{className:"h-5 w-5"}),(0,u.jsx)("span",{children:"Add Expense"})]})]}),(0,u.jsx)("div",{className:"space-y-4",children:r.expenses&&r.expenses.length>0?r.expenses.map(e=>(0,u.jsx)("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:(0,u.jsx)("div",{className:"flex items-center justify-between",children:(0,u.jsxs)("div",{className:"flex-1",children:[(0,u.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,u.jsx)("h3",{className:"font-semibold text-gray-900",children:e.description}),(0,u.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,u.jsx)("button",{onClick:()=>p(e),className:"text-blue-600 hover:text-blue-800 p-1",children:(0,u.jsx)(I,{className:"h-4 w-4"})}),(0,u.jsx)("button",{onClick:()=>L(e.id),className:"text-red-600 hover:text-red-800 p-1",children:(0,u.jsx)(C,{className:"h-4 w-4"})})]})]}),(0,u.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-600 mb-2",children:[(0,u.jsxs)("span",{children:["Paid by: ",(0,u.jsx)("span",{className:"font-medium",children:j(e.paidBy)})]}),(0,u.jsxs)("span",{className:"font-bold text-lg text-gray-900",children:["$",e.amount.toFixed(2)]})]}),(0,u.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[(0,u.jsxs)("span",{children:["Split with: ",e.splitWith.map(e=>j(e)).join(", ")]}),(0,u.jsx)("span",{children:e.date})]}),e.category&&(0,u.jsx)("span",{className:"inline-block mt-2 px-2 py-1 bg-indigo-100 text-indigo-800 text-xs rounded-full",children:e.category})]})})},e.id)):(0,u.jsx)("div",{className:"text-center text-gray-500 py-8",children:"No expenses yet. Add your first expense to get started!"})})]})})]}):(0,u.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 text-center text-gray-600",children:[(0,u.jsx)("p",{className:"mb-4",children:"Select an existing group or create a new one to start tracking expenses."}),(0,u.jsxs)("button",{onClick:()=>s(!0),className:"bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors mx-auto",children:[(0,u.jsx)(T,{className:"h-5 w-5"}),(0,u.jsx)("span",{children:"Create New Group"})]})]}),i&&(0,u.jsx)(Tb,{onSubmit:A,onClose:()=>s(!1)}),l&&r&&(0,u.jsx)(TS,{onSubmit:D,onClose:()=>c(!1)}),(a||h)&&(0,u.jsx)(TT,{members:r?.members||[],expense:h,onSubmit:h?M:P,onClose:()=>{o(!1),p(null)}})]})})};function Tw(){return(0,u.jsx)(TE,{})}},3122:(e,t)=>{"use strict";var r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=t.Propagate=t.LogVerbosity=t.Status=void 0,function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(r||(t.Status=r={})),function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.NONE=3]="NONE"}(n||(t.LogVerbosity=n={})),function(e){e[e.DEADLINE=1]="DEADLINE",e[e.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",e[e.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",e[e.CANCELLATION=8]="CANCELLATION",e[e.DEFAULTS=65535]="DEFAULTS"}(i||(t.Propagate=i={})),t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},3127:e=>{"use strict";function t(e){return"undefined"!=typeof Float32Array?!function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function s(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function o(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:s,e.writeFloatBE=n?s:i,e.readFloatLE=n?a:o,e.readFloatBE=n?o:a}():!function(){function t(e,t,r,n){var i=+(t<0);if(i&&(t=-t),0===t)e(1/t>0?0:0x80000000,r,n);else if(isNaN(t))e(0x7fc00000,r,n);else if(t>34028234663852886e22)e((i<<31|0x7f800000)>>>0,r,n);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var s=Math.floor(Math.log(t)/Math.LN2),a=8388607&Math.round(t*Math.pow(2,-s)*8388608);e((i<<31|s+127<<23|a)>>>0,r,n)}}function a(e,t,r){var n=e(t,r),i=(n>>31)*2+1,s=n>>>23&255,a=8388607&n;return 255===s?a?NaN:1/0*i:0===s?1401298464324817e-60*i*a:i*Math.pow(2,s-150)*(a+8388608)}e.writeFloatLE=t.bind(null,r),e.writeFloatBE=t.bind(null,n),e.readFloatLE=a.bind(null,i),e.readFloatBE=a.bind(null,s)}(),"undefined"!=typeof Float64Array?!function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function s(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function o(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:s,e.writeDoubleBE=n?s:i,e.readDoubleLE=n?a:o,e.readDoubleBE=n?o:a}():!function(){function t(e,t,r,n,i,s){var a,o=+(n<0);if(o&&(n=-n),0===n)e(0,i,s+t),e(1/n>0?0:0x80000000,i,s+r);else if(isNaN(n))e(0,i,s+t),e(0x7ff80000,i,s+r);else if(n>17976931348623157e292)e(0,i,s+t),e((o<<31|0x7ff00000)>>>0,i,s+r);else if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,i,s+t),e((o<<31|a/0x100000000)>>>0,i,s+r);else{var l=Math.floor(Math.log(n)/Math.LN2);1024===l&&(l=1023),e(0x10000000000000*(a=n*Math.pow(2,-l))>>>0,i,s+t),e((o<<31|l+1023<<20|1048576*a&1048575)>>>0,i,s+r)}}function a(e,t,r,n,i){var s=e(n,i+t),a=e(n,i+r),o=(a>>31)*2+1,l=a>>>20&2047,c=0x100000000*(1048575&a)+s;return 2047===l?c?NaN:1/0*o:0===l?5e-324*o*c:o*Math.pow(2,l-1075)*(c+0x10000000000000)}e.writeDoubleLE=t.bind(null,r,0,4),e.writeDoubleBE=t.bind(null,n,4,0),e.readDoubleLE=a.bind(null,i,0,4),e.readDoubleBE=a.bind(null,s,4,0)}(),e}function r(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function n(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function i(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},3232:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelImplementation=void 0;let n=r(6551),i=r(8436);class s{constructor(e,t,r){if("string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof n.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(r&&"object"!=typeof r)throw TypeError("Channel options must be an object");this.internalChannel=new i.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,n,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,n,i)}}t.ChannelImplementation=s},3267:(e,t,r)=>{"use strict";e.exports=c;var n,i=r(4824);((c.prototype=Object.create(i.prototype)).constructor=c).className="Field";var s=r(2110),a=r(1810),o=r(3107),l=/^required|optional|repeated$/;function c(e,t,r,n,s,c,u){if(o.isObject(n)?(u=s,c=n,n=s=void 0):o.isObject(s)&&(u=c,c=s,s=void 0),i.call(this,e,c),!o.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!o.isString(r))throw TypeError("type must be a string");if(void 0!==n&&!l.test(n=n.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==s&&!o.isString(s))throw TypeError("extend must be a string");"proto3_optional"===n&&(n="optional"),this.rule=n&&"optional"!==n?n:void 0,this.type=r,this.id=t,this.extend=s||void 0,this.repeated="repeated"===n,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!o.Long&&void 0!==a.long[r],this.bytes="bytes"===r,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=u}c.fromJSON=function(e,t){var r=new c(e,t.id,t.type,t.rule,t.extend,t.options,t.comment);return t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},Object.defineProperty(c.prototype,"required",{get:function(){return"LEGACY_REQUIRED"===this._features.field_presence}}),Object.defineProperty(c.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(c.prototype,"delimited",{get:function(){return this.resolvedType instanceof n&&"DELIMITED"===this._features.message_encoding}}),Object.defineProperty(c.prototype,"packed",{get:function(){return"PACKED"===this._features.repeated_field_encoding}}),Object.defineProperty(c.prototype,"hasPresence",{get:function(){return!this.repeated&&!this.map&&(this.partOf||this.declaringField||this.extensionField||"IMPLICIT"!==this._features.field_presence)}}),c.prototype.setOption=function(e,t,r){return i.prototype.setOption.call(this,e,t,r)},c.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return o.toObject(["edition",this._editionToJSON(),"rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},c.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=a.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof n?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof s&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof s||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=o.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;o.base64.test(this.typeDefault)?o.base64.decode(this.typeDefault,e=o.newBuffer(o.base64.length(this.typeDefault)),0):o.utf8.write(this.typeDefault,e=o.newBuffer(o.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=o.emptyObject:this.repeated?this.defaultValue=o.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof n&&(this.parent.ctor.prototype[this.name]=this.defaultValue),i.prototype.resolve.call(this)},c.prototype._inferLegacyProtoFeatures=function(e){if("proto2"!==e&&"proto3"!==e)return{};var t={};if("required"===this.rule&&(t.field_presence="LEGACY_REQUIRED"),this.parent&&void 0===a.defaults[this.type]){var r=this.parent.get(this.type.split(".").pop());r&&r instanceof n&&r.group&&(t.message_encoding="DELIMITED")}return!0===this.getOption("packed")?t.repeated_field_encoding="PACKED":!1===this.getOption("packed")&&(t.repeated_field_encoding="EXPANDED"),t},c.prototype._resolveFeatures=function(e){return i.prototype._resolveFeatures.call(this,this._edition||e)},c.d=function(e,t,r,n){return"function"==typeof t?t=o.decorateType(t).name:t&&"object"==typeof t&&(t=o.decorateEnum(t).name),function(i,s){o.decorateType(i.constructor).add(new c(s,e,t,r,{default:n}))}},c._configure=function(e){n=e}},3273:e=>{"use strict";e.exports=function e(e,t,r){var n=r||8192,i=n>>>1,s=null,a=n;return function(r){if(r<1||r>i)return e(r);a+r>n&&(s=e(n),a=0);var o=t.call(s,a,a+=r);return 7&a&&(a=(7|a)+1),o}}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3322:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=void 0;let n=r(8605);class i{constructor(e,t,r){let n;this.listener=t,this.addresses=[],this.hasReturnedResult=!1,n=""===e.authority?"/"+e.path:e.path,this.addresses=[{path:n}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}}t.setup=function(){(0,n.registerResolver)("unix",i)}},3496:e=>{"use strict";e.exports=require("http2")},3695:(e,t,r)=>{"use strict";var n=t,i=r(8920);n[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),r=this.lookup(t);if(r){var n="."===e["@type"].charAt(0)?e["@type"].slice(1):e["@type"];return -1===n.indexOf("/")&&(n="/"+n),this.create({type_url:n,value:r.encode(r.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){var r="type.googleapis.com/",n="",s="";if(t&&t.json&&e.type_url&&e.value){s=e.type_url.substring(e.type_url.lastIndexOf("/")+1),n=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var a=this.lookup(s);a&&(e=a.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof i){var o=e.$type.toObject(e,t),l="."===e.$type.fullName[0]?e.$type.fullName.slice(1):e.$type.fullName;return""===n&&(n=r),s=n+l,o["@type"]=s,o}return this.toObject(e,t)}}},3801:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OutlierDetectionLoadBalancingConfig=t.BaseSubchannelWrapper=t.registerAdminService=t.FilterStackFactory=t.BaseFilter=t.PickResultType=t.QueuePicker=t.UnavailablePicker=t.ChildLoadBalancerHandler=t.subchannelAddressToString=t.validateLoadBalancingConfig=t.getFirstUsableConfig=t.registerLoadBalancerType=t.createChildChannelControlHelper=t.BackoffTimeout=t.durationToMs=t.uriToString=t.createResolver=t.registerResolver=t.log=t.trace=void 0;var n=r(3038);Object.defineProperty(t,"trace",{enumerable:!0,get:function(){return n.trace}}),Object.defineProperty(t,"log",{enumerable:!0,get:function(){return n.log}});var i=r(8605);Object.defineProperty(t,"registerResolver",{enumerable:!0,get:function(){return i.registerResolver}}),Object.defineProperty(t,"createResolver",{enumerable:!0,get:function(){return i.createResolver}});var s=r(7213);Object.defineProperty(t,"uriToString",{enumerable:!0,get:function(){return s.uriToString}});var a=r(155);Object.defineProperty(t,"durationToMs",{enumerable:!0,get:function(){return a.durationToMs}});var o=r(6693);Object.defineProperty(t,"BackoffTimeout",{enumerable:!0,get:function(){return o.BackoffTimeout}});var l=r(598);Object.defineProperty(t,"createChildChannelControlHelper",{enumerable:!0,get:function(){return l.createChildChannelControlHelper}}),Object.defineProperty(t,"registerLoadBalancerType",{enumerable:!0,get:function(){return l.registerLoadBalancerType}}),Object.defineProperty(t,"getFirstUsableConfig",{enumerable:!0,get:function(){return l.getFirstUsableConfig}}),Object.defineProperty(t,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return l.validateLoadBalancingConfig}});var c=r(8387);Object.defineProperty(t,"subchannelAddressToString",{enumerable:!0,get:function(){return c.subchannelAddressToString}});var u=r(4976);Object.defineProperty(t,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return u.ChildLoadBalancerHandler}});var d=r(757);Object.defineProperty(t,"UnavailablePicker",{enumerable:!0,get:function(){return d.UnavailablePicker}}),Object.defineProperty(t,"QueuePicker",{enumerable:!0,get:function(){return d.QueuePicker}}),Object.defineProperty(t,"PickResultType",{enumerable:!0,get:function(){return d.PickResultType}});var h=r(653);Object.defineProperty(t,"BaseFilter",{enumerable:!0,get:function(){return h.BaseFilter}});var p=r(7988);Object.defineProperty(t,"FilterStackFactory",{enumerable:!0,get:function(){return p.FilterStackFactory}});var f=r(9780);Object.defineProperty(t,"registerAdminService",{enumerable:!0,get:function(){return f.registerAdminService}});var m=r(8880);Object.defineProperty(t,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return m.BaseSubchannelWrapper}});var g=r(4189);Object.defineProperty(t,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return g.OutlierDetectionLoadBalancingConfig}})},3865:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadPackageDefinition=t.makeClientConstructor=void 0;let n=r(300),i={unary:n.Client.prototype.makeUnaryRequest,server_stream:n.Client.prototype.makeServerStreamRequest,client_stream:n.Client.prototype.makeClientStreamRequest,bidi:n.Client.prototype.makeBidiStreamRequest};function s(e){return["__proto__","prototype","constructor"].includes(e)}function a(e,t,r){r||(r={});class a extends n.Client{}return Object.keys(e).forEach(t=>{let r;if(s(t))return;let n=e[t];if("string"==typeof t&&"$"===t.charAt(0))throw Error("Method names cannot start with $");r=n.requestStream?n.responseStream?"bidi":"client_stream":n.responseStream?"server_stream":"unary";let l=n.requestSerialize,c=n.responseDeserialize,u=o(i[r],n.path,l,c);a.prototype[t]=u,Object.assign(a.prototype[t],n),n.originalName&&!s(n.originalName)&&(a.prototype[n.originalName]=a.prototype[t])}),a.service=e,a.serviceName=t,a}function o(e,t,r,n){return function(...i){return e.call(this,t,r,n,...i)}}function l(e){return"format"in e}t.makeClientConstructor=a,t.loadPackageDefinition=function(e){let t={};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let n=e[r],i=r.split(".");if(i.some(e=>s(e)))continue;let o=i[i.length-1],c=t;for(let e of i.slice(0,-1))c[e]||(c[e]={}),c=c[e];l(n)?c[o]=n:c[o]=a(n,o,{})}return t}},3873:e=>{"use strict";e.exports=require("path")},3908:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.restrictControlPlaneStatusCode=void 0;let n=r(3122),i=[n.Status.OK,n.Status.INVALID_ARGUMENT,n.Status.NOT_FOUND,n.Status.ALREADY_EXISTS,n.Status.FAILED_PRECONDITION,n.Status.ABORTED,n.Status.OUT_OF_RANGE,n.Status.DATA_LOSS];t.restrictControlPlaneStatusCode=function(e,t){return i.includes(e)?{code:n.Status.INTERNAL,details:`Invalid status from control plane: ${e} ${n.Status[e]} ${t}`}:{code:e,details:t}}},4075:e=>{"use strict";e.exports=require("zlib")},4189:(e,t,r)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.OutlierDetectionLoadBalancer=t.OutlierDetectionLoadBalancingConfig=void 0;let i=r(920),s=r(3122),a=r(155),o=r(3801),l=r(598),c=r(4976),u=r(757),d=r(8387),h=r(8880),p=r(3038),f="outlier_detection";function m(e){p.trace(s.LogVerbosity.DEBUG,f,e)}let g="outlier_detection",y=(null!=(n=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)?n:"true")==="true",v={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},b={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function S(e,t,r,n){if(t in e&&typeof e[t]!==r){let i=n?`${n}.${t}`:t;throw Error(`outlier detection config ${i} parse error: expected ${r}, got ${typeof e[t]}`)}}function T(e,t,r){let n=r?`${r}.${t}`:t;if(t in e){if(!(0,a.isDuration)(e[t]))throw Error(`outlier detection config ${n} parse error: expected Duration, got ${typeof e[t]}`);if(!(e[t].seconds>=0&&e[t].seconds<=315576e6&&e[t].nanos>=0&&e[t].nanos<=0x3b9ac9ff))throw Error(`outlier detection config ${n} parse error: values out of range for non-negative Duaration`)}}function E(e,t,r){let n=r?`${r}.${t}`:t;if(S(e,t,"number",r),t in e&&!(e[t]>=0&&e[t]<=100))throw Error(`outlier detection config ${n} parse error: value out of range for percentage (0-100)`)}class w{constructor(e,t,r,n,i,s,a){if(this.childPolicy=a,a.length>0&&"pick_first"===a[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=e?e:1e4,this.baseEjectionTimeMs=null!=t?t:3e4,this.maxEjectionTimeMs=null!=r?r:3e5,this.maxEjectionPercent=null!=n?n:10,this.successRateEjection=i?Object.assign(Object.assign({},v),i):null,this.failurePercentageEjection=s?Object.assign(Object.assign({},b),s):null}getLoadBalancerName(){return g}toJsonObject(){return{interval:(0,a.msToDuration)(this.intervalMs),base_ejection_time:(0,a.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,a.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new w(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(T(e,"interval"),T(e,"base_ejection_time"),T(e,"max_ejection_time"),E(e,"max_ejection_percent"),"success_rate_ejection"in e){if("object"!=typeof e.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");S(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),E(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),S(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),S(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if("object"!=typeof e.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");E(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),E(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),S(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),S(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new w(e.interval?(0,a.durationToMs)(e.interval):null,e.base_ejection_time?(0,a.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,a.durationToMs)(e.max_ejection_time):null,null!=(t=e.max_ejection_percent)?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(l.validateLoadBalancingConfig))}}t.OutlierDetectionLoadBalancingConfig=w;class C extends h.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((e,t,r,n)=>{if(this.childSubchannelState=r,!this.ejected)for(let e of this.stateListeners)e(this,t,r,n)})}getConnectivityState(){return this.ejected?i.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){for(let e of(this.ejected=!0,this.stateListeners))e(this,this.childSubchannelState,i.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let e of(this.ejected=!1,this.stateListeners))e(this,i.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function _(){return{success:0,failure:0}}class I{constructor(){this.activeBucket=_(),this.inactiveBucket=_()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=_()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class x{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType!==u.PickResultType.COMPLETE)return t;{let e=t.subchannel,r=e.getMapEntry();if(!r)return Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel()});{let n=t.onCallEnded;return this.countCalls&&(n=e=>{var n;e===s.Status.OK?r.counter.addSuccess():r.counter.addFailure(),null==(n=t.onCallEnded)||n.call(t,e)}),Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel(),onCallEnded:n})}}}}class k{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new c.ChildLoadBalancerHandler((0,o.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let n=e.createSubchannel(t,r),i=this.addressMap.get((0,d.subchannelAddressToString)(t)),s=new C(n,i);return(null==i?void 0:i.currentEjectionTimestamp)!==null&&s.eject(),null==i||i.subchannelWrappers.push(s),s},updateState:(t,r)=>{t===i.ConnectivityState.READY?e.updateState(t,new x(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())null!==t.currentEjectionTimestamp&&(e+=1);return 100*e/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;m("Running success rate check");let r=t.request_volume,n=0,i=[];for(let[e,t]of this.addressMap){let s=t.counter.getLastSuccesses(),a=t.counter.getLastFailures();m("Stats for "+e+": successes="+s+" failures="+a+" targetRequestVolume="+r),s+a>=r&&(n+=1,i.push(s/(s+a)))}if(m("Found "+n+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+i+"]"),n<t.minimum_hosts)return;let s=i.reduce((e,t)=>e+t)/i.length,a=0;for(let e of i){let t=e-s;a+=t*t}let o=Math.sqrt(a/i.length),l=s-o*(t.stdev_factor/1e3);for(let[n,i]of(m("stdev="+o+" ejectionThreshold="+l),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let s=i.counter.getLastSuccesses(),a=i.counter.getLastFailures();if(s+a<r)continue;let o=s/(s+a);if(m("Checking candidate "+n+" successRate="+o),o<l){let r=100*Math.random();m("Candidate "+n+" randomNumber="+r+" enforcement_percentage="+t.enforcement_percentage),r<t.enforcement_percentage&&(m("Ejecting candidate "+n),this.eject(i,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;m("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let e of this.addressMap.values())e.counter.getLastSuccesses()+e.counter.getLastFailures()>=t.request_volume&&(r+=1);if(!(r<t.minimum_hosts))for(let[r,n]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let i=n.counter.getLastSuccesses(),s=n.counter.getLastFailures();if((m("Candidate successes="+i+" failures="+s),!(i+s<t.request_volume))&&100*s/(s+i)>t.threshold){let i=100*Math.random();m("Candidate "+r+" randomNumber="+i+" enforcement_percentage="+t.enforcement_percentage),i<t.enforcement_percentage&&(m("Ejecting candidate "+r),this.eject(n,e))}}}eject(e,t){for(let t of(e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1,e.subchannelWrappers))t.eject()}uneject(e){for(let t of(e.currentEjectionTimestamp=null,e.subchannelWrappers))t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),null==(r=(t=this.ejectionTimer).unref)||r.call(t)}runChecks(){let e=new Date;if(m("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[t,r]of(this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e),this.addressMap.entries()))if(null===r.currentEjectionTimestamp)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let e=this.latestConfig.getBaseEjectionTimeMs(),n=this.latestConfig.getMaxEjectionTimeMs(),i=new Date(r.currentEjectionTimestamp.getTime());i.setMilliseconds(i.getMilliseconds()+Math.min(e*r.ejectionTimeMultiplier,Math.max(e,n))),i<new Date&&(m("Unejecting "+t),this.uneject(r))}}updateAddressList(e,t,r){if(!(t instanceof w))return;let n=new Set;for(let t of e)n.add((0,d.subchannelAddressToString)(t));for(let e of n)this.addressMap.has(e)||(m("Adding map entry for "+e),this.addressMap.set(e,{counter:new I,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let e of this.addressMap.keys())n.has(e)||(m("Removing map entry for "+e),this.addressMap.delete(e));let i=(0,l.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,i,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){m("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let e=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(e)}else m("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else for(let e of(m("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(e),e.ejectionTimeMultiplier=0;this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return g}}t.OutlierDetectionLoadBalancer=k,t.setup=function(){y&&(0,o.registerLoadBalancerType)(g,k,w)}},4231:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=void 0;let n=r(1645),i=r(3122),s=r(9978),a=r(8605),o=r(7213),l=r(3038),c="ip_resolver";function u(e){l.trace(i.LogVerbosity.DEBUG,c,e)}let d="ipv4",h="ipv6",p=443;class f{constructor(e,t,r){var a;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,u("Resolver constructed for target "+(0,o.uriToString)(e));let l=[];if(e.scheme!==d&&e.scheme!==h){this.error={code:i.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new s.Metadata};return}for(let t of e.path.split(",")){let r=(0,o.splitHostPort)(t);if(null===r||e.scheme===d&&!(0,n.isIPv4)(r.host)||e.scheme===h&&!(0,n.isIPv6)(r.host)){this.error={code:i.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${t}`,metadata:new s.Metadata};return}l.push({host:r.host,port:null!=(a=r.port)?a:p})}this.addresses=l,u("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}}t.setup=function(){(0,a.registerResolver)(d,f),(0,a.registerResolver)(h,f)}},4346:e=>{"use strict";e.exports=n;var t,r=/\/|\./;function n(e,t){r.test(e)||(e="google/protobuf/"+e+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),n[e]=t}n("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),n("duration",{Duration:t={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),n("timestamp",{Timestamp:t}),n("empty",{Empty:{fields:{}}}),n("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),n("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),n("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),n.get=function(e){return n[e]||null}},4351:(e,t,r)=>{"use strict";e.exports=v;var n=r(7968);((v.prototype=Object.create(n.prototype)).constructor=v).className="Type";var i=r(2110),s=r(2630),a=r(3267),o=r(5585),l=r(3076),c=r(8920),u=r(6996),d=r(6120),h=r(3107),p=r(847),f=r(2823),m=r(6973),g=r(7659),y=r(3695);function v(e,t){n.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function b(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(v.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var r=this.fields[e[t]],n=r.id;if(this._fieldsById[n])throw Error("duplicate id "+n+" in "+this);this._fieldsById[n]=r}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=h.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=h.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=v.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof c||((e.prototype=new c).constructor=e,h.merge(e.prototype,t)),e.$type=e.prototype.$type=this,h.merge(e,c,!0),this._ctor=e;for(var r=0;r<this.fieldsArray.length;++r)this._fieldsArray[r].resolve();var n={};for(r=0;r<this.oneofsArray.length;++r)n[this._oneofsArray[r].resolve().name]={get:h.oneOfGetter(this._oneofsArray[r].oneof),set:h.oneOfSetter(this._oneofsArray[r].oneof)};r&&Object.defineProperties(e.prototype,n)}}}),v.generateConstructor=function(e){for(var t,r=h.codegen(["p"],e.name),n=0;n<e.fieldsArray.length;++n)(t=e._fieldsArray[n]).map?r("this%s={}",h.safeProp(t.name)):t.repeated&&r("this%s=[]",h.safeProp(t.name));return r("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},v.fromJSON=function(e,t){var r=new v(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var c=Object.keys(t.fields),u=0;u<c.length;++u)r.add((void 0!==t.fields[c[u]].keyType?o.fromJSON:a.fromJSON)(c[u],t.fields[c[u]]));if(t.oneofs)for(c=Object.keys(t.oneofs),u=0;u<c.length;++u)r.add(s.fromJSON(c[u],t.oneofs[c[u]]));if(t.nested)for(c=Object.keys(t.nested),u=0;u<c.length;++u){var d=t.nested[c[u]];r.add((void 0!==d.id?a.fromJSON:void 0!==d.fields?v.fromJSON:void 0!==d.values?i.fromJSON:void 0!==d.methods?l.fromJSON:n.fromJSON)(c[u],d))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},v.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return h.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"oneofs",n.arrayToJSON(this.oneofsArray,e),"fields",n.arrayToJSON(this.fieldsArray.filter(function(e){return!e.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},v.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;n.prototype.resolveAll.call(this);var e=this.oneofsArray;for(r=0;r<e.length;)e[r++].resolve();for(var t=this.fieldsArray,r=0;r<t.length;)t[r++].resolve();return this},v.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(e=this._edition||e,n.prototype._resolveFeaturesRecursive.call(this,e),this.oneofsArray.forEach(t=>{t._resolveFeatures(e)}),this.fieldsArray.forEach(t=>{t._resolveFeatures(e)})),this},v.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},v.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof a&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),b(this)}return e instanceof s?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),b(this)):n.prototype.add.call(this,e)},v.prototype.remove=function(e){if(e instanceof a&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),b(this)}if(e instanceof s){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),b(this)}return n.prototype.remove.call(this,e)},v.prototype.isReservedId=function(e){return n.isReservedId(this.reserved,e)},v.prototype.isReservedName=function(e){return n.isReservedName(this.reserved,e)},v.prototype.create=function(e){return new this.ctor(e)},v.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=p(this)({Writer:d,types:t,util:h}),this.decode=f(this)({Reader:u,types:t,util:h}),this.verify=m(this)({types:t,util:h}),this.fromObject=g.fromObject(this)({types:t,util:h}),this.toObject=g.toObject(this)({types:t,util:h});var n=y[e];if(n){var i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=n.fromObject.bind(i),i.toObject=this.toObject,this.toObject=n.toObject.bind(i)}return this},v.prototype.encode=function(e,t){return this.setup().encode(e,t)},v.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},v.prototype.decode=function(e,t){return this.setup().decode(e,t)},v.prototype.decodeDelimited=function(e){return e instanceof u||(e=u.create(e)),this.decode(e,e.uint32())},v.prototype.verify=function(e){return this.setup().verify(e)},v.prototype.fromObject=function(e){return this.setup().fromObject(e)},v.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},v.d=function(e){return function(t){h.decorateType(t,e)}}},4369:(e,t,r)=>{"use strict";e.exports=s;var n=r(6120);(s.prototype=Object.create(n.prototype)).constructor=s;var i=r(8707);function s(){n.call(this)}function a(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(a,t,e),this},s._configure()},4431:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s,metadata:()=>i});var n=r(7413);r(1135);let i={title:"Expensee Splitter",description:"Split bills fairly among friends"};function s({children:e}){return(0,n.jsx)("html",{lang:"en",children:(0,n.jsx)("body",{children:e})})}},4553:e=>{"use strict";function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},t.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},4631:e=>{"use strict";e.exports=require("tls")},4679:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deadlineToString=t.getRelativeTimeout=t.getDeadlineTimeoutString=t.minDeadline=void 0,t.minDeadline=function(...e){let t=1/0;for(let r of e){let e=r instanceof Date?r.getTime():r;e<t&&(t=e)}return t};let r=[["m",1],["S",1e3],["M",6e4],["H",36e5]];t.getDeadlineTimeoutString=function(e){let t=new Date().getTime();e instanceof Date&&(e=e.getTime());let n=Math.max(e-t,0);for(let[e,t]of r){let r=n/t;if(r<1e8)return String(Math.ceil(r))+e}throw Error("Deadline is too far in the future")};let n=0x7fffffff;t.getRelativeTimeout=function(e){let t=(e instanceof Date?e.getTime():e)-new Date().getTime();return t<0?0:t>n?1/0:t},t.deadlineToString=function(e){if(e instanceof Date)return e.toISOString();{let t=new Date(e);return Number.isNaN(t.getTime())?""+e:t.toISOString()}}},4735:e=>{"use strict";e.exports=require("events")},4778:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RetryingCall=t.MessageBufferTracker=t.RetryThrottler=void 0;let n=r(3122),i=r(9978),s=r(3038),a="retrying_call";class o{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}t.RetryThrottler=o;class l{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let n=null!=(r=this.allocatedPerCall.get(t))?r:0;return!(this.limitPerCall-n<e)&&!(this.totalLimit-this.totalAllocated<e)&&(this.allocatedPerCall.set(t,n+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let n=null!=(r=this.allocatedPerCall.get(t))?r:0;if(n<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${n}`);this.allocatedPerCall.set(t,n-e)}freeAll(e){var t;let r=null!=(t=this.allocatedPerCall.get(e))?t:0;if(this.totalAllocated<r)throw Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}}t.MessageBufferTracker=l;let c="grpc-previous-rpc-attempts";class u{constructor(e,t,r,n,i,s,a,o,l){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=n,this.credentials=i,this.deadline=s,this.callNumber=a,this.bufferTracker=o,this.retryThrottler=l,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let e=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(e.initialBackoff.substring(0,e.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){s.trace(n.LogVerbosity.DEBUG,a,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;null==(t=this.listener)||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){for(let{call:r}of(this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new i.Metadata}),this.underlyingCalls))r.cancelWithStatus(e,t)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return null!=(t=this.writeBuffer[e-this.writeBufferOffset])?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let e=this.getBufferEntry(t);e.allocated&&this.bufferTracker.free(e.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[e].state){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&"COMPLETED"!==this.underlyingCalls[t].state&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(n.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let e=-1,t=-1;for(let[r,n]of this.underlyingCalls.entries())"ACTIVE"===n.state&&n.nextMessageToSend>e&&(e=n.nextMessageToSend,t=r);-1===t?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(e=>e===t||e.toString().toLowerCase()===n.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=null==(e=this.callConfig)?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,n=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,n),r}maybeRetryCall(e,t){let r;if("RETRY"!==this.state)return void t(!1);let n=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(n.maxAttempts,5))return void t(!1);if(null===e)r=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else r=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var e,r;if("RETRY"!==this.state)return void t(!1);(null==(r=null==(e=this.retryThrottler)?void 0:e.canRetryCall())||r)&&(t(!0),this.attempts+=1,this.startNewAttempt())},r)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)(null==t?void 0:t.state)==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var n,i,s;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList(null!=(n=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)?n:[],e.code)){let n;if(null==(i=this.retryThrottler)||i.addCallFailed(),null===r)n=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else n=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(t),this.reportStatus(e))},n)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?(null==(s=this.retryThrottler)||s.addCallFailed(),this.maybeRetryCall(r,r=>{r||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e))}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(0===t.length)return null;try{return parseInt(t[0])}catch(e){return -1}}handleChildStatus(e,t){var r;if("COMPLETED"===this.underlyingCalls[t].state)return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===n.Status.OK){null==(r=this.retryThrottler)||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if("COMMITTED"===this.state)return void this.reportStatus(e);let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let n=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(n.maxAttempts,5))return;let i=null!=(e=n.hedgingDelay)?e:"0s",s=Number(i.substring(0,i.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*s),null==(r=(t=this.hedgingTimer).unref)||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,n=this.initialMetadata.clone();r>0&&n.set(c,`${r}`);let i=!1;e.start(n,{onReceiveMetadata:n=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),i=!0,r>0&&n.set(c,`${r}`),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMetadata(n)},onReceiveMessage:r=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMessage(r)},onReceiveStatus:n=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!i&&r>0&&n.metadata.set(c,`${r}`),this.handleChildStatus(n,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let n=this.underlyingCalls[e],i=n.nextMessageToSend;null==(r=(t=this.getBufferEntry(i)).callback)||r.call(t),this.clearSentMessages(),n.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if("COMPLETED"!==t.state&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:t=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose()}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let n={message:t,flags:e.flags},i=this.getNextBufferIndex(),s={entryType:"MESSAGE",message:n,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(s),s.allocated)for(let[n,s]of(null==(r=e.callback)||r.call(e),this.underlyingCalls.entries()))"ACTIVE"===s.state&&s.nextMessageToSend===i&&s.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(n)}},t);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let r=this.underlyingCalls[this.committedCallIndex];s.callback=e.callback,"ACTIVE"===r.state&&r.nextMessageToSend===i&&r.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){for(let e of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==e?void 0:e.state)==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();for(let t of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==t?void 0:t.state)==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}t.RetryingCall=u},4824:(e,t,r)=>{"use strict";e.exports=c,c.className="ReflectionObject";let n=r(2630);var i,s=r(3107),a={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},o={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},l={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function c(e,t){if(!s.isString(e))throw TypeError("name must be a string");if(t&&!s.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(c.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),c.prototype.toJSON=function(){throw Error()},c.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof i&&t._handleAdd(this)},c.prototype.onRemove=function(e){var t=e.root;t instanceof i&&t._handleRemove(this),this.parent=null,this.resolved=!1},c.prototype.resolve=function(){return this.resolved||this.root instanceof i&&(this.resolved=!0),this},c.prototype._resolveFeaturesRecursive=function(e){return this._resolveFeatures(this._edition||e)},c.prototype._resolveFeatures=function(e){if(!this._featuresResolved){var t={};if(!e)throw Error("Unknown edition for "+this.fullName);var r=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(e));if(this._edition){if("proto2"===e)t=Object.assign({},o);else if("proto3"===e)t=Object.assign({},l);else if("2023"===e)t=Object.assign({},a);else throw Error("Unknown edition: "+e);this._features=Object.assign(t,r||{}),this._featuresResolved=!0;return}if(this.partOf instanceof n){var i=Object.assign({},this.partOf._features);this._features=Object.assign(i,r||{})}else if(this.declaringField);else if(this.parent){var s=Object.assign({},this.parent._features);this._features=Object.assign(s,r||{})}else throw Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}},c.prototype._inferLegacyProtoFeatures=function(){return{}},c.prototype.getOption=function(e){if(this.options)return this.options[e]},c.prototype.setOption=function(e,t,r){return this.options||(this.options={}),/^features\./.test(e)?s.setProperty(this.options,e,t,r):r&&void 0!==this.options[e]||(this.getOption(e)!==t&&(this.resolved=!1),this.options[e]=t),this},c.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var n=this.parsedOptions;if(r){var i=n.find(function(t){return Object.prototype.hasOwnProperty.call(t,e)});if(i){var a=i[e];s.setProperty(a,r,t)}else(i={})[e]=s.setProperty({},r,t),n.push(i)}else{var o={};o[e]=t,n.push(o)}return this},c.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),n=0;n<r.length;++n)this.setOption(r[n],e[r[n]],t);return this},c.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},c.prototype._editionToJSON=function(){if(this._edition&&"proto3"!==this._edition)return this._edition},c._configure=function(e){i=e}},4976:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChildLoadBalancerHandler=void 0;let n=r(598),i=r(920),s="child_load_balancer_helper";class a{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(e){this.parent=e,this.child=null}createSubchannel(e,t){return this.parent.channelControlHelper.createSubchannel(e,t)}updateState(e,t){var r;if(this.calledByPendingChild()){if(e===i.ConnectivityState.CONNECTING)return;null==(r=this.parent.currentChild)||r.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(e,t)}requestReresolution(){var e;let t=null!=(e=this.parent.pendingChild)?e:this.parent.currentChild;this.child===t&&this.parent.channelControlHelper.requestReresolution()}setChild(e){this.child=e}addChannelzChild(e){this.parent.channelControlHelper.addChannelzChild(e)}removeChannelzChild(e){this.parent.channelControlHelper.removeChannelzChild(e)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let e=new this.ChildPolicyHelper(this),r=(0,n.createLoadBalancer)(t,e);e.setChild(r),null===this.currentChild?(this.currentChild=r,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=r,i=this.pendingChild)}else i=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return s}}t.ChildLoadBalancerHandler=a},4990:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InterceptingListenerImpl=t.isInterceptingListener=void 0,t.isInterceptingListener=function(e){return void 0!==e.onReceiveMetadata&&1===e.onReceiveMetadata.length};class r{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,e=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(e),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,e=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=e,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(e),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,e=>{this.processingMetadata||this.processingMessage?this.pendingStatus=e:this.nextListener.onReceiveStatus(e)})}}t.InterceptingListenerImpl=r},5108:e=>{"use strict";e.exports=function e(e,t){for(var r=Array(arguments.length-1),n=0,i=2,s=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise(function(i,a){r[n]=function(e){if(s)if(s=!1,e)a(e);else{for(var t=Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(e){s&&(s=!1,a(e))}})}},5251:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>a.a,__next_app__:()=>d,pages:()=>u,routeModule:()=>h,tree:()=>c});var n=r(5239),i=r(8088),s=r(8170),a=r.n(s),o=r(893),l={};for(let e in o)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);r.d(t,l);let c=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,1204)),"/Users/atulya/Desktop/SplitExpense/expensee-splitter/src/app/page.tsx"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,4431)),"/Users/atulya/Desktop/SplitExpense/expensee-splitter/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,7398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,5284,23)),"next/dist/client/components/unauthorized-error"]}],u=["/Users/atulya/Desktop/SplitExpense/expensee-splitter/src/app/page.tsx"],d={require:r,loadChunk:()=>Promise.resolve()},h=new n.AppPageRouteModule({definition:{kind:i.RouteKind.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},5280:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.CompressionAlgorithms=void 0,function(e){e[e.identity=0]="identity",e[e.deflate=1]="deflate",e[e.gzip=2]="gzip"}(r||(t.CompressionAlgorithms=r={}))},5477:(e,t,r)=>{"use strict";var n=t;function i(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=r(6120),n.BufferWriter=r(4369),n.Reader=r(6996),n.BufferReader=r(5677),n.util=r(8707),n.rpc=r(7236),n.roots=r(6642),n.configure=i,i()},5585:(e,t,r)=>{"use strict";e.exports=a;var n=r(3267);((a.prototype=Object.create(n.prototype)).constructor=a).className="MapField";var i=r(1810),s=r(3107);function a(e,t,r,i,a,o){if(n.call(this,e,t,i,void 0,void 0,a,o),!s.isString(r))throw TypeError("keyType must be a string");this.keyType=r,this.resolvedKeyType=null,this.map=!0}a.fromJSON=function(e,t){return new a(e,t.id,t.keyType,t.type,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},a.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return n.prototype.resolve.call(this)},a.d=function(e,t,r){return"function"==typeof r?r=s.decorateType(r).name:r&&"object"==typeof r&&(r=s.decorateEnum(r).name),function(n,i){s.decorateType(n.constructor).add(new a(i,e,t,r))}}},5628:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallCredentials=void 0;let n=r(9978);function i(e){return"getRequestHeaders"in e&&"function"==typeof e.getRequestHeaders}class s{static createFromMetadataGenerator(e){return new o(e)}static createFromGoogleCredential(e){return s.createFromMetadataGenerator((t,r)=>{let s;(s=i(e)?e.getRequestHeaders(t.service_url):new Promise((r,n)=>{e.getRequestMetadata(t.service_url,(e,t)=>e?void n(e):t?void r(t):void n(Error("Headers not set by metadata plugin")))})).then(e=>{let t=new n.Metadata;for(let r of Object.keys(e))t.add(r,e[r]);r(null,t)},e=>{r(e)})})}static createEmpty(){return new l}}t.CallCredentials=s;class a extends s{constructor(e){super(),this.creds=e}async generateMetadata(e){let t=new n.Metadata;for(let r of(await Promise.all(this.creds.map(t=>t.generateMetadata(e)))))t.merge(r);return t}compose(e){return new a(this.creds.concat([e]))}_equals(e){return this===e||e instanceof a&&this.creds.every((t,r)=>t._equals(e.creds[r]))}}class o extends s{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(e,n)=>{void 0!==n?t(n):r(e)})})}compose(e){return new a([this,e])}_equals(e){return this===e||e instanceof o&&this.metadataGenerator===e.metadataGenerator}}class l extends s{generateMetadata(e){return Promise.resolve(new n.Metadata)}compose(e){return e}_equals(e){return e instanceof l}}},5677:(e,t,r)=>{"use strict";e.exports=s;var n=r(6996);(s.prototype=Object.create(n.prototype)).constructor=s;var i=r(8707);function s(e){n.call(this,e)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},5678:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.StreamDecoder=void 0,function(e){e[e.NO_DATA=0]="NO_DATA",e[e.READING_SIZE=1]="READING_SIZE",e[e.READING_MESSAGE=2]="READING_MESSAGE"}(r||(r={}));class n{constructor(e){this.maxReadMessageLength=e,this.readState=r.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t,n=0,i=[];for(;n<e.length;)switch(this.readState){case r.NO_DATA:this.readCompressFlag=e.slice(n,n+1),n+=1,this.readState=r.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case r.READING_SIZE:if(t=Math.min(e.length-n,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,n,n+t),this.readSizeRemaining-=t,n+=t,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),-1!==this.maxReadMessageLength&&this.readMessageSize>this.maxReadMessageLength)throw Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=r.READING_MESSAGE;else{let e=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=r.NO_DATA,i.push(e)}}break;case r.READING_MESSAGE:if(t=Math.min(e.length-n,this.readMessageRemaining),this.readPartialMessage.push(e.slice(n,n+t)),this.readMessageRemaining-=t,n+=t,0===this.readMessageRemaining){let e=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),t=Buffer.concat(e,this.readMessageSize+5);this.readState=r.NO_DATA,i.push(t)}break;default:throw Error("Unexpected read state")}return i}}t.StreamDecoder=n},5920:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,6346,23)),Promise.resolve().then(r.t.bind(r,7924,23)),Promise.resolve().then(r.t.bind(r,5656,23)),Promise.resolve().then(r.t.bind(r,99,23)),Promise.resolve().then(r.t.bind(r,8243,23)),Promise.resolve().then(r.t.bind(r,8827,23)),Promise.resolve().then(r.t.bind(r,2763,23)),Promise.resolve().then(r.t.bind(r,7173,23))},5950:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadBalancingCall=void 0;let n=r(920),i=r(3122),s=r(4679),a=r(9978),o=r(757),l=r(7213),c=r(3038),u=r(3908),d=r(3496),h="load_balancing_call";class p{constructor(e,t,r,n,i,s,a){var o,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=n,this.credentials=i,this.deadline=s,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),d="";u.length>=2&&(d=u[1]);let h=null!=(c=null==(o=(0,l.splitHostPort)(this.host))?void 0:o.host)?c:"localhost";this.serviceUrl=`https://${h}/${d}`}trace(e){c.trace(i.LogVerbosity.DEBUG,h,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,n;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let i=Object.assign(Object.assign({},e),{progress:t});null==(r=this.listener)||r.onReceiveStatus(i),null==(n=this.onCallEnded)||n.call(this,i.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),l=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+o.PickResultType[r.pickResultType]+" subchannel: "+l+" status: "+(null==(e=r.status)?void 0:e.code)+" "+(null==(t=r.status)?void 0:t.details)),r.pickResultType){case o.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(e=>{var t,o,c;if(this.ended)return void this.trace("Credentials metadata generation finished after call ended");let u=this.metadata.clone();if(u.merge(e),u.get("authorization").length>1&&this.outputStatus({code:i.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new a.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==n.ConnectivityState.READY){this.trace("Picked subchannel "+l+" has state "+n.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&u.set("grpc-timeout",(0,s.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(u,this.host,this.methodName,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(e)},onReceiveMessage:e=>{this.trace("Received message"),this.listener.onReceiveMessage(e)},onReceiveStatus:e=>{this.trace("Received status"),e.rstCode===d.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(e,"REFUSED"):this.outputStatus(e,"PROCESSED")}})}catch(e){this.trace("Failed to start call on picked subchannel "+l+" with error "+e.message),this.outputStatus({code:i.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+e.message,metadata:new a.Metadata},"NOT_STARTED");return}null==(o=(t=this.callConfig).onCommitted)||o.call(t),null==(c=r.onCallStarted)||c.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},e=>{let{code:t,details:r}=(0,u.restrictControlPlaneStatusCode)("number"==typeof e.code?e.code:i.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${e.message}`);this.outputStatus({code:t,details:r,metadata:new a.Metadata},"PROCESSED")});break;case o.PickResultType.DROP:let{code:c,details:h}=(0,u.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:c,details:h,metadata:r.status.metadata},"DROP")});break;case o.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:e,details:t}=(0,u.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:e,details:t,metadata:r.status.metadata},"PROCESSED")})}break;case o.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null==(r=this.child)||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new a.Metadata},"PROCESSED")}getPeer(){var e,t;return null!=(t=null==(e=this.child)?void 0:e.getPeer())?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}t.LoadBalancingCall=p},6061:function(e,t){var r;!function(n,i){function s(e){return e.default||e}void 0===(r=(function(){var e={};return i(e),s(e)}).apply(t,[]))||(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function r(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function n(e){return!0===(e&&e.__isLong__)}function i(e){var t=Math.clz32(e&-e);return e?31-t:t}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=n;var s={},a={};function o(e,t){var r,n,i;if(t)return(e>>>=0,(i=0<=e&&e<256)&&(n=a[e]))?n:(r=c(e,0,!0),i&&(a[e]=r),r);return(e|=0,(i=-128<=e&&e<128)&&(n=s[e]))?n:(r=c(e,e<0?-1:0,!1),i&&(s[e]=r),r)}function l(e,t){if(isNaN(e))return t?v:y;if(t){if(e<0)return v;if(e>=f)return w}else{if(e<=-m)return C;if(e+1>=m)return E}return e<0?l(-e,t).neg():c(e%p|0,e/p|0,t)}function c(e,t,n){return new r(e,t,n)}r.fromInt=o,r.fromNumber=l,r.fromBits=c;var u=Math.pow;function d(e,t,r){if(0===e.length)throw Error("empty string");if("number"==typeof t?(r=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?v:y;if((r=r||10)<2||36<r)throw RangeError("radix");if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return d(e.substring(1),t,r).neg();for(var n,i=l(u(r,8)),s=y,a=0;a<e.length;a+=8){var o=Math.min(8,e.length-a),c=parseInt(e.substring(a,a+o),r);if(o<8){var h=l(u(r,o));s=s.mul(h).add(l(c))}else s=(s=s.mul(i)).add(l(c))}return s.unsigned=t,s}function h(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?d(e,t):c(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=d,r.fromValue=h;var p=0x100000000,f=0xffffffffffffffff,m=0x8000000000000000,g=o(0x1000000),y=o(0);r.ZERO=y;var v=o(0,!0);r.UZERO=v;var b=o(1);r.ONE=b;var S=o(1,!0);r.UONE=S;var T=o(-1);r.NEG_ONE=T;var E=c(-1,0x7fffffff,!1);r.MAX_VALUE=E;var w=c(-1,-1,!0);r.MAX_UNSIGNED_VALUE=w;var C=c(0,-0x80000000,!1);r.MIN_VALUE=C;var _=r.prototype;_.toInt=function(){return this.unsigned?this.low>>>0:this.low},_.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},_.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(!this.eq(C))return"-"+this.neg().toString(e);else{var t=l(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}for(var i=l(u(e,6),this.unsigned),s=this,a="";;){var o=s.div(i),c=(s.sub(o.mul(i)).toInt()>>>0).toString(e);if((s=o).isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}},_.getHighBits=function(){return this.high},_.getHighBitsUnsigned=function(){return this.high>>>0},_.getLowBits=function(){return this.low},_.getLowBitsUnsigned=function(){return this.low>>>0},_.getNumBitsAbs=function(){if(this.isNegative())return this.eq(C)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return 0!=this.high?t+33:t+1},_.isSafeInteger=function(){var e=this.high>>21;return!e||!this.unsigned&&-1===e&&(0!==this.low||-2097152!==this.high)},_.isZero=function(){return 0===this.high&&0===this.low},_.eqz=_.isZero,_.isNegative=function(){return!this.unsigned&&this.high<0},_.isPositive=function(){return this.unsigned||this.high>=0},_.isOdd=function(){return(1&this.low)==1},_.isEven=function(){return(1&this.low)==0},_.equals=function(e){return n(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},_.eq=_.equals,_.notEquals=function(e){return!this.eq(e)},_.neq=_.notEquals,_.ne=_.notEquals,_.lessThan=function(e){return 0>this.comp(e)},_.lt=_.lessThan,_.lessThanOrEqual=function(e){return 0>=this.comp(e)},_.lte=_.lessThanOrEqual,_.le=_.lessThanOrEqual,_.greaterThan=function(e){return this.comp(e)>0},_.gt=_.greaterThan,_.greaterThanOrEqual=function(e){return this.comp(e)>=0},_.gte=_.greaterThanOrEqual,_.ge=_.greaterThanOrEqual,_.compare=function(e){if(n(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},_.comp=_.compare,_.negate=function(){return!this.unsigned&&this.eq(C)?C:this.not().add(b)},_.neg=_.negate,_.add=function(e){n(e)||(e=h(e));var t,r,i=this.high>>>16,s=65535&this.high,a=this.low>>>16,o=65535&this.low,l=e.high>>>16,u=65535&e.high,d=e.low>>>16,p=65535&e.low,f=0,m=0;return t=0+((r=0+(o+p))>>>16),r&=65535,t+=a+d,m+=t>>>16,t&=65535,m+=s+u,f+=m>>>16,m&=65535,f+=i+l,c(t<<16|r,(f&=65535)<<16|m,this.unsigned)},_.subtract=function(e){return n(e)||(e=h(e)),this.add(e.neg())},_.sub=_.subtract,_.multiply=function(e){if(this.isZero())return this;if(n(e)||(e=h(e)),t)return c(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return this.unsigned?v:y;if(this.eq(C))return e.isOdd()?C:y;if(e.eq(C))return this.isOdd()?C:y;if(this.isNegative())if(e.isNegative())return this.neg().mul(e.neg());else return this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return l(this.toNumber()*e.toNumber(),this.unsigned);var r,i,s=this.high>>>16,a=65535&this.high,o=this.low>>>16,u=65535&this.low,d=e.high>>>16,p=65535&e.high,f=e.low>>>16,m=65535&e.low,b=0,S=0;return r=0+((i=0+u*m)>>>16),i&=65535,r+=o*m,S+=r>>>16,r&=65535,r+=u*f,S+=r>>>16,r&=65535,S+=a*m,b+=S>>>16,S&=65535,S+=o*f,b+=S>>>16,S&=65535,S+=u*p,b+=S>>>16,S&=65535,b+=s*m+a*f+o*p+u*d,c(r<<16|i,(b&=65535)<<16|S,this.unsigned)},_.mul=_.multiply,_.divide=function(e){if(n(e)||(e=h(e)),e.isZero())throw Error("division by zero");if(t){var r,i,s;return this.unsigned||-0x80000000!==this.high||-1!==e.low||-1!==e.high?c((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?v:y;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return S;s=v}else{if(this.eq(C))if(e.eq(b)||e.eq(T))return C;else return e.eq(C)?b:(r=this.shr(1).div(e).shl(1)).eq(y)?e.isNegative()?b:T:(i=this.sub(e.mul(r)),s=r.add(i.div(e)));if(e.eq(C))return this.unsigned?v:y;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=y}for(i=this;i.gte(e);){for(var a=Math.ceil(Math.log(r=Math.max(1,Math.floor(i.toNumber()/e.toNumber())))/Math.LN2),o=a<=48?1:u(2,a-48),d=l(r),p=d.mul(e);p.isNegative()||p.gt(i);)r-=o,p=(d=l(r,this.unsigned)).mul(e);d.isZero()&&(d=b),s=s.add(d),i=i.sub(p)}return s},_.div=_.divide,_.modulo=function(e){return(n(e)||(e=h(e)),t)?c((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},_.mod=_.modulo,_.rem=_.modulo,_.not=function(){return c(~this.low,~this.high,this.unsigned)},_.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},_.clz=_.countLeadingZeros,_.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},_.ctz=_.countTrailingZeros,_.and=function(e){return n(e)||(e=h(e)),c(this.low&e.low,this.high&e.high,this.unsigned)},_.or=function(e){return n(e)||(e=h(e)),c(this.low|e.low,this.high|e.high,this.unsigned)},_.xor=function(e){return n(e)||(e=h(e)),c(this.low^e.low,this.high^e.high,this.unsigned)},_.shiftLeft=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?c(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):c(0,this.low<<e-32,this.unsigned)},_.shl=_.shiftLeft,_.shiftRight=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):c(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},_.shr=_.shiftRight,_.shiftRightUnsigned=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?c(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):32===e?c(this.high,0,this.unsigned):c(this.high>>>e-32,0,this.unsigned)},_.shru=_.shiftRightUnsigned,_.shr_u=_.shiftRightUnsigned,_.rotateLeft=function(e){var t;return(n(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?c(this.high,this.low,this.unsigned):e<32?(t=32-e,c(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,c(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},_.rotl=_.rotateLeft,_.rotateRight=function(e){var t;return(n(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?c(this.high,this.low,this.unsigned):e<32?(t=32-e,c(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,c(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},_.rotr=_.rotateRight,_.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},_.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},_.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},_.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},_.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},"function"==typeof BigInt&&(r.fromBigInt=function(e,t){return c(Number(BigInt.asIntN(32,e)),Number(BigInt.asIntN(32,e>>BigInt(32))),t)},r.fromValue=function(e,t){return"bigint"==typeof e?r.fromBigInt(e,t):h(e,t)},_.toBigInt=function(){var e=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|e}),e.default=r})},6120:(e,t,r)=>{"use strict";e.exports=d;var n,i=r(8707),s=i.LongBits,a=i.base64,o=i.utf8;function l(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function c(){}function u(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function d(){this.len=0,this.head=new l(c,0,0),this.tail=this.head,this.states=null}var h=function(){return i.Buffer?function(){return(d.create=function(){return new n})()}:function(){return new d}};function p(e,t,r){t[r]=255&e}function f(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}function m(e,t){this.len=e,this.next=void 0,this.val=t}function g(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function y(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}d.create=h(),d.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(d.alloc=i.pool(d.alloc,i.Array.prototype.subarray)),d.prototype._push=function(e,t,r){return this.tail=this.tail.next=new l(e,t,r),this.len+=t,this},m.prototype=Object.create(l.prototype),m.prototype.fn=f,d.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new m((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<0x10000000?4:5,e)).len,this},d.prototype.int32=function(e){return e<0?this._push(g,10,s.fromNumber(e)):this.uint32(e)},d.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},d.prototype.uint64=function(e){var t=s.from(e);return this._push(g,t.length(),t)},d.prototype.int64=d.prototype.uint64,d.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(g,t.length(),t)},d.prototype.bool=function(e){return this._push(p,1,+!!e)},d.prototype.fixed32=function(e){return this._push(y,4,e>>>0)},d.prototype.sfixed32=d.prototype.fixed32,d.prototype.fixed64=function(e){var t=s.from(e);return this._push(y,4,t.lo)._push(y,4,t.hi)},d.prototype.sfixed64=d.prototype.fixed64,d.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},d.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var v=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};d.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(i.isString(e)){var r=d.alloc(t=a.length(e));a.decode(e,r,0),e=r}return this.uint32(t)._push(v,t,e)},d.prototype.string=function(e){var t=o.length(e);return t?this.uint32(t)._push(o.write,t,e):this._push(p,1,0)},d.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new l(c,0,0),this.len=0,this},d.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(c,0,0),this.len=0),this},d.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},d.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},d._configure=function(e){n=e,d.create=h(),n._configure()}},6138:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Type":{"fields":{"name":{"type":"string","id":1},"fields":{"rule":"repeated","type":"Field","id":2},"oneofs":{"rule":"repeated","type":"string","id":3},"options":{"rule":"repeated","type":"Option","id":4},"sourceContext":{"type":"SourceContext","id":5},"syntax":{"type":"Syntax","id":6}}},"Field":{"fields":{"kind":{"type":"Kind","id":1},"cardinality":{"type":"Cardinality","id":2},"number":{"type":"int32","id":3},"name":{"type":"string","id":4},"typeUrl":{"type":"string","id":6},"oneofIndex":{"type":"int32","id":7},"packed":{"type":"bool","id":8},"options":{"rule":"repeated","type":"Option","id":9},"jsonName":{"type":"string","id":10},"defaultValue":{"type":"string","id":11}},"nested":{"Kind":{"values":{"TYPE_UNKNOWN":0,"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Cardinality":{"values":{"CARDINALITY_UNKNOWN":0,"CARDINALITY_OPTIONAL":1,"CARDINALITY_REQUIRED":2,"CARDINALITY_REPEATED":3}}}},"Enum":{"fields":{"name":{"type":"string","id":1},"enumvalue":{"rule":"repeated","type":"EnumValue","id":2},"options":{"rule":"repeated","type":"Option","id":3},"sourceContext":{"type":"SourceContext","id":4},"syntax":{"type":"Syntax","id":5}}},"EnumValue":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"rule":"repeated","type":"Option","id":3}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}},"Any":{"fields":{"type_url":{"type":"string","id":1},"value":{"type":"bytes","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')},6202:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2SubchannelConnector=void 0;let n=r(3496),i=r(4631),s=r(7216),a=r(3122),o=r(7936),l=r(3038),c=r(8605),u=r(8387),d=r(7213),h=r(1645),p=r(7875),f=r(6497),m="transport",g="transport_flowctrl",y=r(6243).rE,{HTTP2_HEADER_AUTHORITY:v,HTTP2_HEADER_CONTENT_TYPE:b,HTTP2_HEADER_METHOD:S,HTTP2_HEADER_PATH:T,HTTP2_HEADER_TE:E,HTTP2_HEADER_USER_AGENT:w}=n.constants,C=2e4,_=Buffer.from("too_many_pings","ascii");class I{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=C,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new s.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,u.subchannelAddressToString)(t),0===r["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,s.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${y}`,r["grpc.secondary_user_agent"]].filter(e=>e).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=1===r["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(e,t,r)=>{let i=!1;e===n.constants.NGHTTP2_ENHANCE_YOUR_CALM&&r&&r.equals(_)&&(i=!0),this.trace("connection closed by GOAWAY with code "+e+" and data "+(null==r?void 0:r.toString())),this.reportDisconnectToOwner(i)}),e.once("error",e=>{this.trace("connection closed with error "+e.message)}),l.isTracerEnabled(m)&&(e.on("remoteSettings",t=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))}),e.on("localSettings",t=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let n,i=this.session.socket,s=i.remoteAddress?(0,u.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,a=i.localAddress?(0,u.stringToSubchannelAddress)(i.localAddress,i.localPort):null;if(this.session.encrypted){let t=i,r=t.getCipher(),s=t.getCertificate(),a=t.getPeerCertificate();n={cipherSuiteStandardName:null!=(e=r.standardName)?e:null,cipherSuiteOtherName:r.standardName?null:r.name,localCertificate:s&&"raw"in s?s.raw:null,remoteCertificate:a&&"raw"in a?a.raw:null}}else n=null;return{remoteAddress:s,localAddress:a,security:n,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(t=this.session.state.localWindowSize)?t:null,remoteFlowControlWindow:null!=(r=this.session.state.remoteWindowSize)?r:null}}trace(e){l.trace(a.LogVerbosity.DEBUG,m,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){l.trace(a.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){l.trace(a.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){l.trace(a.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null==(t=(e=this.keepaliveTimeoutId).unref)||t.call(e));try{this.session.ping((e,t,r)=>{e&&(this.keepaliveTrace("Ping failed with error "+e.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(e){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null==(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),0===this.activeCalls.size&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),1===this.activeCalls.size&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,n,i){let s,a,o,l=e.toHttp2Headers();l[v]=t,l[w]=this.userAgent,l[b]="application/grpc",l[S]="POST",l[T]=r,l[E]="trailers";try{s=this.session.request(l)}catch(e){throw this.handleDisconnect(),e}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),a={addMessageSent:()=>{var e;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null==(e=i.addMessageSent)||e.call(i)},addMessageReceived:()=>{var e;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null==(e=i.addMessageReceived)||e.call(i)},onCallEnd:e=>{var t;null==(t=i.onCallEnd)||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;e?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null==(t=i.onStreamEnd)||t.call(i,e)}}):a={addMessageSent:()=>{var e;null==(e=i.addMessageSent)||e.call(i)},addMessageReceived:()=>{var e;null==(e=i.addMessageReceived)||e.call(i)},onCallEnd:e=>{var t;null==(t=i.onCallEnd)||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;null==(t=i.onStreamEnd)||t.call(i,e)}},o=new p.Http2SubchannelCall(s,a,n,this,(0,f.getNextCallNumber)()),this.addActiveCall(o),o}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,s.unregisterChannelzRef)(this.channelzRef)}}class x{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){l.trace(a.LogVerbosity.DEBUG,m,(0,d.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,s){return this.isShutdown?Promise.reject():new Promise((a,o)=>{var l,p,f;let m;s.realTarget?(m=(0,d.uriToString)(s.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,d.uriToString)(s.realTarget))):(m=null,this.trace("creating HTTP/2 session to "+(0,u.subchannelAddressToString)(e)));let g=(0,c.getDefaultAuthority)(null!=(l=s.realTarget)?l:this.channelTarget),y=t._getConnectionOptions()||{};y.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?y.maxSessionMemory=r["grpc-node.max_session_memory"]:y.maxSessionMemory=Number.MAX_SAFE_INTEGER;let v="http://";if("secureContext"in y){if(v="https://",r["grpc.ssl_target_name_override"]){let e=r["grpc.ssl_target_name_override"];y.checkServerIdentity=(t,r)=>(0,i.checkServerIdentity)(e,r),y.servername=e}else{let e=null!=(f=null==(p=(0,d.splitHostPort)(g))?void 0:p.host)?f:"localhost";y.servername=e}s.socket&&(y.createConnection=(e,t)=>s.socket)}else y.createConnection=(t,r)=>s.socket?s.socket:h.connect(e);y=Object.assign(Object.assign(Object.assign({},y),e),{enableTrace:1===r["grpc-node.tls_enable_trace"]});let b=n.connect(v+g,y);this.session=b;let S="Failed to connect";b.unref(),b.once("connect",()=>{b.removeAllListeners(),a(new I(b,e,r,m)),this.session=null}),b.once("close",()=>{this.session=null,setImmediate(()=>{o(`${S} (${new Date().toISOString()})`)})}),b.once("error",e=>{S=e.message,this.trace("connection failed with error "+S)})})}connect(e,t,r){var n,s;if(this.isShutdown)return Promise.reject();let a=t._getConnectionOptions()||{};if("secureContext"in a){if(a.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let e=r["grpc.ssl_target_name_override"];a.checkServerIdentity=(t,r)=>(0,i.checkServerIdentity)(e,r),a.servername=e}else if("grpc.http_connect_target"in r){let e=(0,c.getDefaultAuthority)(null!=(n=(0,d.parseUri)(r["grpc.http_connect_target"]))?n:{path:"localhost"}),t=(0,d.splitHostPort)(e);a.servername=null!=(s=null==t?void 0:t.host)?s:e}r["grpc-node.tls_enable_trace"]&&(a.enableTrace=!0)}return(0,o.getProxiedConnection)(e,r,a).then(n=>this.createSession(e,t,r,n))}shutdown(){var e;this.isShutdown=!0,null==(e=this.session)||e.close(),this.session=null}}t.Http2SubchannelConnector=x},6243:e=>{"use strict";e.exports={rE:"1.9.15"}},6271:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')},6497:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNextCallNumber=void 0;let r=0;t.getNextCallNumber=function(){return r++}},6551:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelCredentials=void 0;let n=r(4631),i=r(5628),s=r(1866);function a(e,t){if(e&&!(e instanceof Buffer))throw TypeError(`${t}, if provided, must be a Buffer.`)}class o{constructor(e){this.callCredentials=e||i.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var o;if(a(e,"Root certificate"),a(t,"Private key"),a(r,"Certificate chain"),t&&!r)throw Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw Error("Certificate chain must be given with accompanying private key");return new c((0,n.createSecureContext)({ca:null!=(o=null!=e?e:(0,s.getDefaultRootsData)())?o:void 0,key:null!=t?t:void 0,cert:null!=r?r:void 0,ciphers:s.CIPHER_SUITES}),null!=i?i:{})}static createFromSecureContext(e,t){return new c(e,null!=t?t:{})}static createInsecure(){return new l}}t.ChannelCredentials=o;class l extends o{constructor(e){super(e)}compose(e){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof l}}class c extends o{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},(null==t?void 0:t.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){return new u(this,this.callCredentials.compose(e))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e||e instanceof c&&this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity}}class u extends o{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new u(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e||e instanceof u&&this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials)}}},6601:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.PickFirstLoadBalancer=t.shuffled=t.PickFirstLoadBalancingConfig=void 0;let n=r(598),i=r(920),s=r(757),a=r(3038),o=r(3122),l="pick_first";function c(e){a.trace(o.LogVerbosity.DEBUG,l,e)}let u="pick_first",d=250;class h{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return u}toJsonObject(){return{[u]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&"boolean"!=typeof e.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new h(!0===e.shuffleAddressList)}}t.PickFirstLoadBalancingConfig=h;class p{constructor(e){this.subchannel=e}pick(e){return{pickResultType:s.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function f(e){let t=e.slice();for(let e=t.length-1;e>1;e--){let r=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[r],t[r]=n}return t}t.shuffled=f;class m{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=i.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(e,t,r,n,i)=>{this.onSubchannelStateUpdate(e,t,r,i)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(i.ConnectivityState.READY,new p(this.currentPick)):0===this.children.length?this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:e}of(this.stickyTransientFailureMode=!0,this.children))e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,n){var s;if(null==(s=this.currentPick)?void 0:s.realSubchannelEquals(e)){r!==i.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[t,s]of this.children.entries())if(e.realSubchannelEquals(s.subchannel)){r===i.ConnectivityState.READY&&this.pickSubchannel(s.subchannel),r===i.ConnectivityState.TRANSIENT_FAILURE&&(s.hasReportedTransientFailure=!0,n&&(this.lastError=n),this.maybeEnterStickyTransientFailureMode(),t===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(t+1)),s.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let e=r.subchannel.getConnectivityState();if(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.CONNECTING)return void this.startConnecting(t)}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===i.ConnectivityState.IDLE&&(c("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var t;null==(t=this.children[e])||t.subchannel.startConnecting()})),this.connectionDelayTimeout=null==(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},d)).unref)?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(c("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){c(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(e=>({subchannel:this.channelControlHelper.createSubchannel(e,{}),hasReportedTransientFailure:!1}));for(let{subchannel:e}of t)e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef());for(let{subchannel:e}of(this.resetSubchannelList(),this.children=t,this.children))if(e.addConnectivityStateListener(this.subchannelStateListener),e.getConnectivityState()===i.ConnectivityState.READY)return void this.pickSubchannel(e);for(let e of this.children)e.subchannel.getConnectivityState()===i.ConnectivityState.TRANSIENT_FAILURE&&(e.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof h&&(t.getShuffleAddressList()&&(e=f(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===i.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return u}}t.PickFirstLoadBalancer=m,t.setup=function(){(0,n.registerLoadBalancerType)(u,m,h),(0,n.registerDefaultLoadBalancerType)(u)}},6642:e=>{"use strict";e.exports={}},6693:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackoffTimeout=void 0;let r=1e3,n=1.6,i=12e4,s=.2;function a(e,t){return Math.random()*(t-e)+e}class o{constructor(e,t){this.callback=e,this.initialDelay=r,this.multiplier=n,this.maxDelay=i,this.jitter=s,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||null==(r=(t=this.timerId).unref)||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+a(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,null==(t=(e=this.timerId).ref)||t.call(e)}unref(){var e,t;this.hasRef=!1,null==(t=(e=this.timerId).unref)||t.call(e)}getEndTime(){return this.endTime}}t.BackoffTimeout=o},6771:(e,t,r)=>{"use strict";var n=e.exports=r(9374);n.build="full",n.tokenize=r(158),n.parse=r(7408),n.common=r(4346),n.Root._configure(n.Type,n.parse,n.common)},6973:(e,t,r)=>{"use strict";e.exports=l;var n=r(2110),i=r(3107);function s(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function a(e,t,r,i){if(t.resolvedType)if(t.resolvedType instanceof n){e("switch(%s){",i)("default:")("return%j",s(t,"enum value"));for(var a=Object.keys(t.resolvedType.values),o=0;o<a.length;++o)e("case %i:",t.resolvedType.values[a[o]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",r,i)("if(e)")("return%j+e",t.name+".")("}");else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",s(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",s(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",s(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",s(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",s(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",s(t,"buffer"))}return e}function o(e,t,r){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",r)("return%j",s(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",r)("return%j",s(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",r)("return%j",s(t,"boolean key"))}return e}function l(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),r=e.oneofsArray,n={};r.length&&t("var p={}");for(var l=0;l<e.fieldsArray.length;++l){var c=e._fieldsArray[l].resolve(),u="m"+i.safeProp(c.name);if(c.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",u,c.name),c.map)t("if(!util.isObject(%s))",u)("return%j",s(c,"object"))("var k=Object.keys(%s)",u)("for(var i=0;i<k.length;++i){"),o(t,c,"k[i]"),a(t,c,l,u+"[k[i]]")("}");else if(c.repeated)t("if(!Array.isArray(%s))",u)("return%j",s(c,"array"))("for(var i=0;i<%s.length;++i){",u),a(t,c,l,u+"[i]")("}");else{if(c.partOf){var d=i.safeProp(c.partOf.name);1===n[c.partOf.name]&&t("if(p%s===1)",d)("return%j",c.partOf.name+": multiple values"),n[c.partOf.name]=1,t("p%s=1",d)}a(t,c,l,u)}c.optional&&t("}")}return t("return null")}},6984:(e,t,r)=>{"use strict";e.exports=i;var n=r(8707);function i(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!r}(i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,r,i,s,a){if(!s)throw TypeError("request must be specified");var o=this;if(!a)return n.asPromise(e,o,t,r,i,s);if(!o.rpcImpl)return void setTimeout(function(){a(Error("already ended"))},0);try{return o.rpcImpl(t,r[o.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(e,r){if(e)return o.emit("error",e,t),a(e);if(null===r)return void o.end(!0);if(!(r instanceof i))try{r=i[o.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return o.emit("error",e,t),a(e)}return o.emit("data",r,t),a(null,r)})}catch(e){o.emit("error",e,t),setTimeout(function(){a(e)},0);return}},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},6996:(e,t,r)=>{"use strict";e.exports=l;var n,i=r(8707),s=i.LongBits,a=i.utf8;function o(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var c="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")},u=function(){return i.Buffer?function(e){return(l.create=function(e){return i.Buffer.isBuffer(e)?new n(e):c(e)})(e)}:c};function d(){var e=new s(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw o(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw o(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function h(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw o(this,8);return new s(h(this.buf,this.pos+=4),h(this.buf,this.pos+=4))}l.create=u(),l.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,l.prototype.uint32=function(){var e=0xffffffff;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,o(this,10);return e}}(),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw o(this,4);return h(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw o(this,4);return 0|h(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw o(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw o(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw o(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var n=i.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)},l.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw o(this,e);this.pos+=e}else do if(this.pos>=this.len)throw o(this);while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){n=e,l.create=u(),n._configure();var t=i.Long?"toLong":"toNumber";i.merge(l.prototype,{int64:function(){return d.call(this)[t](!1)},uint64:function(){return d.call(this)[t](!0)},sint64:function(){return d.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},7099:e=>{var t=1/0,r="[object Symbol]",n=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,i=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,s="\ud800-\udfff",a="\\u0300-\\u036f\\ufe20-\\ufe23",o="\\u20d0-\\u20f0",l="\\u2700-\\u27bf",c="a-z\\xdf-\\xf6\\xf8-\\xff",u="A-Z\\xc0-\\xd6\\xd8-\\xde",d="\\ufe0e\\ufe0f",h="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",p="[']",f="["+s+"]",m="["+h+"]",g="["+a+o+"]",y="\\d+",v="["+l+"]",b="["+c+"]",S="[^"+s+h+y+l+c+u+"]",T="\ud83c[\udffb-\udfff]",E="[^"+s+"]",w="(?:\ud83c[\udde6-\uddff]){2}",C="[\ud800-\udbff][\udc00-\udfff]",_="["+u+"]",I="\\u200d",x="(?:"+b+"|"+S+")",k="(?:"+_+"|"+S+")",N="(?:"+p+"(?:d|ll|m|re|s|t|ve))?",R="(?:"+p+"(?:D|LL|M|RE|S|T|VE))?",A="(?:"+g+"|"+T+")?",D="["+d+"]?",O="(?:"+I+"(?:"+[E,w,C].join("|")+")"+D+A+")*",P=D+A+O,M="(?:"+[v,w,C].join("|")+")"+P,L="(?:"+[E+g+"?",g,w,C,f].join("|")+")",F=RegExp(p,"g"),B=RegExp(g,"g"),j=RegExp(T+"(?="+T+")|"+L+P,"g"),U=RegExp([_+"?"+b+"+"+N+"(?="+[m,_,"$"].join("|")+")",k+"+"+R+"(?="+[m,_+x,"$"].join("|")+")",_+"?"+x+"+"+N,_+"+"+R,y,M].join("|"),"g"),V=RegExp("["+I+s+a+o+d+"]"),z=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,q={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"ss"},$="object"==typeof global&&global&&global.Object===Object&&global,G="object"==typeof self&&self&&self.Object===Object&&self,K=$||G||Function("return this")();function W(e,t,r,n){var i=-1,s=e?e.length:0;for(n&&s&&(r=e[++i]);++i<s;)r=t(r,e[i],i,e);return r}function H(e){return e.split("")}function Q(e){return e.match(n)||[]}var Y=function(e){return function(t){return null==e?void 0:e[t]}}(q);function J(e){return V.test(e)}function X(e){return z.test(e)}function Z(e){return J(e)?ee(e):H(e)}function ee(e){return e.match(j)||[]}function et(e){return e.match(U)||[]}var er=Object.prototype.toString,en=K.Symbol,ei=en?en.prototype:void 0,es=ei?ei.toString:void 0;function ea(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(i);++n<i;)s[n]=e[n+t];return s}function eo(e){if("string"==typeof e)return e;if(ed(e))return es?es.call(e):"";var r=e+"";return"0"==r&&1/e==-t?"-0":r}function el(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:ea(e,t,r)}function ec(e){return function(t){var r=J(t=eh(t))?Z(t):void 0,n=r?r[0]:t.charAt(0),i=r?el(r,1).join(""):t.slice(1);return n[e]()+i}}function eu(e){return!!e&&"object"==typeof e}function ed(e){return"symbol"==typeof e||eu(e)&&er.call(e)==r}function eh(e){return null==e?"":eo(e)}var ep=function(e){return function(t){return W(ey(em(t).replace(F,"")),e,"")}}(function(e,t,r){return t=t.toLowerCase(),e+(r?ef(t):t)});function ef(e){return eg(eh(e).toLowerCase())}function em(e){return(e=eh(e))&&e.replace(i,Y).replace(B,"")}var eg=ec("toUpperCase");function ey(e,t,r){return(e=eh(e),void 0===(t=r?void 0:t))?X(e)?et(e):Q(e):e.match(t)||[]}e.exports=ep},7213:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uriToString=t.splitHostPort=t.parseUri=void 0;let r=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;t.parseUri=function(e){let t=r.exec(e);return null===t?null:{scheme:t[1],authority:t[2],path:t[3]}};let n=/^\d+$/;t.splitHostPort=function(e){if(e.startsWith("[")){let t=e.indexOf("]");if(-1===t)return null;let r=e.substring(1,t);if(-1===r.indexOf(":"))return null;if(!(e.length>t+1))return{host:r};if(":"!==e[t+1])return null;{let i=e.substring(t+2);return n.test(i)?{host:r,port:+i}:null}}{let t=e.split(":");return 2!==t.length?{host:e}:n.test(t[1])?{host:t[0],port:+t[1]}:null}},t.uriToString=function(e){let t="";return void 0!==e.scheme&&(t+=e.scheme+":"),void 0!==e.authority&&(t+="//"+e.authority+"/"),t+=e.path}},7216:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.getChannelzServiceDefinition=t.getChannelzHandlers=t.unregisterChannelzRef=t.registerChannelzSocket=t.registerChannelzServer=t.registerChannelzSubchannel=t.registerChannelzChannel=t.ChannelzCallTracker=t.ChannelzChildrenTracker=t.ChannelzTrace=void 0;let n=r(1645),i=r(920),s=r(3122),a=r(8387),o=r(9780),l=r(3865);function c(e){return{channel_id:e.id,name:e.name}}function u(e){return{subchannel_id:e.id,name:e.name}}function d(e){return{server_id:e.id}}function h(e){return{socket_id:e.id,name:e.name}}let p=32;class f{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let n=new Date;this.events.push({description:t,severity:e,timestamp:n,childChannel:(null==r?void 0:r.kind)==="channel"?r:void 0,childSubchannel:(null==r?void 0:r.kind)==="subchannel"?r:void 0}),this.events.length>=2*p&&(this.events=this.events.slice(p)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:x(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:x(e.timestamp),channel_ref:e.childChannel?c(e.childChannel):null,subchannel_ref:e.childSubchannel?u(e.childSubchannel):null}))}}}t.ChannelzTrace=f;class m{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,n;switch(e.kind){case"channel":{let r=null!=(t=this.channelChildren.get(e.id))?t:{ref:e,count:0};r.count+=1,this.channelChildren.set(e.id,r);break}case"subchannel":{let t=null!=(r=this.subchannelChildren.get(e.id))?r:{ref:e,count:0};t.count+=1,this.subchannelChildren.set(e.id,t);break}case"socket":{let t=null!=(n=this.socketChildren.get(e.id))?n:{ref:e,count:0};t.count+=1,this.socketChildren.set(e.id,t)}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t))}}}getChildLists(){let e=[];for(let{ref:t}of this.channelChildren.values())e.push(t);let t=[];for(let{ref:e}of this.subchannelChildren.values())t.push(e);let r=[];for(let{ref:e}of this.socketChildren.values())r.push(e);return{channels:e,subchannels:t,sockets:r}}}t.ChannelzChildrenTracker=m;class g{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}t.ChannelzCallTracker=g;let y=1;function v(){return y++}let b=[],S=[],T=[],E=[];function w(e){let t=Number.parseInt(e,16);return[t/256|0,t%256]}function C(e){return""===e?[]:[].concat(...e.split(":").map(e=>w(e)))}function _(e){if((0,n.isIPv4)(e))return Buffer.from(Uint8Array.from(e.split(".").map(e=>Number.parseInt(e))));if(!(0,n.isIPv6)(e))return null;{let t,r,n=e.indexOf("::");-1===n?(t=e,r=""):(t=e.substring(0,n),r=e.substring(n+2));let i=Buffer.from(C(t)),s=Buffer.from(C(r)),a=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,a,s])}}function I(e){switch(e){case i.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case i.ConnectivityState.IDLE:return{state:"IDLE"};case i.ConnectivityState.READY:return{state:"READY"};case i.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case i.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function x(e){if(!e)return null;let t=e.getTime();return{seconds:t/1e3|0,nanos:t%1e3*1e6}}function k(e){let t=e.getInfo();return{ref:c(e.ref),data:{target:t.target,state:I(t.state),calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:x(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},channel_ref:t.children.channels.map(e=>c(e)),subchannel_ref:t.children.subchannels.map(e=>u(e))}}function N(e,t){let r=Number.parseInt(e.request.channel_id),n=b[r];if(void 0===n)return void t({code:s.Status.NOT_FOUND,details:"No channel data found for id "+r});t(null,{channel:k(n)})}function R(e,t){let r=Number.parseInt(e.request.max_results),n=[],i=Number.parseInt(e.request.start_channel_id);for(;i<b.length;i++){let e=b[i];if(void 0!==e&&(n.push(k(e)),n.length>=r))break}t(null,{channel:n,end:i>=T.length})}function A(e){let t=e.getInfo();return{ref:d(e.ref),data:{calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:x(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},listen_socket:t.listenerChildren.sockets.map(e=>h(e))}}function D(e,t){let r=Number.parseInt(e.request.server_id),n=T[r];if(void 0===n)return void t({code:s.Status.NOT_FOUND,details:"No server data found for id "+r});t(null,{server:A(n)})}function O(e,t){let r=Number.parseInt(e.request.max_results),n=[],i=Number.parseInt(e.request.start_server_id);for(;i<T.length;i++){let e=T[i];if(void 0!==e&&(n.push(A(e)),n.length>=r))break}t(null,{server:n,end:i>=T.length})}function P(e,t){let r=Number.parseInt(e.request.subchannel_id),n=S[r];if(void 0===n)return void t({code:s.Status.NOT_FOUND,details:"No subchannel data found for id "+r});let i=n.getInfo();t(null,{subchannel:{ref:u(n.ref),data:{target:i.target,state:I(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:x(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(e=>h(e))}})}function M(e){var t;return(0,a.isTcpSubchannelAddress)(e)?{address:"tcpip_address",tcpip_address:{ip_address:null!=(t=_(e.host))?t:void 0,port:e.port}}:{address:"uds_address",uds_address:{filename:e.path}}}function L(e,t){var r,n,i,a,o;let l=Number.parseInt(e.request.socket_id),c=E[l];if(void 0===c)return void t({code:s.Status.NOT_FOUND,details:"No socket data found for id "+l});let u=c.getInfo(),d=u.security?{model:"tls",tls:{cipher_suite:u.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!=(r=u.security.cipherSuiteStandardName)?r:void 0,other_name:null!=(n=u.security.cipherSuiteOtherName)?n:void 0,local_certificate:null!=(i=u.security.localCertificate)?i:void 0,remote_certificate:null!=(a=u.security.remoteCertificate)?a:void 0}}:null;t(null,{socket:{ref:h(c.ref),local:u.localAddress?M(u.localAddress):null,remote:u.remoteAddress?M(u.remoteAddress):null,remote_name:null!=(o=u.remoteName)?o:void 0,security:d,data:{keep_alives_sent:u.keepAlivesSent,streams_started:u.streamsStarted,streams_succeeded:u.streamsSucceeded,streams_failed:u.streamsFailed,last_local_stream_created_timestamp:x(u.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:x(u.lastRemoteStreamCreatedTimestamp),messages_received:u.messagesReceived,messages_sent:u.messagesSent,last_message_received_timestamp:x(u.lastMessageReceivedTimestamp),last_message_sent_timestamp:x(u.lastMessageSentTimestamp),local_flow_control_window:u.localFlowControlWindow?{value:u.localFlowControlWindow}:null,remote_flow_control_window:u.remoteFlowControlWindow?{value:u.remoteFlowControlWindow}:null}}})}function F(e,t){let r=Number.parseInt(e.request.server_id),n=T[r];if(void 0===n)return void t({code:s.Status.NOT_FOUND,details:"No server data found for id "+r});let i=Number.parseInt(e.request.start_socket_id),a=Number.parseInt(e.request.max_results),o=n.getInfo().sessionChildren.sockets.sort((e,t)=>e.id-t.id),l=[],c=0;for(;c<o.length&&(!(o[c].id>=i)||(l.push(h(o[c])),!(l.length>=a)));c++);t(null,{socket_ref:l,end:c>=o.length})}function B(){return{GetChannel:N,GetTopChannels:R,GetServer:D,GetServers:O,GetSubchannel:P,GetSocket:L,GetServerSockets:F}}t.registerChannelzChannel=function(e,t,r){let n=v(),i={id:n,name:e,kind:"channel"};return r&&(b[n]={ref:i,getInfo:t}),i},t.registerChannelzSubchannel=function(e,t,r){let n=v(),i={id:n,name:e,kind:"subchannel"};return r&&(S[n]={ref:i,getInfo:t}),i},t.registerChannelzServer=function(e,t){let r=v(),n={id:r,kind:"server"};return t&&(T[r]={ref:n,getInfo:e}),n},t.registerChannelzSocket=function(e,t,r){let n=v(),i={id:n,name:e,kind:"socket"};return r&&(E[n]={ref:i,getInfo:t}),i},t.unregisterChannelzRef=function(e){switch(e.kind){case"channel":delete b[e.id];return;case"subchannel":delete S[e.id];return;case"server":delete T[e.id];return;case"socket":delete E[e.id];return}},t.getChannelzHandlers=B;let j=null;function U(){if(j)return j;let e=(0,r(7587).Yi)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return j=(0,l.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service}t.getChannelzServiceDefinition=U,t.setup=function(){(0,o.registerAdminService)(U,B)}},7236:(e,t,r)=>{"use strict";t.Service=r(6984)},7366:e=>{"use strict";e.exports=require("dns")},7408:(e,t,r)=>{"use strict";e.exports=C,C.filename=null,C.defaults={keepCase:!1};var n=r(158),i=r(2703),s=r(4351),a=r(3267),o=r(5585),l=r(2630),c=r(2110),u=r(3076),d=r(1202),h=r(4824),p=r(1810),f=r(3107),m=/^[1-9][0-9]*$/,g=/^-?[1-9][0-9]*$/,y=/^0[x][0-9a-fA-F]+$/,v=/^-?0[x][0-9a-fA-F]+$/,b=/^0[0-7]+$/,S=/^-?0[0-7]+$/,T=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,E=/^[a-zA-Z_][a-zA-Z_0-9]*$/,w=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function C(e,t,r){t instanceof i||(r=t,t=new i),r||(r=C.defaults);var _,I,x,k,N=r.preferTrailingComment||!1,R=n(e,r.alternateCommentMode||!1),A=R.next,D=R.push,O=R.peek,P=R.skip,M=R.cmnt,L=!0,F="proto2",B=t,j=[],U={},V=r.keepCase?function(e){return e}:f.camelCase;function z(){j.forEach(e=>{e._edition=F,Object.keys(U).forEach(t=>{void 0===e.getOption(t)&&e.setOption(t,U[t],!0)})})}function q(e,t,r){var n=C.filename;return r||(C.filename=null),Error("illegal "+(t||"token")+" '"+e+"' ("+(n?n+", ":"")+"line "+R.line+")")}function $(){var e,t=[];do{if('"'!==(e=A())&&"'"!==e)throw q(e);t.push(A()),P(e),e=O()}while('"'===e||"'"===e);return t.join("")}function G(e){var t=A();switch(t){case"'":case'"':return D(t),$();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return W(t,!0)}catch(r){if(e&&w.test(t))return t;throw q(t,"value")}}function K(e,t){do if(t&&('"'===(r=O())||"'"===r)){var r,n,i=$();if(e.push(i),F>=2023)throw q(i,"id")}else try{e.push([n=H(A()),P("to",!0)?H(A()):n])}catch(n){if(t&&w.test(r)&&F>=2023)e.push(r);else throw n}while(P(",",!0));var s={options:void 0};s.setOption=function(e,t){void 0===this.options&&(this.options={}),this.options[e]=t},ee(s,function(e){if("option"===e)el(s,e),P(";");else throw q(e)},function(){eh(s)})}function W(e,t){var r=1;switch("-"===e.charAt(0)&&(r=-1,e=e.substring(1)),e){case"inf":case"INF":case"Inf":return 1/0*r;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(m.test(e))return r*parseInt(e,10);if(y.test(e))return r*parseInt(e,16);if(b.test(e))return r*parseInt(e,8);if(T.test(e))return r*parseFloat(e);throw q(e,"number",t)}function H(e,t){switch(e){case"max":case"MAX":case"Max":return 0x1fffffff;case"0":return 0}if(!t&&"-"===e.charAt(0))throw q(e,"id");if(g.test(e))return parseInt(e,10);if(v.test(e))return parseInt(e,16);if(S.test(e))return parseInt(e,8);throw q(e,"id")}function Q(){if(void 0!==I)throw q("package");if(I=A(),!w.test(I))throw q(I,"name");B=B.define(I),P(";")}function Y(){var e,t=O();switch(t){case"weak":e=k||(k=[]),A();break;case"public":A();default:e=x||(x=[])}t=$(),P(";"),e.push(t)}function J(){if(P("="),(F=$())<2023)throw q(F,"syntax");P(";")}function X(){if(P("="),!["2023"].includes(F=$()))throw q(F,"edition");P(";")}function Z(e,t){switch(t){case"option":return el(e,t),P(";"),!0;case"message":return et(e,t),!0;case"enum":return ea(e,t),!0;case"service":return ep(e,t),!0;case"extend":return em(e,t),!0}return!1}function ee(e,t,r){var n,i=R.line;if(e&&("string"!=typeof e.comment&&(e.comment=M()),e.filename=C.filename),P("{",!0)){for(;"}"!==(n=A());)t(n);P(";",!0)}else r&&r(),P(";"),e&&("string"!=typeof e.comment||N)&&(e.comment=M(i)||e.comment)}function et(e,t){if(!E.test(t=A()))throw q(t,"type name");var r=new s(t);ee(r,function(e){if(!Z(r,e))switch(e){case"map":ei(r,e);break;case"required":if("proto2"!==F)throw q(e);case"repeated":er(r,e);break;case"optional":if("proto3"===F)er(r,"proto3_optional");else if("proto2"!==F)throw q(e);else er(r,"optional");break;case"oneof":es(r,e);break;case"extensions":K(r.extensions||(r.extensions=[]));break;case"reserved":K(r.reserved||(r.reserved=[]),!0);break;default:if("proto2"===F||!w.test(e))throw q(e);D(e),er(r,"optional")}}),e.add(r),e===B&&j.push(r)}function er(e,t,r){var n=A();if("group"===n)return void en(e,t);for(;n.endsWith(".")||O().startsWith(".");)n+=A();if(!w.test(n))throw q(n,"type");var i=A();if(!E.test(i))throw q(i,"name");i=V(i),P("=");var s=new a(i,H(A()),n,t,r);if(ee(s,function(e){if("option"===e)el(s,e),P(";");else throw q(e)},function(){eh(s)}),"proto3_optional"===t){var o=new l("_"+i);s.setOption("proto3_optional",!0),o.add(s),e.add(o)}else e.add(s);e===B&&j.push(s)}function en(e,t){if(F>=2023)throw q("group");var r=A();if(!E.test(r))throw q(r,"name");var n=f.lcFirst(r);r===n&&(r=f.ucFirst(r)),P("=");var i=H(A()),o=new s(r);o.group=!0;var l=new a(n,i,r,t);l.filename=C.filename,ee(o,function(e){switch(e){case"option":el(o,e),P(";");break;case"required":case"repeated":er(o,e);break;case"optional":"proto3"===F?er(o,"proto3_optional"):er(o,"optional");break;case"message":et(o,e);break;case"enum":ea(o,e);break;case"reserved":K(o.reserved||(o.reserved=[]),!0);break;default:throw q(e)}}),e.add(o).add(l)}function ei(e){P("<");var t=A();if(void 0===p.mapKey[t])throw q(t,"type");P(",");var r=A();if(!w.test(r))throw q(r,"type");P(">");var n=A();if(!E.test(n))throw q(n,"name");P("=");var i=new o(V(n),H(A()),t,r);ee(i,function(e){if("option"===e)el(i,e),P(";");else throw q(e)},function(){eh(i)}),e.add(i)}function es(e,t){if(!E.test(t=A()))throw q(t,"name");var r=new l(V(t));ee(r,function(e){"option"===e?(el(r,e),P(";")):(D(e),er(r,"optional"))}),e.add(r)}function ea(e,t){if(!E.test(t=A()))throw q(t,"name");var r=new c(t);ee(r,function(e){switch(e){case"option":el(r,e),P(";");break;case"reserved":K(r.reserved||(r.reserved=[]),!0),void 0===r.reserved&&(r.reserved=[]);break;default:eo(r,e)}}),e.add(r),e===B&&j.push(r)}function eo(e,t){if(!E.test(t))throw q(t,"name");P("=");var r=H(A(),!0),n={options:void 0};n.getOption=function(e){return this.options[e]},n.setOption=function(e,t){h.prototype.setOption.call(n,e,t)},n.setParsedOption=function(){},ee(n,function(e){if("option"===e)el(n,e),P(";");else throw q(e)},function(){eh(n)}),e.add(t,r,n.comment,n.parsedOptions||n.options)}function el(e,t){var r,n,i=!0;for("option"===t&&(t=A());"="!==t;){if("("===t){var s=A();P(")"),t="("+s+")"}if(i){if(i=!1,t.includes(".")&&!t.includes("(")){var a=t.split(".");r=a[0]+".",t=a[1];continue}r=t}else n=n?n+=t:t;t=A()}var o=ec(e,n?r.concat(n):r);n=n&&"."===n[0]?n.slice(1):n,ed(e,r=r&&"."===r[r.length-1]?r.slice(0,-1):r,o,n)}function ec(e,t){if(P("{",!0)){for(var r={};!P("}",!0);){if(!E.test(_=A()))throw q(_,"name");if(null===_)throw q(_,"end of input");var n,i,s=_;if(P(":",!0),"{"===O())n=ec(e,t+"."+_);else if("["===O()){if(n=[],P("[",!0)){do i=G(!0),n.push(i);while(P(",",!0));P("]"),void 0!==i&&eu(e,t+"."+_,i)}}else n=G(!0),eu(e,t+"."+_,n);var a=r[s];a&&(n=[].concat(a).concat(n)),r[s]=n,P(",",!0),P(";",!0)}return r}var o=G(!0);return eu(e,t,o),o}function eu(e,t,r){if(B===e&&/^features\./.test(t)){U[t]=r;return}e.setOption&&e.setOption(t,r)}function ed(e,t,r,n){e.setParsedOption&&e.setParsedOption(t,r,n)}function eh(e){if(P("[",!0)){do el(e,"option");while(P(",",!0));P("]")}return e}function ep(e,t){if(!E.test(t=A()))throw q(t,"service name");var r=new u(t);ee(r,function(e){if(!Z(r,e))if("rpc"===e)ef(r,e);else throw q(e)}),e.add(r),e===B&&j.push(r)}function ef(e,t){var r=M(),n=t;if(!E.test(t=A()))throw q(t,"name");var i,s,a,o,l=t;if(P("("),P("stream",!0)&&(s=!0),!w.test(t=A())||(i=t,P(")"),P("returns"),P("("),P("stream",!0)&&(o=!0),!w.test(t=A())))throw q(t);a=t,P(")");var c=new d(l,n,i,a,s,o);c.comment=r,ee(c,function(e){if("option"===e)el(c,e),P(";");else throw q(e)}),e.add(c)}function em(e,t){if(!w.test(t=A()))throw q(t,"reference");var r=t;ee(null,function(t){switch(t){case"required":case"repeated":er(e,t,r);break;case"optional":"proto3"===F?er(e,"proto3_optional",r):er(e,"optional",r);break;default:if("proto2"===F||!w.test(t))throw q(t);D(t),er(e,"optional",r)}})}for(;null!==(_=A());)switch(_){case"package":if(!L)throw q(_);Q();break;case"import":if(!L)throw q(_);Y();break;case"syntax":if(!L)throw q(_);J();break;case"edition":if(!L)throw q(_);X();break;case"option":el(B,_),P(";",!0);break;default:if(Z(B,_)){L=!1;continue}throw q(_)}return z(),C.filename=null,{package:I,imports:x,weakImports:k,root:t}}},7587:(e,t,r)=>{"use strict";var n,i;n={value:!0},n=n=t.rS=t.Yi=n=t.Ib=n=n=void 0;let s=r(7099),a=r(8474),o=r(1614),l=r(7603);n=r(6061),n=function(e){return"@type"in e&&"string"==typeof e["@type"]},function(e){e.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",e.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",e.IDEMPOTENT="IDEMPOTENT"}(i=t.Ib||(t.Ib={}));let c={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function u(e,t){return""===e?t:e+"."+t}function d(e){return e instanceof a.Service||e instanceof a.Type||e instanceof a.Enum}function h(e){return e instanceof a.Namespace||e instanceof a.Root}function p(e,t){let r=u(t,e.name);return d(e)?[[r,e]]:h(e)&&void 0!==e.nested?Object.keys(e.nested).map(t=>p(e.nested[t],r)).reduce((e,t)=>e.concat(t),[]):[]}function f(e,t){return function(r){return e.toObject(e.decode(r),t)}}function m(e){return function(t){if(Array.isArray(t))throw Error(`Failed to serialize message: expected object with ${e.name} structure, got array instead`);let r=e.fromObject(t);return e.encode(r).finish()}}function g(e){return(e||[]).reduce((e,t)=>{for(let[r,n]of Object.entries(t))"uninterpreted_option"===r?e.uninterpreted_option.push(t.uninterpreted_option):e[r]=n;return e},{deprecated:!1,idempotency_level:i.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function y(e,t,r,n){let i=e.resolvedRequestType,a=e.resolvedResponseType;return{path:"/"+t+"/"+e.name,requestStream:!!e.requestStream,responseStream:!!e.responseStream,requestSerialize:m(i),requestDeserialize:f(i,r),responseSerialize:m(a),responseDeserialize:f(a,r),originalName:s(e.name),requestType:b(i,n),responseType:b(a,n),options:g(e.parsedOptions)}}function v(e,t,r,n){let i={};for(let s of e.methodsArray)i[s.name]=y(s,t,r,n);return i}function b(e,t){let r=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:r.$type.toObject(r,c),fileDescriptorProtos:t}}function S(e,t){let r=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:r.$type.toObject(r,c),fileDescriptorProtos:t}}function T(e,t,r,n){if(e instanceof a.Service)return v(e,t,r,n);if(e instanceof a.Type)return b(e,n);if(e instanceof a.Enum)return S(e,n);throw Error("Type mismatch in reflection object handling")}function E(e,t){let r={};e.resolveAll();let n=e.toDescriptor("proto3").file.map(e=>Buffer.from(o.FileDescriptorProto.encode(e).finish()));for(let[i,s]of p(e,""))r[i]=T(s,i,t,n);return r}function w(e,t){t=t||{};let r=a.Root.fromDescriptor(e);return r.resolveAll(),E(r,t)}n=function(e,t){return(0,l.loadProtosWithOptions)(e,t).then(e=>E(e,t))},t.Yi=function(e,t){return E((0,l.loadProtosWithOptionsSync)(e,t),t)},t.rS=function(e,t){t=t||{};let r=a.Root.fromJSON(e);return r.resolveAll(),E(r,t)},n=function(e,t){return w(o.FileDescriptorSet.decode(e),t)},n=function(e,t){return w(o.FileDescriptorSet.fromObject(e),t)},(0,l.addCommonProtos)()},7603:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addCommonProtos=t.loadProtosWithOptionsSync=t.loadProtosWithOptions=void 0;let n=r(9021),i=r(3873),s=r(8474);function a(e,t){let r=e.resolvePath;e.resolvePath=(e,s)=>{if(i.isAbsolute(s))return s;for(let e of t){let t=i.join(e,s);try{return n.accessSync(t,n.constants.R_OK),t}catch(e){continue}}return process.emitWarning(`${s} not found in any of the include paths ${t}`),r(e,s)}}t.loadProtosWithOptions=async function(e,t){let r=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));a(r,t.includeDirs)}let n=await r.load(e,t);return n.resolveAll(),n},t.loadProtosWithOptionsSync=function(e,t){let r=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))throw Error("The includeDirs option must be an array");a(r,t.includeDirs)}let n=r.loadSync(e,t);return n.resolveAll(),n},t.addCommonProtos=function(){let e=r(2566),t=r(40),n=r(6271),i=r(6138);s.common("api",e.nested.google.nested.protobuf.nested),s.common("descriptor",t.nested.google.nested.protobuf.nested),s.common("source_context",n.nested.google.nested.protobuf.nested),s.common("type",i.nested.google.nested.protobuf.nested)}},7659:(e,t,r)=>{"use strict";var n=t,i=r(2110),s=r(3107);function a(e,t,r,n){var s=!1;if(t.resolvedType)if(t.resolvedType instanceof i){e("switch(d%s){",n);for(var a=t.resolvedType.values,o=Object.keys(a),l=0;l<o.length;++l)a[o[l]]!==t.typeDefault||s||(e("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',n,n,n),t.repeated||e("break"),s=!0),e("case%j:",o[l])("case %i:",a[o[l]])("m%s=%j",n,a[o[l]])("break");e("}")}else e('if(typeof d%s!=="object")',n)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",n,r,n);else{var c=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",n,n);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",n,n);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",n,n);break;case"uint64":c=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",n,n,c)('else if(typeof d%s==="string")',n)("m%s=parseInt(d%s,10)",n,n)('else if(typeof d%s==="number")',n)("m%s=d%s",n,n)('else if(typeof d%s==="object")',n)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",n,n,n,c?"true":"");break;case"bytes":e('if(typeof d%s==="string")',n)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",n,n,n)("else if(d%s.length >= 0)",n)("m%s=d%s",n,n);break;case"string":e("m%s=String(d%s)",n,n);break;case"bool":e("m%s=Boolean(d%s)",n,n)}}return e}function o(e,t,r,n){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",n,r,n,n,r,n,n):e("d%s=types[%i].toObject(m%s,o)",n,r,n);else{var s=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",n,n,n,n);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',n)("d%s=o.longs===String?String(m%s):m%s",n,n,n)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",n,n,n,n,s?"true":"",n);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",n,n,n,n,n);break;default:e("d%s=m%s",n,n)}}return e}n.fromObject=function(e){var t=e.fieldsArray,r=s.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var n=0;n<t.length;++n){var o=t[n].resolve(),l=s.safeProp(o.name);o.map?(r("if(d%s){",l)('if(typeof d%s!=="object")',l)("throw TypeError(%j)",o.fullName+": object expected")("m%s={}",l)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",l),a(r,o,n,l+"[ks[i]]")("}")("}")):o.repeated?(r("if(d%s){",l)("if(!Array.isArray(d%s))",l)("throw TypeError(%j)",o.fullName+": array expected")("m%s=[]",l)("for(var i=0;i<d%s.length;++i){",l),a(r,o,n,l+"[i]")("}")("}")):(o.resolvedType instanceof i||r("if(d%s!=null){",l),a(r,o,n,l),o.resolvedType instanceof i||r("}"))}return r("return m")},n.toObject=function(e){var t=e.fieldsArray.slice().sort(s.compareFieldsById);if(!t.length)return s.codegen()("return {}");for(var r=s.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),n=[],a=[],l=[],c=0;c<t.length;++c)t[c].partOf||(t[c].resolve().repeated?n:t[c].map?a:l).push(t[c]);if(n.length){for(r("if(o.arrays||o.defaults){"),c=0;c<n.length;++c)r("d%s=[]",s.safeProp(n[c].name));r("}")}if(a.length){for(r("if(o.objects||o.defaults){"),c=0;c<a.length;++c)r("d%s={}",s.safeProp(a[c].name));r("}")}if(l.length){for(r("if(o.defaults){"),c=0;c<l.length;++c){var u=l[c],d=s.safeProp(u.name);if(u.resolvedType instanceof i)r("d%s=o.enums===String?%j:%j",d,u.resolvedType.valuesById[u.typeDefault],u.typeDefault);else if(u.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",u.typeDefault.low,u.typeDefault.high,u.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",d)("}else")("d%s=o.longs===String?%j:%i",d,u.typeDefault.toString(),u.typeDefault.toNumber());else if(u.bytes){var h="["+Array.prototype.slice.call(u.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",d,String.fromCharCode.apply(String,u.typeDefault))("else{")("d%s=%s",d,h)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",d,d)("}")}else r("d%s=%j",d,u.typeDefault)}r("}")}var p=!1;for(c=0;c<t.length;++c){var u=t[c],f=e._fieldsArray.indexOf(u),d=s.safeProp(u.name);u.map?(p||(p=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",d,d)("d%s={}",d)("for(var j=0;j<ks2.length;++j){"),o(r,u,f,d+"[ks2[j]]")("}")):u.repeated?(r("if(m%s&&m%s.length){",d,d)("d%s=[]",d)("for(var j=0;j<m%s.length;++j){",d),o(r,u,f,d+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",d,u.name),o(r,u,f,d),u.partOf&&r("if(o.oneofs)")("d%s=%j",s.safeProp(u.partOf.name),u.name)),r("}")}return r("return d")}},7748:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResolvingLoadBalancer=void 0;let n=r(598),i=r(2487),s=r(920),a=r(8605),o=r(757),l=r(6693),c=r(3122),u=r(9978),d=r(3038),h=r(3122),p=r(7213),f=r(4976),m="resolving_load_balancer";function g(e){d.trace(h.LogVerbosity.DEBUG,m,e)}let y=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function v(e,t,r,n){for(let i of r.name)switch(n){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===e&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===e&&i.method===t)return!0}return!1}function b(e,t,r,n){for(let i of r)if(v(e,t,i,n))return i;return null}function S(e){return function(t,r){var n,i;let s=t.split("/").filter(e=>e.length>0),a=null!=(n=s[0])?n:"",o=null!=(i=s[1])?i:"";if(e&&e.methodConfig)for(let t of y){let r=b(a,o,e.methodConfig,t);if(r)return{methodConfig:r,pickInformation:{},status:c.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:c.Status.OK,dynamicFilterFactories:[]}}}class T{constructor(e,t,r,d,h){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=d,this.onFailedResolution=h,this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,i.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(s.ConnectivityState.IDLE,new o.QueuePicker(this)),this.childLoadBalancer=new f.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(g("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(e,t)=>{this.latestChildState=e,this.latestChildPicker=t,this.updateState(e,t)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,a.createResolver)(e,{onSuccessfulResolution:(e,t,r,i,s)=>{var a;this.backoffTimeout.stop(),this.backoffTimeout.reset();let o=null;null===t?null===r?(this.previousServiceConfig=null,o=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(r):o=this.previousServiceConfig:(o=t,this.previousServiceConfig=t);let l=null!=(a=null==o?void 0:o.loadBalancingConfig)?a:[],d=(0,n.getFirstUsableConfig)(l,!0);if(null===d)return void this.handleResolutionFailure({code:c.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new u.Metadata});this.childLoadBalancer.updateAddressList(e,d,s);let h=null!=o?o:this.defaultServiceConfig;this.onSuccessfulResolution(h,null!=i?i:S(h))},onError:e=>{this.handleResolutionFailure(e)}},r);let p={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new l.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},p),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===s.ConnectivityState.IDLE&&this.updateState(s.ConnectivityState.CONNECTING,new o.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){g((0,p.uriToString)(this.target)+" "+s.ConnectivityState[this.currentState]+" -> "+s.ConnectivityState[e]),e===s.ConnectivityState.IDLE&&(t=new o.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===s.ConnectivityState.IDLE&&(this.updateState(s.ConnectivityState.TRANSIENT_FAILURE,new o.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===s.ConnectivityState.IDLE||this.currentState===s.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}t.ResolvingLoadBalancer=T},7757:(e,t,r)=>{"use strict";e.exports=s;var n=r(5108),i=r(9644)("fs");function s(e,t,r){return("function"==typeof t?(r=t,t={}):t||(t={}),r)?!t.xhr&&i&&i.readFile?i.readFile(e,function(n,i){return n&&"undefined"!=typeof XMLHttpRequest?s.xhr(e,t,r):n?r(n):r(null,t.binary?i:i.toString("utf8"))}):s.xhr(e,t,r):n(s,this,e,t)}s.xhr=function(e,t,r){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){if(0!==n.status&&200!==n.status)return r(Error("status "+n.status));if(t.binary){var e=n.response;if(!e){e=[];for(var i=0;i<n.responseText.length;++i)e.push(255&n.responseText.charCodeAt(i))}return r(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return r(null,n.responseText)}},t.binary&&("overrideMimeType"in n&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.responseType="arraybuffer"),n.open("GET",e),n.send()}},7819:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusBuilder=void 0;class r{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return null!==this.code&&(e.code=this.code),null!==this.details&&(e.details=this.details),null!==this.metadata&&(e.metadata=this.metadata),e}}t.StatusBuilder=r},7875:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2SubchannelCall=void 0;let n=r(3496),i=r(1820),s=r(3122),a=r(9978),o=r(5678),l=r(3038),c=r(3122),u="subchannel_call";function d(e){for(let[t,r]of Object.entries(i.constants.errno))if(r===e)return t;return"Unknown system error "+e}class h{constructor(e,t,r,i,l){var c;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=l,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=s.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let u=null!=(c=i.getOptions()["grpc.max_receive_message_length"])?c:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new o.StreamDecoder(u),e.on("response",(e,t)=>{let r="";for(let t of Object.keys(e))r+="		"+t+": "+e[t]+"\n";switch(this.trace("Received server headers:\n"+r),e[":status"]){case 400:this.mappedStatusCode=s.Status.INTERNAL;break;case 401:this.mappedStatusCode=s.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=s.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=s.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=s.Status.UNAVAILABLE;break;default:this.mappedStatusCode=s.Status.UNKNOWN}if(t&n.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(e);else{let t;try{t=a.Metadata.fromHttp2Headers(e)}catch(e){this.endCall({code:s.Status.UNKNOWN,details:e.message,metadata:new a.Metadata});return}this.listener.onReceiveMetadata(t)}}),e.on("trailers",e=>{this.handleTrailers(e)}),e.on("data",e=>{let t;if(!this.statusOutput){this.trace("receive HTTP/2 data frame of length "+e.length);try{t=this.decoder.write(e)}catch(e){this.cancelWithStatus(s.Status.RESOURCE_EXHAUSTED,e.message);return}for(let e of t)this.trace("parsed message of length "+e.length),this.callEventTracker.addMessageReceived(),this.tryPush(e)}}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var t;let r;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),(null==(t=this.finalStatus)?void 0:t.code)===s.Status.OK)return;let i="";switch(e.rstCode){case n.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;r=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`;break;case n.constants.NGHTTP2_REFUSED_STREAM:r=s.Status.UNAVAILABLE,i="Stream refused by server";break;case n.constants.NGHTTP2_CANCEL:r=s.Status.CANCELLED,i="Call cancelled";break;case n.constants.NGHTTP2_ENHANCE_YOUR_CALM:r=s.Status.RESOURCE_EXHAUSTED,i="Bandwidth exhausted or memory limit exceeded";break;case n.constants.NGHTTP2_INADEQUATE_SECURITY:r=s.Status.PERMISSION_DENIED,i="Protocol not secure enough";break;case n.constants.NGHTTP2_INTERNAL_ERROR:r=s.Status.INTERNAL,null===this.internalError?i=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(r=s.Status.UNAVAILABLE,i=this.internalError.message):i=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:r=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:r,details:i,metadata:new a.Metadata,rstCode:e.rstCode})})}),e.on("error",e=>{"ERR_HTTP2_STREAM_ERROR"!==e.code&&(this.trace("Node error event: message="+e.message+" code="+e.code+" errno="+d(e.errno)+" syscall="+e.syscall),this.internalError=e),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:s.Status.UNAVAILABLE,details:"Connection dropped",metadata:new a.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){l.trace(c.LogVerbosity.DEBUG,u,"["+this.callId+"] "+e)}endCall(e){(null===this.finalStatus||this.finalStatus.code===s.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===s.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){let t;this.callEventTracker.onStreamEnd(!0);let r="";for(let t of Object.keys(e))r+="		"+t+": "+e[t]+"\n";this.trace("Received server trailers:\n"+r);try{t=a.Metadata.fromHttp2Headers(e)}catch(e){t=new a.Metadata}let n=t.getMap(),i=this.mappedStatusCode;if(i===s.Status.UNKNOWN&&"string"==typeof n["grpc-status"]){let e=Number(n["grpc-status"]);e in s.Status&&(i=e,this.trace("received status code "+e+" from server")),t.remove("grpc-status")}let o="";if("string"==typeof n["grpc-message"]){try{o=decodeURI(n["grpc-message"])}catch(e){o=n["grpc-message"]}t.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let l={code:i,details:o,metadata:t};this.endCall(l)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;t=(null==(e=this.finalStatus)?void 0:e.code)===s.Status.OK?n.constants.NGHTTP2_NO_ERROR:n.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new a.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==s.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=t=>{process.nextTick(()=>{var r;let n=s.Status.UNAVAILABLE;(null==t?void 0:t.code)==="ERR_STREAM_WRITE_AFTER_END"&&(n=s.Status.INTERNAL),t&&this.cancelWithStatus(n,`Write error: ${t.message}`),null==(r=e.callback)||r.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(e){this.endCall({code:s.Status.UNAVAILABLE,details:`Write failed with error ${e.message}`,metadata:new a.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}t.Http2SubchannelCall=h},7892:(e,t,r)=>{Promise.resolve().then(r.bind(r,1204))},7910:e=>{"use strict";e.exports=require("stream")},7936:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getProxiedConnection=t.mapProxyName=void 0;let n=r(3038),i=r(3122),s=r(8605),a=r(1630),o=r(4631),l=r(3038),c=r(8387),u=r(7213),d=r(9551),h=r(2319),p="proxy";function f(e){l.trace(i.LogVerbosity.DEBUG,p,e)}function m(){let e,t="",r="";if(process.env.grpc_proxy)r="grpc_proxy",t=process.env.grpc_proxy;else if(process.env.https_proxy)r="https_proxy",t=process.env.https_proxy;else{if(!process.env.http_proxy)return{};r="http_proxy",t=process.env.http_proxy}try{e=new d.URL(t)}catch(e){return(0,n.log)(i.LogVerbosity.ERROR,`cannot parse value of "${r}" env var`),{}}if("http:"!==e.protocol)return(0,n.log)(i.LogVerbosity.ERROR,`"${e.protocol}" scheme not supported in proxy URI`),{};let s=null;e.username&&(e.password?((0,n.log)(i.LogVerbosity.INFO,"userinfo found in proxy URI"),s=`${e.username}:${e.password}`):s=e.username);let a=e.hostname,o=e.port;""===o&&(o="80");let l={address:`${a}:${o}`};return s&&(l.creds=s),f("Proxy server "+l.address+" set by environment variable "+r),l}function g(){let e=process.env.no_grpc_proxy,t="no_grpc_proxy";return(e||(e=process.env.no_proxy,t="no_proxy"),e)?(f("No proxy server list set by environment variable "+t),e.split(",")):[]}t.mapProxyName=function(e,t){var r;let n={target:e,extraOptions:{}};if((null!=(r=t["grpc.enable_http_proxy"])?r:1)===0||"unix"===e.scheme)return n;let i=m();if(!i.address)return n;let s=(0,u.splitHostPort)(e.path);if(!s)return n;let a=s.host;for(let t of g())if(t===a)return f("Not using proxy for target in no_proxy list: "+(0,u.uriToString)(e)),n;let o={"grpc.http_connect_target":(0,u.uriToString)(e)};return i.creds&&(o["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:o}},t.getProxiedConnection=function(e,t,r){var l;if(!("grpc.http_connect_target"in t))return Promise.resolve({});let d=t["grpc.http_connect_target"],p=(0,u.parseUri)(d);if(null===p)return Promise.resolve({});let m=(0,u.splitHostPort)(p.path);if(null===m)return Promise.resolve({});let g=`${m.host}:${null!=(l=m.port)?l:h.DEFAULT_PORT}`,y={method:"CONNECT",path:g},v={Host:g};(0,c.isTcpSubchannelAddress)(e)?(y.host=e.host,y.port=e.port):y.socketPath=e.path,"grpc.http_connect_creds"in t&&(v["Proxy-Authorization"]="Basic "+Buffer.from(t["grpc.http_connect_creds"]).toString("base64")),y.headers=v;let b=(0,c.subchannelAddressToString)(e);return f("Using proxy "+b+" to connect to "+y.path),new Promise((e,t)=>{let l=a.request(y);l.once("connect",(a,c,d)=>{var h;if(l.removeAllListeners(),c.removeAllListeners(),200===a.statusCode)if(f("Successfully connected to "+y.path+" through proxy "+b),"secureContext"in r){let n=(0,s.getDefaultAuthority)(p),i=(0,u.splitHostPort)(n),a=null!=(h=null==i?void 0:i.host)?h:n,l=o.connect(Object.assign({host:a,servername:a,socket:c},r),()=>{f("Successfully established a TLS connection to "+y.path+" through proxy "+b),e({socket:l,realTarget:p})});l.on("error",e=>{f("Failed to establish a TLS connection to "+y.path+" through proxy "+b+" with error "+e.message),t()})}else f("Successfully established a plaintext connection to "+y.path+" through proxy "+b),e({socket:c,realTarget:p});else(0,n.log)(i.LogVerbosity.ERROR,"Failed to connect to "+y.path+" through proxy "+b+" with status "+a.statusCode),t()}),l.once("error",e=>{l.removeAllListeners(),(0,n.log)(i.LogVerbosity.ERROR,"Failed to connect to proxy "+b+" with error "+e.message),t()}),l.end()})}},7968:(e,t,r)=>{"use strict";e.exports=d;var n,i,s,a=r(4824);((d.prototype=Object.create(a.prototype)).constructor=d).className="Namespace";var o=r(3267),l=r(3107),c=r(2630);function u(e,t){if(e&&e.length){for(var r={},n=0;n<e.length;++n)r[e[n].name]=e[n].toJSON(t);return r}}function d(e,t){a.call(this,e,t),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function h(e){e._nestedArray=null,e._lookupCache={};for(var t=e;t=t.parent;)t._lookupCache={};return e}d.fromJSON=function(e,t){return new d(e,t.options).addJSON(t.nested)},d.arrayToJSON=u,d.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if("string"!=typeof e[r]&&e[r][0]<=t&&e[r][1]>t)return!0}return!1},d.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1},Object.defineProperty(d.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=l.toArray(this.nested))}}),d.prototype.toJSON=function(e){return l.toObject(["options",this.options,"nested",u(this.nestedArray,e)])},d.prototype.addJSON=function(e){var t=this;if(e)for(var r,a=Object.keys(e),l=0;l<a.length;++l)r=e[a[l]],t.add((void 0!==r.fields?n.fromJSON:void 0!==r.values?s.fromJSON:void 0!==r.methods?i.fromJSON:void 0!==r.id?o.fromJSON:d.fromJSON)(a[l],r));return this},d.prototype.get=function(e){return this.nested&&this.nested[e]||null},d.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof s)return this.nested[e].values;throw Error("no such enum: "+e)},d.prototype.add=function(e){if(!(e instanceof o&&void 0!==e.extend||e instanceof n||e instanceof c||e instanceof s||e instanceof i||e instanceof d))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t)if(t instanceof d&&e instanceof d&&!(t instanceof n||t instanceof i)){for(var r=t.nestedArray,a=0;a<r.length;++a)e.add(r[a]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}else this.nested={};this.nested[e.name]=e,this instanceof n||this instanceof i||this instanceof s||this instanceof o||e._edition||(e._edition=e._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var l=this;l=l.parent;)l._needsRecursiveFeatureResolution=!0,l._needsRecursiveResolve=!0;return e.onAdd(this),h(this)},d.prototype.remove=function(e){if(!(e instanceof a))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),h(this)},d.prototype.define=function(e,t){if(l.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var r=this;e.length>0;){var n=e.shift();if(r.nested&&r.nested[n]){if(!((r=r.nested[n])instanceof d))throw Error("path conflicts with non-namespace objects")}else r.add(r=new d(n))}return t&&r.addJSON(t),r},d.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var e=this.nestedArray,t=0;for(this.resolve();t<e.length;)e[t]instanceof d?e[t++].resolveAll():e[t++].resolve();return this._needsRecursiveResolve=!1,this},d.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(this._needsRecursiveFeatureResolution=!1,e=this._edition||e,a.prototype._resolveFeaturesRecursive.call(this,e),this.nestedArray.forEach(t=>{t._resolveFeaturesRecursive(e)})),this},d.prototype.lookup=function(e,t,r){if("boolean"==typeof t?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),l.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;var n=e.join(".");if(""===e[0])return this.root.lookup(e.slice(1),t);var i=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+n];if(i&&(!t||t.indexOf(i.constructor)>-1)||(i=this._lookupImpl(e,n))&&(!t||t.indexOf(i.constructor)>-1))return i;if(r)return null;for(var s=this;s.parent;){if((i=s.parent._lookupImpl(e,n))&&(!t||t.indexOf(i.constructor)>-1))return i;s=s.parent}return null},d.prototype._lookupImpl=function(e,t){if(Object.prototype.hasOwnProperty.call(this._lookupCache,t))return this._lookupCache[t];var r=this.get(e[0]),n=null;if(r)1===e.length?n=r:r instanceof d&&(e=e.slice(1),n=r._lookupImpl(e,e.join(".")));else for(var i=0;i<this.nestedArray.length;++i)this._nestedArray[i]instanceof d&&(r=this._nestedArray[i]._lookupImpl(e,t))&&(n=r);return this._lookupCache[t]=n,n},d.prototype.lookupType=function(e){var t=this.lookup(e,[n]);if(!t)throw Error("no such type: "+e);return t},d.prototype.lookupEnum=function(e){var t=this.lookup(e,[s]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},d.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[n,s]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},d.prototype.lookupService=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},d._configure=function(e,t,r){n=e,i=t,s=r}},7988:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilterStackFactory=t.FilterStack=void 0;class r{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMessage(t);return t}receiveMessage(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}}t.FilterStack=r;class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new r(this.factories.map(e=>e.createFilter()))}}t.FilterStackFactory=n},8048:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Server=void 0;let n=r(3496),i=r(3122),s=r(2841),a=r(663),o=r(8605),l=r(3038),c=r(8387),u=r(7213),d=r(7216),h=0x7fffffff,p=0x7fffffff,f=2e4,{HTTP2_HEADER_PATH:m}=n.constants,g="server";function y(){}function v(e){return{code:i.Status.UNIMPLEMENTED,details:`The server does not implement the method ${e}`}}function b(e,t){let r=v(t);switch(e){case"unary":return(e,t)=>{t(r,null)};case"clientStream":return(e,t)=>{t(r,null)};case"serverStream":return e=>{e.emit("error",r)};case"bidi":return e=>{e.emit("error",r)};default:throw Error(`Invalid handlerType ${e}`)}}class S{constructor(e){var t,r,n,i;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new d.ChannelzTrace,this.callTracker=new d.ChannelzCallTracker,this.listenerChildrenTracker=new d.ChannelzChildrenTracker,this.sessionChildrenTracker=new d.ChannelzChildrenTracker,this.options=null!=e?e:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,d.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!=(t=this.options["grpc.max_connection_age_ms"])?t:h,this.maxConnectionAgeGraceMs=null!=(r=this.options["grpc.max_connection_age_grace_ms"])?r:h,this.keepaliveTimeMs=null!=(n=this.options["grpc.keepalive_time_ms"])?n:p,this.keepaliveTimeoutMs=null!=(i=this.options["grpc.keepalive_timeout_ms"])?i:f,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,n;let i,s=this.sessions.get(e),a=e.socket,o=a.remoteAddress?(0,c.stringToSubchannelAddress)(a.remoteAddress,a.remotePort):null,l=a.localAddress?(0,c.stringToSubchannelAddress)(a.localAddress,a.localPort):null;if(e.encrypted){let e=a,r=e.getCipher(),n=e.getCertificate(),s=e.getPeerCertificate();i={cipherSuiteStandardName:null!=(t=r.standardName)?t:null,cipherSuiteOtherName:r.standardName?null:r.name,localCertificate:n&&"raw"in n?n.raw:null,remoteCertificate:s&&"raw"in s?s.raw:null}}else i=null;return{remoteAddress:o,localAddress:l,security:i,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:null!=(r=e.state.localWindowSize)?r:null,remoteFlowControlWindow:null!=(n=e.state.remoteWindowSize)?n:null}}}trace(e){l.trace(i.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+e)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(e,t){if(null===e||"object"!=typeof e||null===t||"object"!=typeof t)throw Error("addService() requires two objects as arguments");let r=Object.keys(e);if(0===r.length)throw Error("Cannot add an empty service to a server");r.forEach(r=>{let n,i,s=e[r];n=s.requestStream?s.responseStream?"bidi":"clientStream":s.responseStream?"serverStream":"unary";let a=t[r];if(void 0===a&&"string"==typeof s.originalName&&(a=t[s.originalName]),i=void 0!==a?a.bind(t):b(n,r),!1===this.register(s.path,i,s.responseSerialize,s.requestDeserialize,n))throw Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(null===e||"object"!=typeof e)throw Error("removeService() requires object as argument");Object.keys(e).forEach(t=>{let r=e[t];this.unregister(r.path)})}bind(e,t){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof e)throw TypeError("port must be a string");if(null===t||!(t instanceof a.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof r)throw TypeError("callback must be a function");let s=(0,u.parseUri)(e);if(null===s)throw Error(`Could not parse port "${e}"`);let h=(0,o.mapUriDefaultScheme)(s);if(null===h)throw Error(`Could not get a default scheme for port "${e}"`);let p={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?p.maxSessionMemory=this.options["grpc-node.max_session_memory"]:p.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(p.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let f=(e,t)=>{process.nextTick(()=>r(e,t))},m=()=>{let e;if(t._isSecure()){let r=Object.assign(p,t._getSettings());r.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(e=n.createSecureServer(r)).on("secureConnection",e=>{e.on("error",e=>{this.trace("An incoming TLS connection closed with error: "+e.message)})})}else e=n.createServer(p);return e.setTimeout(0,y),this._setupHandlers(e),e},g=(e,t,r)=>0===e.length?Promise.resolve({port:t,count:r}):Promise.all(e.map(e=>{let r;this.trace("Attempting to bind "+(0,c.subchannelAddressToString)(e)),r=(0,c.isTcpSubchannelAddress)(e)?{host:e.host,port:t}:e;let n=m();return new Promise((i,s)=>{let a=t=>{this.trace("Failed to bind "+(0,c.subchannelAddressToString)(e)+" with error "+t.message),i(t)};n.once("error",a),n.listen(r,()=>{let e;if(this.shutdown){n.close(),i(Error("bindAsync failed because server is shutdown"));return}let r=n.address();e="string"==typeof r?{path:r}:{host:r.address,port:r.port};let s=(0,d.registerChannelzSocket)((0,c.subchannelAddressToString)(e),()=>({localAddress:e,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(s),this.http2ServerList.push({server:n,channelzRef:s}),this.trace("Successfully bound "+(0,c.subchannelAddressToString)(e)),i("port"in e?e.port:t),n.removeListener("error",a)})})})).then(e=>{let n=0;for(let r of e)if("number"==typeof r&&(n+=1,r!==t))throw Error("Invalid state: multiple port numbers added from single address");return{port:t,count:n+r}}),v=e=>{if(0===e.length)return Promise.resolve({port:0,count:0});let t=e[0],r=m();return new Promise((n,i)=>{let s=r=>{this.trace("Failed to bind "+(0,c.subchannelAddressToString)(t)+" with error "+r.message),n(v(e.slice(1)))};r.once("error",s),r.listen(t,()=>{if(this.shutdown){r.close(),n({port:0,count:0});return}let t=r.address(),i={host:t.address,port:t.port},a=(0,d.registerChannelzSocket)((0,c.subchannelAddressToString)(i),()=>({localAddress:i,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(a),this.http2ServerList.push({server:r,channelzRef:a}),this.trace("Successfully bound "+(0,c.subchannelAddressToString)(i)),n(g(e.slice(1),t.port,1)),r.removeListener("error",s)})})},b={onSuccessfulResolution:(t,r,n)=>{let s;if(b.onSuccessfulResolution=()=>{},this.shutdown&&f(Error("bindAsync failed because server is shutdown"),0),0===t.length)return void f(Error(`No addresses resolved for port ${e}`),0);(s=(0,c.isTcpSubchannelAddress)(t[0])?0===t[0].port?v(t):g(t,t[0].port,0):g(t,1,0)).then(e=>{if(0===e.count){let e=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,e),f(Error(e),0)}else e.count<t.length&&l.log(i.LogVerbosity.INFO,`WARNING Only ${e.count} addresses added out of total ${t.length} resolved`),f(null,e.port)},e=>{let r=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,r),f(Error(r),0)})},onError:e=>{f(Error(e.details),0)}};(0,o.createResolver)(h,b,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,d.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(n.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,d.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,n,i){return!this.handlers.has(e)&&(this.handlers.set(e,{func:t,serialize:r,deserialize:n,type:i,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:e})=>!0!==e.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=t=>{this.channelzEnabled&&(0,d.unregisterChannelzRef)(this.channelzRef),e(t)},r=0;function n(){0==--r&&t()}for(let{server:e,channelzRef:t}of(this.started=!1,this.shutdown=!0,this.http2ServerList))e.listening&&(r++,e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,d.unregisterChannelzRef)(t)),n()}));this.sessions.forEach((e,t)=>{t.closed||(r+=1,t.close(n))}),0===r&&t()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[n.constants.HTTP2_HEADER_CONTENT_TYPE];return"string"==typeof r&&!!r.startsWith("application/grpc")||(e.respond({[n.constants.HTTP2_HEADER_STATUS]:n.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return void 0===t?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let n=new s.Http2ServerCallStream(t,null,this.options);void 0===e.code&&(e.code=i.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed()),n.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),null==r||r.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed();return}let n=t[m],a=this._retrieveHandler(n);if(!a)return void this._respondWithError(v(n),e,r);let o=new s.Http2ServerCallStream(e,a,this.options);o.once("callEnd",e=>{e===i.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",e=>{e?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,a,t)||(this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed(),o.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${a.type}`}))}_streamHandler(e,t){if(!0!==this._verifyContentType(e,t))return;let r=t[m],n=this._retrieveHandler(r);if(!n)return void this._respondWithError(v(r),e,null);let a=new s.Http2ServerCallStream(e,n,this.options);this._runHandlerForCall(a,n,t)||a.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${n.type}`})}_runHandlerForCall(e,t,r){var n;let i=e.receiveMetadata(r),s=null!=(n=i.get("grpc-encoding")[0])?n:"identity";i.remove("grpc-encoding");let{type:a}=t;if("unary"===a)T(e,t,i,s);else if("clientStream"===a)E(e,t,i,s);else if("serverStream"===a)w(e,t,i,s);else{if("bidi"!==a)return!1;C(e,t,i,s)}return!0}_setupHandlers(e){if(null===e)return;let t=e.address(),r="null";t&&(r="string"==typeof t?t:t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",e=>{var t,r,i,s,a;if(!this.started)return void e.destroy();let o=(0,d.registerChannelzSocket)(null!=(t=e.socket.remoteAddress)?t:"unknown",this.getChannelzSessionInfoGetter(e),this.channelzEnabled),l={ref:o,streamTracker:new d.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(e,l);let c=e.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+c),this.sessionChildrenTracker.refChild(o));let u=null,p=null,f=!1;if(this.maxConnectionAgeMs!==h){let t=this.maxConnectionAgeMs/10,s=Math.random()*t*2-t;u=null==(i=(r=setTimeout(()=>{var t,r;f=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+c);try{e.goaway(n.constants.NGHTTP2_NO_ERROR,0x7fffffff,Buffer.from("max_age"))}catch(t){e.destroy();return}e.close(),this.maxConnectionAgeGraceMs!==h&&(p=null==(r=(t=setTimeout(()=>{e.destroy()},this.maxConnectionAgeGraceMs)).unref)?void 0:r.call(t))},this.maxConnectionAgeMs+s)).unref)?void 0:i.call(r)}let m=null==(a=(s=setInterval(()=>{var t,r;let n=null==(r=(t=setTimeout(()=>{f=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+c),e.close()},this.keepaliveTimeoutMs)).unref)?void 0:r.call(t);try{e.ping((e,t,r)=>{clearTimeout(n)})}catch(t){e.destroy()}},this.keepaliveTimeMs)).unref)?void 0:a.call(s);e.on("close",()=>{this.channelzEnabled&&(f||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+c),this.sessionChildrenTracker.unrefChild(o),(0,d.unregisterChannelzRef)(o)),u&&clearTimeout(u),p&&clearTimeout(p),m&&clearTimeout(m),this.sessions.delete(e)})})}}async function T(e,t,r,n){try{let i=await e.receiveUnaryMessage(n);if(void 0===i||e.cancelled)return;let a=new s.ServerUnaryCallImpl(e,r,i);t.func(a,(t,r,n,i)=>{e.sendUnaryMessage(t,r,n,i)})}catch(t){e.sendError(t)}}function E(e,t,r,n){let i=new s.ServerReadableStreamImpl(e,r,t.deserialize,n);function a(t,r,n,s){i.destroy(),e.sendUnaryMessage(t,r,n,s)}e.cancelled||(i.on("error",a),t.func(i,a))}async function w(e,t,r,n){try{let i=await e.receiveUnaryMessage(n);if(void 0===i||e.cancelled)return;let a=new s.ServerWritableStreamImpl(e,r,t.serialize,i);t.func(a)}catch(t){e.sendError(t)}}function C(e,t,r,n){let i=new s.ServerDuplexStreamImpl(e,r,t.serialize,t.deserialize,n);e.cancelled||t.func(i)}t.Server=S},8344:e=>{"use strict";function t(e,r){"string"==typeof e&&(r=e,e=void 0);var n=[];function i(e){if("string"!=typeof e){var r=s();if(t.verbose&&console.log("codegen: "+r),r="return "+r,e){for(var a=Object.keys(e),o=Array(a.length+1),l=Array(a.length),c=0;c<a.length;)o[c]=a[c],l[c]=e[a[c++]];return o[c]=r,Function.apply(null,o).apply(null,l)}return Function(r)()}for(var u=Array(arguments.length-1),d=0;d<u.length;)u[d]=arguments[++d];if(d=0,e=e.replace(/%([%dfijs])/g,function(e,t){var r=u[d++];switch(t){case"d":case"f":return String(Number(r));case"i":return String(Math.floor(r));case"j":return JSON.stringify(r);case"s":return String(r)}return"%"}),d!==u.length)throw Error("parameter count mismatch");return n.push(e),i}function s(t){return"function "+(t||r||"")+"("+(e&&e.join(",")||"")+"){\n  "+n.join("\n  ")+"\n}"}return i.toString=s,i}e.exports=t,t.verbose=!1},8354:e=>{"use strict";e.exports=require("util")},8387:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringToSubchannelAddress=t.subchannelAddressToString=t.subchannelAddressEqual=t.isTcpSubchannelAddress=void 0;let n=r(1645);function i(e){return"port"in e}t.isTcpSubchannelAddress=i,t.subchannelAddressEqual=function(e,t){return!e&&!t||!!e&&!!t&&(i(e)?i(t)&&e.host===t.host&&e.port===t.port:!i(t)&&e.path===t.path)},t.subchannelAddressToString=function(e){return i(e)?e.host+":"+e.port:e.path};let s=443;t.stringToSubchannelAddress=function(e,t){return(0,n.isIP)(e)?{host:e,port:null!=t?t:s}:{path:e}}},8436:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InternalChannel=void 0;let n=r(6551),i=r(7748),s=r(561),a=r(757),o=r(3122),l=r(7988),c=r(948),u=r(8605),d=r(3038),h=r(7936),p=r(7213),f=r(920),m=r(7216),g=r(5950),y=r(4679),v=r(1421),b=r(6497),S=r(3908),T=r(4778),E=r(8880),w=0x7fffffff,C=1e3,_=18e5,I=new Map,x=0x1000000,k=1048576;class N extends E.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(e,r,n,i)=>{t.throttleKeepalive(i)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class R{constructor(e,t,r){var g,y,v,b,E,R,A,D;if(this.credentials=t,this.options=r,this.connectivityState=f.ConnectivityState.IDLE,this.currentPicker=new a.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new m.ChannelzCallTracker,this.childrenTracker=new m.ChannelzChildrenTracker,"string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof n.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(r&&"object"!=typeof r)throw TypeError("Channel options must be an object");this.originalTarget=e;let O=(0,p.parseUri)(e);if(null===O)throw Error(`Could not parse target name "${e}"`);let P=(0,u.mapUriDefaultScheme)(O);if(null===P)throw Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},w),null==(y=(g=this.callRefTimer).unref)||y.call(g),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new m.ChannelzTrace,this.channelzRef=(0,m.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,u.getDefaultAuthority)(P);let M=(0,h.mapProxyName)(P,r);this.target=M.target,this.options=Object.assign({},this.options,M.extraOptions),this.subchannelPool=(0,s.getSubchannelPool)((null!=(v=r["grpc.use_local_subchannel_pool"])?v:0)===0),this.retryBufferTracker=new T.MessageBufferTracker(null!=(b=r["grpc.retry_buffer_size"])?b:x,null!=(E=r["grpc.per_rpc_retry_buffer_size"])?E:k),this.keepaliveTime=null!=(R=r["grpc.keepalive_time_ms"])?R:-1,this.idleTimeoutMs=Math.max(null!=(A=r["grpc.client_idle_timeout_ms"])?A:_,C);let L={createSubchannel:(e,t)=>{let r=this.subchannelPool.getOrCreateSubchannel(this.target,e,Object.assign({},this.options,t),this.credentials);r.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",r.getChannelzRef());let n=new N(r,this);return this.wrappedSubchannels.add(n),n},updateState:(e,t)=>{this.currentPicker=t;let r=this.pickQueue.slice();for(let e of(this.pickQueue=[],r.length>0&&this.callRefTimerUnref(),r))e.doPick();this.updateState(e)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.refChild(e)},removeChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.unrefChild(e)}};this.resolvingLoadBalancer=new i.ResolvingLoadBalancer(this.target,L,r,(e,t)=>{e.retryThrottling?I.set(this.getTarget(),new T.RetryThrottler(e.retryThrottling.maxTokens,e.retryThrottling.tokenRatio,I.get(this.getTarget()))):I.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=t,this.currentResolutionError=null,process.nextTick(()=>{let e=this.configSelectionQueue;for(let t of(this.configSelectionQueue=[],e.length>0&&this.callRefTimerUnref(),e))t.getConfig()})},e=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+e.code+' and details "'+e.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,S.restrictControlPlaneStatusCode)(e.code,e.details)),{metadata:e.metadata}));let t=this.configSelectionQueue;for(let r of(this.configSelectionQueue=[],t.length>0&&this.callRefTimerUnref(),t))r.reportResolverError(e)}),this.filterStackFactory=new l.FilterStackFactory([new c.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let F=Error();(0,d.trace)(o.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null==(D=F.stack)?void 0:D.substring(F.stack.indexOf("\n")+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,d.trace)(null!=t?t:o.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,p.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,n;(null==(t=(e=this.callRefTimer).hasRef)?void 0:t.call(e))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(n=(r=this.callRefTimer).ref)||n.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null==(t=(e=this.callRefTimer).unref)||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(t=>t===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){for(let t of((0,d.trace)(o.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,p.uriToString)(this.target)+" "+f.ConnectivityState[this.connectivityState]+" -> "+f.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+f.ConnectivityState[e]),this.connectivityState=e,this.connectivityStateWatchers.slice()))e!==t.currentState&&(t.timer&&clearTimeout(t.timer),this.removeConnectivityStateWatcher(t),t.callback());e!==f.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime)for(let t of(this.keepaliveTime=e,this.wrappedSubchannels))t.throttleKeepalive(e)}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(f.ConnectivityState.IDLE),this.currentPicker=new a.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0)return void this.startIdleTimeout(this.idleTimeoutMs);let e=new Date().valueOf()-this.lastActivityTimestamp.valueOf();e>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-e)},e),null==(r=(t=this.idleTimer).unref)||r.call(t)}maybeStartIdleTimer(){this.connectivityState===f.ConnectivityState.SHUTDOWN||this.idleTimer||this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===o.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,n,i){let s=(0,b.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+s+'] method="'+t+'"'),new g.LoadBalancingCall(this,e,t,r,n,i,s)}createRetryingCall(e,t,r,n,i){let s=(0,b.getNextCallNumber)();return this.trace("createRetryingCall ["+s+'] method="'+t+'"'),new T.RetryingCall(this,e,t,r,n,i,s,this.retryBufferTracker,I.get(this.getTarget()))}createInnerCall(e,t,r,n,i){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(e,t,r,n,i):this.createRetryingCall(e,t,r,n,i)}createResolvingCall(e,t,r,n,i){let s=(0,b.getNextCallNumber)();this.trace("createResolvingCall ["+s+'] method="'+e+'", deadline='+(0,y.deadlineToString)(t));let a={deadline:t,flags:null!=i?i:o.Propagate.DEFAULTS,host:null!=r?r:this.defaultAuthority,parentCall:n},l=new v.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),s);return this.onCallStart(),l.addStatusWatcher(e=>{this.onCallEnd(e)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(f.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,m.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,p.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===f.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let n=null;if(t!==1/0){let e=t instanceof Date?t:new Date(t),s=new Date;if(t===-1/0||e<=s)return void process.nextTick(r,Error("Deadline passed without connectivity state change"));n=setTimeout(()=>{this.removeConnectivityStateWatcher(i),r(Error("Deadline passed without connectivity state change"))},e.getTime()-s.getTime())}let i={currentState:e,callback:r,timer:n};this.connectivityStateWatchers.push(i)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,n,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===f.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(e,t,r,n,i)}}t.InternalChannel=R},8474:(e,t,r)=>{"use strict";e.exports=r(6771)},8570:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.RoundRobinLoadBalancer=void 0;let n=r(598),i=r(920),s=r(757),a=r(8387),o=r(3038),l=r(3122),c="round_robin";function u(e){o.trace(l.LogVerbosity.DEBUG,c,e)}let d="round_robin";class h{getLoadBalancerName(){return d}constructor(){}toJsonObject(){return{[d]:{}}}static createFromJson(e){return new h}}class p{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:s.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class f{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=i.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(e,t,r,n,s)=>{this.calculateAndUpdateState(),(r===i.ConnectivityState.TRANSIENT_FAILURE||r===i.ConnectivityState.IDLE)&&(s&&(this.lastError=s),this.channelControlHelper.requestReresolution(),e.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(i.ConnectivityState.READY)>0){let e=this.subchannels.filter(e=>e.getConnectivityState()===i.ConnectivityState.READY),t=0;null!==this.currentReadyPicker&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(t=0),this.updateState(i.ConnectivityState.READY,new p(e,t))}else this.countSubchannelsWithState(i.ConnectivityState.CONNECTING)>0?this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this)):this.countSubchannelsWithState(i.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this))}updateState(e,t){u(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),e===i.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){for(let t of(this.resetSubchannelList(),u("Connect to address list "+e.map(e=>(0,a.subchannelAddressToString)(e))),this.subchannels=e.map(e=>this.channelControlHelper.createSubchannel(e,{})),this.subchannels)){t.ref(),t.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(t.getChannelzRef());let e=t.getConnectivityState();(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.TRANSIENT_FAILURE)&&t.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return d}}t.RoundRobinLoadBalancer=f,t.setup=function(){(0,n.registerLoadBalancerType)(d,f,h)}},8605:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapUriDefaultScheme=t.getDefaultAuthority=t.createResolver=t.registerDefaultScheme=t.registerResolver=void 0;let n=r(7213),i={},s=null;t.registerResolver=function(e,t){i[e]=t},t.registerDefaultScheme=function(e){s=e},t.createResolver=function(e,t,r){if(void 0!==e.scheme&&e.scheme in i)return new i[e.scheme](e,t,r);throw Error(`No resolver could be created for target ${(0,n.uriToString)(e)}`)},t.getDefaultAuthority=function(e){if(void 0!==e.scheme&&e.scheme in i)return i[e.scheme].getDefaultAuthority(e);throw Error(`Invalid target ${(0,n.uriToString)(e)}`)},t.mapUriDefaultScheme=function(e){if(void 0===e.scheme||!(e.scheme in i))if(null!==s)return{scheme:s,authority:void 0,path:(0,n.uriToString)(e)};else return null;return e}},8707:function(e,t,r){"use strict";var n=t;function i(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function s(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),r&&i(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}n.asPromise=r(5108),n.base64=r(2727),n.EventEmitter=r(4553),n.float=r(3127),n.inquire=r(9644),n.utf8=r(1996),n.pool=r(3273),n.LongBits=r(1156),n.isNode=!!("undefined"!=typeof global&&global&&global.process&&global.process.versions&&global.process.versions.node),n.global=n.isNode&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!!(null!=r&&e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=s,n.ProtocolError=s("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;if(!e){n._Buffer_from=n._Buffer_allocUnsafe=null;return}n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}}},8735:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.channelOptionsEqual=t.recognizedOptions=void 0,t.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},t.channelOptionsEqual=function(e,t){let r=Object.keys(e).sort(),n=Object.keys(t).sort();if(r.length!==n.length)return!1;for(let i=0;i<r.length;i+=1)if(r[i]!==n[i]||e[r[i]]!==t[n[i]])return!1;return!0}},8880:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseSubchannelWrapper=void 0;class r{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}}t.BaseSubchannelWrapper=r},8920:(e,t,r)=>{"use strict";e.exports=i;var n=r(8707);function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)this[t[r]]=e[t[r]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,n.toJSONOptions)}},9021:e=>{"use strict";e.exports=require("fs")},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9123:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientDuplexStreamImpl=t.ClientWritableStreamImpl=t.ClientReadableStreamImpl=t.ClientUnaryCallImpl=t.callErrorFromStatus=void 0;let n=r(4735),i=r(7910),s=r(3122);t.callErrorFromStatus=function(e,t){let r=`${e.code} ${s.Status[e.code]}: ${e.details}`,n=Error(r),i=`${n.stack}
for call at
${t}`;return Object.assign(Error(r),e,{stack:i})};class a extends n.EventEmitter{constructor(){super()}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}}t.ClientUnaryCallImpl=a;class o extends i.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_read(e){var t;null==(t=this.call)||t.startRead()}}t.ClientReadableStreamImpl=o;class l extends i.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_write(e,t,r){var n;let i={callback:r},s=Number(t);Number.isNaN(s)||(i.flags=s),null==(n=this.call)||n.sendMessageWithContext(i,e)}_final(e){var t;null==(t=this.call)||t.halfClose(),e()}}t.ClientWritableStreamImpl=l;class c extends i.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;null==(e=this.call)||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!=(t=null==(e=this.call)?void 0:e.getPeer())?t:"unknown"}_read(e){var t;null==(t=this.call)||t.startRead()}_write(e,t,r){var n;let i={callback:r},s=Number(t);Number.isNaN(s)||(i.flags=s),null==(n=this.call)||n.sendMessageWithContext(i,e)}_final(e){var t;null==(t=this.call)||t.halfClose(),e()}}t.ClientDuplexStreamImpl=c},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9374:(e,t,r)=>{"use strict";var n=e.exports=r(5477);function i(e,t,r){return"function"==typeof t?(r=t,t=new n.Root):t||(t=new n.Root),t.load(e,r)}function s(e,t){return t||(t=new n.Root),t.loadSync(e)}n.build="light",n.load=i,n.loadSync=s,n.encoder=r(847),n.decoder=r(2823),n.verifier=r(6973),n.converter=r(7659),n.ReflectionObject=r(4824),n.Namespace=r(7968),n.Root=r(2703),n.Enum=r(2110),n.Type=r(4351),n.Field=r(3267),n.OneOf=r(2630),n.MapField=r(5585),n.Service=r(3076),n.Method=r(1202),n.Message=r(8920),n.wrappers=r(3695),n.types=r(1810),n.util=r(3107),n.ReflectionObject._configure(n.Root),n.Namespace._configure(n.Type,n.Service,n.Enum),n.Root._configure(n.Type),n.Field._configure(n.Type)},9551:e=>{"use strict";e.exports=require("url")},9644:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},9771:e=>{"use strict";e.exports=require("process")},9780:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addAdminServicesToServer=t.registerAdminService=void 0;let r=[];t.registerAdminService=function(e,t){r.push({getServiceDefinition:e,getHandlers:t})},t.addAdminServicesToServer=function(e){for(let{getServiceDefinition:t,getHandlers:n}of r)e.addService(t(),n())}},9978:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;let n=r(3038),i=r(3122),s=r(2281),a=/^[0-9a-z_.-]+$/,o=/^[ -~]*$/;function l(e){return a.test(e)}function c(e){return o.test(e)}function u(e){return e.endsWith("-bin")}function d(e){return!e.startsWith("grpc-")}function h(e){return e.toLowerCase()}function p(e,t){if(!l(e))throw Error('Metadata key "'+e+'" contains illegal characters');if(null!=t)if(u(e)){if(!Buffer.isBuffer(t))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(t))throw Error("keys that don't end with '-bin' must have String values");if(!c(t))throw Error('Metadata string value "'+t+'" contains illegal characters')}}class f{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){p(e=h(e),t),this.internalRepr.set(e,[t])}add(e,t){p(e=h(e),t);let r=this.internalRepr.get(e);void 0===r?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=h(e),this.internalRepr.delete(e)}get(e){return e=h(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let n=r[0];e[t]=Buffer.isBuffer(n)?Buffer.from(n):n}return e}clone(){let e=new f(this.options),t=e.internalRepr;for(let[e,r]of this.internalRepr){let n=r.map(e=>Buffer.isBuffer(e)?Buffer.from(e):e);t.set(e,n)}return e}merge(e){for(let[t,r]of e.internalRepr){let e=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,e)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(m);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new f;for(let r of Object.keys(e)){if(":"===r.charAt(0))continue;let a=e[r];try{u(r)?Array.isArray(a)?a.forEach(e=>{t.add(r,Buffer.from(e,"base64"))}):void 0!==a&&(d(r)?a.split(",").forEach(e=>{t.add(r,Buffer.from(e.trim(),"base64"))}):t.add(r,Buffer.from(a,"base64"))):Array.isArray(a)?a.forEach(e=>{t.add(r,e)}):void 0!==a&&t.add(r,a)}catch(t){let e=`Failed to add metadata entry ${r}: ${a}. ${(0,s.getErrorMessage)(t)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,n.log)(i.LogVerbosity.ERROR,e)}}return t}}t.Metadata=f;let m=e=>Buffer.isBuffer(e)?e.toString("base64"):e}};var __webpack_require__=require("../webpack-runtime.js");__webpack_require__.C(exports);var __webpack_exec__=e=>__webpack_require__(__webpack_require__.s=e),__webpack_exports__=__webpack_require__.X(0,[825],()=>__webpack_exec__(5251));module.exports=__webpack_exports__})();